/*! For license information please see main.e9fe84d8.js.LICENSE.txt */
(()=>{"use strict";var e={85:(e,t,n)=>{var r=n(340),o=n(950),a=n(119);function i(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function l(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function c(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function u(e){if(31===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function d(e){if(l(e)!==e)throw Error(i(188))}function h(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e;for(e=e.child;null!==e;){if(null!==(t=h(e)))return t;e=e.sibling}return null}var g=Object.assign,m=Symbol.for("react.element"),f=Symbol.for("react.transitional.element"),p=Symbol.for("react.portal"),y=Symbol.for("react.fragment"),v=Symbol.for("react.strict_mode"),b=Symbol.for("react.profiler"),w=Symbol.for("react.consumer"),k=Symbol.for("react.context"),S=Symbol.for("react.forward_ref"),x=Symbol.for("react.suspense"),C=Symbol.for("react.suspense_list"),A=Symbol.for("react.memo"),I=Symbol.for("react.lazy");Symbol.for("react.scope");var T=Symbol.for("react.activity");Symbol.for("react.legacy_hidden"),Symbol.for("react.tracing_marker");var P=Symbol.for("react.memo_cache_sentinel");Symbol.for("react.view_transition");var E=Symbol.iterator;function N(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=E&&e[E]||e["@@iterator"])?e:null}var _=Symbol.for("react.client.reference");function M(e){if(null==e)return null;if("function"===typeof e)return e.$$typeof===_?null:e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case y:return"Fragment";case b:return"Profiler";case v:return"StrictMode";case x:return"Suspense";case C:return"SuspenseList";case T:return"Activity"}if("object"===typeof e)switch(e.$$typeof){case p:return"Portal";case k:return e.displayName||"Context";case w:return(e._context.displayName||"Context")+".Consumer";case S:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case A:return null!==(t=e.displayName||null)?t:M(e.type)||"Memo";case I:t=e._payload,e=e._init;try{return M(e(t))}catch(n){}}return null}var R=Array.isArray,O=o.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,j=a.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,D={pending:!1,data:null,method:null,action:null},L=[],F=-1;function q(e){return{current:e}}function z(e){0>F||(e.current=L[F],L[F]=null,F--)}function U(e,t){F++,L[F]=e.current,e.current=t}var H,B,W=q(null),K=q(null),V=q(null),G=q(null);function Q(e,t){switch(U(V,t),U(K,e),U(W,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?yd(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)e=vd(t=yd(t),e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}z(W),U(W,e)}function Y(){z(W),z(K),z(V)}function J(e){null!==e.memoizedState&&U(G,e);var t=W.current,n=vd(t,e.type);t!==n&&(U(K,e),U(W,n))}function $(e){K.current===e&&(z(W),z(K)),G.current===e&&(z(G),uh._currentValue=D)}function X(e){if(void 0===H)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);H=t&&t[1]||"",B=-1<n.stack.indexOf("\n    at")?" (<anonymous>)":-1<n.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+H+e+B}var Z=!1;function ee(e,t){if(!e||Z)return"";Z=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var r={DetermineComponentFrameRoot:function(){try{if(t){var n=function(){throw Error()};if(Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(n,[])}catch(o){var r=o}Reflect.construct(e,[],n)}else{try{n.call()}catch(a){r=a}e.call(n.prototype)}}else{try{throw Error()}catch(i){r=i}(n=e())&&"function"===typeof n.catch&&n.catch(function(){})}}catch(s){if(s&&r&&"string"===typeof s.stack)return[s.stack,r.stack]}return[null,null]}};r.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var o=Object.getOwnPropertyDescriptor(r.DetermineComponentFrameRoot,"name");o&&o.configurable&&Object.defineProperty(r.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var a=r.DetermineComponentFrameRoot(),i=a[0],s=a[1];if(i&&s){var l=i.split("\n"),c=s.split("\n");for(o=r=0;r<l.length&&!l[r].includes("DetermineComponentFrameRoot");)r++;for(;o<c.length&&!c[o].includes("DetermineComponentFrameRoot");)o++;if(r===l.length||o===c.length)for(r=l.length-1,o=c.length-1;1<=r&&0<=o&&l[r]!==c[o];)o--;for(;1<=r&&0<=o;r--,o--)if(l[r]!==c[o]){if(1!==r||1!==o)do{if(r--,0>--o||l[r]!==c[o]){var u="\n"+l[r].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=r&&0<=o);break}}}finally{Z=!1,Error.prepareStackTrace=n}return(n=e?e.displayName||e.name:"")?X(n):""}function te(e,t){switch(e.tag){case 26:case 27:case 5:return X(e.type);case 16:return X("Lazy");case 13:return e.child!==t&&null!==t?X("Suspense Fallback"):X("Suspense");case 19:return X("SuspenseList");case 0:case 15:return ee(e.type,!1);case 11:return ee(e.type.render,!1);case 1:return ee(e.type,!0);case 31:return X("Activity");default:return""}}function ne(e){try{var t="",n=null;do{t+=te(e,n),n=e,e=e.return}while(e);return t}catch(r){return"\nError generating stack: "+r.message+"\n"+r.stack}}var re=Object.prototype.hasOwnProperty,oe=r.unstable_scheduleCallback,ae=r.unstable_cancelCallback,ie=r.unstable_shouldYield,se=r.unstable_requestPaint,le=r.unstable_now,ce=r.unstable_getCurrentPriorityLevel,ue=r.unstable_ImmediatePriority,de=r.unstable_UserBlockingPriority,he=r.unstable_NormalPriority,ge=r.unstable_LowPriority,me=r.unstable_IdlePriority,fe=r.log,pe=r.unstable_setDisableYieldValue,ye=null,ve=null;function be(e){if("function"===typeof fe&&pe(e),ve&&"function"===typeof ve.setStrictMode)try{ve.setStrictMode(ye,e)}catch(t){}}var we=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(ke(e)/Se|0)|0},ke=Math.log,Se=Math.LN2;var xe=256,Ce=262144,Ae=4194304;function Ie(e){var t=42&e;if(0!==t)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return 261888&e;case 262144:case 524288:case 1048576:case 2097152:return 3932160&e;case 4194304:case 8388608:case 16777216:case 33554432:return 62914560&e;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function Te(e,t,n){var r=e.pendingLanes;if(0===r)return 0;var o=0,a=e.suspendedLanes,i=e.pingedLanes;e=e.warmLanes;var s=134217727&r;return 0!==s?0!==(r=s&~a)?o=Ie(r):0!==(i&=s)?o=Ie(i):n||0!==(n=s&~e)&&(o=Ie(n)):0!==(s=r&~a)?o=Ie(s):0!==i?o=Ie(i):n||0!==(n=r&~e)&&(o=Ie(n)),0===o?0:0!==t&&t!==o&&0===(t&a)&&((a=o&-o)>=(n=t&-t)||32===a&&0!==(4194048&n))?t:o}function Pe(e,t){return 0===(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)}function Ee(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function Ne(){var e=Ae;return 0===(62914560&(Ae<<=1))&&(Ae=4194304),e}function _e(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Me(e,t){e.pendingLanes|=t,268435456!==t&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Re(e,t,n){e.pendingLanes|=t,e.suspendedLanes&=~t;var r=31-we(t);e.entangledLanes|=t,e.entanglements[r]=1073741824|e.entanglements[r]|261930&n}function Oe(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-we(n),o=1<<r;o&t|e[r]&t&&(e[r]|=t),n&=~o}}function je(e,t){var n=t&-t;return 0!==((n=0!==(42&n)?1:De(n))&(e.suspendedLanes|t))?0:n}function De(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function Le(e){return 2<(e&=-e)?8<e?0!==(134217727&e)?32:268435456:8:2}function Fe(){var e=j.p;return 0!==e?e:void 0===(e=window.event)?32:Ih(e.type)}function qe(e,t){var n=j.p;try{return j.p=e,t()}finally{j.p=n}}var ze=Math.random().toString(36).slice(2),Ue="__reactFiber$"+ze,He="__reactProps$"+ze,Be="__reactContainer$"+ze,We="__reactEvents$"+ze,Ke="__reactListeners$"+ze,Ve="__reactHandles$"+ze,Ge="__reactResources$"+ze,Qe="__reactMarker$"+ze;function Ye(e){delete e[Ue],delete e[He],delete e[We],delete e[Ke],delete e[Ve]}function Je(e){var t=e[Ue];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Be]||n[Ue]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=Dd(e);null!==e;){if(n=e[Ue])return n;e=Dd(e)}return t}n=(e=n).parentNode}return null}function $e(e){if(e=e[Ue]||e[Be]){var t=e.tag;if(5===t||6===t||13===t||31===t||26===t||27===t||3===t)return e}return null}function Xe(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e.stateNode;throw Error(i(33))}function Ze(e){var t=e[Ge];return t||(t=e[Ge]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function et(e){e[Qe]=!0}var tt=new Set,nt={};function rt(e,t){ot(e,t),ot(e+"Capture",t)}function ot(e,t){for(nt[e]=t,e=0;e<t.length;e++)tt.add(t[e])}var at=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),it={},st={};function lt(e,t,n){if(o=t,re.call(st,o)||!re.call(it,o)&&(at.test(o)?st[o]=!0:(it[o]=!0,0)))if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":return void e.removeAttribute(t);case"boolean":var r=t.toLowerCase().slice(0,5);if("data-"!==r&&"aria-"!==r)return void e.removeAttribute(t)}e.setAttribute(t,""+n)}var o}function ct(e,t,n){if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(t)}e.setAttribute(t,""+n)}}function ut(e,t,n,r){if(null===r)e.removeAttribute(n);else{switch(typeof r){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(n)}e.setAttributeNS(t,n,""+r)}}function dt(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function ht(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function gt(e){if(!e._valueTracker){var t=ht(e)?"checked":"value";e._valueTracker=function(e,t,n){var r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t);if(!e.hasOwnProperty(t)&&"undefined"!==typeof r&&"function"===typeof r.get&&"function"===typeof r.set){var o=r.get,a=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return o.call(this)},set:function(e){n=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(e){n=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e,t,""+e[t])}}function mt(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=ht(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function ft(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}var pt=/[\n"\\]/g;function yt(e){return e.replace(pt,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function vt(e,t,n,r,o,a,i,s){e.name="",null!=i&&"function"!==typeof i&&"symbol"!==typeof i&&"boolean"!==typeof i?e.type=i:e.removeAttribute("type"),null!=t?"number"===i?(0===t&&""===e.value||e.value!=t)&&(e.value=""+dt(t)):e.value!==""+dt(t)&&(e.value=""+dt(t)):"submit"!==i&&"reset"!==i||e.removeAttribute("value"),null!=t?wt(e,i,dt(t)):null!=n?wt(e,i,dt(n)):null!=r&&e.removeAttribute("value"),null==o&&null!=a&&(e.defaultChecked=!!a),null!=o&&(e.checked=o&&"function"!==typeof o&&"symbol"!==typeof o),null!=s&&"function"!==typeof s&&"symbol"!==typeof s&&"boolean"!==typeof s?e.name=""+dt(s):e.removeAttribute("name")}function bt(e,t,n,r,o,a,i,s){if(null!=a&&"function"!==typeof a&&"symbol"!==typeof a&&"boolean"!==typeof a&&(e.type=a),null!=t||null!=n){if(!("submit"!==a&&"reset"!==a||void 0!==t&&null!==t))return void gt(e);n=null!=n?""+dt(n):"",t=null!=t?""+dt(t):n,s||t===e.value||(e.value=t),e.defaultValue=t}r="function"!==typeof(r=null!=r?r:o)&&"symbol"!==typeof r&&!!r,e.checked=s?e.checked:!!r,e.defaultChecked=!!r,null!=i&&"function"!==typeof i&&"symbol"!==typeof i&&"boolean"!==typeof i&&(e.name=i),gt(e)}function wt(e,t,n){"number"===t&&ft(e.ownerDocument)===e||e.defaultValue===""+n||(e.defaultValue=""+n)}function kt(e,t,n,r){if(e=e.options,t){t={};for(var o=0;o<n.length;o++)t["$"+n[o]]=!0;for(n=0;n<e.length;n++)o=t.hasOwnProperty("$"+e[n].value),e[n].selected!==o&&(e[n].selected=o),o&&r&&(e[n].defaultSelected=!0)}else{for(n=""+dt(n),t=null,o=0;o<e.length;o++){if(e[o].value===n)return e[o].selected=!0,void(r&&(e[o].defaultSelected=!0));null!==t||e[o].disabled||(t=e[o])}null!==t&&(t.selected=!0)}}function St(e,t,n){null==t||((t=""+dt(t))!==e.value&&(e.value=t),null!=n)?e.defaultValue=null!=n?""+dt(n):"":e.defaultValue!==t&&(e.defaultValue=t)}function xt(e,t,n,r){if(null==t){if(null!=r){if(null!=n)throw Error(i(92));if(R(r)){if(1<r.length)throw Error(i(93));r=r[0]}n=r}null==n&&(n=""),t=n}n=dt(t),e.defaultValue=n,(r=e.textContent)===n&&""!==r&&null!==r&&(e.value=r),gt(e)}function Ct(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var At=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function It(e,t,n){var r=0===t.indexOf("--");null==n||"boolean"===typeof n||""===n?r?e.setProperty(t,""):"float"===t?e.cssFloat="":e[t]="":r?e.setProperty(t,n):"number"!==typeof n||0===n||At.has(t)?"float"===t?e.cssFloat=n:e[t]=(""+n).trim():e[t]=n+"px"}function Tt(e,t,n){if(null!=t&&"object"!==typeof t)throw Error(i(62));if(e=e.style,null!=n){for(var r in n)!n.hasOwnProperty(r)||null!=t&&t.hasOwnProperty(r)||(0===r.indexOf("--")?e.setProperty(r,""):"float"===r?e.cssFloat="":e[r]="");for(var o in t)r=t[o],t.hasOwnProperty(o)&&n[o]!==r&&It(e,o,r)}else for(var a in t)t.hasOwnProperty(a)&&It(e,a,t[a])}function Pt(e){if(-1===e.indexOf("-"))return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Et=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Nt=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function _t(e){return Nt.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function Mt(){}var Rt=null;function Ot(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var jt=null,Dt=null;function Lt(e){var t=$e(e);if(t&&(e=t.stateNode)){var n=e[He]||null;e:switch(e=t.stateNode,t.type){case"input":if(vt(e,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll('input[name="'+yt(""+t)+'"][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var o=r[He]||null;if(!o)throw Error(i(90));vt(r,o.value,o.defaultValue,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name)}}for(t=0;t<n.length;t++)(r=n[t]).form===e.form&&mt(r)}break e;case"textarea":St(e,n.value,n.defaultValue);break e;case"select":null!=(t=n.value)&&kt(e,!!n.multiple,t,!1)}}}var Ft=!1;function qt(e,t,n){if(Ft)return e(t,n);Ft=!0;try{return e(t)}finally{if(Ft=!1,(null!==jt||null!==Dt)&&(Zc(),jt&&(t=jt,e=Dt,Dt=jt=null,Lt(t),e)))for(t=0;t<e.length;t++)Lt(e[t])}}function zt(e,t){var n=e.stateNode;if(null===n)return null;var r=n[He]||null;if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(i(231,t,typeof n));return n}var Ut=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),Ht=!1;if(Ut)try{var Bt={};Object.defineProperty(Bt,"passive",{get:function(){Ht=!0}}),window.addEventListener("test",Bt,Bt),window.removeEventListener("test",Bt,Bt)}catch($h){Ht=!1}var Wt=null,Kt=null,Vt=null;function Gt(){if(Vt)return Vt;var e,t,n=Kt,r=n.length,o="value"in Wt?Wt.value:Wt.textContent,a=o.length;for(e=0;e<r&&n[e]===o[e];e++);var i=r-e;for(t=1;t<=i&&n[r-t]===o[a-t];t++);return Vt=o.slice(e,1<t?1-t:void 0)}function Qt(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function Yt(){return!0}function Jt(){return!1}function $t(e){function t(t,n,r,o,a){for(var i in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=o,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(i)&&(t=e[i],this[i]=t?t(o):o[i]);return this.isDefaultPrevented=(null!=o.defaultPrevented?o.defaultPrevented:!1===o.returnValue)?Yt:Jt,this.isPropagationStopped=Jt,this}return g(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=Yt)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=Yt)},persist:function(){},isPersistent:Yt}),t}var Xt,Zt,en,tn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},nn=$t(tn),rn=g({},tn,{view:0,detail:0}),on=$t(rn),an=g({},rn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:yn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==en&&(en&&"mousemove"===e.type?(Xt=e.screenX-en.screenX,Zt=e.screenY-en.screenY):Zt=Xt=0,en=e),Xt)},movementY:function(e){return"movementY"in e?e.movementY:Zt}}),sn=$t(an),ln=$t(g({},an,{dataTransfer:0})),cn=$t(g({},rn,{relatedTarget:0})),un=$t(g({},tn,{animationName:0,elapsedTime:0,pseudoElement:0})),dn=$t(g({},tn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),hn=$t(g({},tn,{data:0})),gn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},mn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},fn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function pn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=fn[e])&&!!t[e]}function yn(){return pn}var vn=$t(g({},rn,{key:function(e){if(e.key){var t=gn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=Qt(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?mn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:yn,charCode:function(e){return"keypress"===e.type?Qt(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?Qt(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),bn=$t(g({},an,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),wn=$t(g({},rn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:yn})),kn=$t(g({},tn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Sn=$t(g({},an,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),xn=$t(g({},tn,{newState:0,oldState:0})),Cn=[9,13,27,32],An=Ut&&"CompositionEvent"in window,In=null;Ut&&"documentMode"in document&&(In=document.documentMode);var Tn=Ut&&"TextEvent"in window&&!In,Pn=Ut&&(!An||In&&8<In&&11>=In),En=String.fromCharCode(32),Nn=!1;function _n(e,t){switch(e){case"keyup":return-1!==Cn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Mn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Rn=!1;var On={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function jn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!On[e.type]:"textarea"===t}function Dn(e,t,n,r){jt?Dt?Dt.push(r):Dt=[r]:jt=r,0<(t=rd(t,"onChange")).length&&(n=new nn("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Ln=null,Fn=null;function qn(e){Yu(e,0)}function zn(e){if(mt(Xe(e)))return e}function Un(e,t){if("change"===e)return t}var Hn=!1;if(Ut){var Bn;if(Ut){var Wn="oninput"in document;if(!Wn){var Kn=document.createElement("div");Kn.setAttribute("oninput","return;"),Wn="function"===typeof Kn.oninput}Bn=Wn}else Bn=!1;Hn=Bn&&(!document.documentMode||9<document.documentMode)}function Vn(){Ln&&(Ln.detachEvent("onpropertychange",Gn),Fn=Ln=null)}function Gn(e){if("value"===e.propertyName&&zn(Fn)){var t=[];Dn(t,Fn,e,Ot(e)),qt(qn,t)}}function Qn(e,t,n){"focusin"===e?(Vn(),Fn=n,(Ln=t).attachEvent("onpropertychange",Gn)):"focusout"===e&&Vn()}function Yn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return zn(Fn)}function Jn(e,t){if("click"===e)return zn(t)}function $n(e,t){if("input"===e||"change"===e)return zn(t)}var Xn="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function Zn(e,t){if(Xn(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var o=n[r];if(!re.call(t,o)||!Xn(e[o],t[o]))return!1}return!0}function er(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function tr(e,t){var n,r=er(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=er(r)}}function nr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?nr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function rr(e){for(var t=ft((e=null!=e&&null!=e.ownerDocument&&null!=e.ownerDocument.defaultView?e.ownerDocument.defaultView:window).document);t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=ft((e=t.contentWindow).document)}return t}function or(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var ar=Ut&&"documentMode"in document&&11>=document.documentMode,ir=null,sr=null,lr=null,cr=!1;function ur(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;cr||null==ir||ir!==ft(r)||("selectionStart"in(r=ir)&&or(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},lr&&Zn(lr,r)||(lr=r,0<(r=rd(sr,"onSelect")).length&&(t=new nn("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=ir)))}function dr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var hr={animationend:dr("Animation","AnimationEnd"),animationiteration:dr("Animation","AnimationIteration"),animationstart:dr("Animation","AnimationStart"),transitionrun:dr("Transition","TransitionRun"),transitionstart:dr("Transition","TransitionStart"),transitioncancel:dr("Transition","TransitionCancel"),transitionend:dr("Transition","TransitionEnd")},gr={},mr={};function fr(e){if(gr[e])return gr[e];if(!hr[e])return e;var t,n=hr[e];for(t in n)if(n.hasOwnProperty(t)&&t in mr)return gr[e]=n[t];return e}Ut&&(mr=document.createElement("div").style,"AnimationEvent"in window||(delete hr.animationend.animation,delete hr.animationiteration.animation,delete hr.animationstart.animation),"TransitionEvent"in window||delete hr.transitionend.transition);var pr=fr("animationend"),yr=fr("animationiteration"),vr=fr("animationstart"),br=fr("transitionrun"),wr=fr("transitionstart"),kr=fr("transitioncancel"),Sr=fr("transitionend"),xr=new Map,Cr="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ar(e,t){xr.set(e,t),rt(t,[e])}Cr.push("scrollEnd");var Ir="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)},Tr=[],Pr=0,Er=0;function Nr(){for(var e=Pr,t=Er=Pr=0;t<e;){var n=Tr[t];Tr[t++]=null;var r=Tr[t];Tr[t++]=null;var o=Tr[t];Tr[t++]=null;var a=Tr[t];if(Tr[t++]=null,null!==r&&null!==o){var i=r.pending;null===i?o.next=o:(o.next=i.next,i.next=o),r.pending=o}0!==a&&Or(n,o,a)}}function _r(e,t,n,r){Tr[Pr++]=e,Tr[Pr++]=t,Tr[Pr++]=n,Tr[Pr++]=r,Er|=r,e.lanes|=r,null!==(e=e.alternate)&&(e.lanes|=r)}function Mr(e,t,n,r){return _r(e,t,n,r),jr(e)}function Rr(e,t){return _r(e,null,null,t),jr(e)}function Or(e,t,n){e.lanes|=n;var r=e.alternate;null!==r&&(r.lanes|=n);for(var o=!1,a=e.return;null!==a;)a.childLanes|=n,null!==(r=a.alternate)&&(r.childLanes|=n),22===a.tag&&(null===(e=a.stateNode)||1&e._visibility||(o=!0)),e=a,a=a.return;return 3===e.tag?(a=e.stateNode,o&&null!==t&&(o=31-we(n),null===(r=(e=a.hiddenUpdates)[o])?e[o]=[t]:r.push(t),t.lane=536870912|n),a):null}function jr(e){if(50<Wc)throw Wc=0,Kc=null,Error(i(185));for(var t=e.return;null!==t;)t=(e=t).return;return 3===e.tag?e.stateNode:null}var Dr={};function Lr(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Fr(e,t,n,r){return new Lr(e,t,n,r)}function qr(e){return!(!(e=e.prototype)||!e.isReactComponent)}function zr(e,t){var n=e.alternate;return null===n?((n=Fr(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=65011712&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n.refCleanup=e.refCleanup,n}function Ur(e,t){e.flags&=65011714;var n=e.alternate;return null===n?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=n.childLanes,e.lanes=n.lanes,e.child=n.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=n.memoizedProps,e.memoizedState=n.memoizedState,e.updateQueue=n.updateQueue,e.type=n.type,t=n.dependencies,e.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function Hr(e,t,n,r,o,a){var s=0;if(r=e,"function"===typeof e)qr(e)&&(s=1);else if("string"===typeof e)s=function(e,t,n){if(1===n||null!=t.itemProp)return!1;switch(e){case"meta":case"title":return!0;case"style":if("string"!==typeof t.precedence||"string"!==typeof t.href||""===t.href)break;return!0;case"link":if("string"!==typeof t.rel||"string"!==typeof t.href||""===t.href||t.onLoad||t.onError)break;return"stylesheet"!==t.rel||(e=t.disabled,"string"===typeof t.precedence&&null==e);case"script":if(t.async&&"function"!==typeof t.async&&"symbol"!==typeof t.async&&!t.onLoad&&!t.onError&&t.src&&"string"===typeof t.src)return!0}return!1}(e,n,W.current)?26:"html"===e||"head"===e||"body"===e?27:5;else e:switch(e){case T:return(e=Fr(31,n,t,o)).elementType=T,e.lanes=a,e;case y:return Br(n.children,o,a,t);case v:s=8,o|=24;break;case b:return(e=Fr(12,n,t,2|o)).elementType=b,e.lanes=a,e;case x:return(e=Fr(13,n,t,o)).elementType=x,e.lanes=a,e;case C:return(e=Fr(19,n,t,o)).elementType=C,e.lanes=a,e;default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case k:s=10;break e;case w:s=9;break e;case S:s=11;break e;case A:s=14;break e;case I:s=16,r=null;break e}s=29,n=Error(i(130,null===e?"null":typeof e,"")),r=null}return(t=Fr(s,n,t,o)).elementType=e,t.type=r,t.lanes=a,t}function Br(e,t,n,r){return(e=Fr(7,e,r,t)).lanes=n,e}function Wr(e,t,n){return(e=Fr(6,e,null,t)).lanes=n,e}function Kr(e){var t=Fr(18,null,null,0);return t.stateNode=e,t}function Vr(e,t,n){return(t=Fr(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var Gr=new WeakMap;function Qr(e,t){if("object"===typeof e&&null!==e){var n=Gr.get(e);return void 0!==n?n:(t={value:e,source:t,stack:ne(t)},Gr.set(e,t),t)}return{value:e,source:t,stack:ne(t)}}var Yr=[],Jr=0,$r=null,Xr=0,Zr=[],eo=0,to=null,no=1,ro="";function oo(e,t){Yr[Jr++]=Xr,Yr[Jr++]=$r,$r=e,Xr=t}function ao(e,t,n){Zr[eo++]=no,Zr[eo++]=ro,Zr[eo++]=to,to=e;var r=no;e=ro;var o=32-we(r)-1;r&=~(1<<o),n+=1;var a=32-we(t)+o;if(30<a){var i=o-o%5;a=(r&(1<<i)-1).toString(32),r>>=i,o-=i,no=1<<32-we(t)+o|n<<o|r,ro=a+e}else no=1<<a|n<<o|r,ro=e}function io(e){null!==e.return&&(oo(e,1),ao(e,1,0))}function so(e){for(;e===$r;)$r=Yr[--Jr],Yr[Jr]=null,Xr=Yr[--Jr],Yr[Jr]=null;for(;e===to;)to=Zr[--eo],Zr[eo]=null,ro=Zr[--eo],Zr[eo]=null,no=Zr[--eo],Zr[eo]=null}function lo(e,t){Zr[eo++]=no,Zr[eo++]=ro,Zr[eo++]=to,no=t.id,ro=t.overflow,to=e}var co=null,uo=null,ho=!1,go=null,mo=!1,fo=Error(i(519));function po(e){throw So(Qr(Error(i(418,1<arguments.length&&void 0!==arguments[1]&&arguments[1]?"text":"HTML","")),e)),fo}function yo(e){var t=e.stateNode,n=e.type,r=e.memoizedProps;switch(t[Ue]=e,t[He]=r,n){case"dialog":Ju("cancel",t),Ju("close",t);break;case"iframe":case"object":case"embed":Ju("load",t);break;case"video":case"audio":for(n=0;n<Gu.length;n++)Ju(Gu[n],t);break;case"source":Ju("error",t);break;case"img":case"image":case"link":Ju("error",t),Ju("load",t);break;case"details":Ju("toggle",t);break;case"input":Ju("invalid",t),bt(t,r.value,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name,!0);break;case"select":Ju("invalid",t);break;case"textarea":Ju("invalid",t),xt(t,r.value,r.defaultValue,r.children)}"string"!==typeof(n=r.children)&&"number"!==typeof n&&"bigint"!==typeof n||t.textContent===""+n||!0===r.suppressHydrationWarning||cd(t.textContent,n)?(null!=r.popover&&(Ju("beforetoggle",t),Ju("toggle",t)),null!=r.onScroll&&Ju("scroll",t),null!=r.onScrollEnd&&Ju("scrollend",t),null!=r.onClick&&(t.onclick=Mt),t=!0):t=!1,t||po(e,!0)}function vo(e){for(co=e.return;co;)switch(co.tag){case 5:case 31:case 13:return void(mo=!1);case 27:case 3:return void(mo=!0);default:co=co.return}}function bo(e){if(e!==co)return!1;if(!ho)return vo(e),ho=!0,!1;var t,n=e.tag;if((t=3!==n&&27!==n)&&((t=5===n)&&(t=!("form"!==(t=e.type)&&"button"!==t)||bd(e.type,e.memoizedProps)),t=!t),t&&uo&&po(e),vo(e),13===n){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(i(317));uo=jd(e)}else if(31===n){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(i(317));uo=jd(e)}else 27===n?(n=uo,Id(e.type)?(e=Od,Od=null,uo=e):uo=n):uo=co?Rd(e.stateNode.nextSibling):null;return!0}function wo(){uo=co=null,ho=!1}function ko(){var e=go;return null!==e&&(null===Nc?Nc=e:Nc.push.apply(Nc,e),go=null),e}function So(e){null===go?go=[e]:go.push(e)}var xo=q(null),Co=null,Ao=null;function Io(e,t,n){U(xo,t._currentValue),t._currentValue=n}function To(e){e._currentValue=xo.current,z(xo)}function Po(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Eo(e,t,n,r){var o=e.child;for(null!==o&&(o.return=e);null!==o;){var a=o.dependencies;if(null!==a){var s=o.child;a=a.firstContext;e:for(;null!==a;){var l=a;a=o;for(var c=0;c<t.length;c++)if(l.context===t[c]){a.lanes|=n,null!==(l=a.alternate)&&(l.lanes|=n),Po(a.return,n,e),r||(s=null);break e}a=l.next}}else if(18===o.tag){if(null===(s=o.return))throw Error(i(341));s.lanes|=n,null!==(a=s.alternate)&&(a.lanes|=n),Po(s,n,e),s=null}else s=o.child;if(null!==s)s.return=o;else for(s=o;null!==s;){if(s===e){s=null;break}if(null!==(o=s.sibling)){o.return=s.return,s=o;break}s=s.return}o=s}}function No(e,t,n,r){e=null;for(var o=t,a=!1;null!==o;){if(!a)if(0!==(524288&o.flags))a=!0;else if(0!==(262144&o.flags))break;if(10===o.tag){var s=o.alternate;if(null===s)throw Error(i(387));if(null!==(s=s.memoizedProps)){var l=o.type;Xn(o.pendingProps.value,s.value)||(null!==e?e.push(l):e=[l])}}else if(o===G.current){if(null===(s=o.alternate))throw Error(i(387));s.memoizedState.memoizedState!==o.memoizedState.memoizedState&&(null!==e?e.push(uh):e=[uh])}o=o.return}null!==e&&Eo(t,e,n,r),t.flags|=262144}function _o(e){for(e=e.firstContext;null!==e;){if(!Xn(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Mo(e){Co=e,Ao=null,null!==(e=e.dependencies)&&(e.firstContext=null)}function Ro(e){return jo(Co,e)}function Oo(e,t){return null===Co&&Mo(e),jo(e,t)}function jo(e,t){var n=t._currentValue;if(t={context:t,memoizedValue:n,next:null},null===Ao){if(null===e)throw Error(i(308));Ao=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else Ao=Ao.next=t;return n}var Do="undefined"!==typeof AbortController?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,n){e.push(n)}};this.abort=function(){t.aborted=!0,e.forEach(function(e){return e()})}},Lo=r.unstable_scheduleCallback,Fo=r.unstable_NormalPriority,qo={$$typeof:k,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function zo(){return{controller:new Do,data:new Map,refCount:0}}function Uo(e){e.refCount--,0===e.refCount&&Lo(Fo,function(){e.controller.abort()})}var Ho=null,Bo=0,Wo=0,Ko=null;function Vo(){if(0===--Bo&&null!==Ho){null!==Ko&&(Ko.status="fulfilled");var e=Ho;Ho=null,Wo=0,Ko=null;for(var t=0;t<e.length;t++)(0,e[t])()}}var Go=O.S;O.S=function(e,t){Rc=le(),"object"===typeof t&&null!==t&&"function"===typeof t.then&&function(e,t){if(null===Ho){var n=Ho=[];Bo=0,Wo=Hu(),Ko={status:"pending",value:void 0,then:function(e){n.push(e)}}}Bo++,t.then(Vo,Vo)}(0,t),null!==Go&&Go(e,t)};var Qo=q(null);function Yo(){var e=Qo.current;return null!==e?e:mc.pooledCache}function Jo(e,t){U(Qo,null===t?Qo.current:t.pool)}function $o(){var e=Yo();return null===e?null:{parent:qo._currentValue,pool:e}}var Xo=Error(i(460)),Zo=Error(i(474)),ea=Error(i(542)),ta={then:function(){}};function na(e){return"fulfilled"===(e=e.status)||"rejected"===e}function ra(e,t,n){switch(void 0===(n=e[n])?e.push(t):n!==t&&(t.then(Mt,Mt),t=n),t.status){case"fulfilled":return t.value;case"rejected":throw sa(e=t.reason),e;default:if("string"===typeof t.status)t.then(Mt,Mt);else{if(null!==(e=mc)&&100<e.shellSuspendCounter)throw Error(i(482));(e=t).status="pending",e.then(function(e){if("pending"===t.status){var n=t;n.status="fulfilled",n.value=e}},function(e){if("pending"===t.status){var n=t;n.status="rejected",n.reason=e}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw sa(e=t.reason),e}throw aa=t,Xo}}function oa(e){try{return(0,e._init)(e._payload)}catch(t){if(null!==t&&"object"===typeof t&&"function"===typeof t.then)throw aa=t,Xo;throw t}}var aa=null;function ia(){if(null===aa)throw Error(i(459));var e=aa;return aa=null,e}function sa(e){if(e===Xo||e===ea)throw Error(i(483))}var la=null,ca=0;function ua(e){var t=ca;return ca+=1,null===la&&(la=[]),ra(la,e,t)}function da(e,t){t=t.props.ref,e.ref=void 0!==t?t:null}function ha(e,t){if(t.$$typeof===m)throw Error(i(525));throw e=Object.prototype.toString.call(t),Error(i(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function ga(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e){for(var t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function o(e,t){return(e=zr(e,t)).index=0,e.sibling=null,e}function a(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=67108866,n):r:(t.flags|=67108866,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=67108866),t}function l(e,t,n,r){return null===t||6!==t.tag?((t=Wr(n,e.mode,r)).return=e,t):((t=o(t,n)).return=e,t)}function c(e,t,n,r){var a=n.type;return a===y?d(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===a||"object"===typeof a&&null!==a&&a.$$typeof===I&&oa(a)===t.type)?(da(t=o(t,n.props),n),t.return=e,t):(da(t=Hr(n.type,n.key,n.props,null,e.mode,r),n),t.return=e,t)}function u(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Vr(n,e.mode,r)).return=e,t):((t=o(t,n.children||[])).return=e,t)}function d(e,t,n,r,a){return null===t||7!==t.tag?((t=Br(n,e.mode,r,a)).return=e,t):((t=o(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t||"bigint"===typeof t)return(t=Wr(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case f:return da(n=Hr(t.type,t.key,t.props,null,e.mode,n),t),n.return=e,n;case p:return(t=Vr(t,e.mode,n)).return=e,t;case I:return h(e,t=oa(t),n)}if(R(t)||N(t))return(t=Br(t,e.mode,n,null)).return=e,t;if("function"===typeof t.then)return h(e,ua(t),n);if(t.$$typeof===k)return h(e,Oo(e,t),n);ha(e,t)}return null}function g(e,t,n,r){var o=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n||"bigint"===typeof n)return null!==o?null:l(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case f:return n.key===o?c(e,t,n,r):null;case p:return n.key===o?u(e,t,n,r):null;case I:return g(e,t,n=oa(n),r)}if(R(n)||N(n))return null!==o?null:d(e,t,n,r,null);if("function"===typeof n.then)return g(e,t,ua(n),r);if(n.$$typeof===k)return g(e,t,Oo(e,n),r);ha(e,n)}return null}function m(e,t,n,r,o){if("string"===typeof r&&""!==r||"number"===typeof r||"bigint"===typeof r)return l(t,e=e.get(n)||null,""+r,o);if("object"===typeof r&&null!==r){switch(r.$$typeof){case f:return c(t,e=e.get(null===r.key?n:r.key)||null,r,o);case p:return u(t,e=e.get(null===r.key?n:r.key)||null,r,o);case I:return m(e,t,n,r=oa(r),o)}if(R(r)||N(r))return d(t,e=e.get(n)||null,r,o,null);if("function"===typeof r.then)return m(e,t,n,ua(r),o);if(r.$$typeof===k)return m(e,t,n,Oo(t,r),o);ha(t,r)}return null}function v(l,c,u,d){if("object"===typeof u&&null!==u&&u.type===y&&null===u.key&&(u=u.props.children),"object"===typeof u&&null!==u){switch(u.$$typeof){case f:e:{for(var b=u.key;null!==c;){if(c.key===b){if((b=u.type)===y){if(7===c.tag){n(l,c.sibling),(d=o(c,u.props.children)).return=l,l=d;break e}}else if(c.elementType===b||"object"===typeof b&&null!==b&&b.$$typeof===I&&oa(b)===c.type){n(l,c.sibling),da(d=o(c,u.props),u),d.return=l,l=d;break e}n(l,c);break}t(l,c),c=c.sibling}u.type===y?((d=Br(u.props.children,l.mode,d,u.key)).return=l,l=d):(da(d=Hr(u.type,u.key,u.props,null,l.mode,d),u),d.return=l,l=d)}return s(l);case p:e:{for(b=u.key;null!==c;){if(c.key===b){if(4===c.tag&&c.stateNode.containerInfo===u.containerInfo&&c.stateNode.implementation===u.implementation){n(l,c.sibling),(d=o(c,u.children||[])).return=l,l=d;break e}n(l,c);break}t(l,c),c=c.sibling}(d=Vr(u,l.mode,d)).return=l,l=d}return s(l);case I:return v(l,c,u=oa(u),d)}if(R(u))return function(o,i,s,l){for(var c=null,u=null,d=i,f=i=0,p=null;null!==d&&f<s.length;f++){d.index>f?(p=d,d=null):p=d.sibling;var y=g(o,d,s[f],l);if(null===y){null===d&&(d=p);break}e&&d&&null===y.alternate&&t(o,d),i=a(y,i,f),null===u?c=y:u.sibling=y,u=y,d=p}if(f===s.length)return n(o,d),ho&&oo(o,f),c;if(null===d){for(;f<s.length;f++)null!==(d=h(o,s[f],l))&&(i=a(d,i,f),null===u?c=d:u.sibling=d,u=d);return ho&&oo(o,f),c}for(d=r(d);f<s.length;f++)null!==(p=m(d,o,f,s[f],l))&&(e&&null!==p.alternate&&d.delete(null===p.key?f:p.key),i=a(p,i,f),null===u?c=p:u.sibling=p,u=p);return e&&d.forEach(function(e){return t(o,e)}),ho&&oo(o,f),c}(l,c,u,d);if(N(u)){if("function"!==typeof(b=N(u)))throw Error(i(150));return function(o,s,l,c){if(null==l)throw Error(i(151));for(var u=null,d=null,f=s,p=s=0,y=null,v=l.next();null!==f&&!v.done;p++,v=l.next()){f.index>p?(y=f,f=null):y=f.sibling;var b=g(o,f,v.value,c);if(null===b){null===f&&(f=y);break}e&&f&&null===b.alternate&&t(o,f),s=a(b,s,p),null===d?u=b:d.sibling=b,d=b,f=y}if(v.done)return n(o,f),ho&&oo(o,p),u;if(null===f){for(;!v.done;p++,v=l.next())null!==(v=h(o,v.value,c))&&(s=a(v,s,p),null===d?u=v:d.sibling=v,d=v);return ho&&oo(o,p),u}for(f=r(f);!v.done;p++,v=l.next())null!==(v=m(f,o,p,v.value,c))&&(e&&null!==v.alternate&&f.delete(null===v.key?p:v.key),s=a(v,s,p),null===d?u=v:d.sibling=v,d=v);return e&&f.forEach(function(e){return t(o,e)}),ho&&oo(o,p),u}(l,c,u=b.call(u),d)}if("function"===typeof u.then)return v(l,c,ua(u),d);if(u.$$typeof===k)return v(l,c,Oo(l,u),d);ha(l,u)}return"string"===typeof u&&""!==u||"number"===typeof u||"bigint"===typeof u?(u=""+u,null!==c&&6===c.tag?(n(l,c.sibling),(d=o(c,u)).return=l,l=d):(n(l,c),(d=Wr(u,l.mode,d)).return=l,l=d),s(l)):n(l,c)}return function(e,t,n,r){try{ca=0;var o=v(e,t,n,r);return la=null,o}catch(i){if(i===Xo||i===ea)throw i;var a=Fr(29,i,null,e.mode);return a.lanes=r,a.return=e,a}}}var ma=ga(!0),fa=ga(!1),pa=!1;function ya(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function va(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function ba(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function wa(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&gc)){var o=r.pending;return null===o?t.next=t:(t.next=o.next,o.next=t),r.pending=t,t=jr(e),Or(e,null,n),t}return _r(e,r,t,n),jr(e)}function ka(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194048&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,Oe(e,n)}}function Sa(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var o=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var i={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};null===a?o=a=i:a=a.next=i,n=n.next}while(null!==n);null===a?o=a=t:a=a.next=t}else o=a=t;return n={baseState:r.baseState,firstBaseUpdate:o,lastBaseUpdate:a,shared:r.shared,callbacks:r.callbacks},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}var xa=!1;function Ca(){if(xa){if(null!==Ko)throw Ko}}function Aa(e,t,n,r){xa=!1;var o=e.updateQueue;pa=!1;var a=o.firstBaseUpdate,i=o.lastBaseUpdate,s=o.shared.pending;if(null!==s){o.shared.pending=null;var l=s,c=l.next;l.next=null,null===i?a=c:i.next=c,i=l;var u=e.alternate;null!==u&&((s=(u=u.updateQueue).lastBaseUpdate)!==i&&(null===s?u.firstBaseUpdate=c:s.next=c,u.lastBaseUpdate=l))}if(null!==a){var d=o.baseState;for(i=0,u=c=l=null,s=a;;){var h=-536870913&s.lane,m=h!==s.lane;if(m?(pc&h)===h:(r&h)===h){0!==h&&h===Wo&&(xa=!0),null!==u&&(u=u.next={lane:0,tag:s.tag,payload:s.payload,callback:null,next:null});e:{var f=e,p=s;h=t;var y=n;switch(p.tag){case 1:if("function"===typeof(f=p.payload)){d=f.call(y,d,h);break e}d=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null===(h="function"===typeof(f=p.payload)?f.call(y,d,h):f)||void 0===h)break e;d=g({},d,h);break e;case 2:pa=!0}}null!==(h=s.callback)&&(e.flags|=64,m&&(e.flags|=8192),null===(m=o.callbacks)?o.callbacks=[h]:m.push(h))}else m={lane:h,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===u?(c=u=m,l=d):u=u.next=m,i|=h;if(null===(s=s.next)){if(null===(s=o.shared.pending))break;s=(m=s).next,m.next=null,o.lastBaseUpdate=m,o.shared.pending=null}}null===u&&(l=d),o.baseState=l,o.firstBaseUpdate=c,o.lastBaseUpdate=u,null===a&&(o.shared.lanes=0),Cc|=i,e.lanes=i,e.memoizedState=d}}function Ia(e,t){if("function"!==typeof e)throw Error(i(191,e));e.call(t)}function Ta(e,t){var n=e.callbacks;if(null!==n)for(e.callbacks=null,e=0;e<n.length;e++)Ia(n[e],t)}var Pa=q(null),Ea=q(0);function Na(e,t){U(Ea,e=Sc),U(Pa,t),Sc=e|t.baseLanes}function _a(){U(Ea,Sc),U(Pa,Pa.current)}function Ma(){Sc=Ea.current,z(Pa),z(Ea)}var Ra=q(null),Oa=null;function ja(e){var t=e.alternate;U(za,1&za.current),U(Ra,e),null===Oa&&(null===t||null!==Pa.current||null!==t.memoizedState)&&(Oa=e)}function Da(e){U(za,za.current),U(Ra,e),null===Oa&&(Oa=e)}function La(e){22===e.tag?(U(za,za.current),U(Ra,e),null===Oa&&(Oa=e)):Fa()}function Fa(){U(za,za.current),U(Ra,Ra.current)}function qa(e){z(Ra),Oa===e&&(Oa=null),z(za)}var za=q(0);function Ua(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||_d(n)||Md(n)))return t}else if(19!==t.tag||"forwards"!==t.memoizedProps.revealOrder&&"backwards"!==t.memoizedProps.revealOrder&&"unstable_legacy-backwards"!==t.memoizedProps.revealOrder&&"together"!==t.memoizedProps.revealOrder){if(null!==t.child){t.child.return=t,t=t.child;continue}}else if(0!==(128&t.flags))return t;if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Ha=0,Ba=null,Wa=null,Ka=null,Va=!1,Ga=!1,Qa=!1,Ya=0,Ja=0,$a=null,Xa=0;function Za(){throw Error(i(321))}function ei(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Xn(e[n],t[n]))return!1;return!0}function ti(e,t,n,r,o,a){return Ha=a,Ba=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,O.H=null===e||null===e.memoizedState?ps:ys,Qa=!1,a=n(r,o),Qa=!1,Ga&&(a=ri(t,n,r,o)),ni(e),a}function ni(e){O.H=fs;var t=null!==Wa&&null!==Wa.next;if(Ha=0,Ka=Wa=Ba=null,Va=!1,Ja=0,$a=null,t)throw Error(i(300));null===e||Rs||null!==(e=e.dependencies)&&_o(e)&&(Rs=!0)}function ri(e,t,n,r){Ba=e;var o=0;do{if(Ga&&($a=null),Ja=0,Ga=!1,25<=o)throw Error(i(301));if(o+=1,Ka=Wa=null,null!=e.updateQueue){var a=e.updateQueue;a.lastEffect=null,a.events=null,a.stores=null,null!=a.memoCache&&(a.memoCache.index=0)}O.H=vs,a=t(n,r)}while(Ga);return a}function oi(){var e=O.H,t=e.useState()[0];return t="function"===typeof t.then?ui(t):t,e=e.useState()[0],(null!==Wa?Wa.memoizedState:null)!==e&&(Ba.flags|=1024),t}function ai(){var e=0!==Ya;return Ya=0,e}function ii(e,t,n){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n}function si(e){if(Va){for(e=e.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}Va=!1}Ha=0,Ka=Wa=Ba=null,Ga=!1,Ja=Ya=0,$a=null}function li(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Ka?Ba.memoizedState=Ka=e:Ka=Ka.next=e,Ka}function ci(){if(null===Wa){var e=Ba.alternate;e=null!==e?e.memoizedState:null}else e=Wa.next;var t=null===Ka?Ba.memoizedState:Ka.next;if(null!==t)Ka=t,Wa=e;else{if(null===e){if(null===Ba.alternate)throw Error(i(467));throw Error(i(310))}e={memoizedState:(Wa=e).memoizedState,baseState:Wa.baseState,baseQueue:Wa.baseQueue,queue:Wa.queue,next:null},null===Ka?Ba.memoizedState=Ka=e:Ka=Ka.next=e}return Ka}function ui(e){var t=Ja;return Ja+=1,null===$a&&($a=[]),e=ra($a,e,t),t=Ba,null===(null===Ka?t.memoizedState:Ka.next)&&(t=t.alternate,O.H=null===t||null===t.memoizedState?ps:ys),e}function di(e){if(null!==e&&"object"===typeof e){if("function"===typeof e.then)return ui(e);if(e.$$typeof===k)return Ro(e)}throw Error(i(438,String(e)))}function hi(e){var t=null,n=Ba.updateQueue;if(null!==n&&(t=n.memoCache),null==t){var r=Ba.alternate;null!==r&&(null!==(r=r.updateQueue)&&(null!=(r=r.memoCache)&&(t={data:r.data.map(function(e){return e.slice()}),index:0})))}if(null==t&&(t={data:[],index:0}),null===n&&(n={lastEffect:null,events:null,stores:null,memoCache:null},Ba.updateQueue=n),n.memoCache=t,void 0===(n=t.data[t.index]))for(n=t.data[t.index]=Array(e),r=0;r<e;r++)n[r]=P;return t.index++,n}function gi(e,t){return"function"===typeof t?t(e):t}function mi(e){return fi(ci(),Wa,e)}function fi(e,t,n){var r=e.queue;if(null===r)throw Error(i(311));r.lastRenderedReducer=n;var o=e.baseQueue,a=r.pending;if(null!==a){if(null!==o){var s=o.next;o.next=a.next,a.next=s}t.baseQueue=o=a,r.pending=null}if(a=e.baseState,null===o)e.memoizedState=a;else{var l=s=null,c=null,u=t=o.next,d=!1;do{var h=-536870913&u.lane;if(h!==u.lane?(pc&h)===h:(Ha&h)===h){var g=u.revertLane;if(0===g)null!==c&&(c=c.next={lane:0,revertLane:0,gesture:null,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),h===Wo&&(d=!0);else{if((Ha&g)===g){u=u.next,g===Wo&&(d=!0);continue}h={lane:0,revertLane:u.revertLane,gesture:null,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===c?(l=c=h,s=a):c=c.next=h,Ba.lanes|=g,Cc|=g}h=u.action,Qa&&n(a,h),a=u.hasEagerState?u.eagerState:n(a,h)}else g={lane:h,revertLane:u.revertLane,gesture:u.gesture,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===c?(l=c=g,s=a):c=c.next=g,Ba.lanes|=h,Cc|=h;u=u.next}while(null!==u&&u!==t);if(null===c?s=a:c.next=l,!Xn(a,e.memoizedState)&&(Rs=!0,d&&null!==(n=Ko)))throw n;e.memoizedState=a,e.baseState=s,e.baseQueue=c,r.lastRenderedState=a}return null===o&&(r.lanes=0),[e.memoizedState,r.dispatch]}function pi(e){var t=ci(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var r=n.dispatch,o=n.pending,a=t.memoizedState;if(null!==o){n.pending=null;var s=o=o.next;do{a=e(a,s.action),s=s.next}while(s!==o);Xn(a,t.memoizedState)||(Rs=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,r]}function yi(e,t,n){var r=Ba,o=ci(),a=ho;if(a){if(void 0===n)throw Error(i(407));n=n()}else n=t();var s=!Xn((Wa||o).memoizedState,n);if(s&&(o.memoizedState=n,Rs=!0),o=o.queue,Hi(wi.bind(null,r,o,e),[e]),o.getSnapshot!==t||s||null!==Ka&&1&Ka.memoizedState.tag){if(r.flags|=2048,Li(9,{destroy:void 0},bi.bind(null,r,o,n,t),null),null===mc)throw Error(i(349));a||0!==(127&Ha)||vi(r,t,n)}return n}function vi(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=Ba.updateQueue)?(t={lastEffect:null,events:null,stores:null,memoCache:null},Ba.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function bi(e,t,n,r){t.value=n,t.getSnapshot=r,ki(t)&&Si(e)}function wi(e,t,n){return n(function(){ki(t)&&Si(e)})}function ki(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Xn(e,n)}catch(r){return!0}}function Si(e){var t=Rr(e,2);null!==t&&Qc(t,e,2)}function xi(e){var t=li();if("function"===typeof e){var n=e;if(e=n(),Qa){be(!0);try{n()}finally{be(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:gi,lastRenderedState:e},t}function Ci(e,t,n,r){return e.baseState=n,fi(e,Wa,"function"===typeof r?r:gi)}function Ai(e,t,n,r,o){if(hs(e))throw Error(i(485));if(null!==(e=t.action)){var a={payload:o,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(e){a.listeners.push(e)}};null!==O.T?n(!0):a.isTransition=!1,r(a),null===(n=t.pending)?(a.next=t.pending=a,Ii(t,a)):(a.next=n.next,t.pending=n.next=a)}}function Ii(e,t){var n=t.action,r=t.payload,o=e.state;if(t.isTransition){var a=O.T,i={};O.T=i;try{var s=n(o,r),l=O.S;null!==l&&l(i,s),Ti(e,t,s)}catch(c){Ei(e,t,c)}finally{null!==a&&null!==i.types&&(a.types=i.types),O.T=a}}else try{Ti(e,t,a=n(o,r))}catch(u){Ei(e,t,u)}}function Ti(e,t,n){null!==n&&"object"===typeof n&&"function"===typeof n.then?n.then(function(n){Pi(e,t,n)},function(n){return Ei(e,t,n)}):Pi(e,t,n)}function Pi(e,t,n){t.status="fulfilled",t.value=n,Ni(t),e.state=n,null!==(t=e.pending)&&((n=t.next)===t?e.pending=null:(n=n.next,t.next=n,Ii(e,n)))}function Ei(e,t,n){var r=e.pending;if(e.pending=null,null!==r){r=r.next;do{t.status="rejected",t.reason=n,Ni(t),t=t.next}while(t!==r)}e.action=null}function Ni(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function _i(e,t){return t}function Mi(e,t){if(ho){var n=mc.formState;if(null!==n){e:{var r=Ba;if(ho){if(uo){t:{for(var o=uo,a=mo;8!==o.nodeType;){if(!a){o=null;break t}if(null===(o=Rd(o.nextSibling))){o=null;break t}}o="F!"===(a=o.data)||"F"===a?o:null}if(o){uo=Rd(o.nextSibling),r="F!"===o.data;break e}}po(r)}r=!1}r&&(t=n[0])}}return(n=li()).memoizedState=n.baseState=t,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:_i,lastRenderedState:t},n.queue=r,n=cs.bind(null,Ba,r),r.dispatch=n,r=xi(!1),a=ds.bind(null,Ba,!1,r.queue),o={state:t,dispatch:null,action:e,pending:null},(r=li()).queue=o,n=Ai.bind(null,Ba,o,a,n),o.dispatch=n,r.memoizedState=e,[t,n,!1]}function Ri(e){return Oi(ci(),Wa,e)}function Oi(e,t,n){if(t=fi(e,t,_i)[0],e=mi(gi)[0],"object"===typeof t&&null!==t&&"function"===typeof t.then)try{var r=ui(t)}catch(i){if(i===Xo)throw ea;throw i}else r=t;var o=(t=ci()).queue,a=o.dispatch;return n!==t.memoizedState&&(Ba.flags|=2048,Li(9,{destroy:void 0},ji.bind(null,o,n),null)),[r,a,e]}function ji(e,t){e.action=t}function Di(e){var t=ci(),n=Wa;if(null!==n)return Oi(t,n,e);ci(),t=t.memoizedState;var r=(n=ci()).queue.dispatch;return n.memoizedState=e,[t,r,!1]}function Li(e,t,n,r){return e={tag:e,create:n,deps:r,inst:t,next:null},null===(t=Ba.updateQueue)&&(t={lastEffect:null,events:null,stores:null,memoCache:null},Ba.updateQueue=t),null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Fi(){return ci().memoizedState}function qi(e,t,n,r){var o=li();Ba.flags|=e,o.memoizedState=Li(1|t,{destroy:void 0},n,void 0===r?null:r)}function zi(e,t,n,r){var o=ci();r=void 0===r?null:r;var a=o.memoizedState.inst;null!==Wa&&null!==r&&ei(r,Wa.memoizedState.deps)?o.memoizedState=Li(t,a,n,r):(Ba.flags|=e,o.memoizedState=Li(1|t,a,n,r))}function Ui(e,t){qi(8390656,8,e,t)}function Hi(e,t){zi(2048,8,e,t)}function Bi(e){var t=ci().memoizedState;return function(e){Ba.flags|=4;var t=Ba.updateQueue;if(null===t)t={lastEffect:null,events:null,stores:null,memoCache:null},Ba.updateQueue=t,t.events=[e];else{var n=t.events;null===n?t.events=[e]:n.push(e)}}({ref:t,nextImpl:e}),function(){if(0!==(2&gc))throw Error(i(440));return t.impl.apply(void 0,arguments)}}function Wi(e,t){return zi(4,2,e,t)}function Ki(e,t){return zi(4,4,e,t)}function Vi(e,t){if("function"===typeof t){e=e();var n=t(e);return function(){"function"===typeof n?n():t(null)}}if(null!==t&&void 0!==t)return e=e(),t.current=e,function(){t.current=null}}function Gi(e,t,n){n=null!==n&&void 0!==n?n.concat([e]):null,zi(4,4,Vi.bind(null,t,e),n)}function Qi(){}function Yi(e,t){var n=ci();t=void 0===t?null:t;var r=n.memoizedState;return null!==t&&ei(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Ji(e,t){var n=ci();t=void 0===t?null:t;var r=n.memoizedState;if(null!==t&&ei(t,r[1]))return r[0];if(r=e(),Qa){be(!0);try{e()}finally{be(!1)}}return n.memoizedState=[r,t],r}function $i(e,t,n){return void 0===n||0!==(1073741824&Ha)&&0===(261930&pc)?e.memoizedState=t:(e.memoizedState=n,e=Gc(),Ba.lanes|=e,Cc|=e,n)}function Xi(e,t,n,r){return Xn(n,t)?n:null!==Pa.current?(e=$i(e,n,r),Xn(e,t)||(Rs=!0),e):0===(42&Ha)||0!==(1073741824&Ha)&&0===(261930&pc)?(Rs=!0,e.memoizedState=n):(e=Gc(),Ba.lanes|=e,Cc|=e,t)}function Zi(e,t,n,r,o){var a=j.p;j.p=0!==a&&8>a?a:8;var i=O.T,s={};O.T=s,ds(e,!1,t,n);try{var l=o(),c=O.S;if(null!==c&&c(s,l),null!==l&&"object"===typeof l&&"function"===typeof l.then)us(e,t,function(e,t){var n=[],r={status:"pending",value:null,reason:null,then:function(e){n.push(e)}};return e.then(function(){r.status="fulfilled",r.value=t;for(var e=0;e<n.length;e++)(0,n[e])(t)},function(e){for(r.status="rejected",r.reason=e,e=0;e<n.length;e++)(0,n[e])(void 0)}),r}(l,r),Vc());else us(e,t,r,Vc())}catch(u){us(e,t,{then:function(){},status:"rejected",reason:u},Vc())}finally{j.p=a,null!==i&&null!==s.types&&(i.types=s.types),O.T=i}}function es(){}function ts(e,t,n,r){if(5!==e.tag)throw Error(i(476));var o=ns(e).queue;Zi(e,o,t,D,null===n?es:function(){return rs(e),n(r)})}function ns(e){var t=e.memoizedState;if(null!==t)return t;var n={};return(t={memoizedState:D,baseState:D,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:gi,lastRenderedState:D},next:null}).next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:gi,lastRenderedState:n},next:null},e.memoizedState=t,null!==(e=e.alternate)&&(e.memoizedState=t),t}function rs(e){var t=ns(e);null===t.next&&(t=e.alternate.memoizedState),us(e,t.next.queue,{},Vc())}function os(){return Ro(uh)}function as(){return ci().memoizedState}function is(){return ci().memoizedState}function ss(e){for(var t=e.return;null!==t;){switch(t.tag){case 24:case 3:var n=Vc(),r=wa(t,e=ba(n),n);return null!==r&&(Qc(r,t,n),ka(r,t,n)),t={cache:zo()},void(e.payload=t)}t=t.return}}function ls(e,t,n){var r=Vc();n={lane:r,revertLane:0,gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null},hs(e)?gs(t,n):null!==(n=Mr(e,t,n,r))&&(Qc(n,e,r),ms(n,t,r))}function cs(e,t,n){us(e,t,n,Vc())}function us(e,t,n,r){var o={lane:r,revertLane:0,gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null};if(hs(e))gs(t,o);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var i=t.lastRenderedState,s=a(i,n);if(o.hasEagerState=!0,o.eagerState=s,Xn(s,i))return _r(e,t,o,0),null===mc&&Nr(),!1}catch(l){}if(null!==(n=Mr(e,t,o,r)))return Qc(n,e,r),ms(n,t,r),!0}return!1}function ds(e,t,n,r){if(r={lane:2,revertLane:Hu(),gesture:null,action:r,hasEagerState:!1,eagerState:null,next:null},hs(e)){if(t)throw Error(i(479))}else null!==(t=Mr(e,n,r,2))&&Qc(t,e,2)}function hs(e){var t=e.alternate;return e===Ba||null!==t&&t===Ba}function gs(e,t){Ga=Va=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function ms(e,t,n){if(0!==(4194048&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,Oe(e,n)}}var fs={readContext:Ro,use:di,useCallback:Za,useContext:Za,useEffect:Za,useImperativeHandle:Za,useLayoutEffect:Za,useInsertionEffect:Za,useMemo:Za,useReducer:Za,useRef:Za,useState:Za,useDebugValue:Za,useDeferredValue:Za,useTransition:Za,useSyncExternalStore:Za,useId:Za,useHostTransitionStatus:Za,useFormState:Za,useActionState:Za,useOptimistic:Za,useMemoCache:Za,useCacheRefresh:Za};fs.useEffectEvent=Za;var ps={readContext:Ro,use:di,useCallback:function(e,t){return li().memoizedState=[e,void 0===t?null:t],e},useContext:Ro,useEffect:Ui,useImperativeHandle:function(e,t,n){n=null!==n&&void 0!==n?n.concat([e]):null,qi(4194308,4,Vi.bind(null,t,e),n)},useLayoutEffect:function(e,t){return qi(4194308,4,e,t)},useInsertionEffect:function(e,t){qi(4,2,e,t)},useMemo:function(e,t){var n=li();t=void 0===t?null:t;var r=e();if(Qa){be(!0);try{e()}finally{be(!1)}}return n.memoizedState=[r,t],r},useReducer:function(e,t,n){var r=li();if(void 0!==n){var o=n(t);if(Qa){be(!0);try{n(t)}finally{be(!1)}}}else o=t;return r.memoizedState=r.baseState=o,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:o},r.queue=e,e=e.dispatch=ls.bind(null,Ba,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},li().memoizedState=e},useState:function(e){var t=(e=xi(e)).queue,n=cs.bind(null,Ba,t);return t.dispatch=n,[e.memoizedState,n]},useDebugValue:Qi,useDeferredValue:function(e,t){return $i(li(),e,t)},useTransition:function(){var e=xi(!1);return e=Zi.bind(null,Ba,e.queue,!0,!1),li().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,n){var r=Ba,o=li();if(ho){if(void 0===n)throw Error(i(407));n=n()}else{if(n=t(),null===mc)throw Error(i(349));0!==(127&pc)||vi(r,t,n)}o.memoizedState=n;var a={value:n,getSnapshot:t};return o.queue=a,Ui(wi.bind(null,r,a,e),[e]),r.flags|=2048,Li(9,{destroy:void 0},bi.bind(null,r,a,n,t),null),n},useId:function(){var e=li(),t=mc.identifierPrefix;if(ho){var n=ro;t="_"+t+"R_"+(n=(no&~(1<<32-we(no)-1)).toString(32)+n),0<(n=Ya++)&&(t+="H"+n.toString(32)),t+="_"}else t="_"+t+"r_"+(n=Xa++).toString(32)+"_";return e.memoizedState=t},useHostTransitionStatus:os,useFormState:Mi,useActionState:Mi,useOptimistic:function(e){var t=li();t.memoizedState=t.baseState=e;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=n,t=ds.bind(null,Ba,!0,n),n.dispatch=t,[e,t]},useMemoCache:hi,useCacheRefresh:function(){return li().memoizedState=ss.bind(null,Ba)},useEffectEvent:function(e){var t=li(),n={impl:e};return t.memoizedState=n,function(){if(0!==(2&gc))throw Error(i(440));return n.impl.apply(void 0,arguments)}}},ys={readContext:Ro,use:di,useCallback:Yi,useContext:Ro,useEffect:Hi,useImperativeHandle:Gi,useInsertionEffect:Wi,useLayoutEffect:Ki,useMemo:Ji,useReducer:mi,useRef:Fi,useState:function(){return mi(gi)},useDebugValue:Qi,useDeferredValue:function(e,t){return Xi(ci(),Wa.memoizedState,e,t)},useTransition:function(){var e=mi(gi)[0],t=ci().memoizedState;return["boolean"===typeof e?e:ui(e),t]},useSyncExternalStore:yi,useId:as,useHostTransitionStatus:os,useFormState:Ri,useActionState:Ri,useOptimistic:function(e,t){return Ci(ci(),0,e,t)},useMemoCache:hi,useCacheRefresh:is};ys.useEffectEvent=Bi;var vs={readContext:Ro,use:di,useCallback:Yi,useContext:Ro,useEffect:Hi,useImperativeHandle:Gi,useInsertionEffect:Wi,useLayoutEffect:Ki,useMemo:Ji,useReducer:pi,useRef:Fi,useState:function(){return pi(gi)},useDebugValue:Qi,useDeferredValue:function(e,t){var n=ci();return null===Wa?$i(n,e,t):Xi(n,Wa.memoizedState,e,t)},useTransition:function(){var e=pi(gi)[0],t=ci().memoizedState;return["boolean"===typeof e?e:ui(e),t]},useSyncExternalStore:yi,useId:as,useHostTransitionStatus:os,useFormState:Di,useActionState:Di,useOptimistic:function(e,t){var n=ci();return null!==Wa?Ci(n,0,e,t):(n.baseState=e,[e,n.queue.dispatch])},useMemoCache:hi,useCacheRefresh:is};function bs(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:g({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}vs.useEffectEvent=Bi;var ws={enqueueSetState:function(e,t,n){e=e._reactInternals;var r=Vc(),o=ba(r);o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=wa(e,o,r))&&(Qc(t,e,r),ka(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=Vc(),o=ba(r);o.tag=1,o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=wa(e,o,r))&&(Qc(t,e,r),ka(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Vc(),r=ba(n);r.tag=2,void 0!==t&&null!==t&&(r.callback=t),null!==(t=wa(e,r,n))&&(Qc(t,e,n),ka(t,e,n))}};function ks(e,t,n,r,o,a,i){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,i):!t.prototype||!t.prototype.isPureReactComponent||(!Zn(n,r)||!Zn(o,a))}function Ss(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&ws.enqueueReplaceState(t,t.state,null)}function xs(e,t){var n=t;if("ref"in t)for(var r in n={},t)"ref"!==r&&(n[r]=t[r]);if(e=e.defaultProps)for(var o in n===t&&(n=g({},n)),e)void 0===n[o]&&(n[o]=e[o]);return n}function Cs(e){Ir(e)}function As(e){console.error(e)}function Is(e){Ir(e)}function Ts(e,t){try{(0,e.onUncaughtError)(t.value,{componentStack:t.stack})}catch(n){setTimeout(function(){throw n})}}function Ps(e,t,n){try{(0,e.onCaughtError)(n.value,{componentStack:n.stack,errorBoundary:1===t.tag?t.stateNode:null})}catch(r){setTimeout(function(){throw r})}}function Es(e,t,n){return(n=ba(n)).tag=3,n.payload={element:null},n.callback=function(){Ts(e,t)},n}function Ns(e){return(e=ba(e)).tag=3,e}function _s(e,t,n,r){var o=n.type.getDerivedStateFromError;if("function"===typeof o){var a=r.value;e.payload=function(){return o(a)},e.callback=function(){Ps(t,n,r)}}var i=n.stateNode;null!==i&&"function"===typeof i.componentDidCatch&&(e.callback=function(){Ps(t,n,r),"function"!==typeof o&&(null===Dc?Dc=new Set([this]):Dc.add(this));var e=r.stack;this.componentDidCatch(r.value,{componentStack:null!==e?e:""})})}var Ms=Error(i(461)),Rs=!1;function Os(e,t,n,r){t.child=null===e?fa(t,null,n,r):ma(t,e.child,n,r)}function js(e,t,n,r,o){n=n.render;var a=t.ref;if("ref"in r){var i={};for(var s in r)"ref"!==s&&(i[s]=r[s])}else i=r;return Mo(t),r=ti(e,t,n,i,a,o),s=ai(),null===e||Rs?(ho&&s&&io(t),t.flags|=1,Os(e,t,r,o),t.child):(ii(e,t,o),ol(e,t,o))}function Ds(e,t,n,r,o){if(null===e){var a=n.type;return"function"!==typeof a||qr(a)||void 0!==a.defaultProps||null!==n.compare?((e=Hr(n.type,null,r,t,t.mode,o)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,Ls(e,t,a,r,o))}if(a=e.child,!al(e,o)){var i=a.memoizedProps;if((n=null!==(n=n.compare)?n:Zn)(i,r)&&e.ref===t.ref)return ol(e,t,o)}return t.flags|=1,(e=zr(a,r)).ref=t.ref,e.return=t,t.child=e}function Ls(e,t,n,r,o){if(null!==e){var a=e.memoizedProps;if(Zn(a,r)&&e.ref===t.ref){if(Rs=!1,t.pendingProps=r=a,!al(e,o))return t.lanes=e.lanes,ol(e,t,o);0!==(131072&e.flags)&&(Rs=!0)}}return Ws(e,t,n,r,o)}function Fs(e,t,n,r){var o=r.children,a=null!==e?e.memoizedState:null;if(null===e&&null===t.stateNode&&(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),"hidden"===r.mode){if(0!==(128&t.flags)){if(a=null!==a?a.baseLanes|n:n,null!==e){for(r=t.child=e.child,o=0;null!==r;)o=o|r.lanes|r.childLanes,r=r.sibling;r=o&~a}else r=0,t.child=null;return zs(e,t,a,n,r)}if(0===(536870912&n))return r=t.lanes=536870912,zs(e,t,null!==a?a.baseLanes|n:n,n,r);t.memoizedState={baseLanes:0,cachePool:null},null!==e&&Jo(0,null!==a?a.cachePool:null),null!==a?Na(t,a):_a(),La(t)}else null!==a?(Jo(0,a.cachePool),Na(t,a),Fa(),t.memoizedState=null):(null!==e&&Jo(0,null),_a(),Fa());return Os(e,t,o,n),t.child}function qs(e,t){return null!==e&&22===e.tag||null!==t.stateNode||(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),t.sibling}function zs(e,t,n,r,o){var a=Yo();return a=null===a?null:{parent:qo._currentValue,pool:a},t.memoizedState={baseLanes:n,cachePool:a},null!==e&&Jo(0,null),_a(),La(t),null!==e&&No(e,t,r,!0),t.childLanes=o,null}function Us(e,t){return(t=Zs({mode:t.mode,children:t.children},e.mode)).ref=e.ref,e.child=t,t.return=e,t}function Hs(e,t,n){return ma(t,e.child,null,n),(e=Us(t,t.pendingProps)).flags|=2,qa(t),t.memoizedState=null,e}function Bs(e,t){var n=t.ref;if(null===n)null!==e&&null!==e.ref&&(t.flags|=4194816);else{if("function"!==typeof n&&"object"!==typeof n)throw Error(i(284));null!==e&&e.ref===n||(t.flags|=4194816)}}function Ws(e,t,n,r,o){return Mo(t),n=ti(e,t,n,r,void 0,o),r=ai(),null===e||Rs?(ho&&r&&io(t),t.flags|=1,Os(e,t,n,o),t.child):(ii(e,t,o),ol(e,t,o))}function Ks(e,t,n,r,o,a){return Mo(t),t.updateQueue=null,n=ri(t,r,n,o),ni(e),r=ai(),null===e||Rs?(ho&&r&&io(t),t.flags|=1,Os(e,t,n,a),t.child):(ii(e,t,a),ol(e,t,a))}function Vs(e,t,n,r,o){if(Mo(t),null===t.stateNode){var a=Dr,i=n.contextType;"object"===typeof i&&null!==i&&(a=Ro(i)),a=new n(r,a),t.memoizedState=null!==a.state&&void 0!==a.state?a.state:null,a.updater=ws,t.stateNode=a,a._reactInternals=t,(a=t.stateNode).props=r,a.state=t.memoizedState,a.refs={},ya(t),i=n.contextType,a.context="object"===typeof i&&null!==i?Ro(i):Dr,a.state=t.memoizedState,"function"===typeof(i=n.getDerivedStateFromProps)&&(bs(t,n,i,r),a.state=t.memoizedState),"function"===typeof n.getDerivedStateFromProps||"function"===typeof a.getSnapshotBeforeUpdate||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||(i=a.state,"function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount(),i!==a.state&&ws.enqueueReplaceState(a,a.state,null),Aa(t,r,a,o),Ca(),a.state=t.memoizedState),"function"===typeof a.componentDidMount&&(t.flags|=4194308),r=!0}else if(null===e){a=t.stateNode;var s=t.memoizedProps,l=xs(n,s);a.props=l;var c=a.context,u=n.contextType;i=Dr,"object"===typeof u&&null!==u&&(i=Ro(u));var d=n.getDerivedStateFromProps;u="function"===typeof d||"function"===typeof a.getSnapshotBeforeUpdate,s=t.pendingProps!==s,u||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(s||c!==i)&&Ss(t,a,r,i),pa=!1;var h=t.memoizedState;a.state=h,Aa(t,r,a,o),Ca(),c=t.memoizedState,s||h!==c||pa?("function"===typeof d&&(bs(t,n,d,r),c=t.memoizedState),(l=pa||ks(t,n,l,r,h,c,i))?(u||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4194308)):("function"===typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=c),a.props=r,a.state=c,a.context=i,r=l):("function"===typeof a.componentDidMount&&(t.flags|=4194308),r=!1)}else{a=t.stateNode,va(e,t),u=xs(n,i=t.memoizedProps),a.props=u,d=t.pendingProps,h=a.context,c=n.contextType,l=Dr,"object"===typeof c&&null!==c&&(l=Ro(c)),(c="function"===typeof(s=n.getDerivedStateFromProps)||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(i!==d||h!==l)&&Ss(t,a,r,l),pa=!1,h=t.memoizedState,a.state=h,Aa(t,r,a,o),Ca();var g=t.memoizedState;i!==d||h!==g||pa||null!==e&&null!==e.dependencies&&_o(e.dependencies)?("function"===typeof s&&(bs(t,n,s,r),g=t.memoizedState),(u=pa||ks(t,n,u,r,h,g,l)||null!==e&&null!==e.dependencies&&_o(e.dependencies))?(c||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(r,g,l),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(r,g,l)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof a.componentDidUpdate||i===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||i===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=g),a.props=r,a.state=g,a.context=l,r=u):("function"!==typeof a.componentDidUpdate||i===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||i===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),r=!1)}return a=r,Bs(e,t),r=0!==(128&t.flags),a||r?(a=t.stateNode,n=r&&"function"!==typeof n.getDerivedStateFromError?null:a.render(),t.flags|=1,null!==e&&r?(t.child=ma(t,e.child,null,o),t.child=ma(t,null,n,o)):Os(e,t,n,o),t.memoizedState=a.state,e=t.child):e=ol(e,t,o),e}function Gs(e,t,n,r){return wo(),t.flags|=256,Os(e,t,n,r),t.child}var Qs={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Ys(e){return{baseLanes:e,cachePool:$o()}}function Js(e,t,n){return e=null!==e?e.childLanes&~n:0,t&&(e|=Tc),e}function $s(e,t,n){var r,o=t.pendingProps,a=!1,s=0!==(128&t.flags);if((r=s)||(r=(null===e||null!==e.memoizedState)&&0!==(2&za.current)),r&&(a=!0,t.flags&=-129),r=0!==(32&t.flags),t.flags&=-33,null===e){if(ho){if(a?ja(t):Fa(),(e=uo)?null!==(e=null!==(e=Nd(e,mo))&&"&"!==e.data?e:null)&&(t.memoizedState={dehydrated:e,treeContext:null!==to?{id:no,overflow:ro}:null,retryLane:536870912,hydrationErrors:null},(n=Kr(e)).return=t,t.child=n,co=t,uo=null):e=null,null===e)throw po(t);return Md(e)?t.lanes=32:t.lanes=536870912,null}var l=o.children;return o=o.fallback,a?(Fa(),l=Zs({mode:"hidden",children:l},a=t.mode),o=Br(o,a,n,null),l.return=t,o.return=t,l.sibling=o,t.child=l,(o=t.child).memoizedState=Ys(n),o.childLanes=Js(e,r,n),t.memoizedState=Qs,qs(null,o)):(ja(t),Xs(t,l))}var c=e.memoizedState;if(null!==c&&null!==(l=c.dehydrated)){if(s)256&t.flags?(ja(t),t.flags&=-257,t=el(e,t,n)):null!==t.memoizedState?(Fa(),t.child=e.child,t.flags|=128,t=null):(Fa(),l=o.fallback,a=t.mode,o=Zs({mode:"visible",children:o.children},a),(l=Br(l,a,n,null)).flags|=2,o.return=t,l.return=t,o.sibling=l,t.child=o,ma(t,e.child,null,n),(o=t.child).memoizedState=Ys(n),o.childLanes=Js(e,r,n),t.memoizedState=Qs,t=qs(null,o));else if(ja(t),Md(l)){if(r=l.nextSibling&&l.nextSibling.dataset)var u=r.dgst;r=u,(o=Error(i(419))).stack="",o.digest=r,So({value:o,source:null,stack:null}),t=el(e,t,n)}else if(Rs||No(e,t,n,!1),r=0!==(n&e.childLanes),Rs||r){if(null!==(r=mc)&&(0!==(o=je(r,n))&&o!==c.retryLane))throw c.retryLane=o,Rr(e,o),Qc(r,e,o),Ms;_d(l)||iu(),t=el(e,t,n)}else _d(l)?(t.flags|=192,t.child=e.child,t=null):(e=c.treeContext,uo=Rd(l.nextSibling),co=t,ho=!0,go=null,mo=!1,null!==e&&lo(t,e),(t=Xs(t,o.children)).flags|=4096);return t}return a?(Fa(),l=o.fallback,a=t.mode,u=(c=e.child).sibling,(o=zr(c,{mode:"hidden",children:o.children})).subtreeFlags=65011712&c.subtreeFlags,null!==u?l=zr(u,l):(l=Br(l,a,n,null)).flags|=2,l.return=t,o.return=t,o.sibling=l,t.child=o,qs(null,o),o=t.child,null===(l=e.child.memoizedState)?l=Ys(n):(null!==(a=l.cachePool)?(c=qo._currentValue,a=a.parent!==c?{parent:c,pool:c}:a):a=$o(),l={baseLanes:l.baseLanes|n,cachePool:a}),o.memoizedState=l,o.childLanes=Js(e,r,n),t.memoizedState=Qs,qs(e.child,o)):(ja(t),e=(n=e.child).sibling,(n=zr(n,{mode:"visible",children:o.children})).return=t,n.sibling=null,null!==e&&(null===(r=t.deletions)?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n)}function Xs(e,t){return(t=Zs({mode:"visible",children:t},e.mode)).return=e,e.child=t}function Zs(e,t){return(e=Fr(22,e,null,t)).lanes=0,e}function el(e,t,n){return ma(t,e.child,null,n),(e=Xs(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function tl(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Po(e.return,t,n)}function nl(e,t,n,r,o,a){var i=e.memoizedState;null===i?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:o,treeForkCount:a}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=o,i.treeForkCount=a)}function rl(e,t,n){var r=t.pendingProps,o=r.revealOrder,a=r.tail;r=r.children;var i=za.current,s=0!==(2&i);if(s?(i=1&i|2,t.flags|=128):i&=1,U(za,i),Os(e,t,r,n),r=ho?Xr:0,!s&&null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&tl(e,n,t);else if(19===e.tag)tl(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(o){case"forwards":for(n=t.child,o=null;null!==n;)null!==(e=n.alternate)&&null===Ua(e)&&(o=n),n=n.sibling;null===(n=o)?(o=t.child,t.child=null):(o=n.sibling,n.sibling=null),nl(t,!1,o,n,a,r);break;case"backwards":case"unstable_legacy-backwards":for(n=null,o=t.child,t.child=null;null!==o;){if(null!==(e=o.alternate)&&null===Ua(e)){t.child=o;break}e=o.sibling,o.sibling=n,n=o,o=e}nl(t,!0,n,null,a,r);break;case"together":nl(t,!1,null,null,void 0,r);break;default:t.memoizedState=null}return t.child}function ol(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Cc|=t.lanes,0===(n&t.childLanes)){if(null===e)return null;if(No(e,t,n,!1),0===(n&t.childLanes))return null}if(null!==e&&t.child!==e.child)throw Error(i(153));if(null!==t.child){for(n=zr(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=zr(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function al(e,t){return 0!==(e.lanes&t)||!(null===(e=e.dependencies)||!_o(e))}function il(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps)Rs=!0;else{if(!al(e,n)&&0===(128&t.flags))return Rs=!1,function(e,t,n){switch(t.tag){case 3:Q(t,t.stateNode.containerInfo),Io(0,qo,e.memoizedState.cache),wo();break;case 27:case 5:J(t);break;case 4:Q(t,t.stateNode.containerInfo);break;case 10:Io(0,t.type,t.memoizedProps.value);break;case 31:if(null!==t.memoizedState)return t.flags|=128,Da(t),null;break;case 13:var r=t.memoizedState;if(null!==r)return null!==r.dehydrated?(ja(t),t.flags|=128,null):0!==(n&t.child.childLanes)?$s(e,t,n):(ja(t),null!==(e=ol(e,t,n))?e.sibling:null);ja(t);break;case 19:var o=0!==(128&e.flags);if((r=0!==(n&t.childLanes))||(No(e,t,n,!1),r=0!==(n&t.childLanes)),o){if(r)return rl(e,t,n);t.flags|=128}if(null!==(o=t.memoizedState)&&(o.rendering=null,o.tail=null,o.lastEffect=null),U(za,za.current),r)break;return null;case 22:return t.lanes=0,Fs(e,t,n,t.pendingProps);case 24:Io(0,qo,e.memoizedState.cache)}return ol(e,t,n)}(e,t,n);Rs=0!==(131072&e.flags)}else Rs=!1,ho&&0!==(1048576&t.flags)&&ao(t,Xr,t.index);switch(t.lanes=0,t.tag){case 16:e:{var r=t.pendingProps;if(e=oa(t.elementType),t.type=e,"function"!==typeof e){if(void 0!==e&&null!==e){var o=e.$$typeof;if(o===S){t.tag=11,t=js(null,t,e,r,n);break e}if(o===A){t.tag=14,t=Ds(null,t,e,r,n);break e}}throw t=M(e)||e,Error(i(306,t,""))}qr(e)?(r=xs(e,r),t.tag=1,t=Vs(null,t,e,r,n)):(t.tag=0,t=Ws(null,t,e,r,n))}return t;case 0:return Ws(e,t,t.type,t.pendingProps,n);case 1:return Vs(e,t,r=t.type,o=xs(r,t.pendingProps),n);case 3:e:{if(Q(t,t.stateNode.containerInfo),null===e)throw Error(i(387));r=t.pendingProps;var a=t.memoizedState;o=a.element,va(e,t),Aa(t,r,null,n);var s=t.memoizedState;if(r=s.cache,Io(0,qo,r),r!==a.cache&&Eo(t,[qo],n,!0),Ca(),r=s.element,a.isDehydrated){if(a={element:r,isDehydrated:!1,cache:s.cache},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=Gs(e,t,r,n);break e}if(r!==o){So(o=Qr(Error(i(424)),t)),t=Gs(e,t,r,n);break e}if(9===(e=t.stateNode.containerInfo).nodeType)e=e.body;else e="HTML"===e.nodeName?e.ownerDocument.body:e;for(uo=Rd(e.firstChild),co=t,ho=!0,go=null,mo=!0,n=fa(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(wo(),r===o){t=ol(e,t,n);break e}Os(e,t,r,n)}t=t.child}return t;case 26:return Bs(e,t),null===e?(n=Kd(t.type,null,t.pendingProps,null))?t.memoizedState=n:ho||(n=t.type,e=t.pendingProps,(r=pd(V.current).createElement(n))[Ue]=t,r[He]=e,hd(r,n,e),et(r),t.stateNode=r):t.memoizedState=Kd(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return J(t),null===e&&ho&&(r=t.stateNode=Ld(t.type,t.pendingProps,V.current),co=t,mo=!0,o=uo,Id(t.type)?(Od=o,uo=Rd(r.firstChild)):uo=o),Os(e,t,t.pendingProps.children,n),Bs(e,t),null===e&&(t.flags|=4194304),t.child;case 5:return null===e&&ho&&((o=r=uo)&&(null!==(r=function(e,t,n,r){for(;1===e.nodeType;){var o=n;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!r&&("INPUT"!==e.nodeName||"hidden"!==e.type))break}else if(r){if(!e[Qe])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if("stylesheet"===(a=e.getAttribute("rel"))&&e.hasAttribute("data-precedence"))break;if(a!==o.rel||e.getAttribute("href")!==(null==o.href||""===o.href?null:o.href)||e.getAttribute("crossorigin")!==(null==o.crossOrigin?null:o.crossOrigin)||e.getAttribute("title")!==(null==o.title?null:o.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(((a=e.getAttribute("src"))!==(null==o.src?null:o.src)||e.getAttribute("type")!==(null==o.type?null:o.type)||e.getAttribute("crossorigin")!==(null==o.crossOrigin?null:o.crossOrigin))&&a&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else{if("input"!==t||"hidden"!==e.type)return e;var a=null==o.name?null:""+o.name;if("hidden"===o.type&&e.getAttribute("name")===a)return e}if(null===(e=Rd(e.nextSibling)))break}return null}(r,t.type,t.pendingProps,mo))?(t.stateNode=r,co=t,uo=Rd(r.firstChild),mo=!1,o=!0):o=!1),o||po(t)),J(t),o=t.type,a=t.pendingProps,s=null!==e?e.memoizedProps:null,r=a.children,bd(o,a)?r=null:null!==s&&bd(o,s)&&(t.flags|=32),null!==t.memoizedState&&(o=ti(e,t,oi,null,null,n),uh._currentValue=o),Bs(e,t),Os(e,t,r,n),t.child;case 6:return null===e&&ho&&((e=n=uo)&&(null!==(n=function(e,t,n){if(""===t)return null;for(;3!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!n)return null;if(null===(e=Rd(e.nextSibling)))return null}return e}(n,t.pendingProps,mo))?(t.stateNode=n,co=t,uo=null,e=!0):e=!1),e||po(t)),null;case 13:return $s(e,t,n);case 4:return Q(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=ma(t,null,r,n):Os(e,t,r,n),t.child;case 11:return js(e,t,t.type,t.pendingProps,n);case 7:return Os(e,t,t.pendingProps,n),t.child;case 8:case 12:return Os(e,t,t.pendingProps.children,n),t.child;case 10:return r=t.pendingProps,Io(0,t.type,r.value),Os(e,t,r.children,n),t.child;case 9:return o=t.type._context,r=t.pendingProps.children,Mo(t),r=r(o=Ro(o)),t.flags|=1,Os(e,t,r,n),t.child;case 14:return Ds(e,t,t.type,t.pendingProps,n);case 15:return Ls(e,t,t.type,t.pendingProps,n);case 19:return rl(e,t,n);case 31:return function(e,t,n){var r=t.pendingProps,o=0!==(128&t.flags);if(t.flags&=-129,null===e){if(ho){if("hidden"===r.mode)return e=Us(t,r),t.lanes=536870912,qs(null,e);if(Da(t),(e=uo)?null!==(e=null!==(e=Nd(e,mo))&&"&"===e.data?e:null)&&(t.memoizedState={dehydrated:e,treeContext:null!==to?{id:no,overflow:ro}:null,retryLane:536870912,hydrationErrors:null},(n=Kr(e)).return=t,t.child=n,co=t,uo=null):e=null,null===e)throw po(t);return t.lanes=536870912,null}return Us(t,r)}var a=e.memoizedState;if(null!==a){var s=a.dehydrated;if(Da(t),o)if(256&t.flags)t.flags&=-257,t=Hs(e,t,n);else{if(null===t.memoizedState)throw Error(i(558));t.child=e.child,t.flags|=128,t=null}else if(Rs||No(e,t,n,!1),o=0!==(n&e.childLanes),Rs||o){if(null!==(r=mc)&&0!==(s=je(r,n))&&s!==a.retryLane)throw a.retryLane=s,Rr(e,s),Qc(r,e,s),Ms;iu(),t=Hs(e,t,n)}else e=a.treeContext,uo=Rd(s.nextSibling),co=t,ho=!0,go=null,mo=!1,null!==e&&lo(t,e),(t=Us(t,r)).flags|=4096;return t}return(e=zr(e.child,{mode:r.mode,children:r.children})).ref=t.ref,t.child=e,e.return=t,e}(e,t,n);case 22:return Fs(e,t,n,t.pendingProps);case 24:return Mo(t),r=Ro(qo),null===e?(null===(o=Yo())&&(o=mc,a=zo(),o.pooledCache=a,a.refCount++,null!==a&&(o.pooledCacheLanes|=n),o=a),t.memoizedState={parent:r,cache:o},ya(t),Io(0,qo,o)):(0!==(e.lanes&n)&&(va(e,t),Aa(t,null,null,n),Ca()),o=e.memoizedState,a=t.memoizedState,o.parent!==r?(o={parent:r,cache:r},t.memoizedState=o,0===t.lanes&&(t.memoizedState=t.updateQueue.baseState=o),Io(0,qo,r)):(r=a.cache,Io(0,qo,r),r!==o.cache&&Eo(t,[qo],n,!0))),Os(e,t,t.pendingProps.children,n),t.child;case 29:throw t.pendingProps}throw Error(i(156,t.tag))}function sl(e){e.flags|=4}function ll(e,t,n,r,o){if((t=0!==(32&e.mode))&&(t=!1),t){if(e.flags|=16777216,(335544128&o)===o)if(e.stateNode.complete)e.flags|=8192;else{if(!ru())throw aa=ta,Zo;e.flags|=8192}}else e.flags&=-16777217}function cl(e,t){if("stylesheet"!==t.type||0!==(4&t.state.loading))e.flags&=-16777217;else if(e.flags|=16777216,!oh(t)){if(!ru())throw aa=ta,Zo;e.flags|=8192}}function ul(e,t){null!==t&&(e.flags|=4),16384&e.flags&&(t=22!==e.tag?Ne():536870912,e.lanes|=t,Pc|=t)}function dl(e,t){if(!ho)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function hl(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var o=e.child;null!==o;)n|=o.lanes|o.childLanes,r|=65011712&o.subtreeFlags,r|=65011712&o.flags,o.return=e,o=o.sibling;else for(o=e.child;null!==o;)n|=o.lanes|o.childLanes,r|=o.subtreeFlags,r|=o.flags,o.return=e,o=o.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function gl(e,t,n){var r=t.pendingProps;switch(so(t),t.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return hl(t),null;case 3:return n=t.stateNode,r=null,null!==e&&(r=e.memoizedState.cache),t.memoizedState.cache!==r&&(t.flags|=2048),To(qo),Y(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(bo(t)?sl(t):null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,ko())),hl(t),null;case 26:var o=t.type,a=t.memoizedState;return null===e?(sl(t),null!==a?(hl(t),cl(t,a)):(hl(t),ll(t,o,0,0,n))):a?a!==e.memoizedState?(sl(t),hl(t),cl(t,a)):(hl(t),t.flags&=-16777217):((e=e.memoizedProps)!==r&&sl(t),hl(t),ll(t,o,0,0,n)),null;case 27:if($(t),n=V.current,o=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==r&&sl(t);else{if(!r){if(null===t.stateNode)throw Error(i(166));return hl(t),null}e=W.current,bo(t)?yo(t):(e=Ld(o,r,n),t.stateNode=e,sl(t))}return hl(t),null;case 5:if($(t),o=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==r&&sl(t);else{if(!r){if(null===t.stateNode)throw Error(i(166));return hl(t),null}if(a=W.current,bo(t))yo(t);else{var s=pd(V.current);switch(a){case 1:a=s.createElementNS("http://www.w3.org/2000/svg",o);break;case 2:a=s.createElementNS("http://www.w3.org/1998/Math/MathML",o);break;default:switch(o){case"svg":a=s.createElementNS("http://www.w3.org/2000/svg",o);break;case"math":a=s.createElementNS("http://www.w3.org/1998/Math/MathML",o);break;case"script":(a=s.createElement("div")).innerHTML="<script><\/script>",a=a.removeChild(a.firstChild);break;case"select":a="string"===typeof r.is?s.createElement("select",{is:r.is}):s.createElement("select"),r.multiple?a.multiple=!0:r.size&&(a.size=r.size);break;default:a="string"===typeof r.is?s.createElement(o,{is:r.is}):s.createElement(o)}}a[Ue]=t,a[He]=r;e:for(s=t.child;null!==s;){if(5===s.tag||6===s.tag)a.appendChild(s.stateNode);else if(4!==s.tag&&27!==s.tag&&null!==s.child){s.child.return=s,s=s.child;continue}if(s===t)break e;for(;null===s.sibling;){if(null===s.return||s.return===t)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}t.stateNode=a;e:switch(hd(a,o,r),o){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}r&&sl(t)}}return hl(t),ll(t,t.type,null===e||e.memoizedProps,t.pendingProps,n),null;case 6:if(e&&null!=t.stateNode)e.memoizedProps!==r&&sl(t);else{if("string"!==typeof r&&null===t.stateNode)throw Error(i(166));if(e=V.current,bo(t)){if(e=t.stateNode,n=t.memoizedProps,r=null,null!==(o=co))switch(o.tag){case 27:case 5:r=o.memoizedProps}e[Ue]=t,(e=!!(e.nodeValue===n||null!==r&&!0===r.suppressHydrationWarning||cd(e.nodeValue,n)))||po(t,!0)}else(e=pd(e).createTextNode(r))[Ue]=t,t.stateNode=e}return hl(t),null;case 31:if(n=t.memoizedState,null===e||null!==e.memoizedState){if(r=bo(t),null!==n){if(null===e){if(!r)throw Error(i(318));if(!(e=null!==(e=t.memoizedState)?e.dehydrated:null))throw Error(i(557));e[Ue]=t}else wo(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;hl(t),e=!1}else n=ko(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=n),e=!0;if(!e)return 256&t.flags?(qa(t),t):(qa(t),null);if(0!==(128&t.flags))throw Error(i(558))}return hl(t),null;case 13:if(r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(o=bo(t),null!==r&&null!==r.dehydrated){if(null===e){if(!o)throw Error(i(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(i(317));o[Ue]=t}else wo(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;hl(t),o=!1}else o=ko(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=o),o=!0;if(!o)return 256&t.flags?(qa(t),t):(qa(t),null)}return qa(t),0!==(128&t.flags)?(t.lanes=n,t):(n=null!==r,e=null!==e&&null!==e.memoizedState,n&&(o=null,null!==(r=t.child).alternate&&null!==r.alternate.memoizedState&&null!==r.alternate.memoizedState.cachePool&&(o=r.alternate.memoizedState.cachePool.pool),a=null,null!==r.memoizedState&&null!==r.memoizedState.cachePool&&(a=r.memoizedState.cachePool.pool),a!==o&&(r.flags|=2048)),n!==e&&n&&(t.child.flags|=8192),ul(t,t.updateQueue),hl(t),null);case 4:return Y(),null===e&&Zu(t.stateNode.containerInfo),hl(t),null;case 10:return To(t.type),hl(t),null;case 19:if(z(za),null===(r=t.memoizedState))return hl(t),null;if(o=0!==(128&t.flags),null===(a=r.rendering))if(o)dl(r,!1);else{if(0!==xc||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(a=Ua(e))){for(t.flags|=128,dl(r,!1),e=a.updateQueue,t.updateQueue=e,ul(t,e),t.subtreeFlags=0,e=n,n=t.child;null!==n;)Ur(n,e),n=n.sibling;return U(za,1&za.current|2),ho&&oo(t,r.treeForkCount),t.child}e=e.sibling}null!==r.tail&&le()>Oc&&(t.flags|=128,o=!0,dl(r,!1),t.lanes=4194304)}else{if(!o)if(null!==(e=Ua(a))){if(t.flags|=128,o=!0,e=e.updateQueue,t.updateQueue=e,ul(t,e),dl(r,!0),null===r.tail&&"hidden"===r.tailMode&&!a.alternate&&!ho)return hl(t),null}else 2*le()-r.renderingStartTime>Oc&&536870912!==n&&(t.flags|=128,o=!0,dl(r,!1),t.lanes=4194304);r.isBackwards?(a.sibling=t.child,t.child=a):(null!==(e=r.last)?e.sibling=a:t.child=a,r.last=a)}return null!==r.tail?(e=r.tail,r.rendering=e,r.tail=e.sibling,r.renderingStartTime=le(),e.sibling=null,n=za.current,U(za,o?1&n|2:1&n),ho&&oo(t,r.treeForkCount),e):(hl(t),null);case 22:case 23:return qa(t),Ma(),r=null!==t.memoizedState,null!==e?null!==e.memoizedState!==r&&(t.flags|=8192):r&&(t.flags|=8192),r?0!==(536870912&n)&&0===(128&t.flags)&&(hl(t),6&t.subtreeFlags&&(t.flags|=8192)):hl(t),null!==(n=t.updateQueue)&&ul(t,n.retryQueue),n=null,null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),r=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(r=t.memoizedState.cachePool.pool),r!==n&&(t.flags|=2048),null!==e&&z(Qo),null;case 24:return n=null,null!==e&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),To(qo),hl(t),null;case 25:case 30:return null}throw Error(i(156,t.tag))}function ml(e,t){switch(so(t),t.tag){case 1:return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return To(qo),Y(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 26:case 27:case 5:return $(t),null;case 31:if(null!==t.memoizedState){if(qa(t),null===t.alternate)throw Error(i(340));wo()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 13:if(qa(t),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(i(340));wo()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return z(za),null;case 4:return Y(),null;case 10:return To(t.type),null;case 22:case 23:return qa(t),Ma(),null!==e&&z(Qo),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 24:return To(qo),null;default:return null}}function fl(e,t){switch(so(t),t.tag){case 3:To(qo),Y();break;case 26:case 27:case 5:$(t);break;case 4:Y();break;case 31:null!==t.memoizedState&&qa(t);break;case 13:qa(t);break;case 19:z(za);break;case 10:To(t.type);break;case 22:case 23:qa(t),Ma(),null!==e&&z(Qo);break;case 24:To(qo)}}function pl(e,t){try{var n=t.updateQueue,r=null!==n?n.lastEffect:null;if(null!==r){var o=r.next;n=o;do{if((n.tag&e)===e){r=void 0;var a=n.create,i=n.inst;r=a(),i.destroy=r}n=n.next}while(n!==o)}}catch(s){xu(t,t.return,s)}}function yl(e,t,n){try{var r=t.updateQueue,o=null!==r?r.lastEffect:null;if(null!==o){var a=o.next;r=a;do{if((r.tag&e)===e){var i=r.inst,s=i.destroy;if(void 0!==s){i.destroy=void 0,o=t;var l=n,c=s;try{c()}catch(u){xu(o,l,u)}}}r=r.next}while(r!==a)}}catch(u){xu(t,t.return,u)}}function vl(e){var t=e.updateQueue;if(null!==t){var n=e.stateNode;try{Ta(t,n)}catch(r){xu(e,e.return,r)}}}function bl(e,t,n){n.props=xs(e.type,e.memoizedProps),n.state=e.memoizedState;try{n.componentWillUnmount()}catch(r){xu(e,t,r)}}function wl(e,t){try{var n=e.ref;if(null!==n){switch(e.tag){case 26:case 27:case 5:var r=e.stateNode;break;default:r=e.stateNode}"function"===typeof n?e.refCleanup=n(r):n.current=r}}catch(o){xu(e,t,o)}}function kl(e,t){var n=e.ref,r=e.refCleanup;if(null!==n)if("function"===typeof r)try{r()}catch(o){xu(e,t,o)}finally{e.refCleanup=null,null!=(e=e.alternate)&&(e.refCleanup=null)}else if("function"===typeof n)try{n(null)}catch(a){xu(e,t,a)}else n.current=null}function Sl(e){var t=e.type,n=e.memoizedProps,r=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":n.autoFocus&&r.focus();break e;case"img":n.src?r.src=n.src:n.srcSet&&(r.srcset=n.srcSet)}}catch(o){xu(e,e.return,o)}}function xl(e,t,n){try{var r=e.stateNode;!function(e,t,n,r){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var o=null,a=null,s=null,l=null,c=null,u=null,d=null;for(m in n){var h=n[m];if(n.hasOwnProperty(m)&&null!=h)switch(m){case"checked":case"value":break;case"defaultValue":c=h;default:r.hasOwnProperty(m)||ud(e,t,m,null,r,h)}}for(var g in r){var m=r[g];if(h=n[g],r.hasOwnProperty(g)&&(null!=m||null!=h))switch(g){case"type":a=m;break;case"name":o=m;break;case"checked":u=m;break;case"defaultChecked":d=m;break;case"value":s=m;break;case"defaultValue":l=m;break;case"children":case"dangerouslySetInnerHTML":if(null!=m)throw Error(i(137,t));break;default:m!==h&&ud(e,t,g,m,r,h)}}return void vt(e,s,l,c,u,d,a,o);case"select":for(a in m=s=l=g=null,n)if(c=n[a],n.hasOwnProperty(a)&&null!=c)switch(a){case"value":break;case"multiple":m=c;default:r.hasOwnProperty(a)||ud(e,t,a,null,r,c)}for(o in r)if(a=r[o],c=n[o],r.hasOwnProperty(o)&&(null!=a||null!=c))switch(o){case"value":g=a;break;case"defaultValue":l=a;break;case"multiple":s=a;default:a!==c&&ud(e,t,o,a,r,c)}return t=l,n=s,r=m,void(null!=g?kt(e,!!n,g,!1):!!r!==!!n&&(null!=t?kt(e,!!n,t,!0):kt(e,!!n,n?[]:"",!1)));case"textarea":for(l in m=g=null,n)if(o=n[l],n.hasOwnProperty(l)&&null!=o&&!r.hasOwnProperty(l))switch(l){case"value":case"children":break;default:ud(e,t,l,null,r,o)}for(s in r)if(o=r[s],a=n[s],r.hasOwnProperty(s)&&(null!=o||null!=a))switch(s){case"value":g=o;break;case"defaultValue":m=o;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=o)throw Error(i(91));break;default:o!==a&&ud(e,t,s,o,r,a)}return void St(e,g,m);case"option":for(var f in n)if(g=n[f],n.hasOwnProperty(f)&&null!=g&&!r.hasOwnProperty(f))if("selected"===f)e.selected=!1;else ud(e,t,f,null,r,g);for(c in r)if(g=r[c],m=n[c],r.hasOwnProperty(c)&&g!==m&&(null!=g||null!=m))if("selected"===c)e.selected=g&&"function"!==typeof g&&"symbol"!==typeof g;else ud(e,t,c,g,r,m);return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var p in n)g=n[p],n.hasOwnProperty(p)&&null!=g&&!r.hasOwnProperty(p)&&ud(e,t,p,null,r,g);for(u in r)if(g=r[u],m=n[u],r.hasOwnProperty(u)&&g!==m&&(null!=g||null!=m))switch(u){case"children":case"dangerouslySetInnerHTML":if(null!=g)throw Error(i(137,t));break;default:ud(e,t,u,g,r,m)}return;default:if(Pt(t)){for(var y in n)g=n[y],n.hasOwnProperty(y)&&void 0!==g&&!r.hasOwnProperty(y)&&dd(e,t,y,void 0,r,g);for(d in r)g=r[d],m=n[d],!r.hasOwnProperty(d)||g===m||void 0===g&&void 0===m||dd(e,t,d,g,r,m);return}}for(var v in n)g=n[v],n.hasOwnProperty(v)&&null!=g&&!r.hasOwnProperty(v)&&ud(e,t,v,null,r,g);for(h in r)g=r[h],m=n[h],!r.hasOwnProperty(h)||g===m||null==g&&null==m||ud(e,t,h,g,r,m)}(r,e.type,n,t),r[He]=t}catch(o){xu(e,e.return,o)}}function Cl(e){return 5===e.tag||3===e.tag||26===e.tag||27===e.tag&&Id(e.type)||4===e.tag}function Al(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||Cl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(27===e.tag&&Id(e.type))continue e;if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function Il(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?(9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).insertBefore(e,t):((t=9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Mt));else if(4!==r&&(27===r&&Id(e.type)&&(n=e.stateNode,t=null),null!==(e=e.child)))for(Il(e,t,n),e=e.sibling;null!==e;)Il(e,t,n),e=e.sibling}function Tl(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&(27===r&&Id(e.type)&&(n=e.stateNode),null!==(e=e.child)))for(Tl(e,t,n),e=e.sibling;null!==e;)Tl(e,t,n),e=e.sibling}function Pl(e){var t=e.stateNode,n=e.memoizedProps;try{for(var r=e.type,o=t.attributes;o.length;)t.removeAttributeNode(o[0]);hd(t,r,n),t[Ue]=e,t[He]=n}catch(a){xu(e,e.return,a)}}var El=!1,Nl=!1,_l=!1,Ml="function"===typeof WeakSet?WeakSet:Set,Rl=null;function Ol(e,t,n){var r=n.flags;switch(n.tag){case 0:case 11:case 15:Ql(e,n),4&r&&pl(5,n);break;case 1:if(Ql(e,n),4&r)if(e=n.stateNode,null===t)try{e.componentDidMount()}catch(i){xu(n,n.return,i)}else{var o=xs(n.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(o,t,e.__reactInternalSnapshotBeforeUpdate)}catch(s){xu(n,n.return,s)}}64&r&&vl(n),512&r&&wl(n,n.return);break;case 3:if(Ql(e,n),64&r&&null!==(e=n.updateQueue)){if(t=null,null!==n.child)switch(n.child.tag){case 27:case 5:case 1:t=n.child.stateNode}try{Ta(e,t)}catch(i){xu(n,n.return,i)}}break;case 27:null===t&&4&r&&Pl(n);case 26:case 5:Ql(e,n),null===t&&4&r&&Sl(n),512&r&&wl(n,n.return);break;case 12:Ql(e,n);break;case 31:Ql(e,n),4&r&&zl(e,n);break;case 13:Ql(e,n),4&r&&Ul(e,n),64&r&&(null!==(e=n.memoizedState)&&(null!==(e=e.dehydrated)&&function(e,t){var n=e.ownerDocument;if("$~"===e.data)e._reactRetry=t;else if("$?"!==e.data||"loading"!==n.readyState)t();else{var r=function(){t(),n.removeEventListener("DOMContentLoaded",r)};n.addEventListener("DOMContentLoaded",r),e._reactRetry=r}}(e,n=Tu.bind(null,n))));break;case 22:if(!(r=null!==n.memoizedState||El)){t=null!==t&&null!==t.memoizedState||Nl,o=El;var a=Nl;El=r,(Nl=t)&&!a?Jl(e,n,0!==(8772&n.subtreeFlags)):Ql(e,n),El=o,Nl=a}break;case 30:break;default:Ql(e,n)}}function jl(e){var t=e.alternate;null!==t&&(e.alternate=null,jl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&Ye(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Dl=null,Ll=!1;function Fl(e,t,n){for(n=n.child;null!==n;)ql(e,t,n),n=n.sibling}function ql(e,t,n){if(ve&&"function"===typeof ve.onCommitFiberUnmount)try{ve.onCommitFiberUnmount(ye,n)}catch(a){}switch(n.tag){case 26:Nl||kl(n,t),Fl(e,t,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(n=n.stateNode).parentNode.removeChild(n);break;case 27:Nl||kl(n,t);var r=Dl,o=Ll;Id(n.type)&&(Dl=n.stateNode,Ll=!1),Fl(e,t,n),Fd(n.stateNode),Dl=r,Ll=o;break;case 5:Nl||kl(n,t);case 6:if(r=Dl,o=Ll,Dl=null,Fl(e,t,n),Ll=o,null!==(Dl=r))if(Ll)try{(9===Dl.nodeType?Dl.body:"HTML"===Dl.nodeName?Dl.ownerDocument.body:Dl).removeChild(n.stateNode)}catch(i){xu(n,t,i)}else try{Dl.removeChild(n.stateNode)}catch(i){xu(n,t,i)}break;case 18:null!==Dl&&(Ll?(Td(9===(e=Dl).nodeType?e.body:"HTML"===e.nodeName?e.ownerDocument.body:e,n.stateNode),Wh(e)):Td(Dl,n.stateNode));break;case 4:r=Dl,o=Ll,Dl=n.stateNode.containerInfo,Ll=!0,Fl(e,t,n),Dl=r,Ll=o;break;case 0:case 11:case 14:case 15:yl(2,n,t),Nl||yl(4,n,t),Fl(e,t,n);break;case 1:Nl||(kl(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount&&bl(n,t,r)),Fl(e,t,n);break;case 21:Fl(e,t,n);break;case 22:Nl=(r=Nl)||null!==n.memoizedState,Fl(e,t,n),Nl=r;break;default:Fl(e,t,n)}}function zl(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&null!==(e=e.memoizedState))){e=e.dehydrated;try{Wh(e)}catch(n){xu(t,t.return,n)}}}function Ul(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&(null!==(e=e.memoizedState)&&null!==(e=e.dehydrated))))try{Wh(e)}catch(n){xu(t,t.return,n)}}function Hl(e,t){var n=function(e){switch(e.tag){case 31:case 13:case 19:var t=e.stateNode;return null===t&&(t=e.stateNode=new Ml),t;case 22:return null===(t=(e=e.stateNode)._retryCache)&&(t=e._retryCache=new Ml),t;default:throw Error(i(435,e.tag))}}(e);t.forEach(function(t){if(!n.has(t)){n.add(t);var r=Pu.bind(null,e,t);t.then(r,r)}})}function Bl(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var o=n[r],a=e,s=t,l=s;e:for(;null!==l;){switch(l.tag){case 27:if(Id(l.type)){Dl=l.stateNode,Ll=!1;break e}break;case 5:Dl=l.stateNode,Ll=!1;break e;case 3:case 4:Dl=l.stateNode.containerInfo,Ll=!0;break e}l=l.return}if(null===Dl)throw Error(i(160));ql(a,s,o),Dl=null,Ll=!1,null!==(a=o.alternate)&&(a.return=null),o.return=null}if(13886&t.subtreeFlags)for(t=t.child;null!==t;)Kl(t,e),t=t.sibling}var Wl=null;function Kl(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Bl(t,e),Vl(e),4&r&&(yl(3,e,e.return),pl(3,e),yl(5,e,e.return));break;case 1:Bl(t,e),Vl(e),512&r&&(Nl||null===n||kl(n,n.return)),64&r&&El&&(null!==(e=e.updateQueue)&&(null!==(r=e.callbacks)&&(n=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=null===n?r:n.concat(r))));break;case 26:var o=Wl;if(Bl(t,e),Vl(e),512&r&&(Nl||null===n||kl(n,n.return)),4&r){var a=null!==n?n.memoizedState:null;if(r=e.memoizedState,null===n)if(null===r)if(null===e.stateNode){e:{r=e.type,n=e.memoizedProps,o=o.ownerDocument||o;t:switch(r){case"title":(!(a=o.getElementsByTagName("title")[0])||a[Qe]||a[Ue]||"http://www.w3.org/2000/svg"===a.namespaceURI||a.hasAttribute("itemprop"))&&(a=o.createElement(r),o.head.insertBefore(a,o.querySelector("head > title"))),hd(a,r,n),a[Ue]=e,et(a),r=a;break e;case"link":var s=nh("link","href",o).get(r+(n.href||""));if(s)for(var l=0;l<s.length;l++)if((a=s[l]).getAttribute("href")===(null==n.href||""===n.href?null:n.href)&&a.getAttribute("rel")===(null==n.rel?null:n.rel)&&a.getAttribute("title")===(null==n.title?null:n.title)&&a.getAttribute("crossorigin")===(null==n.crossOrigin?null:n.crossOrigin)){s.splice(l,1);break t}hd(a=o.createElement(r),r,n),o.head.appendChild(a);break;case"meta":if(s=nh("meta","content",o).get(r+(n.content||"")))for(l=0;l<s.length;l++)if((a=s[l]).getAttribute("content")===(null==n.content?null:""+n.content)&&a.getAttribute("name")===(null==n.name?null:n.name)&&a.getAttribute("property")===(null==n.property?null:n.property)&&a.getAttribute("http-equiv")===(null==n.httpEquiv?null:n.httpEquiv)&&a.getAttribute("charset")===(null==n.charSet?null:n.charSet)){s.splice(l,1);break t}hd(a=o.createElement(r),r,n),o.head.appendChild(a);break;default:throw Error(i(468,r))}a[Ue]=e,et(a),r=a}e.stateNode=r}else rh(o,e.type,e.stateNode);else e.stateNode=$d(o,r,e.memoizedProps);else a!==r?(null===a?null!==n.stateNode&&(n=n.stateNode).parentNode.removeChild(n):a.count--,null===r?rh(o,e.type,e.stateNode):$d(o,r,e.memoizedProps)):null===r&&null!==e.stateNode&&xl(e,e.memoizedProps,n.memoizedProps)}break;case 27:Bl(t,e),Vl(e),512&r&&(Nl||null===n||kl(n,n.return)),null!==n&&4&r&&xl(e,e.memoizedProps,n.memoizedProps);break;case 5:if(Bl(t,e),Vl(e),512&r&&(Nl||null===n||kl(n,n.return)),32&e.flags){o=e.stateNode;try{Ct(o,"")}catch(f){xu(e,e.return,f)}}4&r&&null!=e.stateNode&&xl(e,o=e.memoizedProps,null!==n?n.memoizedProps:o),1024&r&&(_l=!0);break;case 6:if(Bl(t,e),Vl(e),4&r){if(null===e.stateNode)throw Error(i(162));r=e.memoizedProps,n=e.stateNode;try{n.nodeValue=r}catch(f){xu(e,e.return,f)}}break;case 3:if(th=null,o=Wl,Wl=Ud(t.containerInfo),Bl(t,e),Wl=o,Vl(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Wh(t.containerInfo)}catch(f){xu(e,e.return,f)}_l&&(_l=!1,Gl(e));break;case 4:r=Wl,Wl=Ud(e.stateNode.containerInfo),Bl(t,e),Vl(e),Wl=r;break;case 12:default:Bl(t,e),Vl(e);break;case 31:case 19:Bl(t,e),Vl(e),4&r&&(null!==(r=e.updateQueue)&&(e.updateQueue=null,Hl(e,r)));break;case 13:Bl(t,e),Vl(e),8192&e.child.flags&&null!==e.memoizedState!==(null!==n&&null!==n.memoizedState)&&(Mc=le()),4&r&&(null!==(r=e.updateQueue)&&(e.updateQueue=null,Hl(e,r)));break;case 22:o=null!==e.memoizedState;var c=null!==n&&null!==n.memoizedState,u=El,d=Nl;if(El=u||o,Nl=d||c,Bl(t,e),Nl=d,El=u,Vl(e),8192&r)e:for(t=e.stateNode,t._visibility=o?-2&t._visibility:1|t._visibility,o&&(null===n||c||El||Nl||Yl(e)),n=null,t=e;;){if(5===t.tag||26===t.tag){if(null===n){c=n=t;try{if(a=c.stateNode,o)"function"===typeof(s=a.style).setProperty?s.setProperty("display","none","important"):s.display="none";else{l=c.stateNode;var h=c.memoizedProps.style,g=void 0!==h&&null!==h&&h.hasOwnProperty("display")?h.display:null;l.style.display=null==g||"boolean"===typeof g?"":(""+g).trim()}}catch(f){xu(c,c.return,f)}}}else if(6===t.tag){if(null===n){c=t;try{c.stateNode.nodeValue=o?"":c.memoizedProps}catch(f){xu(c,c.return,f)}}}else if(18===t.tag){if(null===n){c=t;try{var m=c.stateNode;o?Pd(m,!0):Pd(c.stateNode,!1)}catch(f){xu(c,c.return,f)}}}else if((22!==t.tag&&23!==t.tag||null===t.memoizedState||t===e)&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;null===t.sibling;){if(null===t.return||t.return===e)break e;n===t&&(n=null),t=t.return}n===t&&(n=null),t.sibling.return=t.return,t=t.sibling}4&r&&(null!==(r=e.updateQueue)&&(null!==(n=r.retryQueue)&&(r.retryQueue=null,Hl(e,n))));case 30:case 21:}}function Vl(e){var t=e.flags;if(2&t){try{for(var n,r=e.return;null!==r;){if(Cl(r)){n=r;break}r=r.return}if(null==n)throw Error(i(160));switch(n.tag){case 27:var o=n.stateNode;Tl(e,Al(e),o);break;case 5:var a=n.stateNode;32&n.flags&&(Ct(a,""),n.flags&=-33),Tl(e,Al(e),a);break;case 3:case 4:var s=n.stateNode.containerInfo;Il(e,Al(e),s);break;default:throw Error(i(161))}}catch(l){xu(e,e.return,l)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function Gl(e){if(1024&e.subtreeFlags)for(e=e.child;null!==e;){var t=e;Gl(t),5===t.tag&&1024&t.flags&&t.stateNode.reset(),e=e.sibling}}function Ql(e,t){if(8772&t.subtreeFlags)for(t=t.child;null!==t;)Ol(e,t.alternate,t),t=t.sibling}function Yl(e){for(e=e.child;null!==e;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:yl(4,t,t.return),Yl(t);break;case 1:kl(t,t.return);var n=t.stateNode;"function"===typeof n.componentWillUnmount&&bl(t,t.return,n),Yl(t);break;case 27:Fd(t.stateNode);case 26:case 5:kl(t,t.return),Yl(t);break;case 22:null===t.memoizedState&&Yl(t);break;default:Yl(t)}e=e.sibling}}function Jl(e,t,n){for(n=n&&0!==(8772&t.subtreeFlags),t=t.child;null!==t;){var r=t.alternate,o=e,a=t,i=a.flags;switch(a.tag){case 0:case 11:case 15:Jl(o,a,n),pl(4,a);break;case 1:if(Jl(o,a,n),"function"===typeof(o=(r=a).stateNode).componentDidMount)try{o.componentDidMount()}catch(c){xu(r,r.return,c)}if(null!==(o=(r=a).updateQueue)){var s=r.stateNode;try{var l=o.shared.hiddenCallbacks;if(null!==l)for(o.shared.hiddenCallbacks=null,o=0;o<l.length;o++)Ia(l[o],s)}catch(c){xu(r,r.return,c)}}n&&64&i&&vl(a),wl(a,a.return);break;case 27:Pl(a);case 26:case 5:Jl(o,a,n),n&&null===r&&4&i&&Sl(a),wl(a,a.return);break;case 12:Jl(o,a,n);break;case 31:Jl(o,a,n),n&&4&i&&zl(o,a);break;case 13:Jl(o,a,n),n&&4&i&&Ul(o,a);break;case 22:null===a.memoizedState&&Jl(o,a,n),wl(a,a.return);break;case 30:break;default:Jl(o,a,n)}t=t.sibling}}function $l(e,t){var n=null;null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),e=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(e=t.memoizedState.cachePool.pool),e!==n&&(null!=e&&e.refCount++,null!=n&&Uo(n))}function Xl(e,t){e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Uo(e))}function Zl(e,t,n,r){if(10256&t.subtreeFlags)for(t=t.child;null!==t;)ec(e,t,n,r),t=t.sibling}function ec(e,t,n,r){var o=t.flags;switch(t.tag){case 0:case 11:case 15:Zl(e,t,n,r),2048&o&&pl(9,t);break;case 1:case 31:case 13:default:Zl(e,t,n,r);break;case 3:Zl(e,t,n,r),2048&o&&(e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Uo(e)));break;case 12:if(2048&o){Zl(e,t,n,r),e=t.stateNode;try{var a=t.memoizedProps,i=a.id,s=a.onPostCommit;"function"===typeof s&&s(i,null===t.alternate?"mount":"update",e.passiveEffectDuration,-0)}catch(l){xu(t,t.return,l)}}else Zl(e,t,n,r);break;case 23:break;case 22:a=t.stateNode,i=t.alternate,null!==t.memoizedState?2&a._visibility?Zl(e,t,n,r):nc(e,t):2&a._visibility?Zl(e,t,n,r):(a._visibility|=2,tc(e,t,n,r,0!==(10256&t.subtreeFlags)||!1)),2048&o&&$l(i,t);break;case 24:Zl(e,t,n,r),2048&o&&Xl(t.alternate,t)}}function tc(e,t,n,r,o){for(o=o&&(0!==(10256&t.subtreeFlags)||!1),t=t.child;null!==t;){var a=e,i=t,s=n,l=r,c=i.flags;switch(i.tag){case 0:case 11:case 15:tc(a,i,s,l,o),pl(8,i);break;case 23:break;case 22:var u=i.stateNode;null!==i.memoizedState?2&u._visibility?tc(a,i,s,l,o):nc(a,i):(u._visibility|=2,tc(a,i,s,l,o)),o&&2048&c&&$l(i.alternate,i);break;case 24:tc(a,i,s,l,o),o&&2048&c&&Xl(i.alternate,i);break;default:tc(a,i,s,l,o)}t=t.sibling}}function nc(e,t){if(10256&t.subtreeFlags)for(t=t.child;null!==t;){var n=e,r=t,o=r.flags;switch(r.tag){case 22:nc(n,r),2048&o&&$l(r.alternate,r);break;case 24:nc(n,r),2048&o&&Xl(r.alternate,r);break;default:nc(n,r)}t=t.sibling}}var rc=8192;function oc(e,t,n){if(e.subtreeFlags&rc)for(e=e.child;null!==e;)ac(e,t,n),e=e.sibling}function ac(e,t,n){switch(e.tag){case 26:oc(e,t,n),e.flags&rc&&null!==e.memoizedState&&function(e,t,n,r){if("stylesheet"===n.type&&("string"!==typeof r.media||!1!==matchMedia(r.media).matches)&&0===(4&n.state.loading)){if(null===n.instance){var o=Vd(r.href),a=t.querySelector(Gd(o));if(a)return null!==(t=a._p)&&"object"===typeof t&&"function"===typeof t.then&&(e.count++,e=ih.bind(e),t.then(e,e)),n.state.loading|=4,n.instance=a,void et(a);a=t.ownerDocument||t,r=Qd(r),(o=qd.get(o))&&Zd(r,o),et(a=a.createElement("link"));var i=a;i._p=new Promise(function(e,t){i.onload=e,i.onerror=t}),hd(a,"link",r),n.instance=a}null===e.stylesheets&&(e.stylesheets=new Map),e.stylesheets.set(n,t),(t=n.state.preload)&&0===(3&n.state.loading)&&(e.count++,n=ih.bind(e),t.addEventListener("load",n),t.addEventListener("error",n))}}(n,Wl,e.memoizedState,e.memoizedProps);break;case 5:default:oc(e,t,n);break;case 3:case 4:var r=Wl;Wl=Ud(e.stateNode.containerInfo),oc(e,t,n),Wl=r;break;case 22:null===e.memoizedState&&(null!==(r=e.alternate)&&null!==r.memoizedState?(r=rc,rc=16777216,oc(e,t,n),rc=r):oc(e,t,n))}}function ic(e){var t=e.alternate;if(null!==t&&null!==(e=t.child)){t.child=null;do{t=e.sibling,e.sibling=null,e=t}while(null!==e)}}function sc(e){var t=e.deletions;if(0!==(16&e.flags)){if(null!==t)for(var n=0;n<t.length;n++){var r=t[n];Rl=r,uc(r,e)}ic(e)}if(10256&e.subtreeFlags)for(e=e.child;null!==e;)lc(e),e=e.sibling}function lc(e){switch(e.tag){case 0:case 11:case 15:sc(e),2048&e.flags&&yl(9,e,e.return);break;case 3:case 12:default:sc(e);break;case 22:var t=e.stateNode;null!==e.memoizedState&&2&t._visibility&&(null===e.return||13!==e.return.tag)?(t._visibility&=-3,cc(e)):sc(e)}}function cc(e){var t=e.deletions;if(0!==(16&e.flags)){if(null!==t)for(var n=0;n<t.length;n++){var r=t[n];Rl=r,uc(r,e)}ic(e)}for(e=e.child;null!==e;){switch((t=e).tag){case 0:case 11:case 15:yl(8,t,t.return),cc(t);break;case 22:2&(n=t.stateNode)._visibility&&(n._visibility&=-3,cc(t));break;default:cc(t)}e=e.sibling}}function uc(e,t){for(;null!==Rl;){var n=Rl;switch(n.tag){case 0:case 11:case 15:yl(8,n,t);break;case 23:case 22:if(null!==n.memoizedState&&null!==n.memoizedState.cachePool){var r=n.memoizedState.cachePool.pool;null!=r&&r.refCount++}break;case 24:Uo(n.memoizedState.cache)}if(null!==(r=n.child))r.return=n,Rl=r;else e:for(n=e;null!==Rl;){var o=(r=Rl).sibling,a=r.return;if(jl(r),r===n){Rl=null;break e}if(null!==o){o.return=a,Rl=o;break e}Rl=a}}}var dc={getCacheForType:function(e){var t=Ro(qo),n=t.data.get(e);return void 0===n&&(n=e(),t.data.set(e,n)),n},cacheSignal:function(){return Ro(qo).controller.signal}},hc="function"===typeof WeakMap?WeakMap:Map,gc=0,mc=null,fc=null,pc=0,yc=0,vc=null,bc=!1,wc=!1,kc=!1,Sc=0,xc=0,Cc=0,Ac=0,Ic=0,Tc=0,Pc=0,Ec=null,Nc=null,_c=!1,Mc=0,Rc=0,Oc=1/0,jc=null,Dc=null,Lc=0,Fc=null,qc=null,zc=0,Uc=0,Hc=null,Bc=null,Wc=0,Kc=null;function Vc(){return 0!==(2&gc)&&0!==pc?pc&-pc:null!==O.T?Hu():Fe()}function Gc(){if(0===Tc)if(0===(536870912&pc)||ho){var e=Ce;0===(3932160&(Ce<<=1))&&(Ce=262144),Tc=e}else Tc=536870912;return null!==(e=Ra.current)&&(e.flags|=32),Tc}function Qc(e,t,n){(e!==mc||2!==yc&&9!==yc)&&null===e.cancelPendingCommit||(tu(e,0),Xc(e,pc,Tc,!1)),Me(e,n),0!==(2&gc)&&e===mc||(e===mc&&(0===(2&gc)&&(Ac|=n),4===xc&&Xc(e,pc,Tc,!1)),ju(e))}function Yc(e,t,n){if(0!==(6&gc))throw Error(i(327));for(var r=!n&&0===(127&t)&&0===(t&e.expiredLanes)||Pe(e,t),o=r?function(e,t){var n=gc;gc|=2;var r=ou(),o=au();mc!==e||pc!==t?(jc=null,Oc=le()+500,tu(e,t)):wc=Pe(e,t);e:for(;;)try{if(0!==yc&&null!==fc){t=fc;var a=vc;t:switch(yc){case 1:yc=0,vc=null,hu(e,t,a,1);break;case 2:case 9:if(na(a)){yc=0,vc=null,du(t);break}t=function(){2!==yc&&9!==yc||mc!==e||(yc=7),ju(e)},a.then(t,t);break e;case 3:yc=7;break e;case 4:yc=5;break e;case 7:na(a)?(yc=0,vc=null,du(t)):(yc=0,vc=null,hu(e,t,a,7));break;case 5:var s=null;switch(fc.tag){case 26:s=fc.memoizedState;case 5:case 27:var l=fc;if(s?oh(s):l.stateNode.complete){yc=0,vc=null;var c=l.sibling;if(null!==c)fc=c;else{var u=l.return;null!==u?(fc=u,gu(u)):fc=null}break t}}yc=0,vc=null,hu(e,t,a,5);break;case 6:yc=0,vc=null,hu(e,t,a,6);break;case 8:eu(),xc=6;break e;default:throw Error(i(462))}}cu();break}catch(d){nu(e,d)}return Ao=Co=null,O.H=r,O.A=o,gc=n,null!==fc?0:(mc=null,pc=0,Nr(),xc)}(e,t):su(e,t,!0),a=r;;){if(0===o){wc&&!r&&Xc(e,t,0,!1);break}if(n=e.current.alternate,!a||$c(n)){if(2===o){if(a=t,e.errorRecoveryDisabledLanes&a)var s=0;else s=0!==(s=-536870913&e.pendingLanes)?s:536870912&s?536870912:0;if(0!==s){t=s;e:{var l=e;o=Ec;var c=l.current.memoizedState.isDehydrated;if(c&&(tu(l,s).flags|=256),2!==(s=su(l,s,!1))){if(kc&&!c){l.errorRecoveryDisabledLanes|=a,Ac|=a,o=4;break e}a=Nc,Nc=o,null!==a&&(null===Nc?Nc=a:Nc.push.apply(Nc,a))}o=s}if(a=!1,2!==o)continue}}if(1===o){tu(e,0),Xc(e,t,0,!0);break}e:{switch(r=e,a=o){case 0:case 1:throw Error(i(345));case 4:if((4194048&t)!==t)break;case 6:Xc(r,t,Tc,!bc);break e;case 2:Nc=null;break;case 3:case 5:break;default:throw Error(i(329))}if((62914560&t)===t&&10<(o=Mc+300-le())){if(Xc(r,t,Tc,!bc),0!==Te(r,0,!0))break e;zc=t,r.timeoutHandle=kd(Jc.bind(null,r,n,Nc,jc,_c,t,Tc,Ac,Pc,bc,a,"Throttled",-0,0),o)}else Jc(r,n,Nc,jc,_c,t,Tc,Ac,Pc,bc,a,null,-0,0)}break}o=su(e,t,!1),a=!1}ju(e)}function Jc(e,t,n,r,o,a,i,s,l,c,u,d,h,g){if(e.timeoutHandle=-1,8192&(d=t.subtreeFlags)||16785408===(16785408&d)){ac(t,a,d={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Mt});var m=(62914560&a)===a?Mc-le():(4194048&a)===a?Rc-le():0;if(null!==(m=function(e,t){return e.stylesheets&&0===e.count&&lh(e,e.stylesheets),0<e.count||0<e.imgCount?function(n){var r=setTimeout(function(){if(e.stylesheets&&lh(e,e.stylesheets),e.unsuspend){var t=e.unsuspend;e.unsuspend=null,t()}},6e4+t);0<e.imgBytes&&0===ah&&(ah=62500*function(){if("function"===typeof performance.getEntriesByType){for(var e=0,t=0,n=performance.getEntriesByType("resource"),r=0;r<n.length;r++){var o=n[r],a=o.transferSize,i=o.initiatorType,s=o.duration;if(a&&s&&gd(i)){for(i=0,s=o.responseEnd,r+=1;r<n.length;r++){var l=n[r],c=l.startTime;if(c>s)break;var u=l.transferSize,d=l.initiatorType;u&&gd(d)&&(i+=u*((l=l.responseEnd)<s?1:(s-c)/(l-c)))}if(--r,t+=8*(a+i)/(o.duration/1e3),10<++e)break}}if(0<e)return t/e/1e6}return navigator.connection&&"number"===typeof(e=navigator.connection.downlink)?e:5}());var o=setTimeout(function(){if(e.waitingForImages=!1,0===e.count&&(e.stylesheets&&lh(e,e.stylesheets),e.unsuspend)){var t=e.unsuspend;e.unsuspend=null,t()}},(e.imgBytes>ah?50:800)+t);return e.unsuspend=n,function(){e.unsuspend=null,clearTimeout(r),clearTimeout(o)}}:null}(d,m)))return zc=a,e.cancelPendingCommit=m(fu.bind(null,e,t,a,n,r,o,i,s,l,u,d,null,h,g)),void Xc(e,a,i,!c)}fu(e,t,a,n,r,o,i,s,l)}function $c(e){for(var t=e;;){var n=t.tag;if((0===n||11===n||15===n)&&16384&t.flags&&(null!==(n=t.updateQueue)&&null!==(n=n.stores)))for(var r=0;r<n.length;r++){var o=n[r],a=o.getSnapshot;o=o.value;try{if(!Xn(a(),o))return!1}catch(i){return!1}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Xc(e,t,n,r){t&=~Ic,t&=~Ac,e.suspendedLanes|=t,e.pingedLanes&=~t,r&&(e.warmLanes|=t),r=e.expirationTimes;for(var o=t;0<o;){var a=31-we(o),i=1<<a;r[a]=-1,o&=~i}0!==n&&Re(e,n,t)}function Zc(){return 0!==(6&gc)||(Du(0,!1),!1)}function eu(){if(null!==fc){if(0===yc)var e=fc.return;else Ao=Co=null,si(e=fc),la=null,ca=0,e=fc;for(;null!==e;)fl(e.alternate,e),e=e.return;fc=null}}function tu(e,t){var n=e.timeoutHandle;-1!==n&&(e.timeoutHandle=-1,Sd(n)),null!==(n=e.cancelPendingCommit)&&(e.cancelPendingCommit=null,n()),zc=0,eu(),mc=e,fc=n=zr(e.current,null),pc=t,yc=0,vc=null,bc=!1,wc=Pe(e,t),kc=!1,Pc=Tc=Ic=Ac=Cc=xc=0,Nc=Ec=null,_c=!1,0!==(8&t)&&(t|=32&t);var r=e.entangledLanes;if(0!==r)for(e=e.entanglements,r&=t;0<r;){var o=31-we(r),a=1<<o;t|=e[o],r&=~a}return Sc=t,Nr(),n}function nu(e,t){Ba=null,O.H=fs,t===Xo||t===ea?(t=ia(),yc=3):t===Zo?(t=ia(),yc=4):yc=t===Ms?8:null!==t&&"object"===typeof t&&"function"===typeof t.then?6:1,vc=t,null===fc&&(xc=1,Ts(e,Qr(t,e.current)))}function ru(){var e=Ra.current;return null===e||((4194048&pc)===pc?null===Oa:((62914560&pc)===pc||0!==(536870912&pc))&&e===Oa)}function ou(){var e=O.H;return O.H=fs,null===e?fs:e}function au(){var e=O.A;return O.A=dc,e}function iu(){xc=4,bc||(4194048&pc)!==pc&&null!==Ra.current||(wc=!0),0===(134217727&Cc)&&0===(134217727&Ac)||null===mc||Xc(mc,pc,Tc,!1)}function su(e,t,n){var r=gc;gc|=2;var o=ou(),a=au();mc===e&&pc===t||(jc=null,tu(e,t)),t=!1;var i=xc;e:for(;;)try{if(0!==yc&&null!==fc){var s=fc,l=vc;switch(yc){case 8:eu(),i=6;break e;case 3:case 2:case 9:case 6:null===Ra.current&&(t=!0);var c=yc;if(yc=0,vc=null,hu(e,s,l,c),n&&wc){i=0;break e}break;default:c=yc,yc=0,vc=null,hu(e,s,l,c)}}lu(),i=xc;break}catch(u){nu(e,u)}return t&&e.shellSuspendCounter++,Ao=Co=null,gc=r,O.H=o,O.A=a,null===fc&&(mc=null,pc=0,Nr()),i}function lu(){for(;null!==fc;)uu(fc)}function cu(){for(;null!==fc&&!ie();)uu(fc)}function uu(e){var t=il(e.alternate,e,Sc);e.memoizedProps=e.pendingProps,null===t?gu(e):fc=t}function du(e){var t=e,n=t.alternate;switch(t.tag){case 15:case 0:t=Ks(n,t,t.pendingProps,t.type,void 0,pc);break;case 11:t=Ks(n,t,t.pendingProps,t.type.render,t.ref,pc);break;case 5:si(t);default:fl(n,t),t=il(n,t=fc=Ur(t,Sc),Sc)}e.memoizedProps=e.pendingProps,null===t?gu(e):fc=t}function hu(e,t,n,r){Ao=Co=null,si(t),la=null,ca=0;var o=t.return;try{if(function(e,t,n,r,o){if(n.flags|=32768,null!==r&&"object"===typeof r&&"function"===typeof r.then){if(null!==(t=n.alternate)&&No(t,n,o,!0),null!==(n=Ra.current)){switch(n.tag){case 31:case 13:return null===Oa?iu():null===n.alternate&&0===xc&&(xc=3),n.flags&=-257,n.flags|=65536,n.lanes=o,r===ta?n.flags|=16384:(null===(t=n.updateQueue)?n.updateQueue=new Set([r]):t.add(r),Cu(e,r,o)),!1;case 22:return n.flags|=65536,r===ta?n.flags|=16384:(null===(t=n.updateQueue)?(t={transitions:null,markerInstances:null,retryQueue:new Set([r])},n.updateQueue=t):null===(n=t.retryQueue)?t.retryQueue=new Set([r]):n.add(r),Cu(e,r,o)),!1}throw Error(i(435,n.tag))}return Cu(e,r,o),iu(),!1}if(ho)return null!==(t=Ra.current)?(0===(65536&t.flags)&&(t.flags|=256),t.flags|=65536,t.lanes=o,r!==fo&&So(Qr(e=Error(i(422),{cause:r}),n))):(r!==fo&&So(Qr(t=Error(i(423),{cause:r}),n)),(e=e.current.alternate).flags|=65536,o&=-o,e.lanes|=o,r=Qr(r,n),Sa(e,o=Es(e.stateNode,r,o)),4!==xc&&(xc=2)),!1;var a=Error(i(520),{cause:r});if(a=Qr(a,n),null===Ec?Ec=[a]:Ec.push(a),4!==xc&&(xc=2),null===t)return!0;r=Qr(r,n),n=t;do{switch(n.tag){case 3:return n.flags|=65536,e=o&-o,n.lanes|=e,Sa(n,e=Es(n.stateNode,r,e)),!1;case 1:if(t=n.type,a=n.stateNode,0===(128&n.flags)&&("function"===typeof t.getDerivedStateFromError||null!==a&&"function"===typeof a.componentDidCatch&&(null===Dc||!Dc.has(a))))return n.flags|=65536,o&=-o,n.lanes|=o,_s(o=Ns(o),e,n,r),Sa(n,o),!1}n=n.return}while(null!==n);return!1}(e,o,t,n,pc))return xc=1,Ts(e,Qr(n,e.current)),void(fc=null)}catch(a){if(null!==o)throw fc=o,a;return xc=1,Ts(e,Qr(n,e.current)),void(fc=null)}32768&t.flags?(ho||1===r?e=!0:wc||0!==(536870912&pc)?e=!1:(bc=e=!0,(2===r||9===r||3===r||6===r)&&(null!==(r=Ra.current)&&13===r.tag&&(r.flags|=16384))),mu(t,e)):gu(t)}function gu(e){var t=e;do{if(0!==(32768&t.flags))return void mu(t,bc);e=t.return;var n=gl(t.alternate,t,Sc);if(null!==n)return void(fc=n);if(null!==(t=t.sibling))return void(fc=t);fc=t=e}while(null!==t);0===xc&&(xc=5)}function mu(e,t){do{var n=ml(e.alternate,e);if(null!==n)return n.flags&=32767,void(fc=n);if(null!==(n=e.return)&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!t&&null!==(e=e.sibling))return void(fc=e);fc=e=n}while(null!==e);xc=6,fc=null}function fu(e,t,n,r,o,a,s,l,c){e.cancelPendingCommit=null;do{wu()}while(0!==Lc);if(0!==(6&gc))throw Error(i(327));if(null!==t){if(t===e.current)throw Error(i(177));if(a=t.lanes|t.childLanes,function(e,t,n,r,o,a){var i=e.pendingLanes;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=n,e.entangledLanes&=n,e.errorRecoveryDisabledLanes&=n,e.shellSuspendCounter=0;var s=e.entanglements,l=e.expirationTimes,c=e.hiddenUpdates;for(n=i&~n;0<n;){var u=31-we(n),d=1<<u;s[u]=0,l[u]=-1;var h=c[u];if(null!==h)for(c[u]=null,u=0;u<h.length;u++){var g=h[u];null!==g&&(g.lane&=-536870913)}n&=~d}0!==r&&Re(e,r,0),0!==a&&0===o&&0!==e.tag&&(e.suspendedLanes|=a&~(i&~t))}(e,n,a|=Er,s,l,c),e===mc&&(fc=mc=null,pc=0),qc=t,Fc=e,zc=n,Uc=a,Hc=o,Bc=r,0!==(10256&t.subtreeFlags)||0!==(10256&t.flags)?(e.callbackNode=null,e.callbackPriority=0,oe(he,function(){return ku(),null})):(e.callbackNode=null,e.callbackPriority=0),r=0!==(13878&t.flags),0!==(13878&t.subtreeFlags)||r){r=O.T,O.T=null,o=j.p,j.p=2,s=gc,gc|=4;try{!function(e,t){if(e=e.containerInfo,md=bh,or(e=rr(e))){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var o=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{n.nodeType,a.nodeType}catch(p){n=null;break e}var s=0,l=-1,c=-1,u=0,d=0,h=e,g=null;t:for(;;){for(var m;h!==n||0!==o&&3!==h.nodeType||(l=s+o),h!==a||0!==r&&3!==h.nodeType||(c=s+r),3===h.nodeType&&(s+=h.nodeValue.length),null!==(m=h.firstChild);)g=h,h=m;for(;;){if(h===e)break t;if(g===n&&++u===o&&(l=s),g===a&&++d===r&&(c=s),null!==(m=h.nextSibling))break;g=(h=g).parentNode}h=m}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(fd={focusedElem:e,selectionRange:n},bh=!1,Rl=t;null!==Rl;)if(e=(t=Rl).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Rl=e;else for(;null!==Rl;){switch(a=(t=Rl).alternate,e=t.flags,t.tag){case 0:if(0!==(4&e)&&null!==(e=null!==(e=t.updateQueue)?e.events:null))for(n=0;n<e.length;n++)(o=e[n]).ref.impl=o.nextImpl;break;case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:if(0!==(1024&e)&&null!==a){e=void 0,n=t,o=a.memoizedProps,a=a.memoizedState,r=n.stateNode;try{var f=xs(n.type,o);e=r.getSnapshotBeforeUpdate(f,a),r.__reactInternalSnapshotBeforeUpdate=e}catch(y){xu(n,n.return,y)}}break;case 3:if(0!==(1024&e))if(9===(n=(e=t.stateNode.containerInfo).nodeType))Ed(e);else if(1===n)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":Ed(e);break;default:e.textContent=""}break;default:if(0!==(1024&e))throw Error(i(163))}if(null!==(e=t.sibling)){e.return=t.return,Rl=e;break}Rl=t.return}}(e,t)}finally{gc=s,j.p=o,O.T=r}}Lc=1,pu(),yu(),vu()}}function pu(){if(1===Lc){Lc=0;var e=Fc,t=qc,n=0!==(13878&t.flags);if(0!==(13878&t.subtreeFlags)||n){n=O.T,O.T=null;var r=j.p;j.p=2;var o=gc;gc|=4;try{Kl(t,e);var a=fd,i=rr(e.containerInfo),s=a.focusedElem,l=a.selectionRange;if(i!==s&&s&&s.ownerDocument&&nr(s.ownerDocument.documentElement,s)){if(null!==l&&or(s)){var c=l.start,u=l.end;if(void 0===u&&(u=c),"selectionStart"in s)s.selectionStart=c,s.selectionEnd=Math.min(u,s.value.length);else{var d=s.ownerDocument||document,h=d&&d.defaultView||window;if(h.getSelection){var g=h.getSelection(),m=s.textContent.length,f=Math.min(l.start,m),p=void 0===l.end?f:Math.min(l.end,m);!g.extend&&f>p&&(i=p,p=f,f=i);var y=tr(s,f),v=tr(s,p);if(y&&v&&(1!==g.rangeCount||g.anchorNode!==y.node||g.anchorOffset!==y.offset||g.focusNode!==v.node||g.focusOffset!==v.offset)){var b=d.createRange();b.setStart(y.node,y.offset),g.removeAllRanges(),f>p?(g.addRange(b),g.extend(v.node,v.offset)):(b.setEnd(v.node,v.offset),g.addRange(b))}}}}for(d=[],g=s;g=g.parentNode;)1===g.nodeType&&d.push({element:g,left:g.scrollLeft,top:g.scrollTop});for("function"===typeof s.focus&&s.focus(),s=0;s<d.length;s++){var w=d[s];w.element.scrollLeft=w.left,w.element.scrollTop=w.top}}bh=!!md,fd=md=null}finally{gc=o,j.p=r,O.T=n}}e.current=t,Lc=2}}function yu(){if(2===Lc){Lc=0;var e=Fc,t=qc,n=0!==(8772&t.flags);if(0!==(8772&t.subtreeFlags)||n){n=O.T,O.T=null;var r=j.p;j.p=2;var o=gc;gc|=4;try{Ol(e,t.alternate,t)}finally{gc=o,j.p=r,O.T=n}}Lc=3}}function vu(){if(4===Lc||3===Lc){Lc=0,se();var e=Fc,t=qc,n=zc,r=Bc;0!==(10256&t.subtreeFlags)||0!==(10256&t.flags)?Lc=5:(Lc=0,qc=Fc=null,bu(e,e.pendingLanes));var o=e.pendingLanes;if(0===o&&(Dc=null),Le(n),t=t.stateNode,ve&&"function"===typeof ve.onCommitFiberRoot)try{ve.onCommitFiberRoot(ye,t,void 0,128===(128&t.current.flags))}catch(l){}if(null!==r){t=O.T,o=j.p,j.p=2,O.T=null;try{for(var a=e.onRecoverableError,i=0;i<r.length;i++){var s=r[i];a(s.value,{componentStack:s.stack})}}finally{O.T=t,j.p=o}}0!==(3&zc)&&wu(),ju(e),o=e.pendingLanes,0!==(261930&n)&&0!==(42&o)?e===Kc?Wc++:(Wc=0,Kc=e):Wc=0,Du(0,!1)}}function bu(e,t){0===(e.pooledCacheLanes&=t)&&(null!=(t=e.pooledCache)&&(e.pooledCache=null,Uo(t)))}function wu(){return pu(),yu(),vu(),ku()}function ku(){if(5!==Lc)return!1;var e=Fc,t=Uc;Uc=0;var n=Le(zc),r=O.T,o=j.p;try{j.p=32>n?32:n,O.T=null,n=Hc,Hc=null;var a=Fc,s=zc;if(Lc=0,qc=Fc=null,zc=0,0!==(6&gc))throw Error(i(331));var l=gc;if(gc|=4,lc(a.current),ec(a,a.current,s,n),gc=l,Du(0,!1),ve&&"function"===typeof ve.onPostCommitFiberRoot)try{ve.onPostCommitFiberRoot(ye,a)}catch(c){}return!0}finally{j.p=o,O.T=r,bu(e,t)}}function Su(e,t,n){t=Qr(n,t),null!==(e=wa(e,t=Es(e.stateNode,t,2),2))&&(Me(e,2),ju(e))}function xu(e,t,n){if(3===e.tag)Su(e,e,n);else for(;null!==t;){if(3===t.tag){Su(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Dc||!Dc.has(r))){e=Qr(n,e),null!==(r=wa(t,n=Ns(2),2))&&(_s(n,r,t,e),Me(r,2),ju(r));break}}t=t.return}}function Cu(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new hc;var o=new Set;r.set(t,o)}else void 0===(o=r.get(t))&&(o=new Set,r.set(t,o));o.has(n)||(kc=!0,o.add(n),e=Au.bind(null,e,t,n),t.then(e,e))}function Au(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),e.pingedLanes|=e.suspendedLanes&n,e.warmLanes&=~n,mc===e&&(pc&n)===n&&(4===xc||3===xc&&(62914560&pc)===pc&&300>le()-Mc?0===(2&gc)&&tu(e,0):Ic|=n,Pc===pc&&(Pc=0)),ju(e)}function Iu(e,t){0===t&&(t=Ne()),null!==(e=Rr(e,t))&&(Me(e,t),ju(e))}function Tu(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Iu(e,n)}function Pu(e,t){var n=0;switch(e.tag){case 31:case 13:var r=e.stateNode,o=e.memoizedState;null!==o&&(n=o.retryLane);break;case 19:r=e.stateNode;break;case 22:r=e.stateNode._retryCache;break;default:throw Error(i(314))}null!==r&&r.delete(t),Iu(e,n)}var Eu=null,Nu=null,_u=!1,Mu=!1,Ru=!1,Ou=0;function ju(e){e!==Nu&&null===e.next&&(null===Nu?Eu=Nu=e:Nu=Nu.next=e),Mu=!0,_u||(_u=!0,Cd(function(){0!==(6&gc)?oe(ue,Lu):Fu()}))}function Du(e,t){if(!Ru&&Mu){Ru=!0;do{for(var n=!1,r=Eu;null!==r;){if(!t)if(0!==e){var o=r.pendingLanes;if(0===o)var a=0;else{var i=r.suspendedLanes,s=r.pingedLanes;a=(1<<31-we(42|e)+1)-1,a=201326741&(a&=o&~(i&~s))?201326741&a|1:a?2|a:0}0!==a&&(n=!0,Uu(r,a))}else a=pc,0===(3&(a=Te(r,r===mc?a:0,null!==r.cancelPendingCommit||-1!==r.timeoutHandle)))||Pe(r,a)||(n=!0,Uu(r,a));r=r.next}}while(n);Ru=!1}}function Lu(){Fu()}function Fu(){Mu=_u=!1;var e=0;0!==Ou&&function(){var e=window.event;if(e&&"popstate"===e.type)return e!==wd&&(wd=e,!0);return wd=null,!1}()&&(e=Ou);for(var t=le(),n=null,r=Eu;null!==r;){var o=r.next,a=qu(r,t);0===a?(r.next=null,null===n?Eu=o:n.next=o,null===o&&(Nu=n)):(n=r,(0!==e||0!==(3&a))&&(Mu=!0)),r=o}0!==Lc&&5!==Lc||Du(e,!1),0!==Ou&&(Ou=0)}function qu(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,o=e.expirationTimes,a=-62914561&e.pendingLanes;0<a;){var i=31-we(a),s=1<<i,l=o[i];-1===l?0!==(s&n)&&0===(s&r)||(o[i]=Ee(s,t)):l<=t&&(e.expiredLanes|=s),a&=~s}if(n=pc,n=Te(e,e===(t=mc)?n:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle),r=e.callbackNode,0===n||e===t&&(2===yc||9===yc)||null!==e.cancelPendingCommit)return null!==r&&null!==r&&ae(r),e.callbackNode=null,e.callbackPriority=0;if(0===(3&n)||Pe(e,n)){if((t=n&-n)===e.callbackPriority)return t;switch(null!==r&&ae(r),Le(n)){case 2:case 8:n=de;break;case 32:default:n=he;break;case 268435456:n=me}return r=zu.bind(null,e),n=oe(n,r),e.callbackPriority=t,e.callbackNode=n,t}return null!==r&&null!==r&&ae(r),e.callbackPriority=2,e.callbackNode=null,2}function zu(e,t){if(0!==Lc&&5!==Lc)return e.callbackNode=null,e.callbackPriority=0,null;var n=e.callbackNode;if(wu()&&e.callbackNode!==n)return null;var r=pc;return 0===(r=Te(e,e===mc?r:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle))?null:(Yc(e,r,t),qu(e,le()),null!=e.callbackNode&&e.callbackNode===n?zu.bind(null,e):null)}function Uu(e,t){if(wu())return null;Yc(e,t,!0)}function Hu(){if(0===Ou){var e=Wo;0===e&&(e=xe,0===(261888&(xe<<=1))&&(xe=256)),Ou=e}return Ou}function Bu(e){return null==e||"symbol"===typeof e||"boolean"===typeof e?null:"function"===typeof e?e:_t(""+e)}function Wu(e,t){var n=t.ownerDocument.createElement("input");return n.name=t.name,n.value=t.value,e.id&&n.setAttribute("form",e.id),t.parentNode.insertBefore(n,t),e=new FormData(e),n.parentNode.removeChild(n),e}for(var Ku=0;Ku<Cr.length;Ku++){var Vu=Cr[Ku];Ar(Vu.toLowerCase(),"on"+(Vu[0].toUpperCase()+Vu.slice(1)))}Ar(pr,"onAnimationEnd"),Ar(yr,"onAnimationIteration"),Ar(vr,"onAnimationStart"),Ar("dblclick","onDoubleClick"),Ar("focusin","onFocus"),Ar("focusout","onBlur"),Ar(br,"onTransitionRun"),Ar(wr,"onTransitionStart"),Ar(kr,"onTransitionCancel"),Ar(Sr,"onTransitionEnd"),ot("onMouseEnter",["mouseout","mouseover"]),ot("onMouseLeave",["mouseout","mouseover"]),ot("onPointerEnter",["pointerout","pointerover"]),ot("onPointerLeave",["pointerout","pointerover"]),rt("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),rt("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),rt("onBeforeInput",["compositionend","keypress","textInput","paste"]),rt("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),rt("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),rt("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Gu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Qu=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Gu));function Yu(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],o=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var i=r.length-1;0<=i;i--){var s=r[i],l=s.instance,c=s.currentTarget;if(s=s.listener,l!==a&&o.isPropagationStopped())break e;a=s,o.currentTarget=c;try{a(o)}catch(u){Ir(u)}o.currentTarget=null,a=l}else for(i=0;i<r.length;i++){if(l=(s=r[i]).instance,c=s.currentTarget,s=s.listener,l!==a&&o.isPropagationStopped())break e;a=s,o.currentTarget=c;try{a(o)}catch(u){Ir(u)}o.currentTarget=null,a=l}}}}function Ju(e,t){var n=t[We];void 0===n&&(n=t[We]=new Set);var r=e+"__bubble";n.has(r)||(ed(t,e,2,!1),n.add(r))}function $u(e,t,n){var r=0;t&&(r|=4),ed(n,e,r,t)}var Xu="_reactListening"+Math.random().toString(36).slice(2);function Zu(e){if(!e[Xu]){e[Xu]=!0,tt.forEach(function(t){"selectionchange"!==t&&(Qu.has(t)||$u(t,!1,e),$u(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Xu]||(t[Xu]=!0,$u("selectionchange",!1,t))}}function ed(e,t,n,r){switch(Ih(t)){case 2:var o=wh;break;case 8:o=kh;break;default:o=Sh}n=o.bind(null,t,n,e),o=void 0,!Ht||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(o=!0),r?void 0!==o?e.addEventListener(t,n,{capture:!0,passive:o}):e.addEventListener(t,n,!0):void 0!==o?e.addEventListener(t,n,{passive:o}):e.addEventListener(t,n,!1)}function td(e,t,n,r,o){var a=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var i=r.tag;if(3===i||4===i){var s=r.stateNode.containerInfo;if(s===o)break;if(4===i)for(i=r.return;null!==i;){var c=i.tag;if((3===c||4===c)&&i.stateNode.containerInfo===o)return;i=i.return}for(;null!==s;){if(null===(i=Je(s)))return;if(5===(c=i.tag)||6===c||26===c||27===c){r=a=i;continue e}s=s.parentNode}}r=r.return}qt(function(){var r=a,o=Ot(n),i=[];e:{var s=xr.get(e);if(void 0!==s){var c=nn,u=e;switch(e){case"keypress":if(0===Qt(n))break e;case"keydown":case"keyup":c=vn;break;case"focusin":u="focus",c=cn;break;case"focusout":u="blur",c=cn;break;case"beforeblur":case"afterblur":c=cn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=sn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=ln;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=wn;break;case pr:case yr:case vr:c=un;break;case Sr:c=kn;break;case"scroll":case"scrollend":c=on;break;case"wheel":c=Sn;break;case"copy":case"cut":case"paste":c=dn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=bn;break;case"toggle":case"beforetoggle":c=xn}var d=0!==(4&t),h=!d&&("scroll"===e||"scrollend"===e),g=d?null!==s?s+"Capture":null:s;d=[];for(var m,f=r;null!==f;){var p=f;if(m=p.stateNode,5!==(p=p.tag)&&26!==p&&27!==p||null===m||null===g||null!=(p=zt(f,g))&&d.push(nd(f,p,m)),h)break;f=f.return}0<d.length&&(s=new c(s,u,null,n,o),i.push({event:s,listeners:d}))}}if(0===(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===Rt||!(u=n.relatedTarget||n.fromElement)||!Je(u)&&!u[Be])&&(c||s)&&(s=o.window===o?o:(s=o.ownerDocument)?s.defaultView||s.parentWindow:window,c?(c=r,null!==(u=(u=n.relatedTarget||n.toElement)?Je(u):null)&&(h=l(u),d=u.tag,u!==h||5!==d&&27!==d&&6!==d)&&(u=null)):(c=null,u=r),c!==u)){if(d=sn,p="onMouseLeave",g="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(d=bn,p="onPointerLeave",g="onPointerEnter",f="pointer"),h=null==c?s:Xe(c),m=null==u?s:Xe(u),(s=new d(p,f+"leave",c,n,o)).target=h,s.relatedTarget=m,p=null,Je(o)===r&&((d=new d(g,f+"enter",u,n,o)).target=m,d.relatedTarget=h,p=d),h=p,c&&u)e:{for(d=od,f=u,m=0,p=g=c;p;p=d(p))m++;p=0;for(var y=f;y;y=d(y))p++;for(;0<m-p;)g=d(g),m--;for(;0<p-m;)f=d(f),p--;for(;m--;){if(g===f||null!==f&&g===f.alternate){d=g;break e}g=d(g),f=d(f)}d=null}else d=null;null!==c&&ad(i,s,c,d,!1),null!==u&&null!==h&&ad(i,h,u,d,!0)}if("select"===(c=(s=r?Xe(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===c&&"file"===s.type)var v=Un;else if(jn(s))if(Hn)v=$n;else{v=Yn;var b=Qn}else!(c=s.nodeName)||"input"!==c.toLowerCase()||"checkbox"!==s.type&&"radio"!==s.type?r&&Pt(r.elementType)&&(v=Un):v=Jn;switch(v&&(v=v(e,r))?Dn(i,v,n,o):(b&&b(e,s,r),"focusout"===e&&r&&"number"===s.type&&null!=r.memoizedProps.value&&wt(s,"number",s.value)),b=r?Xe(r):window,e){case"focusin":(jn(b)||"true"===b.contentEditable)&&(ir=b,sr=r,lr=null);break;case"focusout":lr=sr=ir=null;break;case"mousedown":cr=!0;break;case"contextmenu":case"mouseup":case"dragend":cr=!1,ur(i,n,o);break;case"selectionchange":if(ar)break;case"keydown":case"keyup":ur(i,n,o)}var w;if(An)e:{switch(e){case"compositionstart":var k="onCompositionStart";break e;case"compositionend":k="onCompositionEnd";break e;case"compositionupdate":k="onCompositionUpdate";break e}k=void 0}else Rn?_n(e,n)&&(k="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(k="onCompositionStart");k&&(Pn&&"ko"!==n.locale&&(Rn||"onCompositionStart"!==k?"onCompositionEnd"===k&&Rn&&(w=Gt()):(Kt="value"in(Wt=o)?Wt.value:Wt.textContent,Rn=!0)),0<(b=rd(r,k)).length&&(k=new hn(k,e,null,n,o),i.push({event:k,listeners:b}),w?k.data=w:null!==(w=Mn(n))&&(k.data=w))),(w=Tn?function(e,t){switch(e){case"compositionend":return Mn(t);case"keypress":return 32!==t.which?null:(Nn=!0,En);case"textInput":return(e=t.data)===En&&Nn?null:e;default:return null}}(e,n):function(e,t){if(Rn)return"compositionend"===e||!An&&_n(e,t)?(e=Gt(),Vt=Kt=Wt=null,Rn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Pn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(k=rd(r,"onBeforeInput")).length&&(b=new hn("onBeforeInput","beforeinput",null,n,o),i.push({event:b,listeners:k}),b.data=w)),function(e,t,n,r,o){if("submit"===t&&n&&n.stateNode===o){var a=Bu((o[He]||null).action),i=r.submitter;i&&null!==(t=(t=i[He]||null)?Bu(t.formAction):i.getAttribute("formAction"))&&(a=t,i=null);var s=new nn("action","action",null,r,o);e.push({event:s,listeners:[{instance:null,listener:function(){if(r.defaultPrevented){if(0!==Ou){var e=i?Wu(o,i):new FormData(o);ts(n,{pending:!0,data:e,method:o.method,action:a},null,e)}}else"function"===typeof a&&(s.preventDefault(),e=i?Wu(o,i):new FormData(o),ts(n,{pending:!0,data:e,method:o.method,action:a},a,e))},currentTarget:o}]})}}(i,e,r,n,o)}Yu(i,t)})}function nd(e,t,n){return{instance:e,listener:t,currentTarget:n}}function rd(e,t){for(var n=t+"Capture",r=[];null!==e;){var o=e,a=o.stateNode;if(5!==(o=o.tag)&&26!==o&&27!==o||null===a||(null!=(o=zt(e,n))&&r.unshift(nd(e,o,a)),null!=(o=zt(e,t))&&r.push(nd(e,o,a))),3===e.tag)return r;e=e.return}return[]}function od(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag&&27!==e.tag);return e||null}function ad(e,t,n,r,o){for(var a=t._reactName,i=[];null!==n&&n!==r;){var s=n,l=s.alternate,c=s.stateNode;if(s=s.tag,null!==l&&l===r)break;5!==s&&26!==s&&27!==s||null===c||(l=c,o?null!=(c=zt(n,a))&&i.unshift(nd(n,c,l)):o||null!=(c=zt(n,a))&&i.push(nd(n,c,l))),n=n.return}0!==i.length&&e.push({event:t,listeners:i})}var id=/\r\n?/g,sd=/\u0000|\uFFFD/g;function ld(e){return("string"===typeof e?e:""+e).replace(id,"\n").replace(sd,"")}function cd(e,t){return t=ld(t),ld(e)===t}function ud(e,t,n,r,o,a){switch(n){case"children":"string"===typeof r?"body"===t||"textarea"===t&&""===r||Ct(e,r):("number"===typeof r||"bigint"===typeof r)&&"body"!==t&&Ct(e,""+r);break;case"className":ct(e,"class",r);break;case"tabIndex":ct(e,"tabindex",r);break;case"dir":case"role":case"viewBox":case"width":case"height":ct(e,n,r);break;case"style":Tt(e,r,a);break;case"data":if("object"!==t){ct(e,"data",r);break}case"src":case"href":if(""===r&&("a"!==t||"href"!==n)){e.removeAttribute(n);break}if(null==r||"function"===typeof r||"symbol"===typeof r||"boolean"===typeof r){e.removeAttribute(n);break}r=_t(""+r),e.setAttribute(n,r);break;case"action":case"formAction":if("function"===typeof r){e.setAttribute(n,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"===typeof a&&("formAction"===n?("input"!==t&&ud(e,t,"name",o.name,o,null),ud(e,t,"formEncType",o.formEncType,o,null),ud(e,t,"formMethod",o.formMethod,o,null),ud(e,t,"formTarget",o.formTarget,o,null)):(ud(e,t,"encType",o.encType,o,null),ud(e,t,"method",o.method,o,null),ud(e,t,"target",o.target,o,null))),null==r||"symbol"===typeof r||"boolean"===typeof r){e.removeAttribute(n);break}r=_t(""+r),e.setAttribute(n,r);break;case"onClick":null!=r&&(e.onclick=Mt);break;case"onScroll":null!=r&&Ju("scroll",e);break;case"onScrollEnd":null!=r&&Ju("scrollend",e);break;case"dangerouslySetInnerHTML":if(null!=r){if("object"!==typeof r||!("__html"in r))throw Error(i(61));if(null!=(n=r.__html)){if(null!=o.children)throw Error(i(60));e.innerHTML=n}}break;case"multiple":e.multiple=r&&"function"!==typeof r&&"symbol"!==typeof r;break;case"muted":e.muted=r&&"function"!==typeof r&&"symbol"!==typeof r;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":break;case"xlinkHref":if(null==r||"function"===typeof r||"boolean"===typeof r||"symbol"===typeof r){e.removeAttribute("xlink:href");break}n=_t(""+r),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=r&&"function"!==typeof r&&"symbol"!==typeof r?e.setAttribute(n,""+r):e.removeAttribute(n);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":r&&"function"!==typeof r&&"symbol"!==typeof r?e.setAttribute(n,""):e.removeAttribute(n);break;case"capture":case"download":!0===r?e.setAttribute(n,""):!1!==r&&null!=r&&"function"!==typeof r&&"symbol"!==typeof r?e.setAttribute(n,r):e.removeAttribute(n);break;case"cols":case"rows":case"size":case"span":null!=r&&"function"!==typeof r&&"symbol"!==typeof r&&!isNaN(r)&&1<=r?e.setAttribute(n,r):e.removeAttribute(n);break;case"rowSpan":case"start":null==r||"function"===typeof r||"symbol"===typeof r||isNaN(r)?e.removeAttribute(n):e.setAttribute(n,r);break;case"popover":Ju("beforetoggle",e),Ju("toggle",e),lt(e,"popover",r);break;case"xlinkActuate":ut(e,"http://www.w3.org/1999/xlink","xlink:actuate",r);break;case"xlinkArcrole":ut(e,"http://www.w3.org/1999/xlink","xlink:arcrole",r);break;case"xlinkRole":ut(e,"http://www.w3.org/1999/xlink","xlink:role",r);break;case"xlinkShow":ut(e,"http://www.w3.org/1999/xlink","xlink:show",r);break;case"xlinkTitle":ut(e,"http://www.w3.org/1999/xlink","xlink:title",r);break;case"xlinkType":ut(e,"http://www.w3.org/1999/xlink","xlink:type",r);break;case"xmlBase":ut(e,"http://www.w3.org/XML/1998/namespace","xml:base",r);break;case"xmlLang":ut(e,"http://www.w3.org/XML/1998/namespace","xml:lang",r);break;case"xmlSpace":ut(e,"http://www.w3.org/XML/1998/namespace","xml:space",r);break;case"is":lt(e,"is",r);break;case"innerText":case"textContent":break;default:(!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1])&&lt(e,n=Et.get(n)||n,r)}}function dd(e,t,n,r,o,a){switch(n){case"style":Tt(e,r,a);break;case"dangerouslySetInnerHTML":if(null!=r){if("object"!==typeof r||!("__html"in r))throw Error(i(61));if(null!=(n=r.__html)){if(null!=o.children)throw Error(i(60));e.innerHTML=n}}break;case"children":"string"===typeof r?Ct(e,r):("number"===typeof r||"bigint"===typeof r)&&Ct(e,""+r);break;case"onScroll":null!=r&&Ju("scroll",e);break;case"onScrollEnd":null!=r&&Ju("scrollend",e);break;case"onClick":null!=r&&(e.onclick=Mt);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":break;default:nt.hasOwnProperty(n)||("o"!==n[0]||"n"!==n[1]||(o=n.endsWith("Capture"),t=n.slice(2,o?n.length-7:void 0),"function"===typeof(a=null!=(a=e[He]||null)?a[n]:null)&&e.removeEventListener(t,a,o),"function"!==typeof r)?n in e?e[n]=r:!0===r?e.setAttribute(n,""):lt(e,n,r):("function"!==typeof a&&null!==a&&(n in e?e[n]=null:e.hasAttribute(n)&&e.removeAttribute(n)),e.addEventListener(t,r,o)))}}function hd(e,t,n){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ju("error",e),Ju("load",e);var r,o=!1,a=!1;for(r in n)if(n.hasOwnProperty(r)){var s=n[r];if(null!=s)switch(r){case"src":o=!0;break;case"srcSet":a=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,t));default:ud(e,t,r,s,n,null)}}return a&&ud(e,t,"srcSet",n.srcSet,n,null),void(o&&ud(e,t,"src",n.src,n,null));case"input":Ju("invalid",e);var l=r=s=a=null,c=null,u=null;for(o in n)if(n.hasOwnProperty(o)){var d=n[o];if(null!=d)switch(o){case"name":a=d;break;case"type":s=d;break;case"checked":c=d;break;case"defaultChecked":u=d;break;case"value":r=d;break;case"defaultValue":l=d;break;case"children":case"dangerouslySetInnerHTML":if(null!=d)throw Error(i(137,t));break;default:ud(e,t,o,d,n,null)}}return void bt(e,r,l,c,u,s,a,!1);case"select":for(a in Ju("invalid",e),o=s=r=null,n)if(n.hasOwnProperty(a)&&null!=(l=n[a]))switch(a){case"value":r=l;break;case"defaultValue":s=l;break;case"multiple":o=l;default:ud(e,t,a,l,n,null)}return t=r,n=s,e.multiple=!!o,void(null!=t?kt(e,!!o,t,!1):null!=n&&kt(e,!!o,n,!0));case"textarea":for(s in Ju("invalid",e),r=a=o=null,n)if(n.hasOwnProperty(s)&&null!=(l=n[s]))switch(s){case"value":o=l;break;case"defaultValue":a=l;break;case"children":r=l;break;case"dangerouslySetInnerHTML":if(null!=l)throw Error(i(91));break;default:ud(e,t,s,l,n,null)}return void xt(e,o,a,r);case"option":for(c in n)if(n.hasOwnProperty(c)&&null!=(o=n[c]))if("selected"===c)e.selected=o&&"function"!==typeof o&&"symbol"!==typeof o;else ud(e,t,c,o,n,null);return;case"dialog":Ju("beforetoggle",e),Ju("toggle",e),Ju("cancel",e),Ju("close",e);break;case"iframe":case"object":Ju("load",e);break;case"video":case"audio":for(o=0;o<Gu.length;o++)Ju(Gu[o],e);break;case"image":Ju("error",e),Ju("load",e);break;case"details":Ju("toggle",e);break;case"embed":case"source":case"link":Ju("error",e),Ju("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(u in n)if(n.hasOwnProperty(u)&&null!=(o=n[u]))switch(u){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,t));default:ud(e,t,u,o,n,null)}return;default:if(Pt(t)){for(d in n)n.hasOwnProperty(d)&&(void 0!==(o=n[d])&&dd(e,t,d,o,n,void 0));return}}for(l in n)n.hasOwnProperty(l)&&(null!=(o=n[l])&&ud(e,t,l,o,n,null))}function gd(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}var md=null,fd=null;function pd(e){return 9===e.nodeType?e:e.ownerDocument}function yd(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function vd(e,t){if(0===e)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return 1===e&&"foreignObject"===t?0:e}function bd(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"bigint"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var wd=null;var kd="function"===typeof setTimeout?setTimeout:void 0,Sd="function"===typeof clearTimeout?clearTimeout:void 0,xd="function"===typeof Promise?Promise:void 0,Cd="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof xd?function(e){return xd.resolve(null).then(e).catch(Ad)}:kd;function Ad(e){setTimeout(function(){throw e})}function Id(e){return"head"===e}function Td(e,t){var n=t,r=0;do{var o=n.nextSibling;if(e.removeChild(n),o&&8===o.nodeType)if("/$"===(n=o.data)||"/&"===n){if(0===r)return e.removeChild(o),void Wh(t);r--}else if("$"===n||"$?"===n||"$~"===n||"$!"===n||"&"===n)r++;else if("html"===n)Fd(e.ownerDocument.documentElement);else if("head"===n){Fd(n=e.ownerDocument.head);for(var a=n.firstChild;a;){var i=a.nextSibling,s=a.nodeName;a[Qe]||"SCRIPT"===s||"STYLE"===s||"LINK"===s&&"stylesheet"===a.rel.toLowerCase()||n.removeChild(a),a=i}}else"body"===n&&Fd(e.ownerDocument.body);n=o}while(n);Wh(t)}function Pd(e,t){var n=e;e=0;do{var r=n.nextSibling;if(1===n.nodeType?t?(n._stashedDisplay=n.style.display,n.style.display="none"):(n.style.display=n._stashedDisplay||"",""===n.getAttribute("style")&&n.removeAttribute("style")):3===n.nodeType&&(t?(n._stashedText=n.nodeValue,n.nodeValue=""):n.nodeValue=n._stashedText||""),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0===e)break;e--}else"$"!==n&&"$?"!==n&&"$~"!==n&&"$!"!==n||e++;n=r}while(n)}function Ed(e){var t=e.firstChild;for(t&&10===t.nodeType&&(t=t.nextSibling);t;){var n=t;switch(t=t.nextSibling,n.nodeName){case"HTML":case"HEAD":case"BODY":Ed(n),Ye(n);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===n.rel.toLowerCase())continue}e.removeChild(n)}}function Nd(e,t){for(;8!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!t)return null;if(null===(e=Rd(e.nextSibling)))return null}return e}function _d(e){return"$?"===e.data||"$~"===e.data}function Md(e){return"$!"===e.data||"$?"===e.data&&"loading"!==e.ownerDocument.readyState}function Rd(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t||"$~"===t||"&"===t||"F!"===t||"F"===t)break;if("/$"===t||"/&"===t)return null}}return e}var Od=null;function jd(e){e=e.nextSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n||"/&"===n){if(0===t)return Rd(e.nextSibling);t--}else"$"!==n&&"$!"!==n&&"$?"!==n&&"$~"!==n&&"&"!==n||t++}e=e.nextSibling}return null}function Dd(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n||"$~"===n||"&"===n){if(0===t)return e;t--}else"/$"!==n&&"/&"!==n||t++}e=e.previousSibling}return null}function Ld(e,t,n){switch(t=pd(n),e){case"html":if(!(e=t.documentElement))throw Error(i(452));return e;case"head":if(!(e=t.head))throw Error(i(453));return e;case"body":if(!(e=t.body))throw Error(i(454));return e;default:throw Error(i(451))}}function Fd(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);Ye(e)}var qd=new Map,zd=new Set;function Ud(e){return"function"===typeof e.getRootNode?e.getRootNode():9===e.nodeType?e:e.ownerDocument}var Hd=j.d;j.d={f:function(){var e=Hd.f(),t=Zc();return e||t},r:function(e){var t=$e(e);null!==t&&5===t.tag&&"form"===t.type?rs(t):Hd.r(e)},D:function(e){Hd.D(e),Wd("dns-prefetch",e,null)},C:function(e,t){Hd.C(e,t),Wd("preconnect",e,t)},L:function(e,t,n){Hd.L(e,t,n);var r=Bd;if(r&&e&&t){var o='link[rel="preload"][as="'+yt(t)+'"]';"image"===t&&n&&n.imageSrcSet?(o+='[imagesrcset="'+yt(n.imageSrcSet)+'"]',"string"===typeof n.imageSizes&&(o+='[imagesizes="'+yt(n.imageSizes)+'"]')):o+='[href="'+yt(e)+'"]';var a=o;switch(t){case"style":a=Vd(e);break;case"script":a=Yd(e)}qd.has(a)||(e=g({rel:"preload",href:"image"===t&&n&&n.imageSrcSet?void 0:e,as:t},n),qd.set(a,e),null!==r.querySelector(o)||"style"===t&&r.querySelector(Gd(a))||"script"===t&&r.querySelector(Jd(a))||(hd(t=r.createElement("link"),"link",e),et(t),r.head.appendChild(t)))}},m:function(e,t){Hd.m(e,t);var n=Bd;if(n&&e){var r=t&&"string"===typeof t.as?t.as:"script",o='link[rel="modulepreload"][as="'+yt(r)+'"][href="'+yt(e)+'"]',a=o;switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":a=Yd(e)}if(!qd.has(a)&&(e=g({rel:"modulepreload",href:e},t),qd.set(a,e),null===n.querySelector(o))){switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(n.querySelector(Jd(a)))return}hd(r=n.createElement("link"),"link",e),et(r),n.head.appendChild(r)}}},X:function(e,t){Hd.X(e,t);var n=Bd;if(n&&e){var r=Ze(n).hoistableScripts,o=Yd(e),a=r.get(o);a||((a=n.querySelector(Jd(o)))||(e=g({src:e,async:!0},t),(t=qd.get(o))&&eh(e,t),et(a=n.createElement("script")),hd(a,"link",e),n.head.appendChild(a)),a={type:"script",instance:a,count:1,state:null},r.set(o,a))}},S:function(e,t,n){Hd.S(e,t,n);var r=Bd;if(r&&e){var o=Ze(r).hoistableStyles,a=Vd(e);t=t||"default";var i=o.get(a);if(!i){var s={loading:0,preload:null};if(i=r.querySelector(Gd(a)))s.loading=5;else{e=g({rel:"stylesheet",href:e,"data-precedence":t},n),(n=qd.get(a))&&Zd(e,n);var l=i=r.createElement("link");et(l),hd(l,"link",e),l._p=new Promise(function(e,t){l.onload=e,l.onerror=t}),l.addEventListener("load",function(){s.loading|=1}),l.addEventListener("error",function(){s.loading|=2}),s.loading|=4,Xd(i,t,r)}i={type:"stylesheet",instance:i,count:1,state:s},o.set(a,i)}}},M:function(e,t){Hd.M(e,t);var n=Bd;if(n&&e){var r=Ze(n).hoistableScripts,o=Yd(e),a=r.get(o);a||((a=n.querySelector(Jd(o)))||(e=g({src:e,async:!0,type:"module"},t),(t=qd.get(o))&&eh(e,t),et(a=n.createElement("script")),hd(a,"link",e),n.head.appendChild(a)),a={type:"script",instance:a,count:1,state:null},r.set(o,a))}}};var Bd="undefined"===typeof document?null:document;function Wd(e,t,n){var r=Bd;if(r&&"string"===typeof t&&t){var o=yt(t);o='link[rel="'+e+'"][href="'+o+'"]',"string"===typeof n&&(o+='[crossorigin="'+n+'"]'),zd.has(o)||(zd.add(o),e={rel:e,crossOrigin:n,href:t},null===r.querySelector(o)&&(hd(t=r.createElement("link"),"link",e),et(t),r.head.appendChild(t)))}}function Kd(e,t,n,r){var o,a,s,l,c=(c=V.current)?Ud(c):null;if(!c)throw Error(i(446));switch(e){case"meta":case"title":return null;case"style":return"string"===typeof n.precedence&&"string"===typeof n.href?(t=Vd(n.href),(r=(n=Ze(c).hoistableStyles).get(t))||(r={type:"style",instance:null,count:0,state:null},n.set(t,r)),r):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===n.rel&&"string"===typeof n.href&&"string"===typeof n.precedence){e=Vd(n.href);var u=Ze(c).hoistableStyles,d=u.get(e);if(d||(c=c.ownerDocument||c,d={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},u.set(e,d),(u=c.querySelector(Gd(e)))&&!u._p&&(d.instance=u,d.state.loading=5),qd.has(e)||(n={rel:"preload",as:"style",href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy},qd.set(e,n),u||(o=c,a=e,s=n,l=d.state,o.querySelector('link[rel="preload"][as="style"]['+a+"]")?l.loading=1:(a=o.createElement("link"),l.preload=a,a.addEventListener("load",function(){return l.loading|=1}),a.addEventListener("error",function(){return l.loading|=2}),hd(a,"link",s),et(a),o.head.appendChild(a))))),t&&null===r)throw Error(i(528,""));return d}if(t&&null!==r)throw Error(i(529,""));return null;case"script":return t=n.async,"string"===typeof(n=n.src)&&t&&"function"!==typeof t&&"symbol"!==typeof t?(t=Yd(n),(r=(n=Ze(c).hoistableScripts).get(t))||(r={type:"script",instance:null,count:0,state:null},n.set(t,r)),r):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,e))}}function Vd(e){return'href="'+yt(e)+'"'}function Gd(e){return'link[rel="stylesheet"]['+e+"]"}function Qd(e){return g({},e,{"data-precedence":e.precedence,precedence:null})}function Yd(e){return'[src="'+yt(e)+'"]'}function Jd(e){return"script[async]"+e}function $d(e,t,n){if(t.count++,null===t.instance)switch(t.type){case"style":var r=e.querySelector('style[data-href~="'+yt(n.href)+'"]');if(r)return t.instance=r,et(r),r;var o=g({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null});return et(r=(e.ownerDocument||e).createElement("style")),hd(r,"style",o),Xd(r,n.precedence,e),t.instance=r;case"stylesheet":o=Vd(n.href);var a=e.querySelector(Gd(o));if(a)return t.state.loading|=4,t.instance=a,et(a),a;r=Qd(n),(o=qd.get(o))&&Zd(r,o),et(a=(e.ownerDocument||e).createElement("link"));var s=a;return s._p=new Promise(function(e,t){s.onload=e,s.onerror=t}),hd(a,"link",r),t.state.loading|=4,Xd(a,n.precedence,e),t.instance=a;case"script":return a=Yd(n.src),(o=e.querySelector(Jd(a)))?(t.instance=o,et(o),o):(r=n,(o=qd.get(a))&&eh(r=g({},n),o),et(o=(e=e.ownerDocument||e).createElement("script")),hd(o,"link",r),e.head.appendChild(o),t.instance=o);case"void":return null;default:throw Error(i(443,t.type))}else"stylesheet"===t.type&&0===(4&t.state.loading)&&(r=t.instance,t.state.loading|=4,Xd(r,n.precedence,e));return t.instance}function Xd(e,t,n){for(var r=n.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),o=r.length?r[r.length-1]:null,a=o,i=0;i<r.length;i++){var s=r[i];if(s.dataset.precedence===t)a=s;else if(a!==o)break}a?a.parentNode.insertBefore(e,a.nextSibling):(t=9===n.nodeType?n.head:n).insertBefore(e,t.firstChild)}function Zd(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.title&&(e.title=t.title)}function eh(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.integrity&&(e.integrity=t.integrity)}var th=null;function nh(e,t,n){if(null===th){var r=new Map,o=th=new Map;o.set(n,r)}else(r=(o=th).get(n))||(r=new Map,o.set(n,r));if(r.has(e))return r;for(r.set(e,null),n=n.getElementsByTagName(e),o=0;o<n.length;o++){var a=n[o];if(!(a[Qe]||a[Ue]||"link"===e&&"stylesheet"===a.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==a.namespaceURI){var i=a.getAttribute(t)||"";i=e+i;var s=r.get(i);s?s.push(a):r.set(i,[a])}}return r}function rh(e,t,n){(e=e.ownerDocument||e).head.insertBefore(n,"title"===t?e.querySelector("head > title"):null)}function oh(e){return"stylesheet"!==e.type||0!==(3&e.state.loading)}var ah=0;function ih(){if(this.count--,0===this.count&&(0===this.imgCount||!this.waitingForImages))if(this.stylesheets)lh(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}var sh=null;function lh(e,t){e.stylesheets=null,null!==e.unsuspend&&(e.count++,sh=new Map,t.forEach(ch,e),sh=null,ih.call(e))}function ch(e,t){if(!(4&t.state.loading)){var n=sh.get(e);if(n)var r=n.get(null);else{n=new Map,sh.set(e,n);for(var o=e.querySelectorAll("link[data-precedence],style[data-precedence]"),a=0;a<o.length;a++){var i=o[a];"LINK"!==i.nodeName&&"not all"===i.getAttribute("media")||(n.set(i.dataset.precedence,i),r=i)}r&&n.set(null,r)}i=(o=t.instance).getAttribute("data-precedence"),(a=n.get(i)||r)===r&&n.set(null,o),n.set(i,o),this.count++,r=ih.bind(this),o.addEventListener("load",r),o.addEventListener("error",r),a?a.parentNode.insertBefore(o,a.nextSibling):(e=9===e.nodeType?e.head:e).insertBefore(o,e.firstChild),t.state.loading|=4}}var uh={$$typeof:k,Provider:null,Consumer:null,_currentValue:D,_currentValue2:D,_threadCount:0};function dh(e,t,n,r,o,a,i,s,l){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=_e(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=_e(0),this.hiddenUpdates=_e(null),this.identifierPrefix=r,this.onUncaughtError=o,this.onCaughtError=a,this.onRecoverableError=i,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=l,this.incompleteTransitions=new Map}function hh(e,t,n,r,o,a,i,s,l,c,u,d){return e=new dh(e,t,n,i,l,c,u,d,s),t=1,!0===a&&(t|=24),a=Fr(3,null,null,t),e.current=a,a.stateNode=e,(t=zo()).refCount++,e.pooledCache=t,t.refCount++,a.memoizedState={element:r,isDehydrated:n,cache:t},ya(a),e}function gh(e){return e?e=Dr:Dr}function mh(e,t,n,r,o,a){o=gh(o),null===r.context?r.context=o:r.pendingContext=o,(r=ba(t)).payload={element:n},null!==(a=void 0===a?null:a)&&(r.callback=a),null!==(n=wa(e,r,t))&&(Qc(n,0,t),ka(n,e,t))}function fh(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function ph(e,t){fh(e,t),(e=e.alternate)&&fh(e,t)}function yh(e){if(13===e.tag||31===e.tag){var t=Rr(e,67108864);null!==t&&Qc(t,0,67108864),ph(e,67108864)}}function vh(e){if(13===e.tag||31===e.tag){var t=Vc(),n=Rr(e,t=De(t));null!==n&&Qc(n,0,t),ph(e,t)}}var bh=!0;function wh(e,t,n,r){var o=O.T;O.T=null;var a=j.p;try{j.p=2,Sh(e,t,n,r)}finally{j.p=a,O.T=o}}function kh(e,t,n,r){var o=O.T;O.T=null;var a=j.p;try{j.p=8,Sh(e,t,n,r)}finally{j.p=a,O.T=o}}function Sh(e,t,n,r){if(bh){var o=xh(r);if(null===o)td(e,t,r,Ch,n),jh(e,r);else if(function(e,t,n,r,o){switch(t){case"focusin":return Ph=Dh(Ph,e,t,n,r,o),!0;case"dragenter":return Eh=Dh(Eh,e,t,n,r,o),!0;case"mouseover":return Nh=Dh(Nh,e,t,n,r,o),!0;case"pointerover":var a=o.pointerId;return _h.set(a,Dh(_h.get(a)||null,e,t,n,r,o)),!0;case"gotpointercapture":return a=o.pointerId,Mh.set(a,Dh(Mh.get(a)||null,e,t,n,r,o)),!0}return!1}(o,e,t,n,r))r.stopPropagation();else if(jh(e,r),4&t&&-1<Oh.indexOf(e)){for(;null!==o;){var a=$e(o);if(null!==a)switch(a.tag){case 3:if((a=a.stateNode).current.memoizedState.isDehydrated){var i=Ie(a.pendingLanes);if(0!==i){var s=a;for(s.pendingLanes|=2,s.entangledLanes|=2;i;){var l=1<<31-we(i);s.entanglements[1]|=l,i&=~l}ju(a),0===(6&gc)&&(Oc=le()+500,Du(0,!1))}}break;case 31:case 13:null!==(s=Rr(a,2))&&Qc(s,0,2),Zc(),ph(a,2)}if(null===(a=xh(r))&&td(e,t,r,Ch,n),a===o)break;o=a}null!==o&&r.stopPropagation()}else td(e,t,r,null,n)}}function xh(e){return Ah(e=Ot(e))}var Ch=null;function Ah(e){if(Ch=null,null!==(e=Je(e))){var t=l(e);if(null===t)e=null;else{var n=t.tag;if(13===n){if(null!==(e=c(t)))return e;e=null}else if(31===n){if(null!==(e=u(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return Ch=e,null}function Ih(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ce()){case ue:return 2;case de:return 8;case he:case ge:return 32;case me:return 268435456;default:return 32}default:return 32}}var Th=!1,Ph=null,Eh=null,Nh=null,_h=new Map,Mh=new Map,Rh=[],Oh="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function jh(e,t){switch(e){case"focusin":case"focusout":Ph=null;break;case"dragenter":case"dragleave":Eh=null;break;case"mouseover":case"mouseout":Nh=null;break;case"pointerover":case"pointerout":_h.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Mh.delete(t.pointerId)}}function Dh(e,t,n,r,o,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[o]},null!==t&&(null!==(t=$e(t))&&yh(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==o&&-1===t.indexOf(o)&&t.push(o),e)}function Lh(e){var t=Je(e.target);if(null!==t){var n=l(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=c(n)))return e.blockedOn=t,void qe(e.priority,function(){vh(n)})}else if(31===t){if(null!==(t=u(n)))return e.blockedOn=t,void qe(e.priority,function(){vh(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Fh(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=xh(e.nativeEvent);if(null!==n)return null!==(t=$e(n))&&yh(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);Rt=r,n.target.dispatchEvent(r),Rt=null,t.shift()}return!0}function qh(e,t,n){Fh(e)&&n.delete(t)}function zh(){Th=!1,null!==Ph&&Fh(Ph)&&(Ph=null),null!==Eh&&Fh(Eh)&&(Eh=null),null!==Nh&&Fh(Nh)&&(Nh=null),_h.forEach(qh),Mh.forEach(qh)}function Uh(e,t){e.blockedOn===t&&(e.blockedOn=null,Th||(Th=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,zh)))}var Hh=null;function Bh(e){Hh!==e&&(Hh=e,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){Hh===e&&(Hh=null);for(var t=0;t<e.length;t+=3){var n=e[t],r=e[t+1],o=e[t+2];if("function"!==typeof r){if(null===Ah(r||n))continue;break}var a=$e(n);null!==a&&(e.splice(t,3),t-=3,ts(a,{pending:!0,data:o,method:n.method,action:r},r,o))}}))}function Wh(e){function t(t){return Uh(t,e)}null!==Ph&&Uh(Ph,e),null!==Eh&&Uh(Eh,e),null!==Nh&&Uh(Nh,e),_h.forEach(t),Mh.forEach(t);for(var n=0;n<Rh.length;n++){var r=Rh[n];r.blockedOn===e&&(r.blockedOn=null)}for(;0<Rh.length&&null===(n=Rh[0]).blockedOn;)Lh(n),null===n.blockedOn&&Rh.shift();if(null!=(n=(e.ownerDocument||e).$$reactFormReplay))for(r=0;r<n.length;r+=3){var o=n[r],a=n[r+1],i=o[He]||null;if("function"===typeof a)i||Bh(n);else if(i){var s=null;if(a&&a.hasAttribute("formAction")){if(o=a,i=a[He]||null)s=i.formAction;else if(null!==Ah(o))continue}else s=i.action;"function"===typeof s?n[r+1]=s:(n.splice(r,3),r-=3),Bh(n)}}}function Kh(){function e(e){e.canIntercept&&"react-transition"===e.info&&e.intercept({handler:function(){return new Promise(function(e){return o=e})},focusReset:"manual",scroll:"manual"})}function t(){null!==o&&(o(),o=null),r||setTimeout(n,20)}function n(){if(!r&&!navigation.transition){var e=navigation.currentEntry;e&&null!=e.url&&navigation.navigate(e.url,{state:e.getState(),info:"react-transition",history:"replace"})}}if("object"===typeof navigation){var r=!1,o=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",t),navigation.addEventListener("navigateerror",t),setTimeout(n,100),function(){r=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",t),navigation.removeEventListener("navigateerror",t),null!==o&&(o(),o=null)}}}function Vh(e){this._internalRoot=e}function Gh(e){this._internalRoot=e}Gh.prototype.render=Vh.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(i(409));mh(t.current,Vc(),e,t,null,null)},Gh.prototype.unmount=Vh.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;mh(e.current,2,null,e,null,null),Zc(),t[Be]=null}},Gh.prototype.unstable_scheduleHydration=function(e){if(e){var t=Fe();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Rh.length&&0!==t&&t<Rh[n].priority;n++);Rh.splice(n,0,e),0===n&&Lh(e)}};var Qh=o.version;if("19.2.0"!==Qh)throw Error(i(527,Qh,"19.2.0"));j.findDOMNode=function(e){var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(i(188));throw e=Object.keys(e).join(","),Error(i(268,e))}return e=function(e){var t=e.alternate;if(!t){if(null===(t=l(e)))throw Error(i(188));return t!==e?null:e}for(var n=e,r=t;;){var o=n.return;if(null===o)break;var a=o.alternate;if(null===a){if(null!==(r=o.return)){n=r;continue}break}if(o.child===a.child){for(a=o.child;a;){if(a===n)return d(o),e;if(a===r)return d(o),t;a=a.sibling}throw Error(i(188))}if(n.return!==r.return)n=o,r=a;else{for(var s=!1,c=o.child;c;){if(c===n){s=!0,n=o,r=a;break}if(c===r){s=!0,r=o,n=a;break}c=c.sibling}if(!s){for(c=a.child;c;){if(c===n){s=!0,n=a,r=o;break}if(c===r){s=!0,r=a,n=o;break}c=c.sibling}if(!s)throw Error(i(189))}}if(n.alternate!==r)throw Error(i(190))}if(3!==n.tag)throw Error(i(188));return n.stateNode.current===n?e:t}(t),e=null===(e=null!==e?h(e):null)?null:e.stateNode};var Yh={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:O,reconcilerVersion:"19.2.0"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var Jh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Jh.isDisabled&&Jh.supportsFiber)try{ye=Jh.inject(Yh),ve=Jh}catch(Xh){}}t.createRoot=function(e,t){if(!s(e))throw Error(i(299));var n=!1,r="",o=Cs,a=As,l=Is;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onUncaughtError&&(o=t.onUncaughtError),void 0!==t.onCaughtError&&(a=t.onCaughtError),void 0!==t.onRecoverableError&&(l=t.onRecoverableError)),t=hh(e,1,!1,null,0,n,r,null,o,a,l,Kh),e[Be]=t.current,Zu(e),new Vh(t)},t.hydrateRoot=function(e,t,n){if(!s(e))throw Error(i(299));var r=!1,o="",a=Cs,l=As,c=Is,u=null;return null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onUncaughtError&&(a=n.onUncaughtError),void 0!==n.onCaughtError&&(l=n.onCaughtError),void 0!==n.onRecoverableError&&(c=n.onRecoverableError),void 0!==n.formState&&(u=n.formState)),(t=hh(e,1,!0,t,0,r,o,u,a,l,c,Kh)).context=gh(null),n=t.current,(o=ba(r=De(r=Vc()))).callback=null,wa(n,o,r),n=r,t.current.lanes=n,Me(t,n),ju(t),e[Be]=t.current,Zu(e),new Gh(t)},t.version="19.2.0"},119:(e,t,n)=>{!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(863)},340:(e,t,n)=>{e.exports=n(487)},352:(e,t,n)=>{!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(85)},414:(e,t,n)=>{e.exports=n(916)},487:(e,t)=>{function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,o=e[r];if(!(0<a(o,t)))break e;e[r]=t,e[n]=o,n=r}}function r(e){return 0===e.length?null:e[0]}function o(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,o=e.length,i=o>>>1;r<i;){var s=2*(r+1)-1,l=e[s],c=s+1,u=e[c];if(0>a(l,n))c<o&&0>a(u,l)?(e[r]=u,e[c]=n,r=c):(e[r]=l,e[s]=n,r=s);else{if(!(c<o&&0>a(u,n)))break e;e[r]=u,e[c]=n,r=c}}}return t}function a(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if(t.unstable_now=void 0,"object"===typeof performance&&"function"===typeof performance.now){var i=performance;t.unstable_now=function(){return i.now()}}else{var s=Date,l=s.now();t.unstable_now=function(){return s.now()-l}}var c=[],u=[],d=1,h=null,g=3,m=!1,f=!1,p=!1,y=!1,v="function"===typeof setTimeout?setTimeout:null,b="function"===typeof clearTimeout?clearTimeout:null,w="undefined"!==typeof setImmediate?setImmediate:null;function k(e){for(var t=r(u);null!==t;){if(null===t.callback)o(u);else{if(!(t.startTime<=e))break;o(u),t.sortIndex=t.expirationTime,n(c,t)}t=r(u)}}function S(e){if(p=!1,k(e),!f)if(null!==r(c))f=!0,C||(C=!0,x());else{var t=r(u);null!==t&&M(S,t.startTime-e)}}var x,C=!1,A=-1,I=5,T=-1;function P(){return!!y||!(t.unstable_now()-T<I)}function E(){if(y=!1,C){var e=t.unstable_now();T=e;var n=!0;try{e:{f=!1,p&&(p=!1,b(A),A=-1),m=!0;var a=g;try{t:{for(k(e),h=r(c);null!==h&&!(h.expirationTime>e&&P());){var i=h.callback;if("function"===typeof i){h.callback=null,g=h.priorityLevel;var s=i(h.expirationTime<=e);if(e=t.unstable_now(),"function"===typeof s){h.callback=s,k(e),n=!0;break t}h===r(c)&&o(c),k(e)}else o(c);h=r(c)}if(null!==h)n=!0;else{var l=r(u);null!==l&&M(S,l.startTime-e),n=!1}}break e}finally{h=null,g=a,m=!1}n=void 0}}finally{n?x():C=!1}}}if("function"===typeof w)x=function(){w(E)};else if("undefined"!==typeof MessageChannel){var N=new MessageChannel,_=N.port2;N.port1.onmessage=E,x=function(){_.postMessage(null)}}else x=function(){v(E,0)};function M(e,n){A=v(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return g},t.unstable_next=function(e){switch(g){case 1:case 2:case 3:var t=3;break;default:t=g}var n=g;g=t;try{return e()}finally{g=n}},t.unstable_requestPaint=function(){y=!0},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=g;g=e;try{return t()}finally{g=n}},t.unstable_scheduleCallback=function(e,o,a){var i=t.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?i+a:i:a=i,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:d++,callback:o,priorityLevel:e,startTime:a,expirationTime:s=a+s,sortIndex:-1},a>i?(e.sortIndex=a,n(u,e),null===r(c)&&e===r(u)&&(p?(b(A),A=-1):p=!0,M(S,a-i))):(e.sortIndex=s,n(c,e),f||m||(f=!0,C||(C=!0,x()))),e},t.unstable_shouldYield=P,t.unstable_wrapCallback=function(e){var t=g;return function(){var n=g;g=t;try{return e.apply(this,arguments)}finally{g=n}}}},863:(e,t,n)=>{var r=n(950);function o(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(){}var i={d:{f:a,r:function(){throw Error(o(522))},D:a,C:a,L:a,m:a,X:a,S:a,M:a},p:0,findDOMNode:null},s=Symbol.for("react.portal");var l=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(e,t){return"font"===e?"":"string"===typeof t?"use-credentials"===t?t:"":void 0}t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)throw Error(o(299));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:s,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.flushSync=function(e){var t=l.T,n=i.p;try{if(l.T=null,i.p=2,e)return e()}finally{l.T=t,i.p=n,i.d.f()}},t.preconnect=function(e,t){"string"===typeof e&&(t?t="string"===typeof(t=t.crossOrigin)?"use-credentials"===t?t:"":void 0:t=null,i.d.C(e,t))},t.prefetchDNS=function(e){"string"===typeof e&&i.d.D(e)},t.preinit=function(e,t){if("string"===typeof e&&t&&"string"===typeof t.as){var n=t.as,r=c(n,t.crossOrigin),o="string"===typeof t.integrity?t.integrity:void 0,a="string"===typeof t.fetchPriority?t.fetchPriority:void 0;"style"===n?i.d.S(e,"string"===typeof t.precedence?t.precedence:void 0,{crossOrigin:r,integrity:o,fetchPriority:a}):"script"===n&&i.d.X(e,{crossOrigin:r,integrity:o,fetchPriority:a,nonce:"string"===typeof t.nonce?t.nonce:void 0})}},t.preinitModule=function(e,t){if("string"===typeof e)if("object"===typeof t&&null!==t){if(null==t.as||"script"===t.as){var n=c(t.as,t.crossOrigin);i.d.M(e,{crossOrigin:n,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0})}}else null==t&&i.d.M(e)},t.preload=function(e,t){if("string"===typeof e&&"object"===typeof t&&null!==t&&"string"===typeof t.as){var n=t.as,r=c(n,t.crossOrigin);i.d.L(e,n,{crossOrigin:r,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0,type:"string"===typeof t.type?t.type:void 0,fetchPriority:"string"===typeof t.fetchPriority?t.fetchPriority:void 0,referrerPolicy:"string"===typeof t.referrerPolicy?t.referrerPolicy:void 0,imageSrcSet:"string"===typeof t.imageSrcSet?t.imageSrcSet:void 0,imageSizes:"string"===typeof t.imageSizes?t.imageSizes:void 0,media:"string"===typeof t.media?t.media:void 0})}},t.preloadModule=function(e,t){if("string"===typeof e)if(t){var n=c(t.as,t.crossOrigin);i.d.m(e,{as:"string"===typeof t.as&&"script"!==t.as?t.as:void 0,crossOrigin:n,integrity:"string"===typeof t.integrity?t.integrity:void 0})}else i.d.m(e)},t.requestFormReset=function(e){i.d.r(e)},t.unstable_batchedUpdates=function(e,t){return e(t)},t.useFormState=function(e,t,n){return l.H.useFormState(e,t,n)},t.useFormStatus=function(){return l.H.useHostTransitionStatus()},t.version="19.2.0"},916:(e,t)=>{var n=Symbol.for("react.transitional.element"),r=Symbol.for("react.fragment");function o(e,t,r){var o=null;if(void 0!==r&&(o=""+r),void 0!==t.key&&(o=""+t.key),"key"in t)for(var a in r={},t)"key"!==a&&(r[a]=t[a]);else r=t;return t=r.ref,{$$typeof:n,type:e,key:o,ref:void 0!==t?t:null,props:r}}t.Fragment=r,t.jsx=o,t.jsxs=o},950:(e,t,n)=>{e.exports=n(983)},983:(e,t)=>{var n=Symbol.for("react.transitional.element"),r=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),g=Symbol.for("react.activity"),m=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},p=Object.assign,y={};function v(e,t,n){this.props=e,this.context=t,this.refs=y,this.updater=n||f}function b(){}function w(e,t,n){this.props=e,this.context=t,this.refs=y,this.updater=n||f}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},b.prototype=v.prototype;var k=w.prototype=new b;k.constructor=w,p(k,v.prototype),k.isPureReactComponent=!0;var S=Array.isArray;function x(){}var C={H:null,A:null,T:null,S:null},A=Object.prototype.hasOwnProperty;function I(e,t,r){var o=r.ref;return{$$typeof:n,type:e,key:t,ref:void 0!==o?o:null,props:r}}function T(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var P=/\/+/g;function E(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function N(e,t,o,a,i){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var l,c,u=!1;if(null===e)u=!0;else switch(s){case"bigint":case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case n:case r:u=!0;break;case h:return N((u=e._init)(e._payload),t,o,a,i)}}if(u)return i=i(e),u=""===a?"."+E(e,0):a,S(i)?(o="",null!=u&&(o=u.replace(P,"$&/")+"/"),N(i,t,o,"",function(e){return e})):null!=i&&(T(i)&&(l=i,c=o+(null==i.key||e&&e.key===i.key?"":(""+i.key).replace(P,"$&/")+"/")+u,i=I(l.type,c,l.props)),t.push(i)),1;u=0;var d,g=""===a?".":a+":";if(S(e))for(var f=0;f<e.length;f++)u+=N(a=e[f],t,o,s=g+E(a,f),i);else if("function"===typeof(f=null===(d=e)||"object"!==typeof d?null:"function"===typeof(d=m&&d[m]||d["@@iterator"])?d:null))for(e=f.call(e),f=0;!(a=e.next()).done;)u+=N(a=a.value,t,o,s=g+E(a,f++),i);else if("object"===s){if("function"===typeof e.then)return N(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"===typeof e.status?e.then(x,x):(e.status="pending",e.then(function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)},function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(e),t,o,a,i);throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return u}function _(e,t,n){if(null==e)return e;var r=[],o=0;return N(e,r,"","",function(e){return t.call(n,e,o++)}),r}function M(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var R="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)},O={map:_,forEach:function(e,t,n){_(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return _(e,function(){t++}),t},toArray:function(e){return _(e,function(e){return e})||[]},only:function(e){if(!T(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};t.Activity=g,t.Children=O,t.Component=v,t.Fragment=o,t.Profiler=i,t.PureComponent=w,t.StrictMode=a,t.Suspense=u,t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=C,t.__COMPILER_RUNTIME={__proto__:null,c:function(e){return C.H.useMemoCache(e)}},t.cache=function(e){return function(){return e.apply(null,arguments)}},t.cacheSignal=function(){return null},t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error("The argument must be a React element, but you passed "+e+".");var r=p({},e.props),o=e.key;if(null!=t)for(a in void 0!==t.key&&(o=""+t.key),t)!A.call(t,a)||"key"===a||"__self"===a||"__source"===a||"ref"===a&&void 0===t.ref||(r[a]=t[a]);var a=arguments.length-2;if(1===a)r.children=n;else if(1<a){for(var i=Array(a),s=0;s<a;s++)i[s]=arguments[s+2];r.children=i}return I(e.type,o,r)},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider=e,e.Consumer={$$typeof:s,_context:e},e},t.createElement=function(e,t,n){var r,o={},a=null;if(null!=t)for(r in void 0!==t.key&&(a=""+t.key),t)A.call(t,r)&&"key"!==r&&"__self"!==r&&"__source"!==r&&(o[r]=t[r]);var i=arguments.length-2;if(1===i)o.children=n;else if(1<i){for(var s=Array(i),l=0;l<i;l++)s[l]=arguments[l+2];o.children=s}if(e&&e.defaultProps)for(r in i=e.defaultProps)void 0===o[r]&&(o[r]=i[r]);return I(e,a,o)},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=T,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:M}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=C.T,n={};C.T=n;try{var r=e(),o=C.S;null!==o&&o(n,r),"object"===typeof r&&null!==r&&"function"===typeof r.then&&r.then(x,R)}catch(a){R(a)}finally{null!==t&&null!==n.types&&(t.types=n.types),C.T=t}},t.unstable_useCacheRefresh=function(){return C.H.useCacheRefresh()},t.use=function(e){return C.H.use(e)},t.useActionState=function(e,t,n){return C.H.useActionState(e,t,n)},t.useCallback=function(e,t){return C.H.useCallback(e,t)},t.useContext=function(e){return C.H.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e,t){return C.H.useDeferredValue(e,t)},t.useEffect=function(e,t){return C.H.useEffect(e,t)},t.useEffectEvent=function(e){return C.H.useEffectEvent(e)},t.useId=function(){return C.H.useId()},t.useImperativeHandle=function(e,t,n){return C.H.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return C.H.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return C.H.useLayoutEffect(e,t)},t.useMemo=function(e,t){return C.H.useMemo(e,t)},t.useOptimistic=function(e,t){return C.H.useOptimistic(e,t)},t.useReducer=function(e,t,n){return C.H.useReducer(e,t,n)},t.useRef=function(e){return C.H.useRef(e)},t.useState=function(e){return C.H.useState(e)},t.useSyncExternalStore=function(e,t,n){return C.H.useSyncExternalStore(e,t,n)},t.useTransition=function(){return C.H.useTransition()},t.version="19.2.0"}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}n.m=e,n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce((t,r)=>(n.f[r](e,t),t),[])),n.u=e=>"static/js/"+e+".2765b8c2.chunk.js",n.miniCssF=e=>{},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="evoke-schedule:";n.l=(r,o,a,i)=>{if(e[r])e[r].push(o);else{var s,l;if(void 0!==a)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var d=c[u];if(d.getAttribute("src")==r||d.getAttribute("data-webpack")==t+a){s=d;break}}s||(l=!0,(s=document.createElement("script")).charset="utf-8",n.nc&&s.setAttribute("nonce",n.nc),s.setAttribute("data-webpack",t+a),s.src=r),e[r]=[o];var h=(t,n)=>{s.onerror=s.onload=null,clearTimeout(g);var o=e[r];if(delete e[r],s.parentNode&&s.parentNode.removeChild(s),o&&o.forEach(e=>e(n)),t)return t(n)},g=setTimeout(h.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=h.bind(null,s.onerror),s.onload=h.bind(null,s.onload),l&&document.head.appendChild(s)}}})(),n.p="/EvokeSchedule2.0/",(()=>{var e={792:0};n.f.j=(t,r)=>{var o=n.o(e,t)?e[t]:void 0;if(0!==o)if(o)r.push(o[2]);else{var a=new Promise((n,r)=>o=e[t]=[n,r]);r.push(o[2]=a);var i=n.p+n.u(t),s=new Error;n.l(i,r=>{if(n.o(e,t)&&(0!==(o=e[t])&&(e[t]=void 0),o)){var a=r&&("load"===r.type?"missing":r.type),i=r&&r.target&&r.target.src;s.message="Loading chunk "+t+" failed.\n("+a+": "+i+")",s.name="ChunkLoadError",s.type=a,s.request=i,o[1](s)}},"chunk-"+t,t)}};var t=(t,r)=>{var o,a,i=r[0],s=r[1],l=r[2],c=0;if(i.some(t=>0!==e[t])){for(o in s)n.o(s,o)&&(n.m[o]=s[o]);if(l)l(n)}for(t&&t(r);c<i.length;c++)a=i[c],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0},r=self.webpackChunkevoke_schedule=self.webpackChunkevoke_schedule||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var r=n(950),o=n(352);function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function i(e){var t=function(e,t){if("object"!=a(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=a(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==a(t)?t:t+""}function s(e,t,n){return(t=i(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach(function(t){s(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function u(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}const d=e=>{const t=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase()))(e);return t.charAt(0).toUpperCase()+t.slice(1)},h=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter((e,t,n)=>Boolean(e)&&""!==e.trim()&&n.indexOf(e)===t).join(" ").trim()};var g={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const m=["color","size","strokeWidth","absoluteStrokeWidth","className","children","iconNode"],f=(0,r.forwardRef)((e,t)=>{let{color:n="currentColor",size:o=24,strokeWidth:a=2,absoluteStrokeWidth:i,className:s="",children:l,iconNode:d}=e,f=u(e,m);return(0,r.createElement)("svg",c(c(c({ref:t},g),{},{width:o,height:o,stroke:n,strokeWidth:i?24*Number(a)/Number(o):a,className:h("lucide",s)},!l&&!(e=>{for(const t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(f)&&{"aria-hidden":"true"}),f),[...d.map(e=>{let[t,n]=e;return(0,r.createElement)(t,n)}),...Array.isArray(l)?l:[l]])}),p=["className"],y=(e,t)=>{const n=(0,r.forwardRef)((n,o)=>{let{className:a}=n,i=u(n,p);return(0,r.createElement)(f,c({ref:o,iconNode:t,className:h("lucide-".concat((s=d(e),s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase())),"lucide-".concat(e),a)},i));var s});return n.displayName=d(e),n},v=y("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]),b=y("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),w=y("log-in",[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]]),k=y("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),S=y("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]),x=y("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),C=y("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]),A=y("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),I=y("chart-column",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),T=y("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),P=y("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),E=y("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),N=y("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]),_={RBT:{level:1,name:"RBT"},BS:{level:2,name:"Behavior Specialist"},BCBA:{level:3,name:"BCBA"},EA:{level:4,name:"Educational Assistant"},MHA:{level:5,name:"Mental Health Assistant"},CC:{level:6,name:"Clinical Coordinator"},Trainer:{level:7,name:"Trainer"},Teacher:{level:8,name:"Teacher"},Director:{level:9,name:"Director"}},M=_,R={PRIMARY:"Primary",SECONDARY:"Secondary"},O={PRIMARY:{AM:{start:"8:45",end:"11:30"},PM:{start:"12:00",end:"15:00"}},SECONDARY:{AM:{start:"8:45",end:"12:00"},PM:{start:"12:30",end:"15:00"}}},j={ONE_TO_ONE:"1:1",TWO_TO_ONE:"2:1",ONE_TO_TWO:"1:2"};class D{constructor(e){let{id:t,name:n,role:r,email:o="",userId:a=null,staffPerson:i=null,primaryProgram:s=!1,secondaryProgram:l=!1,isActive:c=!0,absentAM:u=!1,absentPM:d=!1,absentFullDay:h=!1}=e;this.id=t,this.name=n,this.role=r,this.email=o,this.userId=a,this.staffPerson=i,"string"===typeof s?(this.primaryProgram=!0,this.primaryProgramType=s):(this.primaryProgram=s,this.primaryProgramType=s?R.PRIMARY:null),"string"===typeof l?(this.secondaryProgram=!0,this.secondaryProgramType=l):(this.secondaryProgram=l,this.secondaryProgramType=l?R.SECONDARY:null),this.isActive=c,this.absentFullDay=h,this.absentAM=!!h||u,this.absentPM=!!h||d}getRoleLevel(){var e;return(null===(e=_[this.role])||void 0===e?void 0:e.level)||0}canWorkProgram(e){return e===R.PRIMARY||"Primary"===e?this.primaryProgram:(e===R.SECONDARY||"Secondary"===e)&&this.secondaryProgram}canDo1To1Sessions(){return!["Teacher","Trainer","Director","BCBA"].includes(this.role)}canDoDirectSessions(){return["RBT","BS","Behavior Specialist","Senior RBT"].includes(this.role)}isAvailableForSession(e){return!!this.isActive&&(!this.absentFullDay&&("AM"===e?!this.absentAM:"PM"!==e||!this.absentPM))}getAttendanceStatus(){return this.absentFullDay||this.absentAM&&this.absentPM?"Absent Full Day":this.absentAM?"Absent AM":this.absentPM?"Absent PM":"Present"}isPreferredDirectService(){return["RBT","BS","Behavior Specialist","Senior RBT"].includes(this.role)}}class L{constructor(e){let{id:t,name:n,program:r,ratio:o,ratioAM:a=j.ONE_TO_ONE,ratioPM:i=j.ONE_TO_ONE,isActive:s=!0,team:l=[],teamIds:c=[],pairedWith:u=null,absentAM:d=!1,absentPM:h=!1,absentFullDay:g=!1}=e;this.id=t,this.name=n,this.program=r,o?(this.ratioAM=o,this.ratioPM=o,this.ratio=o):(this.ratioAM=a,this.ratioPM=i,this.ratio=a),this.isActive=s,this.team=l,this.teamIds=c.length>0?c:l.map(e=>e.id).filter(Boolean),this.pairedWith=u,this.absentFullDay=g,this.absentAM=!!g||d,this.absentPM=!!g||h}requiresMultipleStaff(){return("AM"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"AM")?this.ratioAM:this.ratioPM)===j.TWO_TO_ONE}getSessionRatio(e){return"AM"===e?this.ratioAM:this.ratioPM}isSmallGroup(){return("AM"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"AM")?this.ratioAM:this.ratioPM)===j.ONE_TO_TWO}isAvailableForSession(e){return!!this.isActive&&(!this.absentFullDay&&("AM"===e?!this.absentAM:"PM"!==e||!this.absentPM))}getAttendanceStatus(){return this.absentFullDay||this.absentAM&&this.absentPM?"Absent Full Day":this.absentAM?"Absent AM":this.absentPM?"Absent PM":"Present"}isPaired(){return null!==this.pairedWith&&void 0!==this.pairedWith}getPairedStudent(e){if(!this.isPaired())return null;return e.find(e=>e.id==this.pairedWith||e.id===this.pairedWith)||null}}class F{constructor(e){let{id:t,staffId:n,studentId:r,session:o,program:a,date:i,isLocked:s=!1,assignedBy:l="auto"}=e;this.id=t,this.staffId=n,this.studentId=r,this.session=o,this.program=a,this.date=i,this.isLocked=s,this.assignedBy=l}getSessionTimes(){return O[this.program.toUpperCase()][this.session]}}class q{constructor(e){let{date:t,assignments:n=[],lockedAssignments:r=new Set,isFinalized:o=!1}=e;this.date=t,this.assignments=n,this.lockedAssignments=r,this.isFinalized=o}getAssignmentsForSession(e,t){return this.assignments.filter(n=>n.session===e&&n.program.toLowerCase()===t.toLowerCase())}getStaffAssignments(e){return this.assignments.filter(t=>t.staffId===e)}getStudentAssignments(e){return this.assignments.filter(t=>t.studentId===e)}isStaffAvailable(e,t,n){return!this.assignments.filter(e=>e.session===t).some(t=>t.staffId===e)}hasStaffWorkedWithStudentToday(e,t){return this.assignments.some(n=>n.staffId===e&&n.studentId===t)}addAssignment(e){this.assignments.push(e)}removeAssignment(e){this.assignments=this.assignments.filter(t=>t.id!==e)}lockAssignment(e){this.lockedAssignments.add(e)}unlockAssignment(e){this.lockedAssignments.delete(e)}isAssignmentLocked(e){return this.lockedAssignments.has(e)}}class z{static validateAssignment(e,t,n,r){const o=[],a=n.find(t=>t.id===e.staffId);return a?(a.canWorkProgram(e.program)||o.push("".concat(a.name," is not assigned to ").concat(e.program," program")),t.isStaffAvailable(e.staffId,e.session,e.program)||o.push("".concat(a.name," is already assigned in ").concat(e.session," session")),t.hasStaffWorkedWithStudentToday(e.staffId,e.studentId)&&o.push("".concat(a.name," has already worked with this student today")),o):(o.push("Staff member not found"),o)}static validateSchedule(e,t,n){const r=[];for(const a of e.assignments){const o=new q({date:e.date,assignments:e.assignments.filter(e=>e.id!==a.id),lockedAssignments:e.lockedAssignments,isFinalized:e.isFinalized}),i=this.validateAssignment(a,o,t,n);r.push(...i.map(e=>"Assignment ".concat(a.id,": ").concat(e)))}const o={};for(const a of e.assignments){const e=n.find(e=>e.id===a.studentId);if(e){const t="".concat(a.session,"-").concat(a.program,"-").concat(e.id);o[t]=(o[t]||0)+1;(e.getSessionRatio?e.getSessionRatio(a.session):e.ratio)===j.TWO_TO_ONE&&o[t]<2&&r.push("".concat(e.name," requires 2:1 ratio but only has ").concat(o[t]," staff assigned"))}}return r}}class U{static generateAssignmentId(){return"assignment_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9))}static formatDate(e){return e.toISOString().split("T")[0]}static sortStaffByHierarchy(e){return[...e].sort((e,t)=>e.getRoleLevel()-t.getRoleLevel())}static getAvailableStaffForStudent(e,t,n,r,o){return r.filter(r=>{if(!r.isActive)return!1;if(!r.canWorkProgram(n))return!1;if(!o.isStaffAvailable(r.id,t,n))return!1;if(o.hasStaffWorkedWithStudentToday(r.id,e.id))return!1;if(!r.canDoDirectSessions())return!1;return!(("AM"===t?e.ratioAM:e.ratioPM)===j.ONE_TO_ONE&&!r.canDo1To1Sessions())})}}const H={LIBRARY_NAME:"MSAL.JS",SKU:"msal.js.common",DEFAULT_AUTHORITY:"https://login.microsoftonline.com/common/",DEFAULT_AUTHORITY_HOST:"login.microsoftonline.com",DEFAULT_COMMON_TENANT:"common",ADFS:"adfs",DSTS:"dstsv2",AAD_INSTANCE_DISCOVERY_ENDPT:"https://login.microsoftonline.com/common/discovery/instance?api-version=1.1&authorization_endpoint=",CIAM_AUTH_URL:".ciamlogin.com",AAD_TENANT_DOMAIN_SUFFIX:".onmicrosoft.com",RESOURCE_DELIM:"|",NO_ACCOUNT:"NO_ACCOUNT",CLAIMS:"claims",CONSUMER_UTID:"9188040d-6c67-4c5b-b112-36a304b66dad",OPENID_SCOPE:"openid",PROFILE_SCOPE:"profile",OFFLINE_ACCESS_SCOPE:"offline_access",EMAIL_SCOPE:"email",CODE_GRANT_TYPE:"authorization_code",RT_GRANT_TYPE:"refresh_token",S256_CODE_CHALLENGE_METHOD:"S256",URL_FORM_CONTENT_TYPE:"application/x-www-form-urlencoded;charset=utf-8",AUTHORIZATION_PENDING:"authorization_pending",NOT_DEFINED:"not_defined",EMPTY_STRING:"",NOT_APPLICABLE:"N/A",NOT_AVAILABLE:"Not Available",FORWARD_SLASH:"/",IMDS_ENDPOINT:"http://169.254.169.254/metadata/instance/compute/location",IMDS_VERSION:"2020-06-01",IMDS_TIMEOUT:2e3,AZURE_REGION_AUTO_DISCOVER_FLAG:"TryAutoDetect",REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX:"login.microsoft.com",KNOWN_PUBLIC_CLOUDS:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"],SHR_NONCE_VALIDITY:240,INVALID_INSTANCE:"invalid_instance"},B=200,W=400,K=400,V=499,G=500,Q=599,Y="GET",J="POST",$=[H.OPENID_SCOPE,H.PROFILE_SCOPE,H.OFFLINE_ACCESS_SCOPE],X=[...$,H.EMAIL_SCOPE],Z="Content-Type",ee="Content-Length",te="Retry-After",ne="X-AnchorMailbox",re="x-ms-request-id",oe="x-ms-httpver",ae="active-account-filters",ie="common",se="organizations",le="consumers",ce="access_token",ue="xms_cc",de="login",he="select_account",ge="consent",me="none",fe="no_session",pe="code",ye="id_token token refresh_token",ve="query",be="fragment",we="query",ke="authorization_code",Se="refresh_token",xe="MSSTS",Ce="ADFS",Ae="Generic",Ie="-",Te=".",Pe={ID_TOKEN:"IdToken",ACCESS_TOKEN:"AccessToken",ACCESS_TOKEN_WITH_AUTH_SCHEME:"AccessToken_With_AuthScheme",REFRESH_TOKEN:"RefreshToken"},Ee="appmetadata",Ne="1",_e="authority-metadata",Me=86400,Re="config",Oe="cache",je="network",De="hardcoded_values",Le={SCHEMA_VERSION:5,MAX_LAST_HEADER_BYTES:330,MAX_CACHED_ERRORS:50,CACHE_KEY:"server-telemetry",CATEGORY_SEPARATOR:"|",VALUE_SEPARATOR:",",OVERFLOW_TRUE:"1",OVERFLOW_FALSE:"0",UNKNOWN_ERROR:"unknown_error"},Fe={BEARER:"Bearer",POP:"pop",SSH:"ssh-cert"},qe=60,ze=3600,Ue="throttling",He="retry-after, h429",Be="invalid_grant",We="client_mismatch",Ke="1",Ve="3",Ge="4",Qe="2",Ye="4",Je="5",$e="0",Xe="1",Ze="2",et="3",tt="4",nt="pop";var rt;!function(e){e[e.Error=0]="Error",e[e.Warning=1]="Warning",e[e.Info=2]="Info",e[e.Verbose=3]="Verbose",e[e.Trace=4]="Trace"}(rt||(rt={}));class ot{constructor(e,t,n){this.level=rt.Info;const r=e||ot.createDefaultLoggerOptions();this.localCallback=r.loggerCallback||(()=>{}),this.piiLoggingEnabled=r.piiLoggingEnabled||!1,this.level="number"===typeof r.logLevel?r.logLevel:rt.Info,this.correlationId=r.correlationId||H.EMPTY_STRING,this.packageName=t||H.EMPTY_STRING,this.packageVersion=n||H.EMPTY_STRING}static createDefaultLoggerOptions(){return{loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:rt.Info}}clone(e,t,n){return new ot({loggerCallback:this.localCallback,piiLoggingEnabled:this.piiLoggingEnabled,logLevel:this.level,correlationId:n||this.correlationId},e,t)}logMessage(e,t){if(t.logLevel>this.level||!this.piiLoggingEnabled&&t.containsPii)return;const n=(new Date).toUTCString(),r="[".concat(n,"] : [").concat(t.correlationId||this.correlationId||"","]"),o="".concat(r," : ").concat(this.packageName,"@").concat(this.packageVersion," : ").concat(rt[t.logLevel]," - ").concat(e);this.executeCallback(t.logLevel,o,t.containsPii||!1)}executeCallback(e,t,n){this.localCallback&&this.localCallback(e,t,n)}error(e,t){this.logMessage(e,{logLevel:rt.Error,containsPii:!1,correlationId:t||H.EMPTY_STRING})}errorPii(e,t){this.logMessage(e,{logLevel:rt.Error,containsPii:!0,correlationId:t||H.EMPTY_STRING})}warning(e,t){this.logMessage(e,{logLevel:rt.Warning,containsPii:!1,correlationId:t||H.EMPTY_STRING})}warningPii(e,t){this.logMessage(e,{logLevel:rt.Warning,containsPii:!0,correlationId:t||H.EMPTY_STRING})}info(e,t){this.logMessage(e,{logLevel:rt.Info,containsPii:!1,correlationId:t||H.EMPTY_STRING})}infoPii(e,t){this.logMessage(e,{logLevel:rt.Info,containsPii:!0,correlationId:t||H.EMPTY_STRING})}verbose(e,t){this.logMessage(e,{logLevel:rt.Verbose,containsPii:!1,correlationId:t||H.EMPTY_STRING})}verbosePii(e,t){this.logMessage(e,{logLevel:rt.Verbose,containsPii:!0,correlationId:t||H.EMPTY_STRING})}trace(e,t){this.logMessage(e,{logLevel:rt.Trace,containsPii:!1,correlationId:t||H.EMPTY_STRING})}tracePii(e,t){this.logMessage(e,{logLevel:rt.Trace,containsPii:!0,correlationId:t||H.EMPTY_STRING})}isPiiLoggingEnabled(){return this.piiLoggingEnabled||!1}}const at="AAD",it="OIDC",st="EAR",lt="none",ct="unexpected_error",ut="post_request_failed",dt={[ct]:"Unexpected error in authentication.",[ut]:"Post request failed from the network, could be a 4xx/5xx or a network unavailability. Please check the exact error code for details."};class ht extends Error{constructor(e,t,n){super(t?"".concat(e,": ").concat(t):e),Object.setPrototypeOf(this,ht.prototype),this.errorCode=e||H.EMPTY_STRING,this.errorMessage=t||H.EMPTY_STRING,this.subError=n||H.EMPTY_STRING,this.name="AuthError"}setCorrelationId(e){this.correlationId=e}}function gt(e,t){return new ht(e,t?"".concat(dt[e]," ").concat(t):dt[e])}const mt="client_info_decoding_error",ft="client_info_empty_error",pt="token_parsing_error",yt="null_or_empty_token",vt="endpoints_resolution_error",bt="network_error",wt="openid_config_error",kt="hash_not_deserialized",St="invalid_state",xt="state_mismatch",Ct="state_not_found",At="nonce_mismatch",It="auth_time_not_found",Tt="max_age_transpired",Pt="multiple_matching_tokens",Et="multiple_matching_accounts",Nt="multiple_matching_appMetadata",_t="request_cannot_be_made",Mt="cannot_remove_empty_scope",Rt="cannot_append_scopeset",Ot="empty_input_scopeset",jt="device_code_polling_cancelled",Dt="device_code_expired",Lt="device_code_unknown_error",Ft="no_account_in_silent_request",qt="invalid_cache_record",zt="invalid_cache_environment",Ut="no_account_found",Ht="no_crypto_object",Bt="unexpected_credential_type",Wt="invalid_assertion",Kt="invalid_client_credential",Vt="token_refresh_required",Gt="user_timeout_reached",Qt="token_claims_cnf_required_for_signedjwt",Yt="authorization_code_missing_from_server_response",Jt="binding_key_not_removed",$t="end_session_endpoint_not_supported",Xt="key_id_missing",Zt="no_network_connectivity",en="user_canceled",tn="missing_tenant_id_error",nn="method_not_implemented",rn="nested_app_auth_bridge_disabled",on={[mt]:"The client info could not be parsed/decoded correctly",[ft]:"The client info was empty",[pt]:"Token cannot be parsed",[yt]:"The token is null or empty",[vt]:"Endpoints cannot be resolved",[bt]:"Network request failed",[wt]:"Could not retrieve endpoints. Check your authority and verify the .well-known/openid-configuration endpoint returns the required endpoints.",[kt]:"The hash parameters could not be deserialized",[St]:"State was not the expected format",[xt]:"State mismatch error",[Ct]:"State not found",[At]:"Nonce mismatch error",[It]:"Max Age was requested and the ID token is missing the auth_time variable. auth_time is an optional claim and is not enabled by default - it must be enabled. See https://aka.ms/msaljs/optional-claims for more information.",[Tt]:"Max Age is set to 0, or too much time has elapsed since the last end-user authentication.",[Pt]:"The cache contains multiple tokens satisfying the requirements. Call AcquireToken again providing more requirements such as authority or account.",[Et]:"The cache contains multiple accounts satisfying the given parameters. Please pass more info to obtain the correct account",[Nt]:"The cache contains multiple appMetadata satisfying the given parameters. Please pass more info to obtain the correct appMetadata",[_t]:"Token request cannot be made without authorization code or refresh token.",[Mt]:"Cannot remove null or empty scope from ScopeSet",[Rt]:"Cannot append ScopeSet",[Ot]:"Empty input ScopeSet cannot be processed",[jt]:"Caller has cancelled token endpoint polling during device code flow by setting DeviceCodeRequest.cancel = true.",[Dt]:"Device code is expired.",[Lt]:"Device code stopped polling for unknown reasons.",[Ft]:"Please pass an account object, silent flow is not supported without account information",[qt]:"Cache record object was null or undefined.",[zt]:"Invalid environment when attempting to create cache entry",[Ut]:"No account found in cache for given key.",[Ht]:"No crypto object detected.",[Bt]:"Unexpected credential type.",[Wt]:"Client assertion must meet requirements described in https://tools.ietf.org/html/rfc7515",[Kt]:"Client credential (secret, certificate, or assertion) must not be empty when creating a confidential client. An application should at most have one credential",[Vt]:"Cannot return token from cache because it must be refreshed. This may be due to one of the following reasons: forceRefresh parameter is set to true, claims have been requested, there is no cached access token or it is expired.",[Gt]:"User defined timeout for device code polling reached",[Qt]:"Cannot generate a POP jwt if the token_claims are not populated",[Yt]:"Server response does not contain an authorization code to proceed",[Jt]:"Could not remove the credential's binding key from storage.",[$t]:"The provided authority does not support logout",[Xt]:"A keyId value is missing from the requested bound token's cache record and is required to match the token to it's stored binding key.",[Zt]:"No network connectivity. Check your internet connection.",[en]:"User cancelled the flow.",[tn]:"A tenant id - not common, organizations, or consumers - must be specified when using the client_credentials flow.",[nn]:"This method has not been implemented",[rn]:"The nested app auth bridge is disabled"};class an extends ht{constructor(e,t){super(e,t?"".concat(on[e],": ").concat(t):on[e]),this.name="ClientAuthError",Object.setPrototypeOf(this,an.prototype)}}function sn(e,t){return new an(e,t)}const ln={createNewGuid:()=>{throw sn(nn)},base64Decode:()=>{throw sn(nn)},base64Encode:()=>{throw sn(nn)},base64UrlEncode:()=>{throw sn(nn)},encodeKid:()=>{throw sn(nn)},async getPublicKeyThumbprint(){throw sn(nn)},async removeTokenBindingKey(){throw sn(nn)},async clearKeystore(){throw sn(nn)},async signJwt(){throw sn(nn)},async hashString(){throw sn(nn)}},cn="@azure/msal-common",un="15.13.0",dn="redirect_uri_empty",hn="claims_request_parsing_error",gn="authority_uri_insecure",mn="url_parse_error",fn="empty_url_error",pn="empty_input_scopes_error",yn="invalid_claims",vn="token_request_empty",bn="logout_request_empty",wn="invalid_code_challenge_method",kn="pkce_params_missing",Sn="invalid_cloud_discovery_metadata",xn="invalid_authority_metadata",Cn="untrusted_authority",An="missing_ssh_jwk",In="missing_ssh_kid",Tn="missing_nonce_authentication_header",Pn="invalid_authentication_header",En="cannot_set_OIDCOptions",Nn="cannot_allow_platform_broker",_n="authority_mismatch",Mn="invalid_request_method_for_EAR",Rn="invalid_authorize_post_body_parameters",On={[dn]:"A redirect URI is required for all calls, and none has been set.",[hn]:"Could not parse the given claims request object.",[gn]:"Authority URIs must use https.  Please see here for valid authority configuration options: https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-js-initializing-client-applications#configuration-options",[mn]:"URL could not be parsed into appropriate segments.",[fn]:"URL was empty or null.",[pn]:"Scopes cannot be passed as null, undefined or empty array because they are required to obtain an access token.",[yn]:"Given claims parameter must be a stringified JSON object.",[vn]:"Token request was empty and not found in cache.",[bn]:"The logout request was null or undefined.",[wn]:'code_challenge_method passed is invalid. Valid values are "plain" and "S256".',[kn]:"Both params: code_challenge and code_challenge_method are to be passed if to be sent in the request",[Sn]:"Invalid cloudDiscoveryMetadata provided. Must be a stringified JSON object containing tenant_discovery_endpoint and metadata fields",[xn]:"Invalid authorityMetadata provided. Must by a stringified JSON object containing authorization_endpoint, token_endpoint, issuer fields.",[Cn]:"The provided authority is not a trusted authority. Please include this authority in the knownAuthorities config parameter.",[An]:"Missing sshJwk in SSH certificate request. A stringified JSON Web Key is required when using the SSH authentication scheme.",[In]:"Missing sshKid in SSH certificate request. A string that uniquely identifies the public SSH key is required when using the SSH authentication scheme.",[Tn]:"Unable to find an authentication header containing server nonce. Either the Authentication-Info or WWW-Authenticate headers must be present in order to obtain a server nonce.",[Pn]:"Invalid authentication header provided",[En]:"Cannot set OIDCOptions parameter. Please change the protocol mode to OIDC or use a non-Microsoft authority.",[Nn]:"Cannot set allowPlatformBroker parameter to true when not in AAD protocol mode.",[_n]:"Authority mismatch error. Authority provided in login request or PublicClientApplication config does not match the environment of the provided account. Please use a matching account or make an interactive request to login to this authority.",[Rn]:"Invalid authorize post body parameters provided. If you are using authorizePostBodyParameters, the request method must be POST. Please check the request method and parameters.",[Mn]:"Invalid request method for EAR protocol mode. The request method cannot be GET when using EAR protocol mode. Please change the request method to POST."};class jn extends ht{constructor(e){super(e,On[e]),this.name="ClientConfigurationError",Object.setPrototypeOf(this,jn.prototype)}}function Dn(e){return new jn(e)}class Ln{static isEmptyObj(e){if(e)try{const t=JSON.parse(e);return 0===Object.keys(t).length}catch(t){}return!0}static startsWith(e,t){return 0===e.indexOf(t)}static endsWith(e,t){return e.length>=t.length&&e.lastIndexOf(t)===e.length-t.length}static queryStringToObject(e){const t={},n=e.split("&"),r=e=>decodeURIComponent(e.replace(/\+/g," "));return n.forEach(e=>{if(e.trim()){const[n,o]=e.split(/=(.+)/g,2);n&&o&&(t[r(n)]=r(o))}}),t}static trimArrayEntries(e){return e.map(e=>e.trim())}static removeEmptyStringsFromArray(e){return e.filter(e=>!!e)}static jsonParseHelper(e){try{return JSON.parse(e)}catch(t){return null}}static matchPattern(e,t){return new RegExp(e.replace(/\\/g,"\\\\").replace(/\*/g,"[^ ]*").replace(/\?/g,"\\?")).test(t)}}class Fn{constructor(e){const t=e?Ln.trimArrayEntries([...e]):[],n=t?Ln.removeEmptyStringsFromArray(t):[];if(!n||!n.length)throw Dn(pn);this.scopes=new Set,n.forEach(e=>this.scopes.add(e))}static fromString(e){const t=(e||H.EMPTY_STRING).split(" ");return new Fn(t)}static createSearchScopes(e){const t=e&&e.length>0?e:[...$],n=new Fn(t);return n.containsOnlyOIDCScopes()?n.removeScope(H.OFFLINE_ACCESS_SCOPE):n.removeOIDCScopes(),n}containsScope(e){const t=this.printScopesLowerCase().split(" "),n=new Fn(t);return!!e&&n.scopes.has(e.toLowerCase())}containsScopeSet(e){return!(!e||e.scopes.size<=0)&&(this.scopes.size>=e.scopes.size&&e.asArray().every(e=>this.containsScope(e)))}containsOnlyOIDCScopes(){let e=0;return X.forEach(t=>{this.containsScope(t)&&(e+=1)}),this.scopes.size===e}appendScope(e){e&&this.scopes.add(e.trim())}appendScopes(e){try{e.forEach(e=>this.appendScope(e))}catch(t){throw sn(Rt)}}removeScope(e){if(!e)throw sn(Mt);this.scopes.delete(e.trim())}removeOIDCScopes(){X.forEach(e=>{this.scopes.delete(e)})}unionScopeSets(e){if(!e)throw sn(Ot);const t=new Set;return e.scopes.forEach(e=>t.add(e.toLowerCase())),this.scopes.forEach(e=>t.add(e.toLowerCase())),t}intersectingScopeSets(e){if(!e)throw sn(Ot);e.containsOnlyOIDCScopes()||e.removeOIDCScopes();const t=this.unionScopeSets(e),n=e.getScopeCount(),r=this.getScopeCount();return t.size<r+n}getScopeCount(){return this.scopes.size}asArray(){const e=[];return this.scopes.forEach(t=>e.push(t)),e}printScopes(){if(this.scopes){return this.asArray().join(" ")}return H.EMPTY_STRING}printScopesLowerCase(){return this.printScopes().toLowerCase()}}const qn=["isHomeTenant"],zn=["isHomeTenant"];function Un(e,t){return!!e&&!!t&&e===t.split(".")[1]}function Hn(e,t,n,r){if(r){const{oid:t,sub:n,tid:o,name:a,tfp:i,acr:s,preferred_username:l,upn:c,login_hint:u}=r,d=o||i||s||"";return{tenantId:d,localAccountId:t||n||"",name:a,username:l||c||"",loginHint:u,isHomeTenant:Un(d,e)}}return{tenantId:n,localAccountId:t,username:"",isHomeTenant:Un(n,e)}}function Bn(e,t,n,r){let o=e;if(t){const{isHomeTenant:n}=t,r=u(t,qn);o=c(c({},e),r)}if(n){const t=Hn(e.homeAccountId,e.localAccountId,e.tenantId,n),{isHomeTenant:a}=t,i=u(t,zn);return o=c(c(c({},o),i),{},{idTokenClaims:n,idToken:r}),o}return o}function Wn(e,t){const n=function(e){if(!e)throw sn(yt);const t=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(e);if(!t||t.length<4)throw sn(pt);return t[2]}(e);try{const e=t(n);return JSON.parse(e)}catch(r){throw sn(pt)}}function Kn(e,t){if(0===t||Date.now()-3e5>e+t)throw sn(Tt)}function Vn(e){if(!e)return e;let t=e.toLowerCase();return Ln.endsWith(t,"?")?t=t.slice(0,-1):Ln.endsWith(t,"?/")&&(t=t.slice(0,-2)),Ln.endsWith(t,"/")||(t+="/"),t}function Gn(e){return e.startsWith("#/")?e.substring(2):e.startsWith("#")||e.startsWith("?")?e.substring(1):e}function Qn(e){if(!e||e.indexOf("=")<0)return null;try{const t=Gn(e),n=Object.fromEntries(new URLSearchParams(t));if(n.code||n.ear_jwe||n.error||n.error_description||n.state)return n}catch(t){throw sn(kt)}return null}function Yn(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0;const r=new Array;return e.forEach((e,o)=>{!t&&n&&o in n?r.push("".concat(o,"=").concat(e)):r.push("".concat(o,"=").concat(encodeURIComponent(e)))}),r.join("&")}function Jn(e){if(!e)return e;const t=e.split("#")[0];try{const e=new URL(t);return Vn(e.origin+e.pathname+e.search)}catch(n){return Vn(t)}}class $n{get urlString(){return this._urlString}constructor(e){if(this._urlString=e,!this._urlString)throw Dn(fn);e.includes("#")||(this._urlString=$n.canonicalizeUri(e))}static canonicalizeUri(e){if(e){let t=e.toLowerCase();return Ln.endsWith(t,"?")?t=t.slice(0,-1):Ln.endsWith(t,"?/")&&(t=t.slice(0,-2)),Ln.endsWith(t,"/")||(t+="/"),t}return e}validateAsUri(){let e;try{e=this.getUrlComponents()}catch(t){throw Dn(mn)}if(!e.HostNameAndPort||!e.PathSegments)throw Dn(mn);if(!e.Protocol||"https:"!==e.Protocol.toLowerCase())throw Dn(gn)}static appendQueryString(e,t){return t?e.indexOf("?")<0?"".concat(e,"?").concat(t):"".concat(e,"&").concat(t):e}static removeHashFromUrl(e){return $n.canonicalizeUri(e.split("#")[0])}replaceTenantPath(e){const t=this.getUrlComponents(),n=t.PathSegments;return!e||0===n.length||n[0]!==ie&&n[0]!==se||(n[0]=e),$n.constructAuthorityUriFromObject(t)}getUrlComponents(){const e=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),t=this.urlString.match(e);if(!t)throw Dn(mn);const n={Protocol:t[1],HostNameAndPort:t[4],AbsolutePath:t[5],QueryString:t[7]};let r=n.AbsolutePath.split("/");return r=r.filter(e=>e&&e.length>0),n.PathSegments=r,n.QueryString&&n.QueryString.endsWith("/")&&(n.QueryString=n.QueryString.substring(0,n.QueryString.length-1)),n}static getDomainFromUrl(e){const t=RegExp("^([^:/?#]+://)?([^/?#]*)"),n=e.match(t);if(!n)throw Dn(mn);return n[2]}static getAbsoluteUrl(e,t){if(e[0]===H.FORWARD_SLASH){const n=new $n(t).getUrlComponents();return n.Protocol+"//"+n.HostNameAndPort+e}return e}static constructAuthorityUriFromObject(e){return new $n(e.Protocol+"//"+e.HostNameAndPort+"/"+e.PathSegments.join("/"))}static hashContainsKnownProperties(e){return!!Qn(e)}}const Xn={"login.microsoftonline.com":{token_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.com/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.com/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/logout"},"login.chinacloudapi.cn":{token_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.chinacloudapi.cn/{tenantid}/discovery/v2.0/keys",issuer:"https://login.partner.microsoftonline.cn/{tenantid}/v2.0",authorization_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/logout"},"login.microsoftonline.us":{token_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.us/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.us/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/logout"}},Zn={metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},er=new Set;function tr(e,t,n,r){if(null===r||void 0===r||r.trace("getAliasesFromMetadata called with source: ".concat(n)),e&&t){const o=nr(t,e);if(o)return null===r||void 0===r||r.trace("getAliasesFromMetadata: found cloud discovery metadata in ".concat(n,", returning aliases")),o.aliases;null===r||void 0===r||r.trace("getAliasesFromMetadata: did not find cloud discovery metadata in ".concat(n))}return null}function nr(e,t){for(let n=0;n<e.length;n++){const r=e[n];if(r.aliases.includes(t))return r}return null}Zn.metadata.forEach(e=>{e.aliases.forEach(e=>{er.add(e)})});const rr="cache_quota_exceeded",or="cache_error_unknown",ar={[rr]:"Exceeded cache storage capacity.",[or]:"Unexpected error occurred when using cache storage."};class ir extends ht{constructor(e,t){const n=t||(ar[e]?ar[e]:ar[or]);super("".concat(e,": ").concat(n)),Object.setPrototypeOf(this,ir.prototype),this.name="CacheError",this.errorCode=e,this.errorMessage=n}}function sr(e){return e instanceof Error?"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name||e.message.includes("exceeded the quota")?new ir(rr):new ir(e.name,e.message):new ir(or)}class lr{constructor(e,t,n,r,o){this.clientId=e,this.cryptoImpl=t,this.commonLogger=n.clone(cn,un),this.staticAuthorityOptions=o,this.performanceClient=r}getAllAccounts(e,t){return this.buildTenantProfiles(this.getAccountsFilteredBy(e,t),t,e)}getAccountInfoFilteredBy(e,t){if(0===Object.keys(e).length||Object.values(e).every(e=>!e))return this.commonLogger.warning("getAccountInfoFilteredBy: Account filter is empty or invalid, returning null"),null;const n=this.getAllAccounts(e,t);if(n.length>1){return n.sort(e=>e.idTokenClaims?-1:1)[0]}return 1===n.length?n[0]:null}getBaseAccountInfo(e,t){const n=this.getAccountsFilteredBy(e,t);return n.length>0?n[0].getAccountInfo():null}buildTenantProfiles(e,t,n){return e.flatMap(e=>this.getTenantProfilesFromAccountEntity(e,t,null===n||void 0===n?void 0:n.tenantId,n))}getTenantedAccountInfoByFilter(e,t,n,r,o){let a,i=null;if(o&&!this.tenantProfileMatchesFilter(n,o))return null;const s=this.getIdToken(e,r,t,n.tenantId);return s&&(a=Wn(s.secret,this.cryptoImpl.base64Decode),!this.idTokenClaimsMatchTenantProfileFilter(a,o))?null:(i=Bn(e,n,a,null===s||void 0===s?void 0:s.secret),i)}getTenantProfilesFromAccountEntity(e,t,n,r){const o=e.getAccountInfo();let a=o.tenantProfiles||new Map;const i=this.getTokenKeys();if(n){const e=a.get(n);if(!e)return[];a=new Map([[n,e]])}const s=[];return a.forEach(e=>{const n=this.getTenantedAccountInfoByFilter(o,i,e,t,r);n&&s.push(n)}),s}tenantProfileMatchesFilter(e,t){return!(t.localAccountId&&!this.matchLocalAccountIdFromTenantProfile(e,t.localAccountId))&&((!t.name||e.name===t.name)&&(void 0===t.isHomeTenant||e.isHomeTenant===t.isHomeTenant))}idTokenClaimsMatchTenantProfileFilter(e,t){if(t){if(t.localAccountId&&!this.matchLocalAccountIdFromTokenClaims(e,t.localAccountId))return!1;if(t.loginHint&&!this.matchLoginHintFromTokenClaims(e,t.loginHint))return!1;if(t.username&&!this.matchUsername(e.preferred_username,t.username))return!1;if(t.name&&!this.matchName(e,t.name))return!1;if(t.sid&&!this.matchSid(e,t.sid))return!1}return!0}async saveCacheRecord(e,t,n){if(!e)throw sn(qt);try{e.account&&await this.setAccount(e.account,t),e.idToken&&!1!==(null===n||void 0===n?void 0:n.idToken)&&await this.setIdTokenCredential(e.idToken,t),e.accessToken&&!1!==(null===n||void 0===n?void 0:n.accessToken)&&await this.saveAccessToken(e.accessToken,t),e.refreshToken&&!1!==(null===n||void 0===n?void 0:n.refreshToken)&&await this.setRefreshTokenCredential(e.refreshToken,t),e.appMetadata&&this.setAppMetadata(e.appMetadata,t)}catch(o){var r;throw null===(r=this.commonLogger)||void 0===r||r.error("CacheManager.saveCacheRecord: failed"),o instanceof ht?o:sr(o)}}async saveAccessToken(e,t){const n={clientId:e.clientId,credentialType:e.credentialType,environment:e.environment,homeAccountId:e.homeAccountId,realm:e.realm,tokenType:e.tokenType,requestedClaimsHash:e.requestedClaimsHash},r=this.getTokenKeys(),o=Fn.fromString(e.target);r.accessToken.forEach(e=>{if(!this.accessTokenKeyMatchesFilter(e,n,!1))return;const r=this.getAccessTokenCredential(e,t);if(r&&this.credentialMatchesFilter(r,n)){Fn.fromString(r.target).intersectingScopeSets(o)&&this.removeAccessToken(e,t)}}),await this.setAccessTokenCredential(e,t)}getAccountsFilteredBy(e,t){const n=this.getAccountKeys(),r=[];return n.forEach(n=>{var o;const a=this.getAccount(n,t);if(!a)return;if(e.homeAccountId&&!this.matchHomeAccountId(a,e.homeAccountId))return;if(e.username&&!this.matchUsername(a.username,e.username))return;if(e.environment&&!this.matchEnvironment(a,e.environment))return;if(e.realm&&!this.matchRealm(a,e.realm))return;if(e.nativeAccountId&&!this.matchNativeAccountId(a,e.nativeAccountId))return;if(e.authorityType&&!this.matchAuthorityType(a,e.authorityType))return;const i={localAccountId:null===e||void 0===e?void 0:e.localAccountId,name:null===e||void 0===e?void 0:e.name},s=null===(o=a.tenantProfiles)||void 0===o?void 0:o.filter(e=>this.tenantProfileMatchesFilter(e,i));s&&0===s.length||r.push(a)}),r}credentialMatchesFilter(e,t){if(t.clientId&&!this.matchClientId(e,t.clientId))return!1;if(t.userAssertionHash&&!this.matchUserAssertionHash(e,t.userAssertionHash))return!1;if("string"===typeof t.homeAccountId&&!this.matchHomeAccountId(e,t.homeAccountId))return!1;if(t.environment&&!this.matchEnvironment(e,t.environment))return!1;if(t.realm&&!this.matchRealm(e,t.realm))return!1;if(t.credentialType&&!this.matchCredentialType(e,t.credentialType))return!1;if(t.familyId&&!this.matchFamilyId(e,t.familyId))return!1;if(t.target&&!this.matchTarget(e,t.target))return!1;if((t.requestedClaimsHash||e.requestedClaimsHash)&&e.requestedClaimsHash!==t.requestedClaimsHash)return!1;if(e.credentialType===Pe.ACCESS_TOKEN_WITH_AUTH_SCHEME){if(t.tokenType&&!this.matchTokenType(e,t.tokenType))return!1;if(t.tokenType===Fe.SSH&&t.keyId&&!this.matchKeyId(e,t.keyId))return!1}return!0}getAppMetadataFilteredBy(e){const t=this.getKeys(),n={};return t.forEach(t=>{if(!this.isAppMetadata(t))return;const r=this.getAppMetadata(t);r&&(e.environment&&!this.matchEnvironment(r,e.environment)||e.clientId&&!this.matchClientId(r,e.clientId)||(n[t]=r))}),n}getAuthorityMetadataByAlias(e){const t=this.getAuthorityMetadataKeys();let n=null;return t.forEach(t=>{if(!this.isAuthorityMetadata(t)||-1===t.indexOf(this.clientId))return;const r=this.getAuthorityMetadata(t);r&&-1!==r.aliases.indexOf(e)&&(n=r)}),n}removeAllAccounts(e){this.getAllAccounts({},e).forEach(t=>{this.removeAccount(t,e)})}removeAccount(e,t){this.removeAccountContext(e,t);this.getAccountKeys().filter(t=>t.includes(e.homeAccountId)&&t.includes(e.environment)).forEach(e=>{this.removeItem(e,t),this.performanceClient.incrementFields({accountsRemoved:1},t)})}removeAccountContext(e,t){const n=this.getTokenKeys(),r=t=>t.includes(e.homeAccountId)&&t.includes(e.environment);n.idToken.filter(r).forEach(e=>{this.removeIdToken(e,t)}),n.accessToken.filter(r).forEach(e=>{this.removeAccessToken(e,t)}),n.refreshToken.filter(r).forEach(e=>{this.removeRefreshToken(e,t)})}removeAccessToken(e,t){const n=this.getAccessTokenCredential(e,t);if(this.removeItem(e,t),this.performanceClient.incrementFields({accessTokensRemoved:1},t),!n||n.credentialType.toLowerCase()!==Pe.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase()||n.tokenType!==Fe.POP)return;const r=n.keyId;r&&this.cryptoImpl.removeTokenBindingKey(r).catch(()=>{var e;this.commonLogger.error("Failed to remove token binding key ".concat(r),t),null===(e=this.performanceClient)||void 0===e||e.incrementFields({removeTokenBindingKeyFailure:1},t)})}removeAppMetadata(e){return this.getKeys().forEach(t=>{this.isAppMetadata(t)&&this.removeItem(t,e)}),!0}getIdToken(e,t,n,r,o){this.commonLogger.trace("CacheManager - getIdToken called");const a={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:Pe.ID_TOKEN,clientId:this.clientId,realm:r},i=this.getIdTokensByFilter(a,t,n),s=i.size;if(s<1)return this.commonLogger.info("CacheManager:getIdToken - No token found"),null;if(s>1){let n=i;if(!r){const t=new Map;i.forEach((n,r)=>{n.realm===e.tenantId&&t.set(r,n)});const r=t.size;if(r<1)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account but none match account entity tenant id, returning first result"),i.values().next().value;if(1===r)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account, defaulting to home tenant profile"),t.values().next().value;n=t}return this.commonLogger.info("CacheManager:getIdToken - Multiple matching ID tokens found, clearing them"),n.forEach((e,n)=>{this.removeIdToken(n,t)}),o&&t&&o.addFields({multiMatchedID:i.size},t),null}return this.commonLogger.info("CacheManager:getIdToken - Returning ID token"),i.values().next().value}getIdTokensByFilter(e,t,n){const r=n&&n.idToken||this.getTokenKeys().idToken,o=new Map;return r.forEach(n=>{if(!this.idTokenKeyMatchesFilter(n,c({clientId:this.clientId},e)))return;const r=this.getIdTokenCredential(n,t);r&&this.credentialMatchesFilter(r,e)&&o.set(n,r)}),o}idTokenKeyMatchesFilter(e,t){const n=e.toLowerCase();return(!t.clientId||-1!==n.indexOf(t.clientId.toLowerCase()))&&(!t.homeAccountId||-1!==n.indexOf(t.homeAccountId.toLowerCase()))}removeIdToken(e,t){this.removeItem(e,t)}removeRefreshToken(e,t){this.removeItem(e,t)}getAccessToken(e,t,n,r){const o=t.correlationId;this.commonLogger.trace("CacheManager - getAccessToken called",o);const a=Fn.createSearchScopes(t.scopes),i=t.authenticationScheme||Fe.BEARER,s=i&&i.toLowerCase()!==Fe.BEARER.toLowerCase()?Pe.ACCESS_TOKEN_WITH_AUTH_SCHEME:Pe.ACCESS_TOKEN,l={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:s,clientId:this.clientId,realm:r||e.tenantId,target:a,tokenType:i,keyId:t.sshKid,requestedClaimsHash:t.requestedClaimsHash},c=n&&n.accessToken||this.getTokenKeys().accessToken,u=[];c.forEach(e=>{if(this.accessTokenKeyMatchesFilter(e,l,!0)){const t=this.getAccessTokenCredential(e,o);t&&this.credentialMatchesFilter(t,l)&&u.push(t)}});const d=u.length;return d<1?(this.commonLogger.info("CacheManager:getAccessToken - No token found",o),null):d>1?(this.commonLogger.info("CacheManager:getAccessToken - Multiple access tokens found, clearing them",o),u.forEach(e=>{this.removeAccessToken(this.generateCredentialKey(e),o)}),this.performanceClient.addFields({multiMatchedAT:u.length},o),null):(this.commonLogger.info("CacheManager:getAccessToken - Returning access token",o),u[0])}accessTokenKeyMatchesFilter(e,t,n){const r=e.toLowerCase();if(t.clientId&&-1===r.indexOf(t.clientId.toLowerCase()))return!1;if(t.homeAccountId&&-1===r.indexOf(t.homeAccountId.toLowerCase()))return!1;if(t.realm&&-1===r.indexOf(t.realm.toLowerCase()))return!1;if(t.requestedClaimsHash&&-1===r.indexOf(t.requestedClaimsHash.toLowerCase()))return!1;if(t.target){const e=t.target.asArray();for(let t=0;t<e.length;t++){if(n&&!r.includes(e[t].toLowerCase()))return!1;if(!n&&r.includes(e[t].toLowerCase()))return!0}}return!0}getAccessTokensByFilter(e,t){const n=this.getTokenKeys(),r=[];return n.accessToken.forEach(n=>{if(!this.accessTokenKeyMatchesFilter(n,e,!0))return;const o=this.getAccessTokenCredential(n,t);o&&this.credentialMatchesFilter(o,e)&&r.push(o)}),r}getRefreshToken(e,t,n,r,o){this.commonLogger.trace("CacheManager - getRefreshToken called");const a=t?Ne:void 0,i={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:Pe.REFRESH_TOKEN,clientId:this.clientId,familyId:a},s=r&&r.refreshToken||this.getTokenKeys().refreshToken,l=[];s.forEach(e=>{if(this.refreshTokenKeyMatchesFilter(e,i)){const t=this.getRefreshTokenCredential(e,n);t&&this.credentialMatchesFilter(t,i)&&l.push(t)}});const c=l.length;return c<1?(this.commonLogger.info("CacheManager:getRefreshToken - No refresh token found."),null):(c>1&&o&&n&&o.addFields({multiMatchedRT:c},n),this.commonLogger.info("CacheManager:getRefreshToken - returning refresh token"),l[0])}refreshTokenKeyMatchesFilter(e,t){const n=e.toLowerCase();return(!t.familyId||-1!==n.indexOf(t.familyId.toLowerCase()))&&(!(!t.familyId&&t.clientId&&-1===n.indexOf(t.clientId.toLowerCase()))&&(!t.homeAccountId||-1!==n.indexOf(t.homeAccountId.toLowerCase())))}readAppMetadataFromCache(e){const t={environment:e,clientId:this.clientId},n=this.getAppMetadataFilteredBy(t),r=Object.keys(n).map(e=>n[e]),o=r.length;if(o<1)return null;if(o>1)throw sn(Nt);return r[0]}isAppMetadataFOCI(e){const t=this.readAppMetadataFromCache(e);return!(!t||t.familyId!==Ne)}matchHomeAccountId(e,t){return!("string"!==typeof e.homeAccountId||t!==e.homeAccountId)}matchLocalAccountIdFromTokenClaims(e,t){return t===(e.oid||e.sub)}matchLocalAccountIdFromTenantProfile(e,t){return e.localAccountId===t}matchName(e,t){var n;return!(t.toLowerCase()!==(null===(n=e.name)||void 0===n?void 0:n.toLowerCase()))}matchUsername(e,t){return!(!e||"string"!==typeof e||(null===t||void 0===t?void 0:t.toLowerCase())!==e.toLowerCase())}matchUserAssertionHash(e,t){return!(!e.userAssertionHash||t!==e.userAssertionHash)}matchEnvironment(e,t){if(this.staticAuthorityOptions){const n=function(e,t){let n;const r=e.canonicalAuthority;if(r){var o;const a=new $n(r).getUrlComponents().HostNameAndPort;n=tr(a,null===(o=e.cloudDiscoveryMetadata)||void 0===o?void 0:o.metadata,Re,t)||tr(a,Zn.metadata,De,t)||e.knownAuthorities}return n||[]}(this.staticAuthorityOptions,this.commonLogger);if(n.includes(t)&&n.includes(e.environment))return!0}const n=this.getAuthorityMetadataByAlias(t);return!!(n&&n.aliases.indexOf(e.environment)>-1)}matchCredentialType(e,t){return e.credentialType&&t.toLowerCase()===e.credentialType.toLowerCase()}matchClientId(e,t){return!(!e.clientId||t!==e.clientId)}matchFamilyId(e,t){return!(!e.familyId||t!==e.familyId)}matchRealm(e,t){var n;return!((null===(n=e.realm)||void 0===n?void 0:n.toLowerCase())!==t.toLowerCase())}matchNativeAccountId(e,t){return!(!e.nativeAccountId||t!==e.nativeAccountId)}matchLoginHintFromTokenClaims(e,t){return e.login_hint===t||(e.preferred_username===t||e.upn===t)}matchSid(e,t){return e.sid===t}matchAuthorityType(e,t){return!(!e.authorityType||t.toLowerCase()!==e.authorityType.toLowerCase())}matchTarget(e,t){if(e.credentialType!==Pe.ACCESS_TOKEN&&e.credentialType!==Pe.ACCESS_TOKEN_WITH_AUTH_SCHEME||!e.target)return!1;return Fn.fromString(e.target).containsScopeSet(t)}matchTokenType(e,t){return!(!e.tokenType||e.tokenType!==t)}matchKeyId(e,t){return!(!e.keyId||e.keyId!==t)}isAppMetadata(e){return-1!==e.indexOf(Ee)}isAuthorityMetadata(e){return-1!==e.indexOf(_e)}generateAuthorityMetadataCacheKey(e){return"".concat(_e,"-").concat(this.clientId,"-").concat(e)}static toObject(e,t){for(const n in t)e[n]=t[n];return e}}class cr extends lr{async setAccount(){throw sn(nn)}getAccount(){throw sn(nn)}async setIdTokenCredential(){throw sn(nn)}getIdTokenCredential(){throw sn(nn)}async setAccessTokenCredential(){throw sn(nn)}getAccessTokenCredential(){throw sn(nn)}async setRefreshTokenCredential(){throw sn(nn)}getRefreshTokenCredential(){throw sn(nn)}setAppMetadata(){throw sn(nn)}getAppMetadata(){throw sn(nn)}setServerTelemetry(){throw sn(nn)}getServerTelemetry(){throw sn(nn)}setAuthorityMetadata(){throw sn(nn)}getAuthorityMetadata(){throw sn(nn)}getAuthorityMetadataKeys(){throw sn(nn)}setThrottlingCache(){throw sn(nn)}getThrottlingCache(){throw sn(nn)}removeItem(){throw sn(nn)}getKeys(){throw sn(nn)}getAccountKeys(){throw sn(nn)}getTokenKeys(){throw sn(nn)}generateCredentialKey(){throw sn(nn)}generateAccountKey(){throw sn(nn)}}const ur="acquireTokenByCode",dr="acquireTokenByRefreshToken",hr="acquireTokenSilent",gr="acquireTokenSilentAsync",mr="acquireTokenPopup",fr="acquireTokenPreRedirect",pr="acquireTokenRedirect",yr="cryptoOptsGetPublicKeyThumbprint",vr="cryptoOptsSignJwt",br="silentCacheClientAcquireToken",wr="silentIframeClientAcquireToken",kr="awaitConcurrentIframe",Sr="silentRefreshClientAcquireToken",xr="ssoSilent",Cr="standardInteractionClientGetDiscoveredAuthority",Ar="nativeInteractionClientAcquireToken",Ir="networkClientSendPostRequestAsync",Tr="refreshTokenClientExecutePostToTokenEndpoint",Pr="authorizationCodeClientExecutePostToTokenEndpoint",Er="refreshTokenClientExecuteTokenRequest",Nr="refreshTokenClientAcquireToken",_r="refreshTokenClientAcquireTokenWithCachedRefreshToken",Mr="refreshTokenClientAcquireTokenByRefreshToken",Rr="refreshTokenClientCreateTokenRequestBody",Or="acquireTokenFromCache",jr="silentFlowClientAcquireCachedToken",Dr="silentFlowClientGenerateResultFromCacheRecord",Lr="acquireTokenBySilentIframe",Fr="initializeBaseRequest",qr="initializeSilentRequest",zr="initializeClientApplication",Ur="initializeCache",Hr="silentIframeClientTokenHelper",Br="silentHandlerInitiateAuthRequest",Wr="silentHandlerMonitorIframeForHash",Kr="silentHandlerLoadFrame",Vr="silentHandlerLoadFrameSync",Gr="standardInteractionClientCreateAuthCodeClient",Qr="standardInteractionClientGetClientConfiguration",Yr="standardInteractionClientInitializeAuthorizationRequest",Jr="getAuthCodeUrl",$r="getStandardParams",Xr="handleCodeResponseFromServer",Zr="handleCodeResponse",eo="handleResponseEar",to="handleResponsePlatformBroker",no="handleResponseCode",ro="updateTokenEndpointAuthority",oo="authClientAcquireToken",ao="authClientExecuteTokenRequest",io="authClientCreateTokenRequestBody",so="popTokenGenerateCnf",lo="popTokenGenerateKid",co="handleServerTokenResponse",uo="deserializeResponse",ho="authorityFactoryCreateDiscoveredInstance",go="authorityResolveEndpointsAsync",mo="authorityGetCloudDiscoveryMetadataFromNetwork",fo="authorityUpdateCloudDiscoveryMetadata",po="authorityGetEndpointMetadataFromNetwork",yo="authorityUpdateEndpointMetadata",vo="authorityUpdateMetadataWithRegionalInformation",bo="regionDiscoveryDetectRegion",wo="regionDiscoveryGetRegionFromIMDS",ko="regionDiscoveryGetCurrentVersion",So="acquireTokenByCodeAsync",xo="handleRedirectPromise",Co="handleNativeRedirectPromise",Ao="nativeMessageHandlerHandshake",Io="removeHiddenIframe",To="clearTokensAndKeysWithClaims",Po="cacheManagerGetRefreshToken",Eo="importExistingCache",No="setUserData",_o="localStorageUpdated",Mo="generatePkceCodes",Ro="generateCodeVerifier",Oo="generateCodeChallengeFromVerifier",jo="sha256Digest",Do="getRandomValues",Lo="generateHKDF",Fo="generateBaseKey",qo="base64Decode",zo="urlEncodeArr",Uo="encrypt",Ho="decrypt",Bo="generateEarKey",Wo="decryptEarResponse",Ko=(new Map([[ur,"ATByCode"],[dr,"ATByRT"],[hr,"ATS"],[gr,"ATSAsync"],[mr,"ATPopup"],[pr,"ATRedirect"],[yr,"CryptoGetPKThumb"],[vr,"CryptoSignJwt"],[br,"SltCacheClientAT"],[wr,"SltIframeClientAT"],[Sr,"SltRClientAT"],[xr,"SsoSlt"],[Cr,"StdIntClientGetDiscAuth"],["fetchAccountIdWithNativeBroker","FetchAccIdWithNtvBroker"],[Ar,"NtvIntClientAT"],["baseClientCreateTokenRequestHeaders","BaseClientCreateTReqHead"],[Ir,"NetClientSendPost"],[Tr,"RTClientExecPost"],[Pr,"AuthCodeClientExecPost"],["brokerHandshake","BrokerHandshake"],["acquireTokenByRefreshTokenInBroker","ATByRTInBroker"],["acquireTokenByBroker","ATByBroker"],[Er,"RTClientExecTReq"],[Nr,"RTClientAT"],[_r,"RTClientATWithCachedRT"],[Mr,"RTClientATByRT"],[Rr,"RTClientCreateTReqBody"],[Or,"ATFromCache"],[jr,"SltFlowClientATCached"],[Dr,"SltFlowClientGenResFromCache"],[Lr,"ATBySltIframe"],[Fr,"InitBaseReq"],[qr,"InitSltReq"],[zr,"InitClientApplication"],[Ur,"InitCache"],[Eo,"importCache"],[No,"setUserData"],[_o,"localStorageUpdated"],[Hr,"SIClientTHelper"],[Br,"SHandlerInitAuthReq"],[Wr,"SltHandlerMonitorIframeForHash"],[Kr,"SHandlerLoadFrame"],[Vr,"SHandlerLoadFrameSync"],[Gr,"StdIntClientCreateAuthCodeClient"],[Qr,"StdIntClientGetClientConf"],[Yr,"StdIntClientInitAuthReq"],[Jr,"GetAuthCodeUrl"],[Xr,"HandleCodeResFromServer"],[Zr,"HandleCodeResp"],[eo,"HandleRespEar"],[no,"HandleRespCode"],[to,"HandleRespPlatBroker"],[ro,"UpdTEndpointAuth"],[oo,"AuthClientAT"],[ao,"AuthClientExecTReq"],[io,"AuthClientCreateTReqBody"],[so,"PopTGenCnf"],[lo,"PopTGenKid"],[co,"HandleServerTRes"],[uo,"DeserializeRes"],[ho,"AuthFactCreateDiscInst"],[go,"AuthResolveEndpointsAsync"],["authorityResolveEndpointsFromLocalSources","AuthResolveEndpointsFromLocal"],[mo,"AuthGetCDMetaFromNet"],[fo,"AuthUpdCDMeta"],[po,"AuthUpdCDMetaFromNet"],[yo,"AuthUpdEndpointMeta"],[vo,"AuthUpdMetaWithRegInfo"],[bo,"RegDiscDetectReg"],[wo,"RegDiscGetRegFromIMDS"],[ko,"RegDiscGetCurrentVer"],[So,"ATByCodeAsync"],["getEndpointMetadataFromNetwork","GetEndpointMetaFromNet"],["getCloudDiscoveryMetadataFromNetworkMeasurement","GetCDMetaFromNet"],[xo,"HandleRedirectPromise"],[Co,"HandleNtvRedirectPromise"],["updateCloudDiscoveryMetadataMeasurement","UpdateCDMeta"],["usernamePasswordClientAcquireToken","UserPassClientAT"],[Ao,"NtvMsgHandlerHandshake"],["nativeGenerateAuthResult","NtvGenAuthRes"],[Io,"RemoveHiddenIframe"],[To,"ClearTAndKeysWithClaims"],[Po,"CacheManagerGetRT"],[Mo,"GenPkceCodes"],[Ro,"GenCodeVerifier"],[Oo,"GenCodeChallengeFromVerifier"],[jo,"Sha256Digest"],[Do,"GetRandomValues"],[Lo,"genHKDF"],[Fo,"genBaseKey"],[qo,"b64Decode"],[zo,"urlEncArr"],[Uo,"encrypt"],[Ho,"decrypt"],[Bo,"genEarKey"],[Wo,"decryptEarResp"]]),1);new Set(["accessTokenSize","durationMs","idTokenSize","matsSilentStatus","matsHttpStatus","refreshTokenSize","queuedTimeMs","startTimeMs","status","multiMatchedAT","multiMatchedID","multiMatchedRT","unencryptedCacheCount","encryptedCacheExpiredCount","oldAccountCount","oldAccessCount","oldIdCount","oldRefreshCount","currAccountCount","currAccessCount","currIdCount","currRefreshCount","expiredCacheRemovedCount","upgradedCacheCount"]);class Vo{startMeasurement(){}endMeasurement(){}flushMeasurement(){return null}}class Go{generateId(){return"callback-id"}startMeasurement(e,t){return{end:()=>null,discard:()=>{},add:()=>{},increment:()=>{},event:{eventId:this.generateId(),status:Ko,authority:"",libraryName:"",libraryVersion:"",clientId:"",name:e,startTimeMs:Date.now(),correlationId:t||""},measurement:new Vo}}startPerformanceMeasurement(){return new Vo}calculateQueuedTime(){return 0}addQueueMeasurement(){}setPreQueueTime(){}endMeasurement(){return null}discardMeasurements(){}removePerformanceCallback(){return!0}addPerformanceCallback(){return""}emitEvents(){}addFields(){}incrementFields(){}cacheEventByCorrelationId(){}}const Qo={tokenRenewalOffsetSeconds:300,preventCorsPreflight:!1},Yo={loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:rt.Info,correlationId:H.EMPTY_STRING},Jo={claimsBasedCachingEnabled:!1},$o={async sendGetRequestAsync(){throw sn(nn)},async sendPostRequestAsync(){throw sn(nn)}},Xo={sku:H.SKU,version:un,cpu:H.EMPTY_STRING,os:H.EMPTY_STRING},Zo={clientSecret:H.EMPTY_STRING,clientAssertion:void 0},ea={azureCloudInstance:lt,tenant:"".concat(H.DEFAULT_COMMON_TENANT)},ta={application:{appName:"",appVersion:""}};function na(e){return e.authOptions.authority.options.protocolMode===it}const ra={sendGetRequestAsync:()=>Promise.reject(sn(nn)),sendPostRequestAsync:()=>Promise.reject(sn(nn))},oa="invalid_grant",aa=483,ia=600,sa="msal",la=30,ca="msal.js.browser",ua="53ee284d-920a-4b59-9d30-a60315b26836",da="ppnbnpeolgkicgegkbkbjmhlideopiji",ha="MATS",ga="MicrosoftEntra",ma="DOM API",fa="get-token-and-sign-out",pa="PlatformAuthDOMHandler",ya="PlatformAuthExtensionHandler",va="Handshake",ba="HandshakeResponse",wa="GetToken",ka="Response",Sa="localStorage",xa="sessionStorage",Ca="memoryStorage",Aa="GET",Ia="POST",Ta="signin",Pa="signout",Ea="request.origin",Na="urlHash",_a="request.params",Ma="code.verifier",Ra="interaction.status",Oa="request.native",ja="wrapper.sku",Da="wrapper.version",La=861,Fa=862,qa=863,za=865,Ua=866,Ha=61,Ba=961,Wa=962;var Ka;!function(e){e.Redirect="redirect",e.Popup="popup",e.Silent="silent",e.None="none"}(Ka||(Ka={}));const Va={scopes:$},Ga="msal.db",Qa="".concat(Ga,".keys"),Ya=0,Ja=1,$a=2,Xa=3,Za=4,ei=5,ti=[Ya,ei,Za],ni="pkce_not_created",ri="ear_jwk_empty",oi="ear_jwe_empty",ai="crypto_nonexistent",ii="empty_navigate_uri",si="hash_empty_error",li="no_state_in_hash",ci="hash_does_not_contain_known_properties",ui="unable_to_parse_state",di="state_interaction_type_mismatch",hi="interaction_in_progress",gi="popup_window_error",mi="empty_window_error",fi="user_cancelled",pi="monitor_popup_timeout",yi="monitor_window_timeout",vi="redirect_in_iframe",bi="block_iframe_reload",wi="block_nested_popups",ki="iframe_closed_prematurely",Si="silent_logout_unsupported",xi="no_account_error",Ci="silent_prompt_value_error",Ai="no_token_request_cache_error",Ii="unable_to_parse_token_request_cache_error",Ti="auth_request_not_set_error",Pi="invalid_cache_type",Ei="non_browser_environment",Ni="database_not_open",_i="no_network_connectivity",Mi="post_request_failed",Ri="get_request_failed",Oi="failed_to_parse_response",ji="unable_to_load_token",Di="crypto_key_not_found",Li="auth_code_required",Fi="auth_code_or_nativeAccountId_required",qi="spa_code_and_nativeAccountId_present",zi="database_unavailable",Ui="unable_to_acquire_token_from_native_platform",Hi="native_handshake_timeout",Bi="native_extension_not_installed",Wi="native_connection_not_established",Ki="uninitialized_public_client_application",Vi="native_prompt_not_supported",Gi="invalid_base64_string",Qi="invalid_pop_token_request",Yi="failed_to_build_headers",Ji="failed_to_parse_headers",$i="failed_to_decrypt_ear_response",Xi="timed_out",Zi="For more visit: aka.ms/msaljs/browser-errors",es={[ni]:"The PKCE code challenge and verifier could not be generated.",[ri]:"No EAR encryption key provided. This is unexpected.",[oi]:"Server response does not contain ear_jwe property. This is unexpected.",[ai]:"The crypto object or function is not available.",[ii]:"Navigation URI is empty. Please check stack trace for more info.",[si]:"Hash value cannot be processed because it is empty. Please verify that your redirectUri is not clearing the hash. ".concat(Zi),[li]:"Hash does not contain state. Please verify that the request originated from msal.",[ci]:"Hash does not contain known properites. Please verify that your redirectUri is not changing the hash.  ".concat(Zi),[ui]:"Unable to parse state. Please verify that the request originated from msal.",[di]:"Hash contains state but the interaction type does not match the caller.",[hi]:"Interaction is currently in progress. Please ensure that this interaction has been completed before calling an interactive API.   ".concat(Zi),[gi]:"Error opening popup window. This can happen if you are using IE or if popups are blocked in the browser.",[mi]:"window.open returned null or undefined window object.",[fi]:"User cancelled the flow.",[pi]:"Token acquisition in popup failed due to timeout.  ".concat(Zi),[yi]:"Token acquisition in iframe failed due to timeout.  ".concat(Zi),[vi]:"Redirects are not supported for iframed or brokered applications. Please ensure you are using MSAL.js in a top frame of the window if using the redirect APIs, or use the popup APIs.",[bi]:"Request was blocked inside an iframe because MSAL detected an authentication response.  ".concat(Zi),[wi]:"Request was blocked inside a popup because MSAL detected it was running in a popup.",[ki]:"The iframe being monitored was closed prematurely.",[Si]:"Silent logout not supported. Please call logoutRedirect or logoutPopup instead.",[xi]:"No account object provided to acquireTokenSilent and no active account has been set. Please call setActiveAccount or provide an account on the request.",[Ci]:"The value given for the prompt value is not valid for silent requests - must be set to 'none' or 'no_session'.",[Ai]:"No token request found in cache.",[Ii]:"The cached token request could not be parsed.",[Ti]:"Auth Request not set. Please ensure initiateAuthRequest was called from the InteractionHandler",[Pi]:"Invalid cache type",[Ei]:"Login and token requests are not supported in non-browser environments.",[Ni]:"Database is not open!",[_i]:"No network connectivity. Check your internet connection.",[Mi]:"Network request failed: If the browser threw a CORS error, check that the redirectUri is registered in the Azure App Portal as type 'SPA'",[Ri]:"Network request failed. Please check the network trace to determine root cause.",[Oi]:"Failed to parse network response. Check network trace.",[ji]:"Error loading token to cache.",[Di]:"Cryptographic Key or Keypair not found in browser storage.",[Li]:"An authorization code must be provided (as the `code` property on the request) to this flow.",[Fi]:"An authorization code or nativeAccountId must be provided to this flow.",[qi]:"Request cannot contain both spa code and native account id.",[zi]:"IndexedDB, which is required for persistent cryptographic key storage, is unavailable. This may be caused by browser privacy features which block persistent storage in third-party contexts.",[Ui]:"Unable to acquire token from native platform.  ".concat(Zi),[Hi]:"Timed out while attempting to establish connection to browser extension",[Bi]:"Native extension is not installed. If you think this is a mistake call the initialize function.",[Wi]:"Connection to native platform has not been established. Please install a compatible browser extension and run initialize().  ".concat(Zi),[Ki]:"You must call and await the initialize function before attempting to call any other MSAL API.  ".concat(Zi),[Vi]:"The provided prompt is not supported by the native platform. This request should be routed to the web based flow.",[Gi]:"Invalid base64 encoded string.",[Qi]:"Invalid PoP token request. The request should not have both a popKid value and signPopToken set to true.",[Yi]:"Failed to build request headers object.",[Ji]:"Failed to parse response headers",[$i]:"Failed to decrypt ear response",[Xi]:"The request timed out."};class ts extends ht{constructor(e,t){super(e,es[e],t),Object.setPrototypeOf(this,ts.prototype),this.name="BrowserAuthError"}}function ns(e,t){return new ts(e,t)}class rs{navigateInternal(e,t){return rs.defaultNavigateWindow(e,t)}navigateExternal(e,t){return rs.defaultNavigateWindow(e,t)}static defaultNavigateWindow(e,t){return t.noHistory?window.location.replace(e):window.location.assign(e),new Promise((e,n)=>{setTimeout(()=>{n(ns(Xi,"failed_to_redirect"))},t.timeout)})}}class os extends ht{constructor(e,t,n){super(e.errorCode,e.errorMessage,e.subError),Object.setPrototypeOf(this,os.prototype),this.name="NetworkError",this.error=e,this.httpStatus=t,this.responseHeaders=n}}function as(e,t,n,r){return e.errorMessage="".concat(e.errorMessage,", additionalErrorInfo: error.name:").concat(null===r||void 0===r?void 0:r.name,", error.message:").concat(null===r||void 0===r?void 0:r.message),new os(e,t,n)}class is{async sendGetRequestAsync(e,t){let n,r={},o=0;const a=ss(t);try{n=await fetch(e,{method:Aa,headers:a})}catch(i){throw as(ns(window.navigator.onLine?Ri:_i),void 0,void 0,i)}r=ls(n.headers);try{return o=n.status,{headers:r,body:await n.json(),status:o}}catch(i){throw as(ns(Oi),o,r,i)}}async sendPostRequestAsync(e,t){const n=t&&t.body||"",r=ss(t);let o,a=0,i={};try{o=await fetch(e,{method:Ia,headers:r,body:n})}catch(s){throw as(ns(window.navigator.onLine?Mi:_i),void 0,void 0,s)}i=ls(o.headers);try{return a=o.status,{headers:i,body:await o.json(),status:a}}catch(s){throw as(ns(Oi),a,i,s)}}}function ss(e){try{const t=new Headers;if(!e||!e.headers)return t;const n=e.headers;return Object.entries(n).forEach(e=>{let[n,r]=e;t.append(n,r)}),t}catch(t){throw as(ns(Yi),void 0,void 0,t)}}function ls(e){try{const t={};return e.forEach((e,n)=>{t[n]=e}),t}catch(t){throw ns(Ji)}}const cs="client_id",us="redirect_uri",ds="token_type",hs="req_cnf",gs="return_spa_code",ms="x-client-xtra-sku",fs="brk_client_id",ps="brk_redirect_uri",ys="instance_aware";function vs(e,t,n){if(!t)return;const r=e.get(cs);r&&e.has(fs)&&(null===n||void 0===n||n.addFields({embeddedClientId:r,embeddedRedirectUri:e.get(us)},t))}function bs(e,t){e.set("response_type",t)}function ws(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:$;!n||r.includes("openid")||t.includes("openid")||r.push("openid");const o=n?[...t||[],...r]:t||[],a=new Fn(o);e.set("scope",a.printScopes())}function ks(e,t){e.set(cs,t)}function Ss(e,t){e.set(us,t)}function xs(e,t){e.set("login_hint",t)}function Cs(e,t){e.set(ne,"UPN:".concat(t))}function As(e,t){e.set(ne,"Oid:".concat(t.uid,"@").concat(t.utid))}function Is(e,t){e.set("sid",t)}function Ts(e,t,n){const r=zs(t,n);try{JSON.parse(r)}catch(o){throw Dn(yn)}e.set("claims",r)}function Ps(e,t){e.set("client-request-id",t)}function Es(e,t){e.set("x-client-SKU",t.sku),e.set("x-client-VER",t.version),t.os&&e.set("x-client-OS",t.os),t.cpu&&e.set("x-client-CPU",t.cpu)}function Ns(e,t){null!==t&&void 0!==t&&t.appName&&e.set("x-app-name",t.appName),null!==t&&void 0!==t&&t.appVersion&&e.set("x-app-ver",t.appVersion)}function _s(e,t){t&&e.set("state",t)}function Ms(e,t,n){if(!t||!n)throw Dn(kn);e.set("code_challenge",t),e.set("code_challenge_method",n)}function Rs(e,t){e.set("client_secret",t)}function Os(e,t){t&&e.set("client_assertion",t)}function js(e,t){t&&e.set("client_assertion_type",t)}function Ds(e,t){e.set("grant_type",t)}function Ls(e){e.set("client_info","1")}function Fs(e){e.has(ys)||e.set(ys,"true")}function qs(e,t){Object.entries(t).forEach(t=>{let[n,r]=t;!e.has(n)&&r&&e.set(n,r)})}function zs(e,t){let n;if(e)try{n=JSON.parse(e)}catch(r){throw Dn(yn)}else n={};return t&&t.length>0&&(n.hasOwnProperty(ce)||(n[ce]={}),n[ce][ue]={values:t}),JSON.stringify(n)}function Us(e,t){t&&(e.set(ds,Fe.POP),e.set(hs,t))}function Hs(e,t){t&&(e.set(ds,Fe.SSH),e.set(hs,t))}function Bs(e,t){e.set("x-client-current-telemetry",t.generateCurrentRequestHeaderValue()),e.set("x-client-last-telemetry",t.generateLastRequestHeaderValue())}function Ws(e){e.set("x-ms-lib-capability",He)}function Ks(e,t,n){e.has(fs)||e.set(fs,t),e.has(ps)||e.set(ps,n)}function Vs(e){return encodeURIComponent(Qs(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"))}function Gs(e){return Ys(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Qs(e){return Ys((new TextEncoder).encode(e))}function Ys(e){const t=Array.from(e,e=>String.fromCodePoint(e)).join("");return btoa(t)}function Js(e){return(new TextDecoder).decode($s(e))}function $s(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw ns(Gi)}const n=atob(t);return Uint8Array.from(n,e=>e.codePointAt(0)||0)}const Xs="AES-GCM",Zs="HKDF",el="SHA-256",tl=new Uint8Array([1,0,1]),nl="0123456789abcdef",rl=new Uint32Array(1),ol="raw",al="encrypt",il="decrypt",sl={name:"RSASSA-PKCS1-v1_5",hash:el,modulusLength:2048,publicExponent:tl};async function ll(e,t,n){null===t||void 0===t||t.addQueueMeasurement(jo,n);const r=(new TextEncoder).encode(e);return window.crypto.subtle.digest(el,r)}function cl(e){return window.crypto.getRandomValues(e)}function ul(){return window.crypto.getRandomValues(rl),rl[0]}function dl(){const e=Date.now(),t=1024*ul()+(1023&ul()),n=new Uint8Array(16),r=Math.trunc(t/2**30),o=t&2**30-1,a=ul();n[0]=e/2**40,n[1]=e/2**32,n[2]=e/2**24,n[3]=e/65536,n[4]=e/256,n[5]=e,n[6]=112|r>>>8,n[7]=r,n[8]=128|o>>>24,n[9]=o>>>16,n[10]=o>>>8,n[11]=o,n[12]=a>>>24,n[13]=a>>>16,n[14]=a>>>8,n[15]=a;let i="";for(let s=0;s<n.length;s++)i+=nl.charAt(n[s]>>>4),i+=nl.charAt(15&n[s]),3!==s&&5!==s&&7!==s&&9!==s||(i+="-");return i}async function hl(e){return window.crypto.subtle.exportKey("jwk",e)}async function gl(){const e=await fl(),t={alg:"dir",kty:"oct",k:Gs(new Uint8Array(e))};return Qs(JSON.stringify(t))}async function ml(e,t){const n=t.split(".");if(5!==n.length)throw ns($i,"jwe_length");const r=await async function(e){const t=Js(e),n=$s(JSON.parse(t).k);return window.crypto.subtle.importKey(ol,n,Xs,!1,[il])}(e).catch(()=>{throw ns($i,"import_key")});try{const e=(new TextEncoder).encode(n[0]),t=$s(n[2]),o=$s(n[3]),a=$s(n[4]),i=8*a.byteLength,s=new Uint8Array(o.length+a.length);s.set(o),s.set(a,o.length);const l=await window.crypto.subtle.decrypt({name:Xs,iv:t,tagLength:i,additionalData:e},r,s);return(new TextDecoder).decode(l)}catch(o){throw ns($i,"decrypt")}}async function fl(){const e=await window.crypto.subtle.generateKey({name:Xs,length:256},!0,[al,il]);return window.crypto.subtle.exportKey(ol,e)}async function pl(e){return window.crypto.subtle.importKey(ol,e,Zs,!1,["deriveKey"])}async function yl(e,t,n){return window.crypto.subtle.deriveKey({name:Zs,salt:t,hash:el,info:(new TextEncoder).encode(n)},e,{name:Xs,length:256},!1,[al,il])}async function vl(e,t,n){const r=(new TextEncoder).encode(t),o=window.crypto.getRandomValues(new Uint8Array(16)),a=await yl(e,o,n),i=await window.crypto.subtle.encrypt({name:Xs,iv:new Uint8Array(12)},a,r);return{data:Gs(new Uint8Array(i)),nonce:Gs(o)}}async function bl(e,t,n,r){const o=$s(r),a=await yl(e,$s(t),n),i=await window.crypto.subtle.decrypt({name:Xs,iv:new Uint8Array(12)},a,o);return(new TextDecoder).decode(i)}async function wl(e){const t=await ll(e);return Gs(new Uint8Array(t))}const kl="storage_not_supported",Sl="stubbed_public_client_application_called",xl="in_mem_redirect_unavailable",Cl={[kl]:"Given storage configuration option was not supported.",[Sl]:"Stub instance of Public Client Application was called. If using msal-react, please ensure context is not used without a provider. For more visit: aka.ms/msaljs/browser-errors",[xl]:"Redirect cannot be supported. In-memory storage was selected and storeAuthStateInCookie=false, which would cause the library to be unable to handle the incoming hash. If you would like to use the redirect API, please use session/localStorage or set storeAuthStateInCookie=true."};class Al extends ht{constructor(e,t){super(e,t),this.name="BrowserConfigurationAuthError",Object.setPrototypeOf(this,Al.prototype)}}function Il(e){return new Al(e,Cl[e])}function Tl(e){e.location.hash="","function"===typeof e.history.replaceState&&e.history.replaceState(null,"","".concat(e.location.origin).concat(e.location.pathname).concat(e.location.search))}function Pl(){return window.parent!==window}function El(){return"undefined"!==typeof window&&window.location?window.location.href.split("?")[0].split("#")[0]:""}function Nl(){if("undefined"!==typeof window&&window.opener&&window.opener!==window&&"string"===typeof window.name&&0===window.name.indexOf("".concat(sa,".")))throw ns(wi)}function _l(){if("undefined"===typeof window)throw ns(Ei)}function Ml(e){if(!e)throw ns(Ki)}function Rl(e){_l(),function(){if($n.hashContainsKnownProperties(window.location.hash)&&Pl())throw ns(bi)}(),Nl(),Ml(e)}function Ol(e,t){if(Rl(e),function(e){if(Pl()&&!e)throw ns(vi)}(t.system.allowRedirectInIframe),t.cache.cacheLocation===Ca&&!t.cache.storeAuthStateInCookie)throw Il(xl)}function jl(e){const t=document.createElement("link");t.rel="preconnect",t.href=new URL(e).origin,t.crossOrigin="anonymous",document.head.appendChild(t),window.setTimeout(()=>{try{document.head.removeChild(t)}catch(e){}},1e4)}const Dl=1e4;const Ll="4.25.0",Fl="msal",ql="browser",zl="".concat(Fl,".").concat(ql,".log.level"),Ul="".concat(Fl,".").concat(ql,".log.pii"),Hl=("".concat(Fl,".").concat(ql,".performance.enabled"),"".concat(Fl,".").concat(ql,".platform.auth.dom")),Bl="".concat(Fl,".version"),Wl="account.keys",Kl="token.keys";function Vl(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return e<1?"".concat(Fl,".").concat(Wl):"".concat(Fl,".").concat(e,".").concat(Wl)}function Gl(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t<1?"".concat(Fl,".").concat(Kl,".").concat(e):"".concat(Fl,".").concat(t,".").concat(Kl,".").concat(e)}class Ql{static loggerCallback(e,t){switch(e){case rt.Error:return void console.error(t);case rt.Info:return void console.info(t);case rt.Verbose:return void console.debug(t);case rt.Warning:return void console.warn(t);default:return void console.log(t)}}constructor(e){var t,n;let r;this.browserEnvironment="undefined"!==typeof window,this.config=function(e,t){let{auth:n,cache:r,system:o,telemetry:a}=e;const i={clientId:H.EMPTY_STRING,authority:"".concat(H.DEFAULT_AUTHORITY),knownAuthorities:[],cloudDiscoveryMetadata:H.EMPTY_STRING,authorityMetadata:H.EMPTY_STRING,redirectUri:"undefined"!==typeof window?El():"",postLogoutRedirectUri:H.EMPTY_STRING,navigateToLoginRequestUrl:!0,clientCapabilities:[],protocolMode:at,OIDCOptions:{serverResponseType:be,defaultScopes:[H.OPENID_SCOPE,H.PROFILE_SCOPE,H.OFFLINE_ACCESS_SCOPE]},azureCloudOptions:{azureCloudInstance:lt,tenant:H.EMPTY_STRING},skipAuthorityMetadataCache:!1,supportsNestedAppAuth:!1,instanceAware:!1,encodeExtraQueryParams:!1},s={cacheLocation:xa,cacheRetentionDays:5,temporaryCacheLocation:xa,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!(!r||r.cacheLocation!==Sa),claimsBasedCachingEnabled:!1},l={loggerCallback:()=>{},logLevel:rt.Info,piiLoggingEnabled:!1},u=c(c({},Qo),{},{loggerOptions:l,networkClient:t?new is:ra,navigationClient:new rs,loadFrameTimeout:0,windowHashTimeout:(null===o||void 0===o?void 0:o.loadFrameTimeout)||6e4,iframeHashTimeout:(null===o||void 0===o?void 0:o.loadFrameTimeout)||Dl,navigateFrameWait:0,redirectNavigationTimeout:3e4,asyncPopups:!1,allowRedirectInIframe:!1,allowPlatformBroker:!1,nativeBrokerHandshakeTimeout:(null===o||void 0===o?void 0:o.nativeBrokerHandshakeTimeout)||2e3,pollIntervalMilliseconds:la}),d=c(c(c({},u),o),{},{loggerOptions:(null===o||void 0===o?void 0:o.loggerOptions)||l}),h={application:{appName:H.EMPTY_STRING,appVersion:H.EMPTY_STRING},client:new Go};(null===n||void 0===n?void 0:n.protocolMode)!==it&&null!==n&&void 0!==n&&n.OIDCOptions&&new ot(d.loggerOptions).warning(JSON.stringify(Dn(En)));if(null!==n&&void 0!==n&&n.protocolMode&&n.protocolMode===it&&null!==d&&void 0!==d&&d.allowPlatformBroker)throw Dn(Nn);return{auth:c(c(c({},i),n),{},{OIDCOptions:c(c({},i.OIDCOptions),null===n||void 0===n?void 0:n.OIDCOptions)}),cache:c(c({},s),r),system:d,telemetry:c(c({},h),a)}}(e,this.browserEnvironment);try{r=window[xa]}catch(u){}const o=null===(t=r)||void 0===t?void 0:t.getItem(zl),a=null===(n=r)||void 0===n||null===(n=n.getItem(Ul))||void 0===n?void 0:n.toLowerCase(),i="true"===a||"false"!==a&&void 0,s=c({},this.config.system.loggerOptions),l=o&&Object.keys(rt).includes(o)?rt[o]:void 0;l&&(s.loggerCallback=Ql.loggerCallback,s.logLevel=l),void 0!==i&&(s.piiLoggingEnabled=i),this.logger=new ot(s,"@azure/msal-browser",Ll),this.available=!1}getConfig(){return this.config}getLogger(){return this.logger}isAvailable(){return this.available}isBrowserEnvironment(){return this.browserEnvironment}}class Yl extends Ql{getModuleName(){return Yl.MODULE_NAME}getId(){return Yl.ID}async initialize(){return this.available="undefined"!==typeof window,this.available}}Yl.MODULE_NAME="",Yl.ID="StandardOperatingContext";const Jl="missing_kid_error",$l="missing_alg_error",Xl={[Jl]:"The JOSE Header for the requested JWT, JWS or JWK object requires a keyId to be configured as the 'kid' header claim. No 'kid' value was provided.",[$l]:"The JOSE Header for the requested JWT, JWS or JWK object requires an algorithm to be specified as the 'alg' header claim. No 'alg' value was provided."};class Zl extends ht{constructor(e,t){super(e,t),this.name="JoseHeaderError",Object.setPrototypeOf(this,Zl.prototype)}}function ec(e){return new Zl(e,Xl[e])}class tc{constructor(e){this.typ=e.typ,this.alg=e.alg,this.kid=e.kid}static getShrHeaderString(e){if(!e.kid)throw ec(Jl);if(!e.alg)throw ec($l);const t=new tc({typ:e.typ||nt,kid:e.kid,alg:e.alg});return JSON.stringify(t)}}class nc{constructor(){this.dbName=Ga,this.version=1,this.tableName=Qa,this.dbOpen=!1}async open(){return new Promise((e,t)=>{const n=window.indexedDB.open(this.dbName,this.version);n.addEventListener("upgradeneeded",e=>{e.target.result.createObjectStore(this.tableName)}),n.addEventListener("success",t=>{const n=t;this.db=n.target.result,this.dbOpen=!0,e()}),n.addEventListener("error",()=>t(ns(zi)))})}closeConnection(){const e=this.db;e&&this.dbOpen&&(e.close(),this.dbOpen=!1)}async validateDbIsOpen(){if(!this.dbOpen)return this.open()}async getItem(e){return await this.validateDbIsOpen(),new Promise((t,n)=>{if(!this.db)return n(ns(Ni));const r=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).get(e);r.addEventListener("success",e=>{const n=e;this.closeConnection(),t(n.target.result)}),r.addEventListener("error",e=>{this.closeConnection(),n(e)})})}async setItem(e,t){return await this.validateDbIsOpen(),new Promise((n,r)=>{if(!this.db)return r(ns(Ni));const o=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).put(t,e);o.addEventListener("success",()=>{this.closeConnection(),n()}),o.addEventListener("error",e=>{this.closeConnection(),r(e)})})}async removeItem(e){return await this.validateDbIsOpen(),new Promise((t,n)=>{if(!this.db)return n(ns(Ni));const r=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).delete(e);r.addEventListener("success",()=>{this.closeConnection(),t()}),r.addEventListener("error",e=>{this.closeConnection(),n(e)})})}async getKeys(){return await this.validateDbIsOpen(),new Promise((e,t)=>{if(!this.db)return t(ns(Ni));const n=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).getAllKeys();n.addEventListener("success",t=>{const n=t;this.closeConnection(),e(n.target.result)}),n.addEventListener("error",e=>{this.closeConnection(),t(e)})})}async containsKey(e){return await this.validateDbIsOpen(),new Promise((t,n)=>{if(!this.db)return n(ns(Ni));const r=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).count(e);r.addEventListener("success",e=>{const n=e;this.closeConnection(),t(1===n.target.result)}),r.addEventListener("error",e=>{this.closeConnection(),n(e)})})}async deleteDatabase(){return this.db&&this.dbOpen&&this.closeConnection(),new Promise((e,t)=>{const n=window.indexedDB.deleteDatabase(Ga),r=setTimeout(()=>t(!1),200);n.addEventListener("success",()=>(clearTimeout(r),e(!0))),n.addEventListener("blocked",()=>(clearTimeout(r),e(!0))),n.addEventListener("error",()=>(clearTimeout(r),t(!1)))})}}class rc{constructor(){this.cache=new Map}async initialize(){}getItem(e){return this.cache.get(e)||null}getUserData(e){return this.getItem(e)}setItem(e,t){this.cache.set(e,t)}async setUserData(e,t){this.setItem(e,t)}removeItem(e){this.cache.delete(e)}getKeys(){const e=[];return this.cache.forEach((t,n)=>{e.push(n)}),e}containsKey(e){return this.cache.has(e)}clear(){this.cache.clear()}decryptData(){return Promise.resolve(null)}}class oc{constructor(e){this.inMemoryCache=new rc,this.indexedDBCache=new nc,this.logger=e}handleDatabaseAccessError(e){if(!(e instanceof ts&&e.errorCode===zi))throw e;this.logger.error("Could not access persistent storage. This may be caused by browser privacy features which block persistent storage in third-party contexts.")}async getItem(e){const t=this.inMemoryCache.getItem(e);if(!t)try{return this.logger.verbose("Queried item not found in in-memory cache, now querying persistent storage."),await this.indexedDBCache.getItem(e)}catch(n){this.handleDatabaseAccessError(n)}return t}async setItem(e,t){this.inMemoryCache.setItem(e,t);try{await this.indexedDBCache.setItem(e,t)}catch(n){this.handleDatabaseAccessError(n)}}async removeItem(e){this.inMemoryCache.removeItem(e);try{await this.indexedDBCache.removeItem(e)}catch(t){this.handleDatabaseAccessError(t)}}async getKeys(){const e=this.inMemoryCache.getKeys();if(0===e.length)try{return this.logger.verbose("In-memory cache is empty, now querying persistent storage."),await this.indexedDBCache.getKeys()}catch(t){this.handleDatabaseAccessError(t)}return e}async containsKey(e){const t=this.inMemoryCache.containsKey(e);if(!t)try{return this.logger.verbose("Key not found in in-memory cache, now querying persistent storage."),await this.indexedDBCache.containsKey(e)}catch(n){this.handleDatabaseAccessError(n)}return t}clearInMemory(){this.logger.verbose("Deleting in-memory keystore"),this.inMemoryCache.clear(),this.logger.verbose("In-memory keystore deleted")}async clearPersistent(){try{this.logger.verbose("Deleting persistent keystore");const e=await this.indexedDBCache.deleteDatabase();return e&&this.logger.verbose("Persistent keystore deleted"),e}catch(e){return this.handleDatabaseAccessError(e),!1}}}class ac{constructor(e,t,n){this.logger=e,function(e){if(!window)throw ns(Ei);if(!window.crypto)throw ns(ai);if(!e&&!window.crypto.subtle)throw ns(ai,"crypto_subtle_undefined")}(null!==n&&void 0!==n&&n),this.cache=new oc(this.logger),this.performanceClient=t}createNewGuid(){return dl()}base64Encode(e){return Qs(e)}base64Decode(e){return Js(e)}base64UrlEncode(e){return Vs(e)}encodeKid(e){return this.base64UrlEncode(JSON.stringify({kid:e}))}async getPublicKeyThumbprint(e){var t;const n=null===(t=this.performanceClient)||void 0===t?void 0:t.startMeasurement(yr,e.correlationId),r=await async function(e,t){return window.crypto.subtle.generateKey(sl,e,t)}(ac.EXTRACTABLE,ac.POP_KEY_USAGES),o=await hl(r.publicKey),a=ic({e:o.e,kty:o.kty,n:o.n}),i=await this.hashString(a),s=await hl(r.privateKey),l=await async function(e,t,n){return window.crypto.subtle.importKey("jwk",e,sl,t,n)}(s,!1,["sign"]);return await this.cache.setItem(i,{privateKey:l,publicKey:r.publicKey,requestMethod:e.resourceRequestMethod,requestUri:e.resourceRequestUri}),n&&n.end({success:!0}),i}async removeTokenBindingKey(e){await this.cache.removeItem(e);if(await this.cache.containsKey(e))throw sn(Jt)}async clearKeystore(){this.cache.clearInMemory();try{return await this.cache.clearPersistent(),!0}catch(e){return e instanceof Error?this.logger.error("Clearing keystore failed with error: ".concat(e.message)):this.logger.error("Clearing keystore failed with unknown error"),!1}}async signJwt(e,t,n,r){var o;const a=null===(o=this.performanceClient)||void 0===o?void 0:o.startMeasurement(vr,r),i=await this.cache.getItem(t);if(!i)throw ns(Di);const s=await hl(i.publicKey),l=ic(s),u=Vs(JSON.stringify({kid:t})),d=Vs(tc.getShrHeaderString(c(c({},null===n||void 0===n?void 0:n.header),{},{alg:s.alg,kid:u})));e.cnf={jwk:JSON.parse(l)};const h=Vs(JSON.stringify(e)),g="".concat(d,".").concat(h),m=(new TextEncoder).encode(g),f=await async function(e,t){return window.crypto.subtle.sign(sl,e,t)}(i.privateKey,m),p=Gs(new Uint8Array(f)),y="".concat(g,".").concat(p);return a&&a.end({success:!0}),y}async hashString(e){return wl(e)}}function ic(e){return JSON.stringify(e,Object.keys(e).sort())}ac.POP_KEY_USAGES=["sign","verify"],ac.EXTRACTABLE=!0;const sc=0,lc=1,cc=2,uc=3;const dc=(e,t,n,r,o)=>function(){n.trace("Executing function ".concat(t));const a=null===r||void 0===r?void 0:r.startMeasurement(t,o);if(o){const e=t+"CallCount";null===r||void 0===r||r.incrementFields({[e]:1},o)}try{const r=e(...arguments);return null===a||void 0===a||a.end({success:!0}),n.trace("Returning result from ".concat(t)),r}catch(i){n.trace("Error occurred in ".concat(t));try{n.trace(JSON.stringify(i))}catch(i){n.trace("Unable to print error message.")}throw null===a||void 0===a||a.end({success:!1},i),i}},hc=(e,t,n,r,o)=>function(){n.trace("Executing function ".concat(t));const a=null===r||void 0===r?void 0:r.startMeasurement(t,o);if(o){const e=t+"CallCount";null===r||void 0===r||r.incrementFields({[e]:1},o)}return null===r||void 0===r||r.setPreQueueTime(t,o),e(...arguments).then(e=>(n.trace("Returning result from ".concat(t)),null===a||void 0===a||a.end({success:!0}),e)).catch(e=>{n.trace("Error occurred in ".concat(t));try{n.trace(JSON.stringify(e))}catch(e){n.trace("Unable to print error message.")}throw null===a||void 0===a||a.end({success:!1},e),e})};class gc{constructor(e,t,n,r){this.networkInterface=e,this.logger=t,this.performanceClient=n,this.correlationId=r}async detectRegion(e,t){var n;null===(n=this.performanceClient)||void 0===n||n.addQueueMeasurement(bo,this.correlationId);let r=e;if(r)t.region_source=Ve;else{const e=gc.IMDS_OPTIONS;try{const n=await hc(this.getRegionFromIMDS.bind(this),wo,this.logger,this.performanceClient,this.correlationId)(H.IMDS_VERSION,e);if(n.status===B&&(r=n.body,t.region_source=Ge),n.status===K){const n=await hc(this.getCurrentVersion.bind(this),ko,this.logger,this.performanceClient,this.correlationId)(e);if(!n)return t.region_source=Ke,null;const o=await hc(this.getRegionFromIMDS.bind(this),wo,this.logger,this.performanceClient,this.correlationId)(n,e);o.status===B&&(r=o.body,t.region_source=Ge)}}catch(o){return t.region_source=Ke,null}}return r||(t.region_source=Ke),r||null}async getRegionFromIMDS(e,t){var n;return null===(n=this.performanceClient)||void 0===n||n.addQueueMeasurement(wo,this.correlationId),this.networkInterface.sendGetRequestAsync("".concat(H.IMDS_ENDPOINT,"?api-version=").concat(e,"&format=text"),t,H.IMDS_TIMEOUT)}async getCurrentVersion(e){var t;null===(t=this.performanceClient)||void 0===t||t.addQueueMeasurement(ko,this.correlationId);try{const t=await this.networkInterface.sendGetRequestAsync("".concat(H.IMDS_ENDPOINT,"?format=json"),e);return t.status===K&&t.body&&t.body["newest-versions"]&&t.body["newest-versions"].length>0?t.body["newest-versions"][0]:null}catch(n){return null}}}function mc(){return Math.round((new Date).getTime()/1e3)}function fc(e){return e.getTime()/1e3}function pc(e){return e?new Date(1e3*Number(e)):new Date}function yc(e,t){const n=Number(e)||0;return mc()+t>n}function vc(e,t){const n=Number(e)+24*t*60*60*1e3;return Date.now()>n}function bc(e,t,n,r,o){return{credentialType:Pe.ID_TOKEN,homeAccountId:e,environment:t,clientId:r,secret:n,realm:o,lastUpdatedAt:Date.now().toString()}}function wc(e,t,n,r,o,a,i,s,l,c,u,d,h,g,m){var f,p;const y={homeAccountId:e,credentialType:Pe.ACCESS_TOKEN,secret:n,cachedAt:mc().toString(),expiresOn:i.toString(),extendedExpiresOn:s.toString(),environment:t,clientId:r,realm:o,target:a,tokenType:u||Fe.BEARER,lastUpdatedAt:Date.now().toString()};if(d&&(y.userAssertionHash=d),c&&(y.refreshOn=c.toString()),g&&(y.requestedClaims=g,y.requestedClaimsHash=m),(null===(f=y.tokenType)||void 0===f?void 0:f.toLowerCase())!==Fe.BEARER.toLowerCase())switch(y.credentialType=Pe.ACCESS_TOKEN_WITH_AUTH_SCHEME,y.tokenType){case Fe.POP:const e=Wn(n,l);if(null===e||void 0===e||null===(p=e.cnf)||void 0===p||!p.kid)throw sn(Qt);y.keyId=e.cnf.kid;break;case Fe.SSH:y.keyId=h}return y}function kc(e,t,n,r,o,a,i){const s={credentialType:Pe.REFRESH_TOKEN,homeAccountId:e,environment:t,clientId:r,secret:n,lastUpdatedAt:Date.now().toString()};return a&&(s.userAssertionHash=a),o&&(s.familyId=o),i&&(s.expiresOn=i.toString()),s}function Sc(e){return e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("credentialType")&&e.hasOwnProperty("clientId")&&e.hasOwnProperty("secret")}function xc(e){return!!e&&(Sc(e)&&e.hasOwnProperty("realm")&&e.hasOwnProperty("target")&&(e.credentialType===Pe.ACCESS_TOKEN||e.credentialType===Pe.ACCESS_TOKEN_WITH_AUTH_SCHEME))}function Cc(e){return!!e&&(Sc(e)&&e.credentialType===Pe.REFRESH_TOKEN)}function Ac(){return mc()+Me}function Ic(e,t,n){e.authorization_endpoint=t.authorization_endpoint,e.token_endpoint=t.token_endpoint,e.end_session_endpoint=t.end_session_endpoint,e.issuer=t.issuer,e.endpointsFromNetwork=n,e.jwks_uri=t.jwks_uri}function Tc(e,t,n){e.aliases=t.aliases,e.preferred_cache=t.preferred_cache,e.preferred_network=t.preferred_network,e.aliasesFromNetwork=n}function Pc(e){return e.expiresAt<=mc()}gc.IMDS_OPTIONS={headers:{Metadata:"true"}};class Ec{constructor(e,t,n,r,o,a,i,s){this.canonicalAuthority=e,this._canonicalAuthority.validateAsUri(),this.networkInterface=t,this.cacheManager=n,this.authorityOptions=r,this.regionDiscoveryMetadata={region_used:void 0,region_source:void 0,region_outcome:void 0},this.logger=o,this.performanceClient=i,this.correlationId=a,this.managedIdentity=s||!1,this.regionDiscovery=new gc(t,this.logger,this.performanceClient,this.correlationId)}getAuthorityType(e){if(e.HostNameAndPort.endsWith(H.CIAM_AUTH_URL))return uc;const t=e.PathSegments;if(t.length)switch(t[0].toLowerCase()){case H.ADFS:return lc;case H.DSTS:return cc}return sc}get authorityType(){return this.getAuthorityType(this.canonicalAuthorityUrlComponents)}get protocolMode(){return this.authorityOptions.protocolMode}get options(){return this.authorityOptions}get canonicalAuthority(){return this._canonicalAuthority.urlString}set canonicalAuthority(e){this._canonicalAuthority=new $n(e),this._canonicalAuthority.validateAsUri(),this._canonicalAuthorityUrlComponents=null}get canonicalAuthorityUrlComponents(){return this._canonicalAuthorityUrlComponents||(this._canonicalAuthorityUrlComponents=this._canonicalAuthority.getUrlComponents()),this._canonicalAuthorityUrlComponents}get hostnameAndPort(){return this.canonicalAuthorityUrlComponents.HostNameAndPort.toLowerCase()}get tenant(){return this.canonicalAuthorityUrlComponents.PathSegments[0]}get authorizationEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.authorization_endpoint);throw sn(vt)}get tokenEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint);throw sn(vt)}get deviceCodeEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint.replace("/token","/devicecode"));throw sn(vt)}get endSessionEndpoint(){if(this.discoveryComplete()){if(!this.metadata.end_session_endpoint)throw sn($t);return this.replacePath(this.metadata.end_session_endpoint)}throw sn(vt)}get selfSignedJwtAudience(){if(this.discoveryComplete())return this.replacePath(this.metadata.issuer);throw sn(vt)}get jwksUri(){if(this.discoveryComplete())return this.replacePath(this.metadata.jwks_uri);throw sn(vt)}canReplaceTenant(e){return 1===e.PathSegments.length&&!Ec.reservedTenantDomains.has(e.PathSegments[0])&&this.getAuthorityType(e)===sc&&this.protocolMode!==it}replaceTenant(e){return e.replace(/{tenant}|{tenantid}/g,this.tenant)}replacePath(e){let t=e;const n=new $n(this.metadata.canonical_authority).getUrlComponents(),r=n.PathSegments;return this.canonicalAuthorityUrlComponents.PathSegments.forEach((e,o)=>{let a=r[o];if(0===o&&this.canReplaceTenant(n)){const e=new $n(this.metadata.authorization_endpoint).getUrlComponents().PathSegments[0];a!==e&&(this.logger.verbose("Replacing tenant domain name ".concat(a," with id ").concat(e)),a=e)}e!==a&&(t=t.replace("/".concat(a,"/"),"/".concat(e,"/")))}),this.replaceTenant(t)}get defaultOpenIdConfigurationEndpoint(){const e=this.hostnameAndPort;return this.canonicalAuthority.endsWith("v2.0/")||this.authorityType===lc||this.protocolMode===it&&!this.isAliasOfKnownMicrosoftAuthority(e)?"".concat(this.canonicalAuthority,".well-known/openid-configuration"):"".concat(this.canonicalAuthority,"v2.0/.well-known/openid-configuration")}discoveryComplete(){return!!this.metadata}async resolveEndpointsAsync(){var e,t;null===(e=this.performanceClient)||void 0===e||e.addQueueMeasurement(go,this.correlationId);const n=this.getCurrentMetadataEntity(),r=await hc(this.updateCloudDiscoveryMetadata.bind(this),fo,this.logger,this.performanceClient,this.correlationId)(n);this.canonicalAuthority=this.canonicalAuthority.replace(this.hostnameAndPort,n.preferred_network);const o=await hc(this.updateEndpointMetadata.bind(this),yo,this.logger,this.performanceClient,this.correlationId)(n);this.updateCachedMetadata(n,r,{source:o}),null===(t=this.performanceClient)||void 0===t||t.addFields({cloudDiscoverySource:r,authorityEndpointSource:o},this.correlationId)}getCurrentMetadataEntity(){let e=this.cacheManager.getAuthorityMetadataByAlias(this.hostnameAndPort);return e||(e={aliases:[],preferred_cache:this.hostnameAndPort,preferred_network:this.hostnameAndPort,canonical_authority:this.canonicalAuthority,authorization_endpoint:"",token_endpoint:"",end_session_endpoint:"",issuer:"",aliasesFromNetwork:!1,endpointsFromNetwork:!1,expiresAt:Ac(),jwks_uri:""}),e}updateCachedMetadata(e,t,n){t!==Oe&&(null===n||void 0===n?void 0:n.source)!==Oe&&(e.expiresAt=Ac(),e.canonical_authority=this.canonicalAuthority);const r=this.cacheManager.generateAuthorityMetadataCacheKey(e.preferred_cache);this.cacheManager.setAuthorityMetadata(r,e),this.metadata=e}async updateEndpointMetadata(e){var t;null===(t=this.performanceClient)||void 0===t||t.addQueueMeasurement(yo,this.correlationId);const n=this.updateEndpointMetadataFromLocalSources(e);if(n){var r;if(n.source===De)if(null!==(r=this.authorityOptions.azureRegionConfiguration)&&void 0!==r&&r.azureRegion&&n.metadata){Ic(e,await hc(this.updateMetadataWithRegionalInformation.bind(this),vo,this.logger,this.performanceClient,this.correlationId)(n.metadata),!1),e.canonical_authority=this.canonicalAuthority}return n.source}let o=await hc(this.getEndpointMetadataFromNetwork.bind(this),po,this.logger,this.performanceClient,this.correlationId)();var a;if(o)return null!==(a=this.authorityOptions.azureRegionConfiguration)&&void 0!==a&&a.azureRegion&&(o=await hc(this.updateMetadataWithRegionalInformation.bind(this),vo,this.logger,this.performanceClient,this.correlationId)(o)),Ic(e,o,!0),je;throw sn(wt,this.defaultOpenIdConfigurationEndpoint)}updateEndpointMetadataFromLocalSources(e){this.logger.verbose("Attempting to get endpoint metadata from authority configuration");const t=this.getEndpointMetadataFromConfig();if(t)return this.logger.verbose("Found endpoint metadata in authority configuration"),Ic(e,t,!1),{source:Re};if(this.logger.verbose("Did not find endpoint metadata in the config... Attempting to get endpoint metadata from the hardcoded values."),this.authorityOptions.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get endpoint metadata from the network metadata cache.");else{const t=this.getEndpointMetadataFromHardcodedValues();if(t)return Ic(e,t,!1),{source:De,metadata:t};this.logger.verbose("Did not find endpoint metadata in hardcoded values... Attempting to get endpoint metadata from the network metadata cache.")}const n=Pc(e);return this.isAuthoritySameType(e)&&e.endpointsFromNetwork&&!n?(this.logger.verbose("Found endpoint metadata in the cache."),{source:Oe}):(n&&this.logger.verbose("The metadata entity is expired."),null)}isAuthoritySameType(e){return new $n(e.canonical_authority).getUrlComponents().PathSegments.length===this.canonicalAuthorityUrlComponents.PathSegments.length}getEndpointMetadataFromConfig(){if(this.authorityOptions.authorityMetadata)try{return JSON.parse(this.authorityOptions.authorityMetadata)}catch(e){throw Dn(xn)}return null}async getEndpointMetadataFromNetwork(){var e;null===(e=this.performanceClient)||void 0===e||e.addQueueMeasurement(po,this.correlationId);const t={},n=this.defaultOpenIdConfigurationEndpoint;this.logger.verbose("Authority.getEndpointMetadataFromNetwork: attempting to retrieve OAuth endpoints from ".concat(n));try{const e=await this.networkInterface.sendGetRequestAsync(n,t),r=function(e){return e.hasOwnProperty("authorization_endpoint")&&e.hasOwnProperty("token_endpoint")&&e.hasOwnProperty("issuer")&&e.hasOwnProperty("jwks_uri")}(e.body);return r?e.body:(this.logger.verbose("Authority.getEndpointMetadataFromNetwork: could not parse response as OpenID configuration"),null)}catch(r){return this.logger.verbose("Authority.getEndpointMetadataFromNetwork: ".concat(r)),null}}getEndpointMetadataFromHardcodedValues(){return this.hostnameAndPort in Xn?Xn[this.hostnameAndPort]:null}async updateMetadataWithRegionalInformation(e){var t,n;null===(t=this.performanceClient)||void 0===t||t.addQueueMeasurement(vo,this.correlationId);const r=null===(n=this.authorityOptions.azureRegionConfiguration)||void 0===n?void 0:n.azureRegion;if(r){var o;if(r!==H.AZURE_REGION_AUTO_DISCOVER_FLAG)return this.regionDiscoveryMetadata.region_outcome=Qe,this.regionDiscoveryMetadata.region_used=r,Ec.replaceWithRegionalInformation(e,r);const t=await hc(this.regionDiscovery.detectRegion.bind(this.regionDiscovery),bo,this.logger,this.performanceClient,this.correlationId)(null===(o=this.authorityOptions.azureRegionConfiguration)||void 0===o?void 0:o.environmentRegion,this.regionDiscoveryMetadata);if(t)return this.regionDiscoveryMetadata.region_outcome=Ye,this.regionDiscoveryMetadata.region_used=t,Ec.replaceWithRegionalInformation(e,t);this.regionDiscoveryMetadata.region_outcome=Je}return e}async updateCloudDiscoveryMetadata(e){var t;null===(t=this.performanceClient)||void 0===t||t.addQueueMeasurement(fo,this.correlationId);const n=this.updateCloudDiscoveryMetadataFromLocalSources(e);if(n)return n;const r=await hc(this.getCloudDiscoveryMetadataFromNetwork.bind(this),mo,this.logger,this.performanceClient,this.correlationId)();if(r)return Tc(e,r,!0),je;throw Dn(Cn)}updateCloudDiscoveryMetadataFromLocalSources(e){this.logger.verbose("Attempting to get cloud discovery metadata  from authority configuration"),this.logger.verbosePii("Known Authorities: ".concat(this.authorityOptions.knownAuthorities||H.NOT_APPLICABLE)),this.logger.verbosePii("Authority Metadata: ".concat(this.authorityOptions.authorityMetadata||H.NOT_APPLICABLE)),this.logger.verbosePii("Canonical Authority: ".concat(e.canonical_authority||H.NOT_APPLICABLE));const t=this.getCloudDiscoveryMetadataFromConfig();if(t)return this.logger.verbose("Found cloud discovery metadata in authority configuration"),Tc(e,t,!1),Re;if(this.logger.verbose("Did not find cloud discovery metadata in the config... Attempting to get cloud discovery metadata from the hardcoded values."),this.options.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded cloud discovery metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get cloud discovery metadata from the network metadata cache.");else{const t=(n=this.hostnameAndPort,nr(Zn.metadata,n));if(t)return this.logger.verbose("Found cloud discovery metadata from hardcoded values."),Tc(e,t,!1),De;this.logger.verbose("Did not find cloud discovery metadata in hardcoded values... Attempting to get cloud discovery metadata from the network metadata cache.")}var n;const r=Pc(e);return this.isAuthoritySameType(e)&&e.aliasesFromNetwork&&!r?(this.logger.verbose("Found cloud discovery metadata in the cache."),Oe):(r&&this.logger.verbose("The metadata entity is expired."),null)}getCloudDiscoveryMetadataFromConfig(){if(this.authorityType===uc)return this.logger.verbose("CIAM authorities do not support cloud discovery metadata, generate the aliases from authority host."),Ec.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort);if(this.authorityOptions.cloudDiscoveryMetadata){this.logger.verbose("The cloud discovery metadata has been provided as a network response, in the config.");try{this.logger.verbose("Attempting to parse the cloud discovery metadata.");const e=nr(JSON.parse(this.authorityOptions.cloudDiscoveryMetadata).metadata,this.hostnameAndPort);if(this.logger.verbose("Parsed the cloud discovery metadata."),e)return this.logger.verbose("There is returnable metadata attached to the parsed cloud discovery metadata."),e;this.logger.verbose("There is no metadata attached to the parsed cloud discovery metadata.")}catch(e){throw this.logger.verbose("Unable to parse the cloud discovery metadata. Throwing Invalid Cloud Discovery Metadata Error."),Dn(Sn)}}return this.isInKnownAuthorities()?(this.logger.verbose("The host is included in knownAuthorities. Creating new cloud discovery metadata from the host."),Ec.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)):null}async getCloudDiscoveryMetadataFromNetwork(){var e;null===(e=this.performanceClient)||void 0===e||e.addQueueMeasurement(mo,this.correlationId);const t="".concat(H.AAD_INSTANCE_DISCOVERY_ENDPT).concat(this.canonicalAuthority,"oauth2/v2.0/authorize"),n={};let r=null;try{const e=await this.networkInterface.sendGetRequestAsync(t,n);let o,a;if(function(e){return e.hasOwnProperty("tenant_discovery_endpoint")&&e.hasOwnProperty("metadata")}(e.body))o=e.body,a=o.metadata,this.logger.verbosePii("tenant_discovery_endpoint is: ".concat(o.tenant_discovery_endpoint));else{if(!function(e){return e.hasOwnProperty("error")&&e.hasOwnProperty("error_description")}(e.body))return this.logger.error("AAD did not return a CloudInstanceDiscoveryResponse or CloudInstanceDiscoveryErrorResponse"),null;if(this.logger.warning("A CloudInstanceDiscoveryErrorResponse was returned. The cloud instance discovery network request's status code is: ".concat(e.status)),o=e.body,o.error===H.INVALID_INSTANCE)return this.logger.error("The CloudInstanceDiscoveryErrorResponse error is invalid_instance."),null;this.logger.warning("The CloudInstanceDiscoveryErrorResponse error is ".concat(o.error)),this.logger.warning("The CloudInstanceDiscoveryErrorResponse error description is ".concat(o.error_description)),this.logger.warning("Setting the value of the CloudInstanceDiscoveryMetadata (returned from the network) to []"),a=[]}this.logger.verbose("Attempting to find a match between the developer's authority and the CloudInstanceDiscoveryMetadata returned from the network request."),r=nr(a,this.hostnameAndPort)}catch(o){if(o instanceof ht)this.logger.error("There was a network error while attempting to get the cloud discovery instance metadata.\nError: ".concat(o.errorCode,"\nError Description: ").concat(o.errorMessage));else{const e=o;this.logger.error("A non-MSALJS error was thrown while attempting to get the cloud instance discovery metadata.\nError: ".concat(e.name,"\nError Description: ").concat(e.message))}return null}return r||(this.logger.warning("The developer's authority was not found within the CloudInstanceDiscoveryMetadata returned from the network request."),this.logger.verbose("Creating custom Authority for custom domain scenario."),r=Ec.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)),r}isInKnownAuthorities(){return this.authorityOptions.knownAuthorities.filter(e=>e&&$n.getDomainFromUrl(e).toLowerCase()===this.hostnameAndPort).length>0}static generateAuthority(e,t){let n;if(t&&t.azureCloudInstance!==lt){const e=t.tenant?t.tenant:H.DEFAULT_COMMON_TENANT;n="".concat(t.azureCloudInstance,"/").concat(e,"/")}return n||e}static createCloudDiscoveryMetadataFromHost(e){return{preferred_network:e,preferred_cache:e,aliases:[e]}}getPreferredCache(){if(this.managedIdentity)return H.DEFAULT_AUTHORITY_HOST;if(this.discoveryComplete())return this.metadata.preferred_cache;throw sn(vt)}isAlias(e){return this.metadata.aliases.indexOf(e)>-1}isAliasOfKnownMicrosoftAuthority(e){return er.has(e)}static isPublicCloudAuthority(e){return H.KNOWN_PUBLIC_CLOUDS.indexOf(e)>=0}static buildRegionalAuthorityString(e,t,n){const r=new $n(e);r.validateAsUri();const o=r.getUrlComponents();let a="".concat(t,".").concat(o.HostNameAndPort);this.isPublicCloudAuthority(o.HostNameAndPort)&&(a="".concat(t,".").concat(H.REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX));const i=$n.constructAuthorityUriFromObject(c(c({},r.getUrlComponents()),{},{HostNameAndPort:a})).urlString;return n?"".concat(i,"?").concat(n):i}static replaceWithRegionalInformation(e,t){const n=c({},e);return n.authorization_endpoint=Ec.buildRegionalAuthorityString(n.authorization_endpoint,t),n.token_endpoint=Ec.buildRegionalAuthorityString(n.token_endpoint,t),n.end_session_endpoint&&(n.end_session_endpoint=Ec.buildRegionalAuthorityString(n.end_session_endpoint,t)),n}static transformCIAMAuthority(e){let t=e;const n=new $n(e).getUrlComponents();if(0===n.PathSegments.length&&n.HostNameAndPort.endsWith(H.CIAM_AUTH_URL)){const e=n.HostNameAndPort.split(".")[0];t="".concat(t).concat(e).concat(H.AAD_TENANT_DOMAIN_SUFFIX)}return t}}function Nc(e){return e.endsWith(H.FORWARD_SLASH)?e:"".concat(e).concat(H.FORWARD_SLASH)}Ec.reservedTenantDomains=new Set(["{tenant}","{tenantid}",ie,le,se]);const _c="no_tokens_found",Mc="native_account_unavailable",Rc="refresh_token_expired",Oc="ux_not_allowed",jc="bad_token",Dc=["interaction_required","consent_required","login_required",jc,Oc],Lc=["message_only","additional_action","basic_action","user_password_expired","consent_required","bad_token"],Fc={[_c]:"No refresh token found in the cache. Please sign-in.",[Mc]:"The requested account is not available in the native broker. It may have been deleted or logged out. Please sign-in again using an interactive API.",[Rc]:"Refresh token has expired.",[jc]:"Identity provider returned bad_token due to an expired or invalid refresh token. Please invoke an interactive API to resolve.",[Oc]:"`canShowUI` flag in Edge was set to false. User interaction required on web page. Please invoke an interactive API to resolve."};class qc extends ht{constructor(e,t,n,r,o,a,i,s){super(e,t,n),Object.setPrototypeOf(this,qc.prototype),this.timestamp=r||H.EMPTY_STRING,this.traceId=o||H.EMPTY_STRING,this.correlationId=a||H.EMPTY_STRING,this.claims=i||H.EMPTY_STRING,this.name="InteractionRequiredAuthError",this.errorNo=s}}function zc(e,t,n){const r=!!e&&Dc.indexOf(e)>-1,o=!!n&&Lc.indexOf(n)>-1,a=!!t&&Dc.some(e=>t.indexOf(e)>-1);return r||a||o}function Uc(e){return new qc(e,Fc[e])}function Hc(e,t){if(!e)throw sn(ft);try{const n=t(e);return JSON.parse(n)}catch(n){throw sn(mt)}}function Bc(e){if(!e)throw sn(mt);const t=e.split(Te,2);return{uid:t[0],utid:t.length<2?H.EMPTY_STRING:t[1]}}function Wc(e){if(e){return e.tid||e.tfp||e.acr||null}return null}class Kc{getAccountInfo(){return{homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId,loginHint:this.loginHint,name:this.name,nativeAccountId:this.nativeAccountId,authorityType:this.authorityType,tenantProfiles:new Map((this.tenantProfiles||[]).map(e=>[e.tenantId,e])),dataBoundary:this.dataBoundary}}isSingleTenant(){return!this.tenantProfiles}static createAccount(e,t,n){var r,o,a,i,s,l,c,u,d;const h=new Kc;let g;t.authorityType===lc?h.authorityType=Ce:t.protocolMode===it?h.authorityType=Ae:h.authorityType=xe,e.clientInfo&&n&&(g=Hc(e.clientInfo,n),g.xms_tdbr&&(h.dataBoundary="EU"===g.xms_tdbr?"EU":"None")),h.clientInfo=e.clientInfo,h.homeAccountId=e.homeAccountId,h.nativeAccountId=e.nativeAccountId;const m=e.environment||t&&t.getPreferredCache();if(!m)throw sn(zt);h.environment=m,h.realm=(null===(r=g)||void 0===r?void 0:r.utid)||Wc(e.idTokenClaims)||"",h.localAccountId=(null===(o=g)||void 0===o?void 0:o.uid)||(null===(a=e.idTokenClaims)||void 0===a?void 0:a.oid)||(null===(i=e.idTokenClaims)||void 0===i?void 0:i.sub)||"";const f=(null===(s=e.idTokenClaims)||void 0===s?void 0:s.preferred_username)||(null===(l=e.idTokenClaims)||void 0===l?void 0:l.upn),p=null!==(c=e.idTokenClaims)&&void 0!==c&&c.emails?e.idTokenClaims.emails[0]:null;if(h.username=f||p||"",h.loginHint=null===(u=e.idTokenClaims)||void 0===u?void 0:u.login_hint,h.name=(null===(d=e.idTokenClaims)||void 0===d?void 0:d.name)||"",h.cloudGraphHostName=e.cloudGraphHostName,h.msGraphHost=e.msGraphHost,e.tenantProfiles)h.tenantProfiles=e.tenantProfiles;else{const t=Hn(e.homeAccountId,h.localAccountId,h.realm,e.idTokenClaims);h.tenantProfiles=[t]}return h}static createFromAccountInfo(e,t,n){var r;const o=new Kc;return o.authorityType=e.authorityType||Ae,o.homeAccountId=e.homeAccountId,o.localAccountId=e.localAccountId,o.nativeAccountId=e.nativeAccountId,o.realm=e.tenantId,o.environment=e.environment,o.username=e.username,o.name=e.name,o.loginHint=e.loginHint,o.cloudGraphHostName=t,o.msGraphHost=n,o.tenantProfiles=Array.from((null===(r=e.tenantProfiles)||void 0===r?void 0:r.values())||[]),o.dataBoundary=e.dataBoundary,o}static generateHomeAccountId(e,t,n,r,o){if(t!==lc&&t!==cc){if(e)try{const t=Hc(e,r.base64Decode);if(t.uid&&t.utid)return"".concat(t.uid,".").concat(t.utid)}catch(a){}n.warning("No client info in response")}return(null===o||void 0===o?void 0:o.sub)||""}static isAccountEntity(e){return!!e&&(e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("realm")&&e.hasOwnProperty("localAccountId")&&e.hasOwnProperty("username")&&e.hasOwnProperty("authorityType"))}static accountInfoIsEqual(e,t,n){if(!e||!t)return!1;let r=!0;if(n){const n=e.idTokenClaims||{},o=t.idTokenClaims||{};r=n.iat===o.iat&&n.nonce===o.nonce}return e.homeAccountId===t.homeAccountId&&e.localAccountId===t.localAccountId&&e.username===t.username&&e.tenantId===t.tenantId&&e.loginHint===t.loginHint&&e.environment===t.environment&&e.nativeAccountId===t.nativeAccountId&&r}}function Vc(e,t,n){var r;return{clientId:e,authority:t.authority,scopes:t.scopes,homeAccountIdentifier:n,claims:t.claims,authenticationScheme:t.authenticationScheme,resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,sshKid:t.sshKid,embeddedClientId:t.embeddedClientId||(null===(r=t.tokenBodyParameters)||void 0===r?void 0:r.clientId)}}const Gc=864e5,Qc="Lax",Yc="None";class Jc{initialize(){return Promise.resolve()}getItem(e){const t="".concat(encodeURIComponent(e)),n=document.cookie.split(";");for(let r=0;r<n.length;r++){const e=n[r],[o,...a]=decodeURIComponent(e).trim().split("="),i=a.join("=");if(o===t)return i}return""}getUserData(){throw sn(nn)}setItem(e,t,n){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Qc,a="".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(t),";path=/;SameSite=").concat(o,";");if(n){const e=function(e){const t=new Date,n=new Date(t.getTime()+e*Gc);return n.toUTCString()}(n);a+="expires=".concat(e,";")}(r||o===Yc)&&(a+="Secure;"),document.cookie=a}async setUserData(){return Promise.reject(sn(nn))}removeItem(e){this.setItem(e,"",-1)}getKeys(){const e=document.cookie.split(";"),t=[];return e.forEach(e=>{const n=decodeURIComponent(e).trim().split("=");t.push(n[0])}),t}containsKey(e){return this.getKeys().includes(e)}decryptData(){return Promise.resolve(null)}}function $c(e,t){const n=e.getItem(Vl(t));return n?JSON.parse(n):[]}function Xc(e,t,n){const r=t.getItem(Gl(e,n));if(r){const e=JSON.parse(r);if(e&&e.hasOwnProperty("idToken")&&e.hasOwnProperty("accessToken")&&e.hasOwnProperty("refreshToken"))return e}return{idToken:[],accessToken:[],refreshToken:[]}}function Zc(e){return e.hasOwnProperty("id")&&e.hasOwnProperty("nonce")&&e.hasOwnProperty("data")}const eu="msal.cache.encryption";class tu{constructor(e,t,n){if(!window.localStorage)throw Il(kl);this.memoryStorage=new rc,this.initialized=!1,this.clientId=e,this.logger=t,this.performanceClient=n,this.broadcast=new BroadcastChannel("msal.broadcast.cache")}async initialize(e){const t=new Jc,n=t.getItem(eu);let r={key:"",id:""};if(n)try{r=JSON.parse(n)}catch(o){}if(r.key&&r.id){const t=dc($s,qo,this.logger,this.performanceClient,e)(r.key);this.encryptionCookie={id:r.id,key:await hc(pl,Lo,this.logger,this.performanceClient,e)(t)}}else{const n=dl(),r=await hc(fl,Fo,this.logger,this.performanceClient,e)(),o=dc(Gs,zo,this.logger,this.performanceClient,e)(new Uint8Array(r));this.encryptionCookie={id:n,key:await hc(pl,Lo,this.logger,this.performanceClient,e)(r)};const a={id:n,key:o};t.setItem(eu,JSON.stringify(a),0,!0,Yc)}await hc(this.importExistingCache.bind(this),Eo,this.logger,this.performanceClient,e)(e),this.broadcast.addEventListener("message",this.updateCache.bind(this)),this.initialized=!0}getItem(e){return window.localStorage.getItem(e)}getUserData(e){if(!this.initialized)throw ns(Ki);return this.memoryStorage.getItem(e)}async decryptData(e,t,n){if(!this.initialized||!this.encryptionCookie)throw ns(Ki);if(t.id!==this.encryptionCookie.id)return this.performanceClient.incrementFields({encryptedCacheExpiredCount:1},n),null;const r=await hc(bl,Ho,this.logger,this.performanceClient,n)(this.encryptionCookie.key,t.nonce,this.getContext(e),t.data);if(!r)return null;try{return JSON.parse(r)}catch(o){return this.performanceClient.incrementFields({encryptedCacheCorruptionCount:1},n),null}}setItem(e,t){window.localStorage.setItem(e,t)}async setUserData(e,t,n,r){if(!this.initialized||!this.encryptionCookie)throw ns(Ki);const{data:o,nonce:a}=await hc(vl,Uo,this.logger,this.performanceClient,n)(this.encryptionCookie.key,t,this.getContext(e)),i={id:this.encryptionCookie.id,nonce:a,data:o,lastUpdatedAt:r};this.memoryStorage.setItem(e,t),this.setItem(e,JSON.stringify(i)),this.broadcast.postMessage({key:e,value:t,context:this.getContext(e)})}removeItem(e){this.memoryStorage.containsKey(e)&&(this.memoryStorage.removeItem(e),this.broadcast.postMessage({key:e,value:null,context:this.getContext(e)})),window.localStorage.removeItem(e)}getKeys(){return Object.keys(window.localStorage)}containsKey(e){return window.localStorage.hasOwnProperty(e)}clear(){this.memoryStorage.clear();$c(this).forEach(e=>this.removeItem(e));const e=Xc(this.clientId,this);e.idToken.forEach(e=>this.removeItem(e)),e.accessToken.forEach(e=>this.removeItem(e)),e.refreshToken.forEach(e=>this.removeItem(e)),this.getKeys().forEach(e=>{(e.startsWith(Fl)||-1!==e.indexOf(this.clientId))&&this.removeItem(e)})}async importExistingCache(e){if(!this.encryptionCookie)return;let t=$c(this);t=await this.importArray(t,e),t.length?this.setItem(Vl(),JSON.stringify(t)):this.removeItem(Vl());const n=Xc(this.clientId,this);n.idToken=await this.importArray(n.idToken,e),n.accessToken=await this.importArray(n.accessToken,e),n.refreshToken=await this.importArray(n.refreshToken,e),n.idToken.length||n.accessToken.length||n.refreshToken.length?this.setItem(Gl(this.clientId),JSON.stringify(n)):this.removeItem(Gl(this.clientId))}async getItemFromEncryptedCache(e,t){if(!this.encryptionCookie)return null;const n=this.getItem(e);if(!n)return null;let r;try{r=JSON.parse(n)}catch(o){return null}return Zc(r)?r.id!==this.encryptionCookie.id?(this.performanceClient.incrementFields({encryptedCacheExpiredCount:1},t),null):hc(bl,Ho,this.logger,this.performanceClient,t)(this.encryptionCookie.key,r.nonce,this.getContext(e),r.data):(this.performanceClient.incrementFields({unencryptedCacheCount:1},t),r)}async importArray(e,t){const n=[],r=[];return e.forEach(e=>{const o=this.getItemFromEncryptedCache(e,t).then(t=>{t?(this.memoryStorage.setItem(e,t),n.push(e)):this.removeItem(e)});r.push(o)}),await Promise.all(r),n}getContext(e){let t="";return e.includes(this.clientId)&&(t=this.clientId),t}updateCache(e){this.logger.trace("Updating internal cache from broadcast event");const t=this.performanceClient.startMeasurement(_o);t.add({isBackground:!0});const{key:n,value:r,context:o}=e.data;return n?o&&o!==this.clientId?(this.logger.trace("Ignoring broadcast event from clientId: ".concat(o)),void t.end({success:!1,errorCode:"contextMismatch"})):(r?(this.memoryStorage.setItem(n,r),this.logger.verbose("Updated item in internal cache")):(this.memoryStorage.removeItem(n),this.logger.verbose("Removed item from internal cache")),void t.end({success:!0})):(this.logger.error("Broadcast event missing key"),void t.end({success:!1,errorCode:"noKey"}))}}class nu{constructor(){if(!window.sessionStorage)throw Il(kl)}async initialize(){}getItem(e){return window.sessionStorage.getItem(e)}getUserData(e){return this.getItem(e)}setItem(e,t){window.sessionStorage.setItem(e,t)}async setUserData(e,t){this.setItem(e,t)}removeItem(e){window.sessionStorage.removeItem(e)}getKeys(){return Object.keys(window.sessionStorage)}containsKey(e){return window.sessionStorage.hasOwnProperty(e)}decryptData(){return Promise.resolve(null)}}const ru="msal:initializeStart",ou="msal:initializeEnd",au="msal:accountAdded",iu="msal:accountRemoved",su="msal:activeAccountChanged",lu="msal:loginStart",cu="msal:loginSuccess",uu="msal:loginFailure",du="msal:acquireTokenStart",hu="msal:acquireTokenSuccess",gu="msal:acquireTokenFailure",mu="msal:acquireTokenFromNetworkStart",fu="msal:ssoSilentStart",pu="msal:ssoSilentSuccess",yu="msal:ssoSilentFailure",vu="msal:acquireTokenByCodeStart",bu="msal:acquireTokenByCodeSuccess",wu="msal:acquireTokenByCodeFailure",ku="msal:handleRedirectStart",Su="msal:handleRedirectEnd",xu="msal:popupOpened",Cu="msal:logoutStart",Au="msal:logoutSuccess",Iu="msal:logoutFailure",Tu="msal:logoutEnd",Pu="msal:restoreFromBFCache";function Eu(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}class Nu extends lr{constructor(e,t,n,r,o,a,i){super(e,n,r,o,i),this.cacheConfig=t,this.logger=r,this.internalStorage=new rc,this.browserStorage=_u(e,t.cacheLocation,r,o),this.temporaryCacheStorage=_u(e,t.temporaryCacheLocation,r,o),this.cookieStorage=new Jc,this.eventHandler=a}async initialize(e){this.performanceClient.addFields({cacheLocation:this.cacheConfig.cacheLocation,cacheRetentionDays:this.cacheConfig.cacheRetentionDays},e),await this.browserStorage.initialize(e),await this.migrateExistingCache(e),this.trackVersionChanges(e)}async migrateExistingCache(e){const t=$c(this.browserStorage,0),n=Xc(this.clientId,this.browserStorage,0);this.performanceClient.addFields({oldAccountCount:t.length,oldAccessCount:n.accessToken.length,oldIdCount:n.idToken.length,oldRefreshCount:n.refreshToken.length},e);const r=$c(this.browserStorage,1),o=Xc(this.clientId,this.browserStorage,1);this.performanceClient.addFields({currAccountCount:r.length,currAccessCount:o.accessToken.length,currIdCount:o.idToken.length,currRefreshCount:o.refreshToken.length},e),await Promise.all([this.updateV0ToCurrent(1,t,r,e),this.updateV0ToCurrent(1,n.idToken,o.idToken,e),this.updateV0ToCurrent(1,n.accessToken,o.accessToken,e),this.updateV0ToCurrent(1,n.refreshToken,o.refreshToken,e)]),t.length>0?this.browserStorage.setItem(Vl(0),JSON.stringify(t)):this.browserStorage.removeItem(Vl(0)),r.length>0?this.browserStorage.setItem(Vl(1),JSON.stringify(r)):this.browserStorage.removeItem(Vl(1)),this.setTokenKeys(n,e,0),this.setTokenKeys(o,e,1)}async updateV0ToCurrent(e,t,n,r){const o=[];for(const a of[...t]){const i=this.browserStorage.getItem(a),s=this.validateAndParseJson(i||"");if(!s){Eu(t,a);continue}s.lastUpdatedAt||(s.lastUpdatedAt=Date.now().toString(),this.setItem(a,JSON.stringify(s),r));const l=Zc(s)?await this.browserStorage.decryptData(a,s,r):s;let c;if(l&&(xc(l)||Cc(l))&&(c=l.expiresOn),!l||vc(s.lastUpdatedAt,this.cacheConfig.cacheRetentionDays)||c&&yc(c,300))this.browserStorage.removeItem(a),Eu(t,a),this.performanceClient.incrementFields({expiredCacheRemovedCount:1},r);else if(this.cacheConfig.cacheLocation!==Sa||Zc(s)){const t="".concat(Fl,".").concat(e).concat("-").concat(a),i=this.browserStorage.getItem(t);if(!i){o.push(this.setUserData(t,JSON.stringify(l),r,s.lastUpdatedAt).then(()=>{n.push(t),this.performanceClient.incrementFields({upgradedCacheCount:1},r)}));continue}{const e=this.validateAndParseJson(i);if(Number(s.lastUpdatedAt)>Number(e.lastUpdatedAt)){o.push(this.setUserData(t,JSON.stringify(l),r,s.lastUpdatedAt).then(()=>{this.performanceClient.incrementFields({updatedCacheFromV0Count:1},r)}));continue}}}}return Promise.all(o)}trackVersionChanges(e){const t=this.browserStorage.getItem(Bl);t&&(this.logger.info("MSAL.js was last initialized by version: ".concat(t)),this.performanceClient.addFields({previousLibraryVersion:t},e)),t!==Ll&&this.setItem(Bl,Ll,e)}validateAndParseJson(e){if(!e)return null;try{const t=JSON.parse(e);return t&&"object"===typeof t?t:null}catch(t){return null}}setItem(e,t,n){let r=0,o=[];for(let i=0;i<=20;i++)try{this.browserStorage.setItem(e,t),i>0&&(i<=r?this.removeAccessTokenKeys(o.slice(0,i),n,0):(this.removeAccessTokenKeys(o.slice(0,r),n,0),this.removeAccessTokenKeys(o.slice(r,i),n)));break}catch(a){const s=sr(a);if(!(s.errorCode===rr&&i<20))throw s;if(!o.length){const n=e===Gl(this.clientId,0)?JSON.parse(t).accessToken:this.getTokenKeys(0).accessToken,a=e===Gl(this.clientId)?JSON.parse(t).accessToken:this.getTokenKeys().accessToken;o=[...n,...a],r=n.length}if(o.length<=i)throw s;this.removeAccessToken(o[i],n,!1)}}async setUserData(e,t,n,r){let o=0,a=[];for(let s=0;s<=20;s++)try{await hc(this.browserStorage.setUserData.bind(this.browserStorage),No,this.logger,this.performanceClient)(e,t,n,r),s>0&&(s<=o?this.removeAccessTokenKeys(a.slice(0,s),n,0):(this.removeAccessTokenKeys(a.slice(0,o),n,0),this.removeAccessTokenKeys(a.slice(o,s),n)));break}catch(i){const e=sr(i);if(!(e.errorCode===rr&&s<20))throw e;if(!a.length){const e=this.getTokenKeys(0).accessToken,t=this.getTokenKeys().accessToken;a=[...e,...t],o=e.length}if(a.length<=s)throw e;this.removeAccessToken(a[s],n,!1)}}getAccount(e,t){this.logger.trace("BrowserCacheManager.getAccount called");const n=this.browserStorage.getUserData(e);if(!n)return this.removeAccountKeyFromMap(e,t),null;const r=this.validateAndParseJson(n);return r&&Kc.isAccountEntity(r)?lr.toObject(new Kc,r):null}async setAccount(e,t){this.logger.trace("BrowserCacheManager.setAccount called");const n=this.generateAccountKey(e.getAccountInfo()),r=Date.now().toString();e.lastUpdatedAt=r,await this.setUserData(n,JSON.stringify(e),t,r);const o=this.addAccountKeyToMap(n,t);this.cacheConfig.cacheLocation===Sa&&o&&this.eventHandler.emitEvent(au,void 0,e.getAccountInfo())}getAccountKeys(){return $c(this.browserStorage)}addAccountKeyToMap(e,t){this.logger.trace("BrowserCacheManager.addAccountKeyToMap called"),this.logger.tracePii("BrowserCacheManager.addAccountKeyToMap called with key: ".concat(e));const n=this.getAccountKeys();return-1===n.indexOf(e)?(n.push(e),this.setItem(Vl(),JSON.stringify(n),t),this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key added"),!0):(this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key already exists in map"),!1)}removeAccountKeyFromMap(e,t){this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap called"),this.logger.tracePii("BrowserCacheManager.removeAccountKeyFromMap called with key: ".concat(e));const n=this.getAccountKeys(),r=n.indexOf(e);if(r>-1){if(n.splice(r,1),0===n.length)return void this.removeItem(Vl());this.setItem(Vl(),JSON.stringify(n),t),this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap account key removed")}else this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap key not found in existing map")}removeAccount(e,t){const n=this.getActiveAccount(t);(null===n||void 0===n?void 0:n.homeAccountId)===e.homeAccountId&&(null===n||void 0===n?void 0:n.environment)===e.environment&&this.setActiveAccount(null,t),super.removeAccount(e,t),this.removeAccountKeyFromMap(this.generateAccountKey(e),t),this.browserStorage.getKeys().forEach(t=>{t.includes(e.homeAccountId)&&t.includes(e.environment)&&this.browserStorage.removeItem(t)}),this.cacheConfig.cacheLocation===Sa&&this.eventHandler.emitEvent(iu,void 0,e)}removeIdToken(e,t){super.removeIdToken(e,t);const n=this.getTokenKeys(),r=n.idToken.indexOf(e);r>-1&&(this.logger.info("idToken removed from tokenKeys map"),n.idToken.splice(r,1),this.setTokenKeys(n,t))}removeAccessToken(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super.removeAccessToken(e,t),n&&this.removeAccessTokenKeys([e],t)}removeAccessTokenKeys(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.logger.trace("removeAccessTokenKey called");const r=this.getTokenKeys(n);let o=0;if(e.forEach(e=>{const t=r.accessToken.indexOf(e);t>-1&&(r.accessToken.splice(t,1),o++)}),o>0)return this.logger.info("removed ".concat(o," accessToken keys from tokenKeys map")),void this.setTokenKeys(r,t,n)}removeRefreshToken(e,t){super.removeRefreshToken(e,t);const n=this.getTokenKeys(),r=n.refreshToken.indexOf(e);r>-1&&(this.logger.info("refreshToken removed from tokenKeys map"),n.refreshToken.splice(r,1),this.setTokenKeys(n,t))}getTokenKeys(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return Xc(this.clientId,this.browserStorage,e)}setTokenKeys(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;0!==e.idToken.length||0!==e.accessToken.length||0!==e.refreshToken.length?this.setItem(Gl(this.clientId,n),JSON.stringify(e),t):this.removeItem(Gl(this.clientId,n))}getIdTokenCredential(e,t){const n=this.browserStorage.getUserData(e);if(!n)return this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeIdToken(e,t),null;const r=this.validateAndParseJson(n);return r&&(o=r)&&Sc(o)&&o.hasOwnProperty("realm")&&o.credentialType===Pe.ID_TOKEN?(this.logger.trace("BrowserCacheManager.getIdTokenCredential: cache hit"),r):(this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),null);var o}async setIdTokenCredential(e,t){this.logger.trace("BrowserCacheManager.setIdTokenCredential called");const n=this.generateCredentialKey(e),r=Date.now().toString();e.lastUpdatedAt=r,await this.setUserData(n,JSON.stringify(e),t,r);const o=this.getTokenKeys();-1===o.idToken.indexOf(n)&&(this.logger.info("BrowserCacheManager: addTokenKey - idToken added to map"),o.idToken.push(n),this.setTokenKeys(o,t))}getAccessTokenCredential(e,t){const n=this.browserStorage.getUserData(e);if(!n)return this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeAccessTokenKeys([e],t),null;const r=this.validateAndParseJson(n);return r&&xc(r)?(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: cache hit"),r):(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),null)}async setAccessTokenCredential(e,t){this.logger.trace("BrowserCacheManager.setAccessTokenCredential called");const n=this.generateCredentialKey(e),r=Date.now().toString();e.lastUpdatedAt=r,await this.setUserData(n,JSON.stringify(e),t,r);const o=this.getTokenKeys(),a=o.accessToken.indexOf(n);-1!==a&&o.accessToken.splice(a,1),this.logger.trace("access token ".concat(-1===a?"added to":"updated in"," map")),o.accessToken.push(n),this.setTokenKeys(o,t)}getRefreshTokenCredential(e,t){const n=this.browserStorage.getUserData(e);if(!n)return this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeRefreshToken(e,t),null;const r=this.validateAndParseJson(n);return r&&Cc(r)?(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: cache hit"),r):(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),null)}async setRefreshTokenCredential(e,t){this.logger.trace("BrowserCacheManager.setRefreshTokenCredential called");const n=this.generateCredentialKey(e),r=Date.now().toString();e.lastUpdatedAt=r,await this.setUserData(n,JSON.stringify(e),t,r);const o=this.getTokenKeys();-1===o.refreshToken.indexOf(n)&&(this.logger.info("BrowserCacheManager: addTokenKey - refreshToken added to map"),o.refreshToken.push(n),this.setTokenKeys(o,t))}getAppMetadata(e){const t=this.browserStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null;const n=this.validateAndParseJson(t);return n&&(r=e,(o=n)&&0===r.indexOf(Ee)&&o.hasOwnProperty("clientId")&&o.hasOwnProperty("environment"))?(this.logger.trace("BrowserCacheManager.getAppMetadata: cache hit"),n):(this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null);var r,o}setAppMetadata(e,t){this.logger.trace("BrowserCacheManager.setAppMetadata called");const n=function(e){let{environment:t,clientId:n}=e;return[Ee,t,n].join(Ie).toLowerCase()}(e);this.setItem(n,JSON.stringify(e),t)}getServerTelemetry(e){const t=this.browserStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null;const n=this.validateAndParseJson(t);return n&&function(e,t){const n=0===e.indexOf(Le.CACHE_KEY);let r=!0;return t&&(r=t.hasOwnProperty("failedRequests")&&t.hasOwnProperty("errors")&&t.hasOwnProperty("cacheHits")),n&&r}(e,n)?(this.logger.trace("BrowserCacheManager.getServerTelemetry: cache hit"),n):(this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null)}setServerTelemetry(e,t,n){this.logger.trace("BrowserCacheManager.setServerTelemetry called"),this.setItem(e,JSON.stringify(t),n)}getAuthorityMetadata(e){const t=this.internalStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAuthorityMetadata: called, no cache hit"),null;const n=this.validateAndParseJson(t);return n&&function(e,t){return!!t&&0===e.indexOf(_e)&&t.hasOwnProperty("aliases")&&t.hasOwnProperty("preferred_cache")&&t.hasOwnProperty("preferred_network")&&t.hasOwnProperty("canonical_authority")&&t.hasOwnProperty("authorization_endpoint")&&t.hasOwnProperty("token_endpoint")&&t.hasOwnProperty("issuer")&&t.hasOwnProperty("aliasesFromNetwork")&&t.hasOwnProperty("endpointsFromNetwork")&&t.hasOwnProperty("expiresAt")&&t.hasOwnProperty("jwks_uri")}(e,n)?(this.logger.trace("BrowserCacheManager.getAuthorityMetadata: cache hit"),n):null}getAuthorityMetadataKeys(){return this.internalStorage.getKeys().filter(e=>this.isAuthorityMetadata(e))}setWrapperMetadata(e,t){this.internalStorage.setItem(ja,e),this.internalStorage.setItem(Da,t)}getWrapperMetadata(){return[this.internalStorage.getItem(ja)||H.EMPTY_STRING,this.internalStorage.getItem(Da)||H.EMPTY_STRING]}setAuthorityMetadata(e,t){this.logger.trace("BrowserCacheManager.setAuthorityMetadata called"),this.internalStorage.setItem(e,JSON.stringify(t))}getActiveAccount(e){const t=this.generateCacheKey(ae),n=this.browserStorage.getItem(t);if(!n)return this.logger.trace("BrowserCacheManager.getActiveAccount: No active account filters found"),null;const r=this.validateAndParseJson(n);return r?(this.logger.trace("BrowserCacheManager.getActiveAccount: Active account filters schema found"),this.getAccountInfoFilteredBy({homeAccountId:r.homeAccountId,localAccountId:r.localAccountId,tenantId:r.tenantId},e)):(this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null)}setActiveAccount(e,t){const n=this.generateCacheKey(ae);if(e){this.logger.verbose("setActiveAccount: Active account set");const r={homeAccountId:e.homeAccountId,localAccountId:e.localAccountId,tenantId:e.tenantId,lastUpdatedAt:mc().toString()};this.setItem(n,JSON.stringify(r),t)}else this.logger.verbose("setActiveAccount: No account passed, active account not set"),this.browserStorage.removeItem(n);this.eventHandler.emitEvent(su)}getThrottlingCache(e){const t=this.browserStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null;const n=this.validateAndParseJson(t);return n&&function(e,t){let n=!1;e&&(n=0===e.indexOf(Ue));let r=!0;return t&&(r=t.hasOwnProperty("throttleTime")),n&&r}(e,n)?(this.logger.trace("BrowserCacheManager.getThrottlingCache: cache hit"),n):(this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null)}setThrottlingCache(e,t,n){this.logger.trace("BrowserCacheManager.setThrottlingCache called"),this.setItem(e,JSON.stringify(t),n)}getTemporaryCache(e,t){const n=t?this.generateCacheKey(e):e;if(this.cacheConfig.storeAuthStateInCookie){const e=this.cookieStorage.getItem(n);if(e)return this.logger.trace("BrowserCacheManager.getTemporaryCache: storeAuthStateInCookies set to true, retrieving from cookies"),e}const r=this.temporaryCacheStorage.getItem(n);if(!r){if(this.cacheConfig.cacheLocation===Sa){const e=this.browserStorage.getItem(n);if(e)return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item found in local storage"),e}return this.logger.trace("BrowserCacheManager.getTemporaryCache: No cache item found in local storage"),null}return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item returned"),r}setTemporaryCache(e,t,n){const r=n?this.generateCacheKey(e):e;this.temporaryCacheStorage.setItem(r,t),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.setTemporaryCache: storeAuthStateInCookie set to true, setting item cookie"),this.cookieStorage.setItem(r,t,void 0,this.cacheConfig.secureCookies))}removeItem(e){this.browserStorage.removeItem(e)}removeTemporaryItem(e){this.temporaryCacheStorage.removeItem(e),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.removeItem: storeAuthStateInCookie is true, clearing item cookie"),this.cookieStorage.removeItem(e))}getKeys(){return this.browserStorage.getKeys()}clear(e){this.removeAllAccounts(e),this.removeAppMetadata(e),this.temporaryCacheStorage.getKeys().forEach(e=>{-1===e.indexOf(Fl)&&-1===e.indexOf(this.clientId)||this.removeTemporaryItem(e)}),this.browserStorage.getKeys().forEach(e=>{-1===e.indexOf(Fl)&&-1===e.indexOf(this.clientId)||this.browserStorage.removeItem(e)}),this.internalStorage.clear()}clearTokensAndKeysWithClaims(e){this.performanceClient.addQueueMeasurement(To,e);const t=this.getTokenKeys();let n=0;t.accessToken.forEach(t=>{const r=this.getAccessTokenCredential(t,e);null!==r&&void 0!==r&&r.requestedClaimsHash&&t.includes(r.requestedClaimsHash.toLowerCase())&&(this.removeAccessToken(t,e),n++)}),n>0&&this.logger.warning("".concat(n," access tokens with claims in the cache keys have been removed from the cache."))}generateCacheKey(e){return Ln.startsWith(e,Fl)?e:"".concat(Fl,".").concat(this.clientId,".").concat(e)}generateCredentialKey(e){const t=e.credentialType===Pe.REFRESH_TOKEN&&e.familyId||e.clientId,n=e.tokenType&&e.tokenType.toLowerCase()!==Fe.BEARER.toLowerCase()?e.tokenType.toLowerCase():"";return["".concat(Fl,".").concat(1),e.homeAccountId,e.environment,e.credentialType,t,e.realm||"",e.target||"",e.requestedClaimsHash||"",n].join("-").toLowerCase()}generateAccountKey(e){const t=e.homeAccountId.split(".")[1];return["".concat(Fl,".").concat(1),e.homeAccountId,e.environment,t||e.tenantId||""].join("-").toLowerCase()}resetRequestCache(){this.logger.trace("BrowserCacheManager.resetRequestCache called"),this.removeTemporaryItem(this.generateCacheKey(_a)),this.removeTemporaryItem(this.generateCacheKey(Ma)),this.removeTemporaryItem(this.generateCacheKey(Ea)),this.removeTemporaryItem(this.generateCacheKey(Na)),this.removeTemporaryItem(this.generateCacheKey(Oa)),this.setInteractionInProgress(!1)}cacheAuthorizeRequest(e,t){this.logger.trace("BrowserCacheManager.cacheAuthorizeRequest called");const n=Qs(JSON.stringify(e));if(this.setTemporaryCache(_a,n,!0),t){const e=Qs(t);this.setTemporaryCache(Ma,e,!0)}}getCachedRequest(){this.logger.trace("BrowserCacheManager.getCachedRequest called");const e=this.getTemporaryCache(_a,!0);if(!e)throw ns(Ai);const t=this.getTemporaryCache(Ma,!0);let n,r="";try{n=JSON.parse(Js(e)),t&&(r=Js(t))}catch(o){throw this.logger.errorPii("Attempted to parse: ".concat(e)),this.logger.error("Parsing cached token request threw with error: ".concat(o)),ns(Ii)}return[n,r]}getCachedNativeRequest(){this.logger.trace("BrowserCacheManager.getCachedNativeRequest called");const e=this.getTemporaryCache(Oa,!0);if(!e)return this.logger.trace("BrowserCacheManager.getCachedNativeRequest: No cached native request found"),null;const t=this.validateAndParseJson(e);return t||(this.logger.error("BrowserCacheManager.getCachedNativeRequest: Unable to parse native request"),null)}isInteractionInProgress(e){var t;const n=null===(t=this.getInteractionInProgress())||void 0===t?void 0:t.clientId;return e?n===this.clientId:!!n}getInteractionInProgress(){const e="".concat(Fl,".").concat(Ra),t=this.getTemporaryCache(e,!1);try{return t?JSON.parse(t):null}catch(n){return this.logger.error("Cannot parse interaction status. Removing temporary cache items and clearing url hash. Retrying interaction should fix the error"),this.removeTemporaryItem(e),this.resetRequestCache(),Tl(window),null}}setInteractionInProgress(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ta;const r="".concat(Fl,".").concat(Ra);if(e){if(this.getInteractionInProgress())throw ns(hi);this.setTemporaryCache(r,JSON.stringify({clientId:this.clientId,type:n}),!1)}else e||(null===(t=this.getInteractionInProgress())||void 0===t?void 0:t.clientId)!==this.clientId||this.removeTemporaryItem(r)}async hydrateCache(e,t){var n,r,o;const a=bc(null===(n=e.account)||void 0===n?void 0:n.homeAccountId,null===(r=e.account)||void 0===r?void 0:r.environment,e.idToken,this.clientId,e.tenantId);let i;t.claims&&(i=await this.cryptoImpl.hashString(t.claims));const s={idToken:a,accessToken:wc(null===(o=e.account)||void 0===o?void 0:o.homeAccountId,e.account.environment,e.accessToken,this.clientId,e.tenantId,e.scopes.join(" "),e.expiresOn?fc(e.expiresOn):0,e.extExpiresOn?fc(e.extExpiresOn):0,Js,void 0,e.tokenType,void 0,t.sshKid,t.claims,i)};return this.saveCacheRecord(s,e.correlationId)}async saveCacheRecord(e,t,n){try{await super.saveCacheRecord(e,t,n)}catch(r){if(r instanceof ir&&this.performanceClient&&t)try{const e=this.getTokenKeys();this.performanceClient.addFields({cacheRtCount:e.refreshToken.length,cacheIdCount:e.idToken.length,cacheAtCount:e.accessToken.length},t)}catch(r){}throw r}}}function _u(e,t,n,r){try{switch(t){case Sa:return new tu(e,n,r);case xa:return new nu}}catch(o){n.error(o)}return new rc}class Mu{constructor(e){this.eventCallbacks=new Map,this.logger=e||new ot({}),"undefined"!==typeof BroadcastChannel&&(this.broadcastChannel=new BroadcastChannel("msal.broadcast.event")),this.invokeCrossTabCallbacks=this.invokeCrossTabCallbacks.bind(this)}addEventCallback(e,t,n){if("undefined"!==typeof window){const r=n||dl();return this.eventCallbacks.has(r)?(this.logger.error("Event callback with id: ".concat(r," is already registered. Please provide a unique id or remove the existing callback and try again.")),null):(this.eventCallbacks.set(r,[e,t||[]]),this.logger.verbose("Event callback registered with id: ".concat(r)),r)}return null}removeEventCallback(e){this.eventCallbacks.delete(e),this.logger.verbose("Event callback ".concat(e," removed."))}emitEvent(e,t,n,r){var o;const a={eventType:e,interactionType:t||null,payload:n||null,error:r||null,timestamp:Date.now()};switch(e){case au:case iu:case su:null===(o=this.broadcastChannel)||void 0===o||o.postMessage(a);break;default:this.invokeCallbacks(a)}}invokeCallbacks(e){this.eventCallbacks.forEach((t,n)=>{let[r,o]=t;(0===o.length||o.includes(e.eventType))&&(this.logger.verbose("Emitting event to callback ".concat(n,": ").concat(e.eventType)),r.apply(null,[e]))})}invokeCrossTabCallbacks(e){const t=e.data;this.invokeCallbacks(t)}subscribeCrossTab(){var e;null===(e=this.broadcastChannel)||void 0===e||e.addEventListener("message",this.invokeCrossTabCallbacks)}unsubscribeCrossTab(){var e;null===(e=this.broadcastChannel)||void 0===e||e.removeEventListener("message",this.invokeCrossTabCallbacks)}}const Ru="home_account_id",Ou="UPN";async function ju(e,t,n,r,o,a,i){null===i||void 0===i||i.addQueueMeasurement(ho,a);const s=Ec.transformCIAMAuthority(Nc(e)),l=new Ec(s,t,n,r,o,a,i);try{return await hc(l.resolveEndpointsAsync.bind(l),go,o,i,a)(),l}catch(c){throw sn(vt)}}class Du extends ht{constructor(e,t,n,r,o){super(e,t,n),this.name="ServerError",this.errorNo=r,this.status=o,Object.setPrototypeOf(this,Du.prototype)}}class Lu{static generateThrottlingStorageKey(e){return"".concat(Ue,".").concat(JSON.stringify(e))}static preProcess(e,t,n){const r=Lu.generateThrottlingStorageKey(t),o=e.getThrottlingCache(r);if(o){var a;if(o.throttleTime<Date.now())return void e.removeItem(r,n);throw new Du((null===(a=o.errorCodes)||void 0===a?void 0:a.join(" "))||H.EMPTY_STRING,o.errorMessage,o.subError)}}static postProcess(e,t,n,r){if(Lu.checkResponseStatus(n)||Lu.checkResponseForRetryAfter(n)){const o={throttleTime:Lu.calculateThrottleTime(parseInt(n.headers[te])),error:n.body.error,errorCodes:n.body.error_codes,errorMessage:n.body.error_description,subError:n.body.suberror};e.setThrottlingCache(Lu.generateThrottlingStorageKey(t),o,r)}}static checkResponseStatus(e){return 429===e.status||e.status>=500&&e.status<600}static checkResponseForRetryAfter(e){return!!e.headers&&(e.headers.hasOwnProperty(te)&&(e.status<200||e.status>=300))}static calculateThrottleTime(e){const t=e<=0?0:e,n=Date.now()/1e3;return Math.floor(1e3*Math.min(n+(t||qe),n+ze))}static removeThrottle(e,t,n,r){const o=Vc(t,n,r),a=this.generateThrottlingStorageKey(o);e.removeItem(a,n.correlationId)}}class Fu{constructor(e,t){this.config=function(e){let{authOptions:t,systemOptions:n,loggerOptions:r,cacheOptions:o,storageInterface:a,networkInterface:i,cryptoInterface:s,clientCredentials:l,libraryInfo:u,telemetry:d,serverTelemetryManager:h,persistencePlugin:g,serializableCache:m}=e;const f=c(c({},Yo),r);return{authOptions:(p=t,c({clientCapabilities:[],azureCloudOptions:ea,skipAuthorityMetadataCache:!1,instanceAware:!1,encodeExtraQueryParams:!1},p)),systemOptions:c(c({},Qo),n),loggerOptions:f,cacheOptions:c(c({},Jo),o),storageInterface:a||new cr(t.clientId,ln,new ot(f),new Go),networkInterface:i||$o,cryptoInterface:s||ln,clientCredentials:l||Zo,libraryInfo:c(c({},Xo),u),telemetry:c(c({},ta),d),serverTelemetryManager:h||null,persistencePlugin:g||null,serializableCache:m||null};var p}(e),this.logger=new ot(this.config.loggerOptions,cn,un),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t}createTokenRequestHeaders(e){const t={};if(t[Z]=H.URL_FORM_CONTENT_TYPE,!this.config.systemOptions.preventCorsPreflight&&e)switch(e.type){case Ru:try{const n=Bc(e.credential);t[ne]="Oid:".concat(n.uid,"@").concat(n.utid)}catch(n){this.logger.verbose("Could not parse home account ID for CCS Header: "+n)}break;case Ou:t[ne]="UPN: ".concat(e.credential)}return t}async executePostToTokenEndpoint(e,t,n,r,o,a){var i;a&&(null===(i=this.performanceClient)||void 0===i||i.addQueueMeasurement(a,o));const s=await this.sendPostRequest(r,e,{body:t,headers:n},o);return this.config.serverTelemetryManager&&s.status<500&&429!==s.status&&this.config.serverTelemetryManager.clearTelemetryCache(),s}async sendPostRequest(e,t,n,r){let o;Lu.preProcess(this.cacheManager,e,r);try{var a,i;o=await hc(this.networkClient.sendPostRequestAsync.bind(this.networkClient),Ir,this.logger,this.performanceClient,r)(t,n);const e=o.headers||{};null===(a=this.performanceClient)||void 0===a||a.addFields({refreshTokenSize:(null===(i=o.body.refresh_token)||void 0===i?void 0:i.length)||0,httpVerToken:e[oe]||"",requestId:e[re]||""},r)}catch(l){if(l instanceof os){const e=l.responseHeaders;var s;if(e)null===(s=this.performanceClient)||void 0===s||s.addFields({httpVerToken:e[oe]||"",requestId:e[re]||"",contentTypeHeader:e[Z]||void 0,contentLengthHeader:e[ee]||void 0,httpStatus:l.httpStatus},r);throw l.error}throw l instanceof ht?l:sn(bt)}return Lu.postProcess(this.cacheManager,e,o,r),o}async updateAuthority(e,t){var n;null===(n=this.performanceClient)||void 0===n||n.addQueueMeasurement(ro,t);const r="https://".concat(e,"/").concat(this.authority.tenant,"/"),o=await ju(r,this.networkClient,this.cacheManager,this.authority.options,this.logger,t,this.performanceClient);this.authority=o}createTokenQueryParameters(e){const t=new Map;return e.embeddedClientId&&Ks(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri),e.tokenQueryParameters&&qs(t,e.tokenQueryParameters),Ps(t,e.correlationId),vs(t,e.correlationId,this.performanceClient),Yn(t)}}class qu{static setRequestState(e,t,n){const r=qu.generateLibraryState(e,n);return t?"".concat(r).concat(H.RESOURCE_DELIM).concat(t):r}static generateLibraryState(e,t){if(!e)throw sn(Ht);const n={id:e.createNewGuid()};t&&(n.meta=t);const r=JSON.stringify(n);return e.base64Encode(r)}static parseRequestState(e,t){if(!e)throw sn(Ht);if(!t)throw sn(St);try{const n=t.split(H.RESOURCE_DELIM),r=n[0],o=n.length>1?n.slice(1).join(H.RESOURCE_DELIM):H.EMPTY_STRING,a=e.base64Decode(r),i=JSON.parse(a);return{userRequestState:o||H.EMPTY_STRING,libraryState:i}}catch(n){throw sn(St)}}}const zu="sw";class Uu{constructor(e,t){this.cryptoUtils=e,this.performanceClient=t}async generateCnf(e,t){var n;null===(n=this.performanceClient)||void 0===n||n.addQueueMeasurement(so,e.correlationId);const r=await hc(this.generateKid.bind(this),so,t,this.performanceClient,e.correlationId)(e),o=this.cryptoUtils.base64UrlEncode(JSON.stringify(r));return{kid:r.kid,reqCnfString:o}}async generateKid(e){var t;null===(t=this.performanceClient)||void 0===t||t.addQueueMeasurement(lo,e.correlationId);return{kid:await this.cryptoUtils.getPublicKeyThumbprint(e),xms_ksl:zu}}async signPopToken(e,t,n){return this.signPayload(e,t,n)}async signPayload(e,t,n,r){const{resourceRequestMethod:o,resourceRequestUri:a,shrClaims:i,shrNonce:s,shrOptions:l}=n,u=a?new $n(a):void 0,d=null===u||void 0===u?void 0:u.getUrlComponents();return this.cryptoUtils.signJwt(c({at:e,ts:mc(),m:null===o||void 0===o?void 0:o.toUpperCase(),u:null===d||void 0===d?void 0:d.HostNameAndPort,nonce:s||this.cryptoUtils.createNewGuid(),p:null===d||void 0===d?void 0:d.AbsolutePath,q:null!==d&&void 0!==d&&d.QueryString?[[],d.QueryString]:void 0,client_claims:i||void 0},r),t,l,n.correlationId)}}class Hu{constructor(e,t){this.cache=e,this.hasChanged=t}get cacheHasChanged(){return this.hasChanged}get tokenCache(){return this.cache}}class Bu{constructor(e,t,n,r,o,a,i){this.clientId=e,this.cacheStorage=t,this.cryptoObj=n,this.logger=r,this.serializableCache=o,this.persistencePlugin=a,this.performanceClient=i}validateTokenResponse(e,t){if(e.error||e.error_description||e.suberror){var n;const r="Error(s): ".concat(e.error_codes||H.NOT_AVAILABLE," - Timestamp: ").concat(e.timestamp||H.NOT_AVAILABLE," - Description: ").concat(e.error_description||H.NOT_AVAILABLE," - Correlation ID: ").concat(e.correlation_id||H.NOT_AVAILABLE," - Trace ID: ").concat(e.trace_id||H.NOT_AVAILABLE),o=null!==(n=e.error_codes)&&void 0!==n&&n.length?e.error_codes[0]:void 0,a=new Du(e.error,r,e.suberror,o,e.status);if(t&&e.status&&e.status>=G&&e.status<=Q)return void this.logger.warning("executeTokenRequest:validateTokenResponse - AAD is currently unavailable and the access token is unable to be refreshed.\n".concat(a));if(t&&e.status&&e.status>=W&&e.status<=V)return void this.logger.warning("executeTokenRequest:validateTokenResponse - AAD is currently available but is unable to refresh the access token.\n".concat(a));if(zc(e.error,e.error_description,e.suberror))throw new qc(e.error,e.error_description,e.suberror,e.timestamp||H.EMPTY_STRING,e.trace_id||H.EMPTY_STRING,e.correlation_id||H.EMPTY_STRING,e.claims||H.EMPTY_STRING,o);throw a}}async handleServerTokenResponse(e,t,n,r,o,a,i,s,l){var c;let u,d;if(null===(c=this.performanceClient)||void 0===c||c.addQueueMeasurement(co,e.correlation_id),e.id_token){if(u=Wn(e.id_token||H.EMPTY_STRING,this.cryptoObj.base64Decode),o&&o.nonce&&u.nonce!==o.nonce)throw sn(At);if(r.maxAge||0===r.maxAge){const e=u.auth_time;if(!e)throw sn(It);Kn(e,r.maxAge)}}this.homeAccountIdentifier=Kc.generateHomeAccountId(e.client_info||H.EMPTY_STRING,t.authorityType,this.logger,this.cryptoObj,u),o&&o.state&&(d=qu.parseRequestState(this.cryptoObj,o.state)),e.key_id=e.key_id||r.sshKid||void 0;const h=this.generateCacheRecord(e,t,n,r,u,a,o);let g;try{if(this.persistencePlugin&&this.serializableCache&&(this.logger.verbose("Persistence enabled, calling beforeCacheAccess"),g=new Hu(this.serializableCache,!0),await this.persistencePlugin.beforeCacheAccess(g)),i&&!s&&h.account){const e=this.cacheStorage.generateAccountKey(h.account.getAccountInfo());if(!this.cacheStorage.getAccount(e,r.correlationId))return this.logger.warning("Account used to refresh tokens not in persistence, refreshed tokens will not be stored in the cache"),await Bu.generateAuthenticationResult(this.cryptoObj,t,h,!1,r,u,d,void 0,l)}await this.cacheStorage.saveCacheRecord(h,r.correlationId,r.storeInCache)}finally{this.persistencePlugin&&this.serializableCache&&g&&(this.logger.verbose("Persistence enabled, calling afterCacheAccess"),await this.persistencePlugin.afterCacheAccess(g))}return Bu.generateAuthenticationResult(this.cryptoObj,t,h,!1,r,u,d,e,l)}generateCacheRecord(e,t,n,r,o,a,i){const s=t.getPreferredCache();if(!s)throw sn(zt);const l=Wc(o);let c,u;e.id_token&&o&&(c=bc(this.homeAccountIdentifier,s,e.id_token,this.clientId,l||""),u=Wu(this.cacheStorage,t,this.homeAccountIdentifier,this.cryptoObj.base64Decode,r.correlationId,o,e.client_info,s,l,i,void 0,this.logger));let d=null;if(e.access_token){const o=e.scope?Fn.fromString(e.scope):new Fn(r.scopes||[]),i=("string"===typeof e.expires_in?parseInt(e.expires_in,10):e.expires_in)||0,c=("string"===typeof e.ext_expires_in?parseInt(e.ext_expires_in,10):e.ext_expires_in)||0,u=("string"===typeof e.refresh_in?parseInt(e.refresh_in,10):e.refresh_in)||void 0,h=n+i,g=h+c,m=u&&u>0?n+u:void 0;d=wc(this.homeAccountIdentifier,s,e.access_token,this.clientId,l||t.tenant||"",o.printScopes(),h,g,this.cryptoObj.base64Decode,m,e.token_type,a,e.key_id,r.claims,r.requestedClaimsHash)}let h=null;if(e.refresh_token){let t;if(e.refresh_token_expires_in){t=n+("string"===typeof e.refresh_token_expires_in?parseInt(e.refresh_token_expires_in,10):e.refresh_token_expires_in)}h=kc(this.homeAccountIdentifier,s,e.refresh_token,this.clientId,e.foci,a,t)}let g=null;return e.foci&&(g={clientId:this.clientId,environment:s,familyId:e.foci}),{account:u,idToken:c,accessToken:d,refreshToken:h,appMetadata:g}}static async generateAuthenticationResult(e,t,n,r,o,a,i,s,l){var c,u,d,h,g;let m,f,p=H.EMPTY_STRING,y=[],v=null,b=H.EMPTY_STRING;if(n.accessToken){if(n.accessToken.tokenType!==Fe.POP||o.popKid)p=n.accessToken.secret;else{const t=new Uu(e),{secret:r,keyId:a}=n.accessToken;if(!a)throw sn(Xt);p=await t.signPopToken(r,a,o)}y=Fn.fromString(n.accessToken.target).asArray(),v=pc(n.accessToken.expiresOn),m=pc(n.accessToken.extendedExpiresOn),n.accessToken.refreshOn&&(f=pc(n.accessToken.refreshOn))}n.appMetadata&&(b=n.appMetadata.familyId===Ne?Ne:"");const w=(null===a||void 0===a?void 0:a.oid)||(null===a||void 0===a?void 0:a.sub)||"",k=(null===a||void 0===a?void 0:a.tid)||"";null!==s&&void 0!==s&&s.spa_accountid&&n.account&&(n.account.nativeAccountId=null===s||void 0===s?void 0:s.spa_accountid);const S=n.account?Bn(n.account.getAccountInfo(),void 0,a,null===(c=n.idToken)||void 0===c?void 0:c.secret):null;return{authority:t.canonicalAuthority,uniqueId:w,tenantId:k,scopes:y,account:S,idToken:(null===n||void 0===n||null===(u=n.idToken)||void 0===u?void 0:u.secret)||"",idTokenClaims:a||{},accessToken:p,fromCache:r,expiresOn:v,extExpiresOn:m,refreshOn:f,correlationId:o.correlationId,requestId:l||H.EMPTY_STRING,familyId:b,tokenType:(null===(d=n.accessToken)||void 0===d?void 0:d.tokenType)||H.EMPTY_STRING,state:i?i.userRequestState:H.EMPTY_STRING,cloudGraphHostName:(null===(h=n.account)||void 0===h?void 0:h.cloudGraphHostName)||H.EMPTY_STRING,msGraphHost:(null===(g=n.account)||void 0===g?void 0:g.msGraphHost)||H.EMPTY_STRING,code:null===s||void 0===s?void 0:s.spa_code,fromNativeBroker:!1}}}function Wu(e,t,n,r,o,a,i,s,l,c,u,d){null===d||void 0===d||d.verbose("setCachedAccount called");const h=e.getAccountKeys().find(e=>e.startsWith(n));let g=null;h&&(g=e.getAccount(h,o));const m=g||Kc.createAccount({homeAccountId:n,idTokenClaims:a,clientInfo:i,environment:s,cloudGraphHostName:null===c||void 0===c?void 0:c.cloud_graph_host_name,msGraphHost:null===c||void 0===c?void 0:c.msgraph_host,nativeAccountId:u},t,r),f=m.tenantProfiles||[],p=l||m.realm;if(p&&!f.find(e=>e.tenantId===p)){const e=Hn(n,m.localAccountId,p,a);f.push(e)}return m.tenantProfiles=f,m}async function Ku(e,t,n){if("string"===typeof e)return e;return e({clientId:t,tokenEndpoint:n})}class Vu extends Fu{constructor(e,t){var n;super(e,t),this.includeRedirectUri=!0,this.oidcDefaultScopes=null===(n=this.config.authOptions.authority.options.OIDCOptions)||void 0===n?void 0:n.defaultScopes}async acquireToken(e,t){var n,r;if(null===(n=this.performanceClient)||void 0===n||n.addQueueMeasurement(oo,e.correlationId),!e.code)throw sn(_t);const o=mc(),a=await hc(this.executeTokenRequest.bind(this),ao,this.logger,this.performanceClient,e.correlationId)(this.authority,e),i=null===(r=a.headers)||void 0===r?void 0:r[re],s=new Bu(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin,this.performanceClient);return s.validateTokenResponse(a.body),hc(s.handleServerTokenResponse.bind(s),co,this.logger,this.performanceClient,e.correlationId)(a.body,this.authority,o,e,t,void 0,void 0,void 0,i)}getLogoutUri(e){if(!e)throw Dn(bn);const t=this.createLogoutUrlQueryString(e);return $n.appendQueryString(this.authority.endSessionEndpoint,t)}async executeTokenRequest(e,t){var n;null===(n=this.performanceClient)||void 0===n||n.addQueueMeasurement(ao,t.correlationId);const r=this.createTokenQueryParameters(t),o=$n.appendQueryString(e.tokenEndpoint,r),a=await hc(this.createTokenRequestBody.bind(this),io,this.logger,this.performanceClient,t.correlationId)(t);let i;if(t.clientInfo)try{const e=Hc(t.clientInfo,this.cryptoUtils.base64Decode);i={credential:"".concat(e.uid).concat(Te).concat(e.utid),type:Ru}}catch(c){this.logger.verbose("Could not parse client info for CCS Header: "+c)}const s=this.createTokenRequestHeaders(i||t.ccsCredential),l=Vc(this.config.authOptions.clientId,t);return hc(this.executePostToTokenEndpoint.bind(this),Pr,this.logger,this.performanceClient,t.correlationId)(o,a,s,l,t.correlationId,Pr)}async createTokenRequestBody(e){var t,n;null===(t=this.performanceClient)||void 0===t||t.addQueueMeasurement(io,e.correlationId);const r=new Map;if(ks(r,e.embeddedClientId||(null===(n=e.tokenBodyParameters)||void 0===n?void 0:n[cs])||this.config.authOptions.clientId),this.includeRedirectUri)Ss(r,e.redirectUri);else if(!e.redirectUri)throw Dn(dn);if(ws(r,e.scopes,!0,this.oidcDefaultScopes),function(e,t){e.set("code",t)}(r,e.code),Es(r,this.config.libraryInfo),Ns(r,this.config.telemetry.application),Ws(r),this.serverTelemetryManager&&!na(this.config)&&Bs(r,this.serverTelemetryManager),e.codeVerifier&&function(e,t){e.set("code_verifier",t)}(r,e.codeVerifier),this.config.clientCredentials.clientSecret&&Rs(r,this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){const t=this.config.clientCredentials.clientAssertion;Os(r,await Ku(t.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),js(r,t.assertionType)}if(Ds(r,ke),Ls(r),e.authenticationScheme===Fe.POP){const t=new Uu(this.cryptoUtils,this.performanceClient);let n;if(e.popKid)n=this.cryptoUtils.encodeKid(e.popKid);else{n=(await hc(t.generateCnf.bind(t),so,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString}Us(r,n)}else if(e.authenticationScheme===Fe.SSH){if(!e.sshJwk)throw Dn(An);Hs(r,e.sshJwk)}let o;if((!Ln.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&Ts(r,e.claims,this.config.authOptions.clientCapabilities),e.clientInfo)try{const t=Hc(e.clientInfo,this.cryptoUtils.base64Decode);o={credential:"".concat(t.uid).concat(Te).concat(t.utid),type:Ru}}catch(a){this.logger.verbose("Could not parse client info for CCS Header: "+a)}else o=e.ccsCredential;if(this.config.systemOptions.preventCorsPreflight&&o)switch(o.type){case Ru:try{As(r,Bc(o.credential))}catch(a){this.logger.verbose("Could not parse home account ID for CCS Header: "+a)}break;case Ou:Cs(r,o.credential)}return e.embeddedClientId&&Ks(r,this.config.authOptions.clientId,this.config.authOptions.redirectUri),e.tokenBodyParameters&&qs(r,e.tokenBodyParameters),!e.enableSpaAuthorizationCode||e.tokenBodyParameters&&e.tokenBodyParameters[gs]||qs(r,{[gs]:"1"}),vs(r,e.correlationId,this.performanceClient),Yn(r)}createLogoutUrlQueryString(e){const t=new Map;return e.postLogoutRedirectUri&&function(e,t){e.set("post_logout_redirect_uri",t)}(t,e.postLogoutRedirectUri),e.correlationId&&Ps(t,e.correlationId),e.idTokenHint&&function(e,t){e.set("id_token_hint",t)}(t,e.idTokenHint),e.state&&_s(t,e.state),e.logoutHint&&function(e,t){e.set("logout_hint",t)}(t,e.logoutHint),e.extraQueryParameters&&qs(t,e.extraQueryParameters),this.config.authOptions.instanceAware&&Fs(t),Yn(t,this.config.authOptions.encodeExtraQueryParams,e.extraQueryParameters)}}function Gu(e){const{skus:t,libraryName:n,libraryVersion:r,extensionName:o,extensionVersion:a}=e,i=new Map([[0,[n,r]],[2,[o,a]]]);let s=[];if(null!==t&&void 0!==t&&t.length){if(s=t.split(","),s.length<4)return t}else s=Array.from({length:4},()=>"|");return i.forEach((e,t)=>{var n,r;2===e.length&&null!==(n=e[0])&&void 0!==n&&n.length&&null!==(r=e[1])&&void 0!==r&&r.length&&function(e){const{skuArr:t,index:n,skuName:r,skuVersion:o}=e;if(n>=t.length)return;t[n]=[r,o].join("|")}({skuArr:s,index:t,skuName:e[0],skuVersion:e[1]})}),s.join(",")}class Qu{constructor(e,t){this.cacheOutcome=$e,this.cacheManager=t,this.apiId=e.apiId,this.correlationId=e.correlationId,this.wrapperSKU=e.wrapperSKU||H.EMPTY_STRING,this.wrapperVer=e.wrapperVer||H.EMPTY_STRING,this.telemetryCacheKey=Le.CACHE_KEY+Ie+e.clientId}generateCurrentRequestHeaderValue(){const e="".concat(this.apiId).concat(Le.VALUE_SEPARATOR).concat(this.cacheOutcome),t=[this.wrapperSKU,this.wrapperVer],n=this.getNativeBrokerErrorCode();null!==n&&void 0!==n&&n.length&&t.push("broker_error=".concat(n));const r=t.join(Le.VALUE_SEPARATOR),o=[e,this.getRegionDiscoveryFields()].join(Le.VALUE_SEPARATOR);return[Le.SCHEMA_VERSION,o,r].join(Le.CATEGORY_SEPARATOR)}generateLastRequestHeaderValue(){const e=this.getLastRequests(),t=Qu.maxErrorsToSend(e),n=e.failedRequests.slice(0,2*t).join(Le.VALUE_SEPARATOR),r=e.errors.slice(0,t).join(Le.VALUE_SEPARATOR),o=e.errors.length,a=[o,t<o?Le.OVERFLOW_TRUE:Le.OVERFLOW_FALSE].join(Le.VALUE_SEPARATOR);return[Le.SCHEMA_VERSION,e.cacheHits,n,r,a].join(Le.CATEGORY_SEPARATOR)}cacheFailedRequest(e){const t=this.getLastRequests();t.errors.length>=Le.MAX_CACHED_ERRORS&&(t.failedRequests.shift(),t.failedRequests.shift(),t.errors.shift()),t.failedRequests.push(this.apiId,this.correlationId),e instanceof Error&&e&&e.toString()?e instanceof ht?e.subError?t.errors.push(e.subError):e.errorCode?t.errors.push(e.errorCode):t.errors.push(e.toString()):t.errors.push(e.toString()):t.errors.push(Le.UNKNOWN_ERROR),this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t,this.correlationId)}incrementCacheHits(){const e=this.getLastRequests();return e.cacheHits+=1,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e,this.correlationId),e.cacheHits}getLastRequests(){return this.cacheManager.getServerTelemetry(this.telemetryCacheKey)||{failedRequests:[],errors:[],cacheHits:0}}clearTelemetryCache(){const e=this.getLastRequests(),t=Qu.maxErrorsToSend(e);if(t===e.errors.length)this.cacheManager.removeItem(this.telemetryCacheKey,this.correlationId);else{const n={failedRequests:e.failedRequests.slice(2*t),errors:e.errors.slice(t),cacheHits:0};this.cacheManager.setServerTelemetry(this.telemetryCacheKey,n,this.correlationId)}}static maxErrorsToSend(e){let t,n=0,r=0;const o=e.errors.length;for(t=0;t<o;t++){const o=e.failedRequests[2*t]||H.EMPTY_STRING,a=e.failedRequests[2*t+1]||H.EMPTY_STRING,i=e.errors[t]||H.EMPTY_STRING;if(r+=o.toString().length+a.toString().length+i.length+3,!(r<Le.MAX_LAST_HEADER_BYTES))break;n+=1}return n}getRegionDiscoveryFields(){const e=[];return e.push(this.regionUsed||H.EMPTY_STRING),e.push(this.regionSource||H.EMPTY_STRING),e.push(this.regionOutcome||H.EMPTY_STRING),e.join(",")}updateRegionDiscoveryMetadata(e){this.regionUsed=e.region_used,this.regionSource=e.region_source,this.regionOutcome=e.region_outcome}setCacheOutcome(e){this.cacheOutcome=e}setNativeBrokerErrorCode(e){const t=this.getLastRequests();t.nativeBrokerErrorCode=e,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t,this.correlationId)}getNativeBrokerErrorCode(){return this.getLastRequests().nativeBrokerErrorCode}clearNativeBrokerErrorCode(){const e=this.getLastRequests();delete e.nativeBrokerErrorCode,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e,this.correlationId)}static makeExtraSkuString(e){return Gu(e)}}class Yu{constructor(e,t,n,r,o,a,i,s,l){this.config=e,this.browserStorage=t,this.browserCrypto=n,this.networkClient=this.config.system.networkClient,this.eventHandler=o,this.navigationClient=a,this.platformAuthProvider=s,this.correlationId=l||dl(),this.logger=r.clone(ca,Ll,this.correlationId),this.performanceClient=i}async clearCacheOnLogout(e,t){if(t)try{this.browserStorage.removeAccount(t,e),this.logger.verbose("Cleared cache items belonging to the account provided in the logout request.")}catch(n){this.logger.error("Account provided in logout request was not found. Local cache unchanged.")}else try{this.logger.verbose("No account provided in logout request, clearing all cache items.",this.correlationId),this.browserStorage.clear(e),await this.browserCrypto.clearKeystore()}catch(r){this.logger.error("Attempted to clear all MSAL cache items and failed. Local cache unchanged.")}}getRedirectUri(e){this.logger.verbose("getRedirectUri called");const t=e||this.config.auth.redirectUri;return $n.getAbsoluteUrl(t,El())}initializeServerTelemetryManager(e,t){this.logger.verbose("initializeServerTelemetryManager called");const n={clientId:this.config.auth.clientId,correlationId:this.correlationId,apiId:e,forceRefresh:t||!1,wrapperSKU:this.browserStorage.getWrapperMetadata()[0],wrapperVer:this.browserStorage.getWrapperMetadata()[1]};return new Qu(n,this.browserStorage)}async getDiscoveredAuthority(e){const{account:t}=e,n=e.requestExtraQueryParameters&&e.requestExtraQueryParameters.hasOwnProperty("instance_aware")?e.requestExtraQueryParameters.instance_aware:void 0;this.performanceClient.addQueueMeasurement(Cr,this.correlationId);const r={protocolMode:this.config.auth.protocolMode,OIDCOptions:this.config.auth.OIDCOptions,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},o=e.requestAuthority||this.config.auth.authority,a=null!==n&&void 0!==n&&n.length?"true"===n:this.config.auth.instanceAware,i=t&&a?this.config.auth.authority.replace($n.getDomainFromUrl(o),t.environment):o,s=Ec.generateAuthority(i,e.requestAzureCloudOptions||this.config.auth.azureCloudOptions),l=await hc(ju,ho,this.logger,this.performanceClient,this.correlationId)(s,this.config.system.networkClient,this.browserStorage,r,this.logger,this.correlationId,this.performanceClient);if(t&&!l.isAlias(t.environment))throw Dn(_n);return l}}async function Ju(e,t,n,r){n.addQueueMeasurement(Fr,e.correlationId);const o=e.authority||t.auth.authority,a=[...e&&e.scopes||[]],i=c(c({},e),{},{correlationId:e.correlationId,authority:o,scopes:a});if(i.authenticationScheme){if(i.authenticationScheme===Fe.SSH){if(!e.sshJwk)throw Dn(An);if(!e.sshKid)throw Dn(In)}r.verbose('Authentication Scheme set to "'.concat(i.authenticationScheme,'" as configured in Auth request'))}else i.authenticationScheme=Fe.BEARER,r.verbose('Authentication Scheme wasn\'t explicitly set in request, defaulting to "Bearer" request');return t.cache.claimsBasedCachingEnabled&&e.claims&&!Ln.isEmptyObj(e.claims)&&(i.requestedClaimsHash=await wl(e.claims)),i}async function $u(e,t,n,r,o){r.addQueueMeasurement(qr,e.correlationId);const a=await hc(Ju,Fr,o,r,e.correlationId)(e,n,r,o);return c(c(c({},e),a),{},{account:t,forceRefresh:e.forceRefresh||!1})}function Xu(e,t){let n;const r=e.httpMethod;if(t===st){if(n=r||J,n!==J)throw Dn(Mn)}else n=r||Y;if(e.authorizePostBodyParameters&&n!==J)throw Dn(Rn);return n}class Zu extends Yu{initializeLogoutRequest(e){this.logger.verbose("initializeLogoutRequest called",null===e||void 0===e?void 0:e.correlationId);const t=c({correlationId:this.correlationId||dl()},e);if(e)if(e.logoutHint)this.logger.verbose("logoutHint has already been set in logoutRequest");else if(e.account){const n=this.getLogoutHintFromIdTokenClaims(e.account);n&&(this.logger.verbose("Setting logoutHint to login_hint ID Token Claim value for the account provided"),t.logoutHint=n)}else this.logger.verbose("logoutHint was not set and account was not passed into logout request, logoutHint will not be set");else this.logger.verbose("logoutHint will not be set since no logout request was configured");return e&&null===e.postLogoutRedirectUri?this.logger.verbose("postLogoutRedirectUri passed as null, not setting post logout redirect uri",t.correlationId):e&&e.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to uri set on logout request",t.correlationId),t.postLogoutRedirectUri=$n.getAbsoluteUrl(e.postLogoutRedirectUri,El())):null===this.config.auth.postLogoutRedirectUri?this.logger.verbose("postLogoutRedirectUri configured as null and no uri set on request, not passing post logout redirect",t.correlationId):this.config.auth.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to configured uri",t.correlationId),t.postLogoutRedirectUri=$n.getAbsoluteUrl(this.config.auth.postLogoutRedirectUri,El())):(this.logger.verbose("Setting postLogoutRedirectUri to current page",t.correlationId),t.postLogoutRedirectUri=$n.getAbsoluteUrl(El(),El())),t}getLogoutHintFromIdTokenClaims(e){const t=e.idTokenClaims;if(t){if(t.login_hint)return t.login_hint;this.logger.verbose("The ID Token Claims tied to the provided account do not contain a login_hint claim, logoutHint will not be added to logout request")}else this.logger.verbose("The provided account does not contain ID Token Claims, logoutHint will not be added to logout request");return null}async createAuthCodeClient(e){this.performanceClient.addQueueMeasurement(Gr,this.correlationId);const t=await hc(this.getClientConfiguration.bind(this),Qr,this.logger,this.performanceClient,this.correlationId)(e);return new Vu(t,this.performanceClient)}async getClientConfiguration(e){const{serverTelemetryManager:t,requestAuthority:n,requestAzureCloudOptions:r,requestExtraQueryParameters:o,account:a}=e;this.performanceClient.addQueueMeasurement(Qr,this.correlationId);const i=await hc(this.getDiscoveredAuthority.bind(this),Cr,this.logger,this.performanceClient,this.correlationId)({requestAuthority:n,requestAzureCloudOptions:r,requestExtraQueryParameters:o,account:a}),s=this.config.system.loggerOptions;return{authOptions:{clientId:this.config.auth.clientId,authority:i,clientCapabilities:this.config.auth.clientCapabilities,redirectUri:this.config.auth.redirectUri},systemOptions:{tokenRenewalOffsetSeconds:this.config.system.tokenRenewalOffsetSeconds,preventCorsPreflight:!0},loggerOptions:{loggerCallback:s.loggerCallback,piiLoggingEnabled:s.piiLoggingEnabled,logLevel:s.logLevel,correlationId:this.correlationId},cacheOptions:{claimsBasedCachingEnabled:this.config.cache.claimsBasedCachingEnabled},cryptoInterface:this.browserCrypto,networkInterface:this.networkClient,storageInterface:this.browserStorage,serverTelemetryManager:t,libraryInfo:{sku:ca,version:Ll,cpu:H.EMPTY_STRING,os:H.EMPTY_STRING},telemetry:this.config.telemetry}}async initializeAuthorizationRequest(e,t){this.performanceClient.addQueueMeasurement(Yr,this.correlationId);const n=this.getRedirectUri(e.redirectUri),r={interactionType:t},o=qu.setRequestState(this.browserCrypto,e&&e.state||H.EMPTY_STRING,r),a=await hc(Ju,Fr,this.logger,this.performanceClient,this.correlationId)(c(c({},e),{},{correlationId:this.correlationId}),this.config,this.performanceClient,this.logger),i=c(c({},a),{},{redirectUri:n,state:o,nonce:e.nonce||dl(),responseMode:this.config.auth.OIDCOptions.serverResponseType}),s=c(c({},i),{},{httpMethod:Xu(i,this.config.auth.protocolMode)});if(e.loginHint||e.sid)return s;const l=e.account||this.browserStorage.getActiveAccount(this.correlationId);return l&&(this.logger.verbose("Setting validated request account",this.correlationId),this.logger.verbosePii("Setting validated request account: ".concat(l.homeAccountId),this.correlationId),s.account=l),s}}function ed(e,t,n){const r=Qn(e);if(!r)throw Gn(e)?(n.error("A ".concat(t," is present in the iframe but it does not contain known properties. It's likely that the ").concat(t," has been replaced by code running on the redirectUri page.")),n.errorPii("The ".concat(t," detected is: ").concat(e)),ns(ci)):(n.error("The request has returned to the redirectUri but a ".concat(t," is not present. It's likely that the ").concat(t," has been removed or the page has been redirected by code running on the redirectUri page.")),ns(si));return r}function td(e,t,n){if(!e.state)throw ns(li);const r=function(e,t){if(!t)return null;try{return qu.parseRequestState(e,t).libraryState.meta}catch(n){throw sn(St)}}(t,e.state);if(!r)throw ns(ui);if(r.interactionType!==n)throw ns(di)}function nd(e,t,n,r){var o,a;const i=t.correlationId,s=new Map;ks(s,t.embeddedClientId||(null===(o=t.extraQueryParameters)||void 0===o?void 0:o[cs])||e.clientId);if(ws(s,[...t.scopes||[],...t.extraScopesToConsent||[]],!0,null===(a=e.authority.options.OIDCOptions)||void 0===a?void 0:a.defaultScopes),Ss(s,t.redirectUri),Ps(s,i),function(e,t){e.set("response_mode",t||we)}(s,t.responseMode),Ls(s),t.prompt&&(!function(e,t){e.set("prompt",t)}(s,t.prompt),null===r||void 0===r||r.addFields({prompt:t.prompt},i)),t.domainHint&&(!function(e,t){e.set("domain_hint",t)}(s,t.domainHint),null===r||void 0===r||r.addFields({domainHintFromRequest:!0},i)),t.prompt!==he)if(t.sid&&t.prompt===me)n.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from request"),Is(s,t.sid),null===r||void 0===r||r.addFields({sidFromRequest:!0},i);else if(t.account){const e=function(e){var t;return(null===(t=e.idTokenClaims)||void 0===t?void 0:t.sid)||null}(t.account);let o=function(e){var t;return e.loginHint||(null===(t=e.idTokenClaims)||void 0===t?void 0:t.login_hint)||null}(t.account);if(o&&t.domainHint&&(n.warning('AuthorizationCodeClient.createAuthCodeUrlQueryString: "domainHint" param is set, skipping opaque "login_hint" claim. Please consider not passing domainHint'),o=null),o){n.verbose("createAuthCodeUrlQueryString: login_hint claim present on account"),xs(s,o),null===r||void 0===r||r.addFields({loginHintFromClaim:!0},i);try{As(s,Bc(t.account.homeAccountId))}catch(l){n.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(e&&t.prompt===me){n.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from account"),Is(s,e),null===r||void 0===r||r.addFields({sidFromClaim:!0},i);try{As(s,Bc(t.account.homeAccountId))}catch(l){n.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(t.loginHint)n.verbose("createAuthCodeUrlQueryString: Adding login_hint from request"),xs(s,t.loginHint),Cs(s,t.loginHint),null===r||void 0===r||r.addFields({loginHintFromRequest:!0},i);else if(t.account.username){n.verbose("createAuthCodeUrlQueryString: Adding login_hint from account"),xs(s,t.account.username),null===r||void 0===r||r.addFields({loginHintFromUpn:!0},i);try{As(s,Bc(t.account.homeAccountId))}catch(l){n.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}}else t.loginHint&&(n.verbose("createAuthCodeUrlQueryString: No account, adding login_hint from request"),xs(s,t.loginHint),Cs(s,t.loginHint),null===r||void 0===r||r.addFields({loginHintFromRequest:!0},i));else n.verbose("createAuthCodeUrlQueryString: Prompt is select_account, ignoring account hints");return t.nonce&&function(e,t){e.set("nonce",t)}(s,t.nonce),t.state&&_s(s,t.state),(t.claims||e.clientCapabilities&&e.clientCapabilities.length>0)&&Ts(s,t.claims,e.clientCapabilities),t.embeddedClientId&&Ks(s,e.clientId,e.redirectUri),!e.instanceAware||t.extraQueryParameters&&Object.keys(t.extraQueryParameters).includes(ys)||Fs(s),s}function rd(e,t,n,r){const o=Yn(t,n,r);return $n.appendQueryString(e.authorizationEndpoint,o)}function od(e,t){if(!e.state||!t)throw e.state?sn(Ct,"Cached State"):sn(Ct,"Server State");let n,r;try{n=decodeURIComponent(e.state)}catch(o){throw sn(St,e.state)}try{r=decodeURIComponent(t)}catch(o){throw sn(St,e.state)}if(n!==r)throw sn(xt);if(e.error||e.error_description||e.suberror){const t=function(e){var t,n;const r="code=",o=null===(t=e.error_uri)||void 0===t?void 0:t.lastIndexOf(r);return o&&o>=0?null===(n=e.error_uri)||void 0===n?void 0:n.substring(o+r.length):void 0}(e);if(zc(e.error,e.error_description,e.suberror))throw new qc(e.error||"",e.error_description,e.suberror,e.timestamp||"",e.trace_id||"",e.correlation_id||"",e.claims||"",t);throw new Du(e.error||"",e.error_description,e.suberror,t)}}class ad{constructor(e,t,n,r,o){this.authModule=e,this.browserStorage=t,this.authCodeRequest=n,this.logger=r,this.performanceClient=o}async handleCodeResponse(e,t){let n;this.performanceClient.addQueueMeasurement(Zr,t.correlationId);try{n=function(e,t){if(od(e,t),!e.code)throw sn(Yt);return e}(e,t.state)}catch(r){throw r instanceof Du&&r.subError===fi?ns(fi):r}return hc(this.handleCodeResponseFromServer.bind(this),Xr,this.logger,this.performanceClient,t.correlationId)(n,t)}async handleCodeResponseFromServer(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.performanceClient.addQueueMeasurement(Xr,t.correlationId),this.logger.trace("InteractionHandler.handleCodeResponseFromServer called"),this.authCodeRequest.code=e.code,e.cloud_instance_host_name&&await hc(this.authModule.updateAuthority.bind(this.authModule),ro,this.logger,this.performanceClient,t.correlationId)(e.cloud_instance_host_name,t.correlationId),n&&(e.nonce=t.nonce||void 0),e.state=t.state,e.client_info)this.authCodeRequest.clientInfo=e.client_info;else{const e=this.createCcsCredentials(t);e&&(this.authCodeRequest.ccsCredential=e)}return await hc(this.authModule.acquireToken.bind(this.authModule),oo,this.logger,this.performanceClient,t.correlationId)(this.authCodeRequest,e)}createCcsCredentials(e){return e.account?{credential:e.account.homeAccountId,type:Ru}:e.loginHint?{credential:e.loginHint,type:Ou}:null}}const id="user_switch",sd={[id]:"User attempted to switch accounts in the native broker, which is not allowed. All new accounts must sign-in through the standard web flow first, please try again."};class ld extends ht{constructor(e,t,n){super(e,t),Object.setPrototypeOf(this,ld.prototype),this.name="NativeAuthError",this.ext=n}}function cd(e){if(e.ext&&e.ext.status&&"DISABLED"===e.ext.status)return!0;if(e.ext&&e.ext.error&&-2147186943===e.ext.error)return!0;switch(e.errorCode){case"ContentError":case"PageException":return!0;default:return!1}}function ud(e,t,n){if(n&&n.status)switch(n.status){case"ACCOUNT_UNAVAILABLE":return Uc(Mc);case"USER_INTERACTION_REQUIRED":return new qc(e,t);case"USER_CANCEL":return ns(fi);case"NO_NETWORK":return ns(_i);case"UX_NOT_ALLOWED":return Uc(Oc)}return new ld(e,sd[e]||t,n)}class dd extends Fu{constructor(e,t){super(e,t)}async acquireCachedToken(e){var t;null===(t=this.performanceClient)||void 0===t||t.addQueueMeasurement(jr,e.correlationId);let n=$e;if(e.forceRefresh||!this.config.cacheOptions.claimsBasedCachingEnabled&&!Ln.isEmptyObj(e.claims))throw this.setCacheOutcome(Xe,e.correlationId),sn(Vt);if(!e.account)throw sn(Ft);const r=e.account.tenantId||function(e){var t;const n=null===(t=new $n(e).getUrlComponents().PathSegments.slice(-1)[0])||void 0===t?void 0:t.toLowerCase();switch(n){case ie:case se:case le:return;default:return n}}(e.authority),o=this.cacheManager.getTokenKeys(),a=this.cacheManager.getAccessToken(e.account,e,o,r);if(!a)throw this.setCacheOutcome(Ze,e.correlationId),sn(Vt);if(i=a.cachedAt,Number(i)>mc()||yc(a.expiresOn,this.config.systemOptions.tokenRenewalOffsetSeconds))throw this.setCacheOutcome(et,e.correlationId),sn(Vt);var i;a.refreshOn&&yc(a.refreshOn,0)&&(n=tt);const s=e.authority||this.authority.getPreferredCache(),l={account:this.cacheManager.getAccount(this.cacheManager.generateAccountKey(e.account),e.correlationId),accessToken:a,idToken:this.cacheManager.getIdToken(e.account,e.correlationId,o,r,this.performanceClient),refreshToken:null,appMetadata:this.cacheManager.readAppMetadataFromCache(s)};return this.setCacheOutcome(n,e.correlationId),this.config.serverTelemetryManager&&this.config.serverTelemetryManager.incrementCacheHits(),[await hc(this.generateResultFromCacheRecord.bind(this),Dr,this.logger,this.performanceClient,e.correlationId)(l,e),n]}setCacheOutcome(e,t){var n,r;null===(n=this.serverTelemetryManager)||void 0===n||n.setCacheOutcome(e),null===(r=this.performanceClient)||void 0===r||r.addFields({cacheOutcome:e},t),e!==$e&&this.logger.info("Token refresh is required due to cache outcome: ".concat(e))}async generateResultFromCacheRecord(e,t){var n;let r;if(null===(n=this.performanceClient)||void 0===n||n.addQueueMeasurement(Dr,t.correlationId),e.idToken&&(r=Wn(e.idToken.secret,this.config.cryptoInterface.base64Decode)),t.maxAge||0===t.maxAge){var o;const e=null===(o=r)||void 0===o?void 0:o.auth_time;if(!e)throw sn(It);Kn(e,t.maxAge)}return Bu.generateAuthenticationResult(this.cryptoUtils,this.authority,e,!0,t,r)}}class hd extends Zu{async acquireToken(e){this.performanceClient.addQueueMeasurement(br,e.correlationId);const t=this.initializeServerTelemetryManager(Ha),n=await hc(this.getClientConfiguration.bind(this),Qr,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:t,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,account:e.account}),r=new dd(n,this.performanceClient);this.logger.verbose("Silent auth client created");try{const t=(await hc(r.acquireCachedToken.bind(r),jr,this.logger,this.performanceClient,e.correlationId)(e))[0];return this.performanceClient.addFields({fromCache:!0},e.correlationId),t}catch(o){throw o instanceof ts&&o.errorCode===Di&&this.logger.verbose("Signing keypair for bound access token not found. Refreshing bound access token and generating a new crypto keypair."),o}}logout(e){this.logger.verbose("logoutRedirect called");const t=this.initializeLogoutRequest(e);return this.clearCacheOnLogout(t.correlationId,null===t||void 0===t?void 0:t.account)}}const gd=["prompt"],md=["scopes"];class fd extends Yu{constructor(e,t,n,r,o,a,i,s,l,c,u,d){super(e,t,n,r,o,a,s,l,d),this.apiId=i,this.accountId=c,this.platformAuthProvider=l,this.nativeStorageManager=u,this.silentCacheClient=new hd(e,this.nativeStorageManager,n,r,o,a,s,l,d);const h=this.platformAuthProvider.getExtensionName();this.skus=Qu.makeExtraSkuString({libraryName:ca,libraryVersion:Ll,extensionName:h,extensionVersion:this.platformAuthProvider.getExtensionVersion()})}addRequestSKUs(e){e.extraParameters=c(c({},e.extraParameters),{},{[ms]:this.skus})}async acquireToken(e,t){this.performanceClient.addQueueMeasurement(Ar,this.correlationId),this.logger.trace("NativeInteractionClient - acquireToken called.");const n=this.performanceClient.startMeasurement(Ar,this.correlationId),r=mc(),o=this.initializeServerTelemetryManager(this.apiId);try{const i=await this.initializeNativeRequest(e);try{const e=await this.acquireTokensFromCache(this.accountId,i);return n.end({success:!0,isNativeBroker:!1,fromCache:!0}),e}catch(a){if(t===Ja)throw this.logger.info("MSAL internal Cache does not contain tokens, return error as per cache policy"),n.end({success:!1,brokerErrorCode:"cache_request_failed"}),a;this.logger.info("MSAL internal Cache does not contain tokens, proceed to make a native call")}const s=await this.platformAuthProvider.sendMessage(i);return await this.handleNativeResponse(s,i,r).then(e=>(n.end({success:!0,isNativeBroker:!0,requestId:e.requestId}),o.clearNativeBrokerErrorCode(),e)).catch(e=>{throw n.end({success:!1,errorCode:e.errorCode,subErrorCode:e.subError}),e})}catch(a){throw a instanceof ld&&o.setNativeBrokerErrorCode(a.errorCode),n.end({success:!1}),a}}createSilentCacheRequest(e,t){return{authority:e.authority,correlationId:this.correlationId,scopes:Fn.fromString(e.scope).asArray(),account:t,forceRefresh:!1}}async acquireTokensFromCache(e,t){if(!e)throw this.logger.warning("NativeInteractionClient:acquireTokensFromCache - No nativeAccountId provided"),sn(Ut);const n=this.browserStorage.getBaseAccountInfo({nativeAccountId:e},this.correlationId);if(!n)throw sn(Ut);try{const e=this.createSilentCacheRequest(t,n),r=await this.silentCacheClient.acquireToken(e),o=c(c({},n),{},{idTokenClaims:null===r||void 0===r?void 0:r.idTokenClaims,idToken:null===r||void 0===r?void 0:r.idToken});return c(c({},r),{},{account:o})}catch(r){throw r}}async acquireTokenRedirect(e,t){this.logger.trace("NativeInteractionClient - acquireTokenRedirect called.");const n=Object.assign({},(function(e){if(null==e)throw new TypeError("Cannot destructure "+e)}(e),e));delete n.onRedirectNavigate;const r=await this.initializeNativeRequest(n);try{await this.platformAuthProvider.sendMessage(r)}catch(i){if(i instanceof ld){if(this.initializeServerTelemetryManager(this.apiId).setNativeBrokerErrorCode(i.errorCode),cd(i))throw i}}this.browserStorage.setTemporaryCache(Oa,JSON.stringify(r),!0);const o={apiId:La,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},a=this.config.auth.navigateToLoginRequestUrl?window.location.href:this.getRedirectUri(e.redirectUri);t.end({success:!0}),await this.navigationClient.navigateExternal(a,o)}async handleRedirectPromise(e,t){if(this.logger.trace("NativeInteractionClient - handleRedirectPromise called."),!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;const n=this.browserStorage.getCachedNativeRequest();if(!n)return this.logger.verbose("NativeInteractionClient - handleRedirectPromise called but there is no cached request, returning null."),e&&t&&(null===e||void 0===e||e.addFields({errorCode:"no_cached_request"},t)),null;const{prompt:r}=n,o=u(n,gd);r&&this.logger.verbose("NativeInteractionClient - handleRedirectPromise called and prompt was included in the original request, removing prompt from cached request to prevent second interaction with native broker window."),this.browserStorage.removeItem(this.browserStorage.generateCacheKey(Oa));const a=mc();try{this.logger.verbose("NativeInteractionClient - handleRedirectPromise sending message to native broker.");const t=await this.platformAuthProvider.sendMessage(o),n=await this.handleNativeResponse(t,o,a);return this.initializeServerTelemetryManager(this.apiId).clearNativeBrokerErrorCode(),e&&this.correlationId&&this.performanceClient.addFields({isNativeBroker:!0},this.correlationId),n}catch(i){throw i}}logout(){return this.logger.trace("NativeInteractionClient - logout called."),Promise.reject("Logout not implemented yet")}async handleNativeResponse(e,t,n){var r,o;this.logger.trace("NativeInteractionClient - handleNativeResponse called.");const a=Wn(e.id_token,Js),i=this.createHomeAccountIdentifier(e,a),s=null===(r=this.browserStorage.getAccountInfoFilteredBy({nativeAccountId:t.accountId},this.correlationId))||void 0===r?void 0:r.homeAccountId;if(null!==(o=t.extraParameters)&&void 0!==o&&o.child_client_id&&e.account.id!==t.accountId)this.logger.info("handleNativeServerResponse: Double broker flow detected, ignoring accountId mismatch");else if(i!==s&&e.account.id!==t.accountId)throw ud(id);const l=await this.getDiscoveredAuthority({requestAuthority:t.authority}),c=Wu(this.browserStorage,l,i,Js,this.correlationId,a,e.client_info,void 0,a.tid,void 0,e.account.id,this.logger);e.expires_in=Number(e.expires_in);const u=await this.generateAuthenticationResult(e,t,a,c,l.canonicalAuthority,n);return await this.cacheAccount(c,this.correlationId),await this.cacheNativeTokens(e,t,i,a,e.access_token,u.tenantId,n),u}createHomeAccountIdentifier(e,t){return Kc.generateHomeAccountId(e.client_info||H.EMPTY_STRING,sc,this.logger,this.browserCrypto,t)}generateScopes(e,t){return t?Fn.fromString(t):Fn.fromString(e)}async generatePopAccessToken(e,t){if(t.tokenType===Fe.POP&&t.signPopToken){if(e.shr)return this.logger.trace("handleNativeServerResponse: SHR is enabled in native layer"),e.shr;const n=new Uu(this.browserCrypto),r={resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,shrNonce:t.shrNonce};if(!t.keyId)throw sn(Xt);return n.signPopToken(e.access_token,t.keyId,r)}return e.access_token}async generateAuthenticationResult(e,t,n,r,o,a){const i=this.addTelemetryFromNativeResponse(e.properties.MATS),s=this.generateScopes(t.scope,e.scope),l=e.account.properties||{},c=l.UID||n.oid||n.sub||H.EMPTY_STRING,u=l.TenantId||n.tid||H.EMPTY_STRING,d=Bn(r.getAccountInfo(),void 0,n,e.id_token);d.nativeAccountId!==e.account.id&&(d.nativeAccountId=e.account.id);const h=await this.generatePopAccessToken(e,t),g=t.tokenType===Fe.POP?Fe.POP:Fe.BEARER;return{authority:o,uniqueId:c,tenantId:u,scopes:s.asArray(),account:d,idToken:e.id_token,idTokenClaims:n,accessToken:h,fromCache:!!i&&this.isResponseFromCache(i),expiresOn:pc(a+e.expires_in),tokenType:g,correlationId:this.correlationId,state:e.state,fromNativeBroker:!0}}async cacheAccount(e,t){await this.browserStorage.setAccount(e,this.correlationId),this.browserStorage.removeAccountContext(e.getAccountInfo(),t)}cacheNativeTokens(e,t,n,r,o,a,i){const s=bc(n,t.authority,e.id_token||"",t.clientId,r.tid||""),l=i+(t.tokenType===Fe.POP?H.SHR_NONCE_VALIDITY:("string"===typeof e.expires_in?parseInt(e.expires_in,10):e.expires_in)||0),c=this.generateScopes(e.scope,t.scope),u={idToken:s,accessToken:wc(n,t.authority,o,t.clientId,r.tid||a,c.printScopes(),l,0,Js,void 0,t.tokenType,void 0,t.keyId)};return this.nativeStorageManager.saveCacheRecord(u,this.correlationId,t.storeInCache)}getExpiresInValue(e,t){return e===Fe.POP?H.SHR_NONCE_VALIDITY:("string"===typeof t?parseInt(t,10):t)||0}addTelemetryFromNativeResponse(e){const t=this.getMATSFromResponse(e);return t?(this.performanceClient.addFields({extensionId:this.platformAuthProvider.getExtensionId(),extensionVersion:this.platformAuthProvider.getExtensionVersion(),matsBrokerVersion:t.broker_version,matsAccountJoinOnStart:t.account_join_on_start,matsAccountJoinOnEnd:t.account_join_on_end,matsDeviceJoin:t.device_join,matsPromptBehavior:t.prompt_behavior,matsApiErrorCode:t.api_error_code,matsUiVisible:t.ui_visible,matsSilentCode:t.silent_code,matsSilentBiSubCode:t.silent_bi_sub_code,matsSilentMessage:t.silent_message,matsSilentStatus:t.silent_status,matsHttpStatus:t.http_status,matsHttpEventCount:t.http_event_count},this.correlationId),t):null}getMATSFromResponse(e){if(e)try{return JSON.parse(e)}catch(t){this.logger.error("NativeInteractionClient - Error parsing MATS telemetry, returning null instead")}return null}isResponseFromCache(e){return"undefined"===typeof e.is_cached?(this.logger.verbose("NativeInteractionClient - MATS telemetry does not contain field indicating if response was served from cache. Returning false."),!1):!!e.is_cached}async initializeNativeRequest(e){this.logger.trace("NativeInteractionClient - initializeNativeRequest called");const t=await this.getCanonicalAuthority(e),{scopes:n}=e,r=u(e,md),o=new Fn(n||[]);o.appendScopes($);const a=c(c({},r),{},{accountId:this.accountId,clientId:this.config.auth.clientId,authority:t.urlString,scope:o.printScopes(),redirectUri:this.getRedirectUri(e.redirectUri),prompt:this.getPrompt(e.prompt),correlationId:this.correlationId,tokenType:e.authenticationScheme,windowTitleSubstring:document.title,extraParameters:c(c({},e.extraQueryParameters),e.tokenQueryParameters),extendedExpiryToken:!1,keyId:e.popKid});if(a.signPopToken&&e.popKid)throw ns(Qi);if(this.handleExtraBrokerParams(a),a.extraParameters=a.extraParameters||{},a.extraParameters.telemetry=ha,e.authenticationScheme===Fe.POP){const t={resourceRequestUri:e.resourceRequestUri,resourceRequestMethod:e.resourceRequestMethod,shrClaims:e.shrClaims,shrNonce:e.shrNonce},n=new Uu(this.browserCrypto);let r;if(a.keyId)r=this.browserCrypto.base64UrlEncode(JSON.stringify({kid:a.keyId})),a.signPopToken=!1;else{const e=await hc(n.generateCnf.bind(n),so,this.logger,this.performanceClient,this.correlationId)(t,this.logger);r=e.reqCnfString,a.keyId=e.kid,a.signPopToken=!0}a.reqCnf=r}return this.addRequestSKUs(a),a}async getCanonicalAuthority(e){const t=e.authority||this.config.auth.authority;e.account&&await this.getDiscoveredAuthority({requestAuthority:t,requestAzureCloudOptions:e.azureCloudOptions,account:e.account});const n=new $n(t);return n.validateAsUri(),n}getPrompt(e){switch(this.apiId){case qa:case Ha:return this.logger.trace("initializeNativeRequest: silent request sets prompt to none"),me}if(e)switch(e){case me:case ge:case de:case he:return this.logger.trace("initializeNativeRequest: prompt is compatible with native flow"),e;default:throw this.logger.trace("initializeNativeRequest: prompt = ".concat(e," is not compatible with native flow")),ns(Vi)}else this.logger.trace("initializeNativeRequest: prompt was not provided")}handleExtraBrokerParams(e){var t;const n=e.extraParameters&&e.extraParameters.hasOwnProperty(fs)&&e.extraParameters.hasOwnProperty(ps)&&e.extraParameters.hasOwnProperty(cs);if(!e.embeddedClientId&&!n)return;let r="";const o=e.redirectUri;e.embeddedClientId?(e.redirectUri=this.config.auth.redirectUri,r=e.embeddedClientId):e.extraParameters&&(e.redirectUri=e.extraParameters[ps],r=e.extraParameters[cs]),e.extraParameters={child_client_id:r,child_redirect_uri:o},null===(t=this.performanceClient)||void 0===t||t.addFields({embeddedClientId:r,embeddedRedirectUri:o},this.correlationId)}}async function pd(e,t,n,r,o){const a=nd(c(c({},e.auth),{},{authority:t}),n,r,o);if(Es(a,{sku:ca,version:Ll,os:"",cpu:""}),e.auth.protocolMode!==it&&Ns(a,e.telemetry.application),n.platformBroker&&(function(e){e.set("nativebroker","1")}(a),o.addFields({isPlatformAuthorizeRequest:!0},n.correlationId),n.authenticationScheme===Fe.POP)){const e=new ac(r,o),t=new Uu(e);let i;if(n.popKid)i=e.encodeKid(n.popKid);else{i=(await hc(t.generateCnf.bind(t),so,r,o,n.correlationId)(n,r)).reqCnfString}Us(a,i)}return vs(a,n.correlationId,o),a}async function yd(e,t,n,r,o){if(!n.codeChallenge)throw Dn(kn);const a=await hc(pd,$r,r,o,n.correlationId)(e,t,n,r,o);return bs(a,pe),Ms(a,n.codeChallenge,H.S256_CODE_CHALLENGE_METHOD),qs(a,n.extraQueryParameters||{}),rd(t,a,e.auth.encodeExtraQueryParams,n.extraQueryParameters)}async function vd(e,t,n,r,o,a){if(!r.earJwk)throw ns(ri);const i=await pd(t,n,r,o,a);bs(i,ye),function(e,t){e.set("ear_jwk",encodeURIComponent(t)),e.set("ear_jwe_crypto","eyJhbGciOiJkaXIiLCJlbmMiOiJBMjU2R0NNIn0")}(i,r.earJwk);const s=new Map;qs(s,r.extraQueryParameters||{});return wd(e,rd(n,s,t.auth.encodeExtraQueryParams,r.extraQueryParameters),i)}async function bd(e,t,n,r,o,a){const i=await pd(t,n,r,o,a);bs(i,pe),Ms(i,r.codeChallenge,r.codeChallengeMethod||H.S256_CODE_CHALLENGE_METHOD),function(e,t){Object.entries(t).forEach(t=>{let[n,r]=t;r&&e.set(n,r)})}(i,r.authorizePostBodyParameters||{});const s=new Map;qs(s,r.extraQueryParameters||{});return wd(e,rd(n,s,t.auth.encodeExtraQueryParams,r.extraQueryParameters),i)}function wd(e,t,n){const r=e.createElement("form");return r.method="post",r.action=t,n.forEach((t,n)=>{const o=e.createElement("input");o.hidden=!0,o.name=n,o.value=t,r.appendChild(o)}),e.body.appendChild(r),r}async function kd(e,t,n,r,o,a,i,s,l,u){if(s.verbose("Account id found, calling WAM for token"),!u)throw ns(Wi);const d=new ac(s,l),h=new fd(r,o,d,s,i,r.system.navigationClient,n,l,u,t,a,e.correlationId),{userRequestState:g}=qu.parseRequestState(d,e.state);return hc(h.acquireToken.bind(h),Ar,s,l,e.correlationId)(c(c({},e),{},{state:g,prompt:void 0}))}async function Sd(e,t,n,r,o,a,i,s,l,u,d,h){if(Lu.removeThrottle(i,o.auth.clientId,e),t.accountId)return hc(kd,to,u,d,e.correlationId)(e,t.accountId,r,o,i,s,l,u,d,h);const g=c(c({},e),{},{code:t.code||"",codeVerifier:n}),m=new ad(a,i,g,u,d);return await hc(m.handleCodeResponse.bind(m),Zr,u,d,e.correlationId)(t,e)}async function xd(e,t,n,r,o,a,i,s,l,c,u){if(Lu.removeThrottle(a,r.auth.clientId,e),od(t,e.state),!t.ear_jwe)throw ns(oi);if(!e.earJwk)throw ns(ri);const d=JSON.parse(await hc(ml,Wo,l,c,e.correlationId)(e.earJwk,t.ear_jwe));if(d.accountId)return hc(kd,to,l,c,e.correlationId)(e,d.accountId,n,r,a,i,s,l,c,u);const h=new Bu(r.auth.clientId,a,new ac(l,c),l,null,null,c);h.validateTokenResponse(d);const g={code:"",state:e.state,nonce:e.nonce,client_info:d.client_info,cloud_graph_host_name:d.cloud_graph_host_name,cloud_instance_host_name:d.cloud_instance_host_name,cloud_instance_name:d.cloud_instance_name,msgraph_host:d.msgraph_host};return await hc(h.handleServerTokenResponse.bind(h),co,l,c,e.correlationId)(d,o,mc(),e,g,void 0,void 0,void 0,void 0)}async function Cd(e,t,n){e.addQueueMeasurement(Mo,n);const r=dc(Ad,Ro,t,e,n)(e,t,n);return{verifier:r,challenge:await hc(Id,Oo,t,e,n)(r,e,t,n)}}function Ad(e,t,n){try{const r=new Uint8Array(32);dc(cl,Do,t,e,n)(r);return Gs(r)}catch(r){throw ns(ni)}}async function Id(e,t,n,r){t.addQueueMeasurement(Oo,r);try{const o=await hc(ll,jo,n,t,r)(e,t,r);return Gs(new Uint8Array(o))}catch(o){throw ns(ni)}}class Td{constructor(e,t,n,r){this.logger=e,this.handshakeTimeoutMs=t,this.extensionId=r,this.resolvers=new Map,this.handshakeResolvers=new Map,this.messageChannel=new MessageChannel,this.windowListener=this.onWindowMessage.bind(this),this.performanceClient=n,this.handshakeEvent=n.startMeasurement(Ao),this.platformAuthType=ya}async sendMessage(e){this.logger.trace(this.platformAuthType+" - sendMessage called.");const t={method:wa,request:e},n={channel:ua,extensionId:this.extensionId,responseId:dl(),body:t};this.logger.trace(this.platformAuthType+" - Sending request to browser extension"),this.logger.tracePii(this.platformAuthType+" - Sending request to browser extension: ".concat(JSON.stringify(n))),this.messageChannel.port1.postMessage(n);const r=await new Promise((e,t)=>{this.resolvers.set(n.responseId,{resolve:e,reject:t})});return this.validatePlatformBrokerResponse(r)}static async createProvider(e,t,n){e.trace("PlatformAuthExtensionHandler - createProvider called.");try{const r=new Td(e,t,n,da);return await r.sendHandshakeRequest(),r}catch(r){const o=new Td(e,t,n);return await o.sendHandshakeRequest(),o}}async sendHandshakeRequest(){this.logger.trace(this.platformAuthType+" - sendHandshakeRequest called."),window.addEventListener("message",this.windowListener,!1);const e={channel:ua,extensionId:this.extensionId,responseId:dl(),body:{method:va}};return this.handshakeEvent.add({extensionId:this.extensionId,extensionHandshakeTimeoutMs:this.handshakeTimeoutMs}),this.messageChannel.port1.onmessage=e=>{this.onChannelMessage(e)},window.postMessage(e,window.origin,[this.messageChannel.port2]),new Promise((t,n)=>{this.handshakeResolvers.set(e.responseId,{resolve:t,reject:n}),this.timeoutId=window.setTimeout(()=>{window.removeEventListener("message",this.windowListener,!1),this.messageChannel.port1.close(),this.messageChannel.port2.close(),this.handshakeEvent.end({extensionHandshakeTimedOut:!0,success:!1}),n(ns(Hi)),this.handshakeResolvers.delete(e.responseId)},this.handshakeTimeoutMs)})}onWindowMessage(e){if(this.logger.trace(this.platformAuthType+" - onWindowMessage called"),e.source!==window)return;const t=e.data;if(t.channel&&t.channel===ua&&(!t.extensionId||t.extensionId===this.extensionId)&&t.body.method===va){const e=this.handshakeResolvers.get(t.responseId);if(!e)return void this.logger.trace(this.platformAuthType+".onWindowMessage - resolver can't be found for request ".concat(t.responseId));this.logger.verbose(t.extensionId?"Extension with id: ".concat(t.extensionId," not installed"):"No extension installed"),clearTimeout(this.timeoutId),this.messageChannel.port1.close(),this.messageChannel.port2.close(),window.removeEventListener("message",this.windowListener,!1),this.handshakeEvent.end({success:!1,extensionInstalled:!1}),e.reject(ns(Bi))}}onChannelMessage(e){this.logger.trace(this.platformAuthType+" - onChannelMessage called.");const t=e.data,n=this.resolvers.get(t.responseId),r=this.handshakeResolvers.get(t.responseId);try{const e=t.body.method;if(e===ka){if(!n)return;const e=t.body.response;if(this.logger.trace(this.platformAuthType+" - Received response from browser extension"),this.logger.tracePii(this.platformAuthType+" - Received response from browser extension: ".concat(JSON.stringify(e))),"Success"!==e.status)n.reject(ud(e.code,e.description,e.ext));else{if(!e.result)throw gt(ct,"Event does not contain result.");e.result.code&&e.result.description?n.reject(ud(e.result.code,e.result.description,e.result.ext)):n.resolve(e.result)}this.resolvers.delete(t.responseId)}else if(e===ba){if(!r)return void this.logger.trace(this.platformAuthType+".onChannelMessage - resolver can't be found for request ".concat(t.responseId));clearTimeout(this.timeoutId),window.removeEventListener("message",this.windowListener,!1),this.extensionId=t.extensionId,this.extensionVersion=t.body.version,this.logger.verbose(this.platformAuthType+" - Received HandshakeResponse from extension: ".concat(this.extensionId)),this.handshakeEvent.end({extensionInstalled:!0,success:!0}),r.resolve(),this.handshakeResolvers.delete(t.responseId)}}catch(o){this.logger.error("Error parsing response from WAM Extension"),this.logger.errorPii("Error parsing response from WAM Extension: ".concat(o)),this.logger.errorPii("Unable to parse ".concat(e)),n?n.reject(o):r&&r.reject(o)}}validatePlatformBrokerResponse(e){if(e.hasOwnProperty("access_token")&&e.hasOwnProperty("id_token")&&e.hasOwnProperty("client_info")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scope")&&e.hasOwnProperty("expires_in"))return e;throw gt(ct,"Response missing expected properties.")}getExtensionId(){return this.extensionId}getExtensionVersion(){return this.extensionVersion}getExtensionName(){var e;return this.getExtensionId()===da?"chrome":null!==(e=this.getExtensionId())&&void 0!==e&&e.length?"unknown":void 0}}const Pd=["accountId","clientId","authority","scope","redirectUri","correlationId","state","storeInCache","embeddedClientId","extraParameters"];class Ed{constructor(e,t,n){this.logger=e,this.performanceClient=t,this.correlationId=n,this.platformAuthType=pa}static async createProvider(e,t,n){var r;if(e.trace("PlatformAuthDOMHandler: createProvider called"),null!==(r=window.navigator)&&void 0!==r&&r.platformAuthentication){const r=await window.navigator.platformAuthentication.getSupportedContracts(ga);if(null!==r&&void 0!==r&&r.includes(fa))return e.trace("Platform auth api available in DOM"),new Ed(e,t,n)}}getExtensionId(){return ga}getExtensionVersion(){return""}getExtensionName(){return ma}async sendMessage(e){this.logger.trace(this.platformAuthType+" - Sending request to browser DOM API");try{const t=this.initializePlatformDOMRequest(e),n=await window.navigator.platformAuthentication.executeGetToken(t);return this.validatePlatformBrokerResponse(n)}catch(t){throw this.logger.error(this.platformAuthType+" - executeGetToken DOM API error"),t}}initializePlatformDOMRequest(e){this.logger.trace(this.platformAuthType+" - initializeNativeDOMRequest called");const{accountId:t,clientId:n,authority:r,scope:o,redirectUri:a,correlationId:i,state:s,storeInCache:l,embeddedClientId:d,extraParameters:h}=e,g=u(e,Pd),m=this.getDOMExtraParams(g);return{accountId:t,brokerId:this.getExtensionId(),authority:r,clientId:n,correlationId:i||this.correlationId,extraParameters:c(c({},h),m),isSecurityTokenService:!1,redirectUri:a,scope:o,state:s,storeInCache:l,embeddedClientId:d}}validatePlatformBrokerResponse(e){if(e.hasOwnProperty("isSuccess")){if(e.hasOwnProperty("accessToken")&&e.hasOwnProperty("idToken")&&e.hasOwnProperty("clientInfo")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scopes")&&e.hasOwnProperty("expiresIn"))return this.logger.trace(this.platformAuthType+" - platform broker returned successful and valid response"),this.convertToPlatformBrokerResponse(e);if(e.hasOwnProperty("error")){const t=e;if(!1===t.isSuccess&&t.error&&t.error.code)throw this.logger.trace(this.platformAuthType+" - platform broker returned error response"),ud(t.error.code,t.error.description,{error:parseInt(t.error.errorCode),protocol_error:t.error.protocolError,status:t.error.status,properties:t.error.properties})}}throw gt(ct,"Response missing expected properties.")}convertToPlatformBrokerResponse(e){var t;this.logger.trace(this.platformAuthType+" - convertToNativeResponse called");return{access_token:e.accessToken,id_token:e.idToken,client_info:e.clientInfo,account:e.account,expires_in:e.expiresIn,scope:e.scopes,state:e.state||"",properties:e.properties||{},extendedLifetimeToken:null!==(t=e.extendedLifetimeToken)&&void 0!==t&&t,shr:e.proofOfPossessionPayload}}getDOMExtraParams(e){return c({},Object.entries(e).reduce((e,t)=>{let[n,r]=t;return e[n]=String(r),e},{}))}}async function Nd(e,t,n,r){e.trace("getPlatformAuthProvider called",n);const o=function(){let e;try{var t;return e=window[xa],"true"===(null===(t=e)||void 0===t?void 0:t.getItem(Hl))}catch(n){return!1}}();let a;e.trace("Has client allowed platform auth via DOM API: "+o);try{o&&(a=await Ed.createProvider(e,t,n)),a||(e.trace("Platform auth via DOM API not available, checking for extension"),a=await Td.createProvider(e,r||2e3,t))}catch(i){e.trace("Platform auth not available",i)}return a}function _d(e,t,n,r){if(t.trace("isPlatformAuthAllowed called"),!e.system.allowPlatformBroker)return t.trace("isPlatformAuthAllowed: allowPlatformBroker is not enabled, returning false"),!1;if(!n)return t.trace("isPlatformAuthAllowed: Platform auth provider is not initialized, returning false"),!1;if(r)switch(r){case Fe.BEARER:case Fe.POP:return t.trace("isPlatformAuthAllowed: authenticationScheme is supported, returning true"),!0;default:return t.trace("isPlatformAuthAllowed: authenticationScheme is not supported, returning false"),!1}return!0}class Md extends Zu{constructor(e,t,n,r,o,a,i,s,l,c){super(e,t,n,r,o,a,i,l,c),this.unloadWindow=this.unloadWindow.bind(this),this.nativeStorage=s,this.eventHandler=o}acquireToken(e,t){let n;try{var r;if(n={popupName:this.generatePopupName(e.scopes||$,e.authority||this.config.auth.authority),popupWindowAttributes:e.popupWindowAttributes||{},popupWindowParent:null!==(r=e.popupWindowParent)&&void 0!==r?r:window},this.performanceClient.addFields({isAsyncPopup:this.config.system.asyncPopups},this.correlationId),this.config.system.asyncPopups)return this.logger.verbose("asyncPopups set to true, acquiring token"),this.acquireTokenPopupAsync(e,n,t);{const r=c(c({},e),{},{httpMethod:Xu(e,this.config.auth.protocolMode)});return this.logger.verbose("asyncPopup set to false, opening popup before acquiring token"),n.popup=this.openSizedPopup("about:blank",n),this.acquireTokenPopupAsync(r,n,t)}}catch(o){return Promise.reject(o)}}logout(e){try{var t;this.logger.verbose("logoutPopup called");const n=this.initializeLogoutRequest(e),r={popupName:this.generateLogoutPopupName(n),popupWindowAttributes:(null===e||void 0===e?void 0:e.popupWindowAttributes)||{},popupWindowParent:null!==(t=null===e||void 0===e?void 0:e.popupWindowParent)&&void 0!==t?t:window},o=e&&e.authority,a=e&&e.mainWindowRedirectUri;return this.config.system.asyncPopups?(this.logger.verbose("asyncPopups set to true"),this.logoutPopupAsync(n,r,o,a)):(this.logger.verbose("asyncPopup set to false, opening popup"),r.popup=this.openSizedPopup("about:blank",r),this.logoutPopupAsync(n,r,o,a))}catch(n){return Promise.reject(n)}}async acquireTokenPopupAsync(e,t,n){this.logger.verbose("acquireTokenPopupAsync called");const r=await hc(this.initializeAuthorizationRequest.bind(this),Yr,this.logger,this.performanceClient,this.correlationId)(e,Ka.Popup);t.popup&&jl(r.authority);const o=_d(this.config,this.logger,this.platformAuthProvider,e.authenticationScheme);return r.platformBroker=o,this.config.auth.protocolMode===st?this.executeEarFlow(r,t):this.executeCodeFlow(r,t,n)}async executeCodeFlow(e,t,n){const r=e.correlationId,o=this.initializeServerTelemetryManager(Fa),a=n||await hc(Cd,Mo,this.logger,this.performanceClient,r)(this.performanceClient,this.logger,r),i=c(c({},e),{},{codeChallenge:a.challenge});try{const n=await hc(this.createAuthCodeClient.bind(this),Gr,this.logger,this.performanceClient,r)({serverTelemetryManager:o,requestAuthority:i.authority,requestAzureCloudOptions:i.azureCloudOptions,requestExtraQueryParameters:i.extraQueryParameters,account:i.account});if(i.httpMethod===J)return await this.executeCodeFlowWithPost(i,t,n,a.verifier);{const o=await hc(yd,Jr,this.logger,this.performanceClient,r)(this.config,n.authority,i,this.logger,this.performanceClient),s=this.initiateAuthRequest(o,t);this.eventHandler.emitEvent(xu,Ka.Popup,{popupWindow:s},null);const l=await this.monitorPopupForHash(s,t.popupWindowParent),c=dc(ed,uo,this.logger,this.performanceClient,this.correlationId)(l,this.config.auth.OIDCOptions.serverResponseType,this.logger);return await hc(Sd,no,this.logger,this.performanceClient,r)(e,c,a.verifier,Fa,this.config,n,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}}catch(l){var s;throw null===(s=t.popup)||void 0===s||s.close(),l instanceof ht&&(l.setCorrelationId(this.correlationId),o.cacheFailedRequest(l)),l}}async executeEarFlow(e,t){const n=e.correlationId,r=await hc(this.getDiscoveredAuthority.bind(this),Cr,this.logger,this.performanceClient,n)({requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),o=await hc(gl,Bo,this.logger,this.performanceClient,n)(),a=c(c({},e),{},{earJwk:o}),i=t.popup||this.openPopup("about:blank",t);(await vd(i.document,this.config,r,a,this.logger,this.performanceClient)).submit();const s=await hc(this.monitorPopupForHash.bind(this),Wr,this.logger,this.performanceClient,n)(i,t.popupWindowParent),l=dc(ed,uo,this.logger,this.performanceClient,this.correlationId)(s,this.config.auth.OIDCOptions.serverResponseType,this.logger);return hc(xd,eo,this.logger,this.performanceClient,n)(a,l,Fa,this.config,r,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}async executeCodeFlowWithPost(e,t,n,r){const o=e.correlationId,a=await hc(this.getDiscoveredAuthority.bind(this),Cr,this.logger,this.performanceClient,o)({requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),i=t.popup||this.openPopup("about:blank",t);(await bd(i.document,this.config,a,e,this.logger,this.performanceClient)).submit();const s=await hc(this.monitorPopupForHash.bind(this),Wr,this.logger,this.performanceClient,o)(i,t.popupWindowParent),l=dc(ed,uo,this.logger,this.performanceClient,this.correlationId)(s,this.config.auth.OIDCOptions.serverResponseType,this.logger);return hc(Sd,no,this.logger,this.performanceClient,o)(e,l,r,Fa,this.config,n,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}async logoutPopupAsync(e,t,n,r){this.logger.verbose("logoutPopupAsync called"),this.eventHandler.emitEvent(Cu,Ka.Popup,e);const o=this.initializeServerTelemetryManager(Wa);try{await this.clearCacheOnLogout(this.correlationId,e.account);const s=await hc(this.createAuthCodeClient.bind(this),Gr,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:o,requestAuthority:n,account:e.account||void 0});try{s.authority.endSessionEndpoint}catch(l){var a;if(null!==(a=e.account)&&void 0!==a&&a.homeAccountId&&e.postLogoutRedirectUri&&s.authority.protocolMode===it){var i;if(this.eventHandler.emitEvent(Au,Ka.Popup,e),r){const e={apiId:Wa,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},t=$n.getAbsoluteUrl(r,El());await this.navigationClient.navigateInternal(t,e)}return void(null===(i=t.popup)||void 0===i||i.close())}}const c=s.getLogoutUri(e);this.eventHandler.emitEvent(Au,Ka.Popup,e);const u=this.openPopup(c,t);if(this.eventHandler.emitEvent(xu,Ka.Popup,{popupWindow:u},null),await this.monitorPopupForHash(u,t.popupWindowParent).catch(()=>{}),r){const e={apiId:Wa,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},t=$n.getAbsoluteUrl(r,El());this.logger.verbose("Redirecting main window to url specified in the request"),this.logger.verbosePii("Redirecting main window to: ".concat(t)),await this.navigationClient.navigateInternal(t,e)}else this.logger.verbose("No main window navigation requested")}catch(c){var s;throw null===(s=t.popup)||void 0===s||s.close(),c instanceof ht&&(c.setCorrelationId(this.correlationId),o.cacheFailedRequest(c)),this.eventHandler.emitEvent(Iu,Ka.Popup,null,c),this.eventHandler.emitEvent(Tu,Ka.Popup),c}this.eventHandler.emitEvent(Tu,Ka.Popup)}initiateAuthRequest(e,t){if(e)return this.logger.infoPii("Navigate to: ".concat(e)),this.openPopup(e,t);throw this.logger.error("Navigate url is empty"),ns(ii)}monitorPopupForHash(e,t){return new Promise((t,n)=>{this.logger.verbose("PopupHandler.monitorPopupForHash - polling started");const r=setInterval(()=>{if(e.closed)return this.logger.error("PopupHandler.monitorPopupForHash - window closed"),clearInterval(r),void n(ns(fi));let o="";try{o=e.location.href}catch(s){}if(!o||"about:blank"===o)return;clearInterval(r);let a="";const i=this.config.auth.OIDCOptions.serverResponseType;e&&(a=i===ve?e.location.search:e.location.hash),this.logger.verbose("PopupHandler.monitorPopupForHash - popup window is on same origin as caller"),t(a)},this.config.system.pollIntervalMilliseconds)}).finally(()=>{this.cleanPopup(e,t)})}openPopup(e,t){try{let n;if(t.popup?(n=t.popup,this.logger.verbosePii("Navigating popup window to: ".concat(e)),n.location.assign(e)):"undefined"===typeof t.popup&&(this.logger.verbosePii("Opening popup window to: ".concat(e)),n=this.openSizedPopup(e,t)),!n)throw ns(mi);return n.focus&&n.focus(),this.currentWindow=n,t.popupWindowParent.addEventListener("beforeunload",this.unloadWindow),n}catch(n){throw this.logger.error("error opening popup "+n.message),ns(gi)}}openSizedPopup(e,t){var n,r,o,a;let{popupName:i,popupWindowAttributes:s,popupWindowParent:l}=t;const c=l.screenLeft?l.screenLeft:l.screenX,u=l.screenTop?l.screenTop:l.screenY,d=l.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,h=l.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;let g=null===(n=s.popupSize)||void 0===n?void 0:n.width,m=null===(r=s.popupSize)||void 0===r?void 0:r.height,f=null===(o=s.popupPosition)||void 0===o?void 0:o.top,p=null===(a=s.popupPosition)||void 0===a?void 0:a.left;return(!g||g<0||g>d)&&(this.logger.verbose("Default popup window width used. Window width not configured or invalid."),g=aa),(!m||m<0||m>h)&&(this.logger.verbose("Default popup window height used. Window height not configured or invalid."),m=ia),(!f||f<0||f>h)&&(this.logger.verbose("Default popup window top position used. Window top not configured or invalid."),f=Math.max(0,h/2-ia/2+u)),(!p||p<0||p>d)&&(this.logger.verbose("Default popup window left position used. Window left not configured or invalid."),p=Math.max(0,d/2-aa/2+c)),l.open(e,i,"width=".concat(g,", height=").concat(m,", top=").concat(f,", left=").concat(p,", scrollbars=yes"))}unloadWindow(e){this.currentWindow&&this.currentWindow.close(),e.preventDefault()}cleanPopup(e,t){e.close(),t.removeEventListener("beforeunload",this.unloadWindow)}generatePopupName(e,t){return"".concat(sa,".").concat(this.config.auth.clientId,".").concat(e.join("-"),".").concat(t,".").concat(this.correlationId)}generateLogoutPopupName(e){const t=e.account&&e.account.homeAccountId;return"".concat(sa,".").concat(this.config.auth.clientId,".").concat(t,".").concat(this.correlationId)}}class Rd extends Zu{constructor(e,t,n,r,o,a,i,s,l,c){super(e,t,n,r,o,a,i,l,c),this.nativeStorage=s}async acquireToken(e){const t=await hc(this.initializeAuthorizationRequest.bind(this),Yr,this.logger,this.performanceClient,this.correlationId)(e,Ka.Redirect);t.platformBroker=_d(this.config,this.logger,this.platformAuthProvider,e.authenticationScheme);const n=e=>{e.persisted&&(this.logger.verbose("Page was restored from back/forward cache. Clearing temporary cache."),this.browserStorage.resetRequestCache(),this.eventHandler.emitEvent(Pu,Ka.Redirect))},r=this.getRedirectStartPage(e.redirectStartPage);this.logger.verbosePii("Redirect start page: ".concat(r)),this.browserStorage.setTemporaryCache(Ea,r,!0),window.addEventListener("pageshow",n);try{this.config.auth.protocolMode===st?await this.executeEarFlow(t):await this.executeCodeFlow(t,e.onRedirectNavigate)}catch(o){throw o instanceof ht&&o.setCorrelationId(this.correlationId),window.removeEventListener("pageshow",n),o}}async executeCodeFlow(e,t){const n=e.correlationId,r=this.initializeServerTelemetryManager(La),o=await hc(Cd,Mo,this.logger,this.performanceClient,n)(this.performanceClient,this.logger,n),a=c(c({},e),{},{codeChallenge:o.challenge});this.browserStorage.cacheAuthorizeRequest(a,o.verifier);try{if(a.httpMethod===J)return await this.executeCodeFlowWithPost(a);{const n=await hc(this.createAuthCodeClient.bind(this),Gr,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:r,requestAuthority:a.authority,requestAzureCloudOptions:a.azureCloudOptions,requestExtraQueryParameters:a.extraQueryParameters,account:a.account}),o=await hc(yd,Jr,this.logger,this.performanceClient,e.correlationId)(this.config,n.authority,a,this.logger,this.performanceClient);return await this.initiateAuthRequest(o,t)}}catch(i){throw i instanceof ht&&(i.setCorrelationId(this.correlationId),r.cacheFailedRequest(i)),i}}async executeEarFlow(e){const t=e.correlationId,n=await hc(this.getDiscoveredAuthority.bind(this),Cr,this.logger,this.performanceClient,t)({requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),r=await hc(gl,Bo,this.logger,this.performanceClient,t)(),o=c(c({},e),{},{earJwk:r});this.browserStorage.cacheAuthorizeRequest(o);return(await vd(document,this.config,n,o,this.logger,this.performanceClient)).submit(),new Promise((e,t)=>{setTimeout(()=>{t(ns(Xi,"failed_to_redirect"))},this.config.system.redirectNavigationTimeout)})}async executeCodeFlowWithPost(e){const t=e.correlationId,n=await hc(this.getDiscoveredAuthority.bind(this),Cr,this.logger,this.performanceClient,t)({requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account});this.browserStorage.cacheAuthorizeRequest(e);return(await bd(document,this.config,n,e,this.logger,this.performanceClient)).submit(),new Promise((e,t)=>{setTimeout(()=>{t(ns(Xi,"failed_to_redirect"))},this.config.system.redirectNavigationTimeout)})}async handleRedirectPromise(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;const o=this.initializeServerTelemetryManager(za);try{const[a,i]=this.getRedirectResponse(e||"");if(!a)return this.logger.info("handleRedirectPromise did not detect a response as a result of a redirect. Cleaning temporary cache."),this.browserStorage.resetRequestCache(),"back_forward"!==function(){if("undefined"===typeof window||"undefined"===typeof window.performance||"function"!==typeof window.performance.getEntriesByType)return;const e=window.performance.getEntriesByType("navigation"),t=e.length?e[0]:void 0;return null===t||void 0===t?void 0:t.type}()?r.event.errorCode="no_server_response":this.logger.verbose("Back navigation event detected. Muting no_server_response error"),null;const s=this.browserStorage.getTemporaryCache(Ea,!0)||H.EMPTY_STRING,l=Jn(s);if(l===Jn(window.location.href)&&this.config.auth.navigateToLoginRequestUrl){this.logger.verbose("Current page is loginRequestUrl, handling response"),s.indexOf("#")>-1&&function(e){const t=e.split("#");t.shift(),window.location.hash=t.length>0?t.join("#"):""}(s);return await this.handleResponse(a,t,n,o)}if(!this.config.auth.navigateToLoginRequestUrl)return this.logger.verbose("NavigateToLoginRequestUrl set to false, handling response"),await this.handleResponse(a,t,n,o);if(!Pl()||this.config.system.allowRedirectInIframe){this.browserStorage.setTemporaryCache(Na,i,!0);const e={apiId:za,timeout:this.config.system.redirectNavigationTimeout,noHistory:!0};let r=!0;if(s&&"null"!==s)this.logger.verbose("Navigating to loginRequestUrl: ".concat(s)),r=await this.navigationClient.navigateInternal(s,e);else{const t=function(){const e=new $n(window.location.href).getUrlComponents();return"".concat(e.Protocol,"//").concat(e.HostNameAndPort,"/")}();this.browserStorage.setTemporaryCache(Ea,t,!0),this.logger.warning("Unable to get valid login request url from cache, redirecting to home page"),r=await this.navigationClient.navigateInternal(t,e)}if(!r)return await this.handleResponse(a,t,n,o)}return null}catch(a){throw a instanceof ht&&(a.setCorrelationId(this.correlationId),o.cacheFailedRequest(a)),a}}getRedirectResponse(e){this.logger.verbose("getRedirectResponseHash called");let t=e;t||(t=this.config.auth.OIDCOptions.serverResponseType===ve?window.location.search:window.location.hash);let n=Qn(t);if(n){try{td(n,this.browserCrypto,Ka.Redirect)}catch(o){return o instanceof ht&&this.logger.error("Interaction type validation failed due to ".concat(o.errorCode,": ").concat(o.errorMessage)),[null,""]}return Tl(window),this.logger.verbose("Hash contains known properties, returning response hash"),[n,t]}const r=this.browserStorage.getTemporaryCache(Na,!0);return this.browserStorage.removeItem(this.browserStorage.generateCacheKey(Na)),r&&(n=Qn(r),n)?(this.logger.verbose("Hash does not contain known properties, returning cached hash"),[n,r]):[null,""]}async handleResponse(e,t,n,r){if(!e.state)throw ns(li);if(e.ear_jwe){const n=await hc(this.getDiscoveredAuthority.bind(this),Cr,this.logger,this.performanceClient,t.correlationId)({requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account});return hc(xd,eo,this.logger,this.performanceClient,t.correlationId)(t,e,La,this.config,n,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}const o=await hc(this.createAuthCodeClient.bind(this),Gr,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:r,requestAuthority:t.authority});return hc(Sd,no,this.logger,this.performanceClient,t.correlationId)(t,e,n,La,this.config,o,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}async initiateAuthRequest(e,t){if(this.logger.verbose("RedirectHandler.initiateAuthRequest called"),e){this.logger.infoPii("RedirectHandler.initiateAuthRequest: Navigate to: ".concat(e));const n={apiId:La,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},r=t||this.config.auth.onRedirectNavigate;if("function"===typeof r){this.logger.verbose("RedirectHandler.initiateAuthRequest: Invoking onRedirectNavigate callback");return!1!==r(e)?(this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate did not return false, navigating"),void await this.navigationClient.navigateExternal(e,n)):void this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate returned false, stopping navigation")}return this.logger.verbose("RedirectHandler.initiateAuthRequest: Navigating window to navigate url"),void await this.navigationClient.navigateExternal(e,n)}throw this.logger.info("RedirectHandler.initiateAuthRequest: Navigate url is empty"),ns(ii)}async logout(e){this.logger.verbose("logoutRedirect called");const t=this.initializeLogoutRequest(e),n=this.initializeServerTelemetryManager(Ba);try{this.eventHandler.emitEvent(Cu,Ka.Redirect,e),await this.clearCacheOnLogout(this.correlationId,t.account);const a={apiId:Ba,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},i=await hc(this.createAuthCodeClient.bind(this),Gr,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:n,requestAuthority:e&&e.authority,requestExtraQueryParameters:null===e||void 0===e?void 0:e.extraQueryParameters,account:e&&e.account||void 0});if(i.authority.protocolMode===it)try{i.authority.endSessionEndpoint}catch(o){var r;if(null!==(r=t.account)&&void 0!==r&&r.homeAccountId)return void this.eventHandler.emitEvent(Au,Ka.Redirect,t)}const s=i.getLogoutUri(t);if(this.eventHandler.emitEvent(Au,Ka.Redirect,t),!e||"function"!==typeof e.onRedirectNavigate)return this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0,Pa),void await this.navigationClient.navigateExternal(s,a);if(!1!==e.onRedirectNavigate(s))return this.logger.verbose("Logout onRedirectNavigate did not return false, navigating"),this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0,Pa),void await this.navigationClient.navigateExternal(s,a);this.browserStorage.setInteractionInProgress(!1),this.logger.verbose("Logout onRedirectNavigate returned false, stopping navigation")}catch(a){throw a instanceof ht&&(a.setCorrelationId(this.correlationId),n.cacheFailedRequest(a)),this.eventHandler.emitEvent(Iu,Ka.Redirect,null,a),this.eventHandler.emitEvent(Tu,Ka.Redirect),a}this.eventHandler.emitEvent(Tu,Ka.Redirect)}getRedirectStartPage(e){const t=e||window.location.href;return $n.getAbsoluteUrl(t,El())}}async function Od(e,t,n,r,o){if(t.addQueueMeasurement(Br,r),!e)throw n.info("Navigate url is empty"),ns(ii);return o?hc(Fd,Kr,n,t,r)(e,o,t,r):dc(qd,Vr,n,t,r)(e)}async function jd(e,t,n,r,o){const a=zd();if(!a.contentDocument)throw"No document associated with iframe!";return(await bd(a.contentDocument,e,t,n,r,o)).submit(),a}async function Dd(e,t,n,r,o){const a=zd();if(!a.contentDocument)throw"No document associated with iframe!";return(await vd(a.contentDocument,e,t,n,r,o)).submit(),a}async function Ld(e,t,n,r,o,a,i){return r.addQueueMeasurement(Wr,a),new Promise((r,a)=>{t<Dl&&o.warning("system.loadFrameTimeout or system.iframeHashTimeout set to lower (".concat(t,"ms) than the default (").concat(Dl,"ms). This may result in timeouts."));const s=window.setTimeout(()=>{window.clearInterval(l),a(ns(yi))},t),l=window.setInterval(()=>{let t="";const n=e.contentWindow;try{t=n?n.location.href:""}catch(a){}if(!t||"about:blank"===t)return;let o="";n&&(o=i===ve?n.location.search:n.location.hash),window.clearTimeout(s),window.clearInterval(l),r(o)},n)}).finally(()=>{dc(Ud,Io,o,r,a)(e)})}function Fd(e,t,n,r){return n.addQueueMeasurement(Kr,r),new Promise((n,r)=>{const o=zd();window.setTimeout(()=>{o?(o.src=e,n(o)):r("Unable to load iframe")},t)})}function qd(e){const t=zd();return t.src=e,t}function zd(){const e=document.createElement("iframe");return e.className="msalSilentIframe",e.style.visibility="hidden",e.style.position="absolute",e.style.width=e.style.height="0",e.style.border="0",e.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),document.body.appendChild(e),e}function Ud(e){document.body===e.parentNode&&document.body.removeChild(e)}class Hd extends Zu{constructor(e,t,n,r,o,a,i,s,l,c,u){super(e,t,n,r,o,a,s,c,u),this.apiId=i,this.nativeStorage=l}async acquireToken(e){this.performanceClient.addQueueMeasurement(wr,e.correlationId),e.loginHint||e.sid||e.account&&e.account.username||this.logger.warning("No user hint provided. The authorization server may need more information to complete this request.");const t=c({},e);t.prompt?t.prompt!==me&&t.prompt!==fe&&(this.logger.warning("SilentIframeClient. Replacing invalid prompt ".concat(t.prompt," with ").concat(me)),t.prompt=me):t.prompt=me;const n=await hc(this.initializeAuthorizationRequest.bind(this),Yr,this.logger,this.performanceClient,e.correlationId)(t,Ka.Silent);return n.platformBroker=_d(this.config,this.logger,this.platformAuthProvider,n.authenticationScheme),jl(n.authority),this.config.auth.protocolMode===st?this.executeEarFlow(n):this.executeCodeFlow(n)}async executeCodeFlow(e){let t;const n=this.initializeServerTelemetryManager(this.apiId);try{return t=await hc(this.createAuthCodeClient.bind(this),Gr,this.logger,this.performanceClient,e.correlationId)({serverTelemetryManager:n,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),await hc(this.silentTokenHelper.bind(this),Hr,this.logger,this.performanceClient,e.correlationId)(t,e)}catch(r){if(r instanceof ht&&(r.setCorrelationId(this.correlationId),n.cacheFailedRequest(r)),!t||!(r instanceof ht)||r.errorCode!==oa)throw r;return this.performanceClient.addFields({retryError:r.errorCode},this.correlationId),await hc(this.silentTokenHelper.bind(this),Hr,this.logger,this.performanceClient,this.correlationId)(t,e)}}async executeEarFlow(e){const t=e.correlationId,n=await hc(this.getDiscoveredAuthority.bind(this),Cr,this.logger,this.performanceClient,t)({requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),r=await hc(gl,Bo,this.logger,this.performanceClient,t)(),o=c(c({},e),{},{earJwk:r}),a=await hc(Dd,Br,this.logger,this.performanceClient,t)(this.config,n,o,this.logger,this.performanceClient),i=this.config.auth.OIDCOptions.serverResponseType,s=await hc(Ld,Wr,this.logger,this.performanceClient,t)(a,this.config.system.iframeHashTimeout,this.config.system.pollIntervalMilliseconds,this.performanceClient,this.logger,t,i),l=dc(ed,uo,this.logger,this.performanceClient,t)(s,i,this.logger);return hc(xd,eo,this.logger,this.performanceClient,t)(o,l,this.apiId,this.config,n,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}logout(){return Promise.reject(ns(Si))}async silentTokenHelper(e,t){const n=t.correlationId;this.performanceClient.addQueueMeasurement(Hr,n);const r=await hc(Cd,Mo,this.logger,this.performanceClient,n)(this.performanceClient,this.logger,n),o=c(c({},t),{},{codeChallenge:r.challenge});let a;if(t.httpMethod===J)a=await hc(jd,Br,this.logger,this.performanceClient,n)(this.config,e.authority,o,this.logger,this.performanceClient);else{const t=await hc(yd,Jr,this.logger,this.performanceClient,n)(this.config,e.authority,o,this.logger,this.performanceClient);a=await hc(Od,Br,this.logger,this.performanceClient,n)(t,this.performanceClient,this.logger,n,this.config.system.navigateFrameWait)}const i=this.config.auth.OIDCOptions.serverResponseType,s=await hc(Ld,Wr,this.logger,this.performanceClient,n)(a,this.config.system.iframeHashTimeout,this.config.system.pollIntervalMilliseconds,this.performanceClient,this.logger,n,i),l=dc(ed,uo,this.logger,this.performanceClient,n)(s,i,this.logger);return hc(Sd,no,this.logger,this.performanceClient,n)(t,l,r.verifier,this.apiId,this.config,e,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}}class Bd extends Fu{constructor(e,t){super(e,t)}async acquireToken(e){var t,n;null===(t=this.performanceClient)||void 0===t||t.addQueueMeasurement(Nr,e.correlationId);const r=mc(),o=await hc(this.executeTokenRequest.bind(this),Er,this.logger,this.performanceClient,e.correlationId)(e,this.authority),a=null===(n=o.headers)||void 0===n?void 0:n[re],i=new Bu(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin);return i.validateTokenResponse(o.body),hc(i.handleServerTokenResponse.bind(i),co,this.logger,this.performanceClient,e.correlationId)(o.body,this.authority,r,e,void 0,void 0,!0,e.forceCache,a)}async acquireTokenByRefreshToken(e){var t;if(!e)throw Dn(vn);if(null===(t=this.performanceClient)||void 0===t||t.addQueueMeasurement(Mr,e.correlationId),!e.account)throw sn(Ft);if(this.cacheManager.isAppMetadataFOCI(e.account.environment))try{return await hc(this.acquireTokenWithCachedRefreshToken.bind(this),_r,this.logger,this.performanceClient,e.correlationId)(e,!0)}catch(n){const t=n instanceof qc&&n.errorCode===_c,r=n instanceof Du&&n.errorCode===Be&&n.subError===We;if(t||r)return hc(this.acquireTokenWithCachedRefreshToken.bind(this),_r,this.logger,this.performanceClient,e.correlationId)(e,!1);throw n}return hc(this.acquireTokenWithCachedRefreshToken.bind(this),_r,this.logger,this.performanceClient,e.correlationId)(e,!1)}async acquireTokenWithCachedRefreshToken(e,t){var n;null===(n=this.performanceClient)||void 0===n||n.addQueueMeasurement(_r,e.correlationId);const r=dc(this.cacheManager.getRefreshToken.bind(this.cacheManager),Po,this.logger,this.performanceClient,e.correlationId)(e.account,t,e.correlationId,void 0,this.performanceClient);if(!r)throw Uc(_c);var o;if(r.expiresOn&&yc(r.expiresOn,e.refreshTokenExpirationOffsetSeconds||300))throw null===(o=this.performanceClient)||void 0===o||o.addFields({rtExpiresOnMs:Number(r.expiresOn)},e.correlationId),Uc(Rc);const a=c(c({},e),{},{refreshToken:r.secret,authenticationScheme:e.authenticationScheme||Fe.BEARER,ccsCredential:{credential:e.account.homeAccountId,type:Ru}});try{return await hc(this.acquireToken.bind(this),Nr,this.logger,this.performanceClient,e.correlationId)(a)}catch(s){var i;if(s instanceof qc)if(null===(i=this.performanceClient)||void 0===i||i.addFields({rtExpiresOnMs:Number(r.expiresOn)},e.correlationId),s.subError===jc){this.logger.verbose("acquireTokenWithRefreshToken: bad refresh token, removing from cache");const t=this.cacheManager.generateCredentialKey(r);this.cacheManager.removeRefreshToken(t,e.correlationId)}throw s}}async executeTokenRequest(e,t){var n;null===(n=this.performanceClient)||void 0===n||n.addQueueMeasurement(Er,e.correlationId);const r=this.createTokenQueryParameters(e),o=$n.appendQueryString(t.tokenEndpoint,r),a=await hc(this.createTokenRequestBody.bind(this),Rr,this.logger,this.performanceClient,e.correlationId)(e),i=this.createTokenRequestHeaders(e.ccsCredential),s=Vc(this.config.authOptions.clientId,e);return hc(this.executePostToTokenEndpoint.bind(this),Tr,this.logger,this.performanceClient,e.correlationId)(o,a,i,s,e.correlationId,Tr)}async createTokenRequestBody(e){var t,n,r;null===(t=this.performanceClient)||void 0===t||t.addQueueMeasurement(Rr,e.correlationId);const o=new Map;if(ks(o,e.embeddedClientId||(null===(n=e.tokenBodyParameters)||void 0===n?void 0:n[cs])||this.config.authOptions.clientId),e.redirectUri&&Ss(o,e.redirectUri),ws(o,e.scopes,!0,null===(r=this.config.authOptions.authority.options.OIDCOptions)||void 0===r?void 0:r.defaultScopes),Ds(o,Se),Ls(o),Es(o,this.config.libraryInfo),Ns(o,this.config.telemetry.application),Ws(o),this.serverTelemetryManager&&!na(this.config)&&Bs(o,this.serverTelemetryManager),function(e,t){e.set("refresh_token",t)}(o,e.refreshToken),this.config.clientCredentials.clientSecret&&Rs(o,this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){const t=this.config.clientCredentials.clientAssertion;Os(o,await Ku(t.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),js(o,t.assertionType)}if(e.authenticationScheme===Fe.POP){const t=new Uu(this.cryptoUtils,this.performanceClient);let n;if(e.popKid)n=this.cryptoUtils.encodeKid(e.popKid);else{n=(await hc(t.generateCnf.bind(t),so,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString}Us(o,n)}else if(e.authenticationScheme===Fe.SSH){if(!e.sshJwk)throw Dn(An);Hs(o,e.sshJwk)}if((!Ln.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&Ts(o,e.claims,this.config.authOptions.clientCapabilities),this.config.systemOptions.preventCorsPreflight&&e.ccsCredential)switch(e.ccsCredential.type){case Ru:try{As(o,Bc(e.ccsCredential.credential))}catch(a){this.logger.verbose("Could not parse home account ID for CCS Header: "+a)}break;case Ou:Cs(o,e.ccsCredential.credential)}return e.embeddedClientId&&Ks(o,this.config.authOptions.clientId,this.config.authOptions.redirectUri),e.tokenBodyParameters&&qs(o,e.tokenBodyParameters),vs(o,e.correlationId,this.performanceClient),Yn(o)}}class Wd extends Zu{async acquireToken(e){this.performanceClient.addQueueMeasurement(Sr,e.correlationId);const t=await hc(Ju,Fr,this.logger,this.performanceClient,e.correlationId)(e,this.config,this.performanceClient,this.logger),n=c(c({},e),t);e.redirectUri&&(n.redirectUri=this.getRedirectUri(e.redirectUri));const r=this.initializeServerTelemetryManager(Ha),o=await this.createRefreshTokenClient({serverTelemetryManager:r,authorityUrl:n.authority,azureCloudOptions:n.azureCloudOptions,account:n.account});return hc(o.acquireTokenByRefreshToken.bind(o),Mr,this.logger,this.performanceClient,e.correlationId)(n).catch(e=>{throw e.setCorrelationId(this.correlationId),r.cacheFailedRequest(e),e})}logout(){return Promise.reject(ns(Si))}async createRefreshTokenClient(e){const t=await hc(this.getClientConfiguration.bind(this),Qr,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:e.serverTelemetryManager,requestAuthority:e.authorityUrl,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account});return new Bd(t,this.performanceClient)}}class Kd{constructor(e,t,n,r){this.isBrowserEnvironment="undefined"!==typeof window,this.config=e,this.storage=t,this.logger=n,this.cryptoObj=r}async loadExternalTokens(e,t,n){if(!this.isBrowserEnvironment)throw ns(Ei);const r=e.correlationId||dl(),o=t.id_token?Wn(t.id_token,Js):void 0,a={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},i=e.authority?new Ec(Ec.generateAuthority(e.authority,e.azureCloudOptions),this.config.system.networkClient,this.storage,a,this.logger,e.correlationId||dl()):void 0,s=await this.loadAccount(e,n.clientInfo||t.client_info||"",r,o,i),l=await this.loadIdToken(t,s.homeAccountId,s.environment,s.realm,r),c=await this.loadAccessToken(e,t,s.homeAccountId,s.environment,s.realm,n,r),u=await this.loadRefreshToken(t,s.homeAccountId,s.environment,r);return this.generateAuthenticationResult(e,{account:s,idToken:l,accessToken:c,refreshToken:u},o,i)}async loadAccount(e,t,n,r,o){if(this.logger.verbose("TokenCache - loading account"),e.account){const t=Kc.createFromAccountInfo(e.account);return await this.storage.setAccount(t,n),t}if(!o||!t&&!r)throw this.logger.error("TokenCache - if an account is not provided on the request, authority and either clientInfo or idToken must be provided instead."),ns(ji);const a=Kc.generateHomeAccountId(t,o.authorityType,this.logger,this.cryptoObj,r),i=null===r||void 0===r?void 0:r.tid,s=Wu(this.storage,o,a,Js,n,r,t,o.hostnameAndPort,i,void 0,void 0,this.logger);return await this.storage.setAccount(s,n),s}async loadIdToken(e,t,n,r,o){if(!e.id_token)return this.logger.verbose("TokenCache - no id token found in response"),null;this.logger.verbose("TokenCache - loading id token");const a=bc(t,n,e.id_token,this.config.auth.clientId,r);return await this.storage.setIdTokenCredential(a,o),a}async loadAccessToken(e,t,n,r,o,a,i){if(!t.access_token)return this.logger.verbose("TokenCache - no access token found in response"),null;if(!t.expires_in)return this.logger.error("TokenCache - no expiration set on the access token. Cannot add it to the cache."),null;if(!t.scope&&(!e.scopes||!e.scopes.length))return this.logger.error("TokenCache - scopes not specified in the request or response. Cannot add token to the cache."),null;this.logger.verbose("TokenCache - loading access token");const s=t.scope?Fn.fromString(t.scope):new Fn(e.scopes),l=a.expiresOn||t.expires_in+mc(),c=a.extendedExpiresOn||(t.ext_expires_in||t.expires_in)+mc(),u=wc(n,r,t.access_token,this.config.auth.clientId,o,s.printScopes(),l,c,Js);return await this.storage.setAccessTokenCredential(u,i),u}async loadRefreshToken(e,t,n,r){if(!e.refresh_token)return this.logger.verbose("TokenCache - no refresh token found in response"),null;this.logger.verbose("TokenCache - loading refresh token");const o=kc(t,n,e.refresh_token,this.config.auth.clientId,e.foci,void 0,e.refresh_token_expires_in);return await this.storage.setRefreshTokenCredential(o,r),o}generateAuthenticationResult(e,t,n,r){var o,a,i;let s,l="",c=[],u=null;null!==t&&void 0!==t&&t.accessToken&&(l=t.accessToken.secret,c=Fn.fromString(t.accessToken.target).asArray(),u=pc(t.accessToken.expiresOn),s=pc(t.accessToken.extendedExpiresOn));const d=t.account;return{authority:r?r.canonicalAuthority:"",uniqueId:t.account.localAccountId,tenantId:t.account.realm,scopes:c,account:d.getAccountInfo(),idToken:(null===(o=t.idToken)||void 0===o?void 0:o.secret)||"",idTokenClaims:n||{},accessToken:l,fromCache:!0,expiresOn:u,correlationId:e.correlationId||"",requestId:"",extExpiresOn:s,familyId:(null===(a=t.refreshToken)||void 0===a?void 0:a.familyId)||"",tokenType:(null===t||void 0===t||null===(i=t.accessToken)||void 0===i?void 0:i.tokenType)||"",state:e.state||"",cloudGraphHostName:d.cloudGraphHostName||"",msGraphHost:d.msGraphHost||"",fromNativeBroker:!1}}}class Vd extends Vu{constructor(e){super(e),this.includeRedirectUri=!1}}class Gd extends Zu{constructor(e,t,n,r,o,a,i,s,l,c){super(e,t,n,r,o,a,s,l,c),this.apiId=i}async acquireToken(e){if(!e.code)throw ns(Li);const t=await hc(this.initializeAuthorizationRequest.bind(this),Yr,this.logger,this.performanceClient,e.correlationId)(e,Ka.Silent),n=this.initializeServerTelemetryManager(this.apiId);try{const r=c(c({},t),{},{code:e.code}),o=await hc(this.getClientConfiguration.bind(this),Qr,this.logger,this.performanceClient,e.correlationId)({serverTelemetryManager:n,requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account}),a=new Vd(o);this.logger.verbose("Auth code client created");const i=new ad(a,this.browserStorage,r,this.logger,this.performanceClient);return await hc(i.handleCodeResponseFromServer.bind(i),Xr,this.logger,this.performanceClient,e.correlationId)({code:e.code,msgraph_host:e.msGraphHost,cloud_graph_host_name:e.cloudGraphHostName,cloud_instance_host_name:e.cloudInstanceHostName},t,!1)}catch(r){throw r instanceof ht&&(r.setCorrelationId(this.correlationId),n.cacheFailedRequest(r)),r}}logout(){return Promise.reject(ns(Si))}}function Qd(e,t,n){try{Rl(e)}catch(r){throw t.end({success:!1},r,n),r}}class Yd{constructor(e){var t,n,r,o;this.operatingContext=e,this.isBrowserEnvironment=this.operatingContext.isBrowserEnvironment(),this.config=e.getConfig(),this.initialized=!1,this.logger=this.operatingContext.getLogger(),this.networkClient=this.config.system.networkClient,this.navigationClient=this.config.system.navigationClient,this.redirectResponse=new Map,this.hybridAuthCodeResponses=new Map,this.performanceClient=this.config.telemetry.client,this.browserCrypto=this.isBrowserEnvironment?new ac(this.logger,this.performanceClient):ln,this.eventHandler=new Mu(this.logger),this.browserStorage=this.isBrowserEnvironment?new Nu(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler,function(e){const t=e.cloudDiscoveryMetadata;let n;if(t)try{n=JSON.parse(t)}catch(r){throw Dn(Sn)}return{canonicalAuthority:e.authority?Nc(e.authority):void 0,knownAuthorities:e.knownAuthorities,cloudDiscoveryMetadata:n}}(this.config.auth)):(t=this.config.auth.clientId,n=this.logger,r=this.performanceClient,o=this.eventHandler,new Nu(t,{cacheLocation:Ca,cacheRetentionDays:5,temporaryCacheLocation:Ca,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1},ln,n,r,o));const a={cacheLocation:Ca,cacheRetentionDays:5,temporaryCacheLocation:Ca,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1};this.nativeInternalStorage=new Nu(this.config.auth.clientId,a,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler),this.tokenCache=new Kd(this.config,this.browserStorage,this.logger,this.browserCrypto),this.activeSilentTokenRequests=new Map,this.trackPageVisibility=this.trackPageVisibility.bind(this),this.trackPageVisibilityWithMeasurement=this.trackPageVisibilityWithMeasurement.bind(this)}static async createController(e,t){const n=new Yd(e);return await n.initialize(t),n}trackPageVisibility(e){e&&(this.logger.info("Perf: Visibility change detected"),this.performanceClient.incrementFields({visibilityChangeCount:1},e))}async initialize(e,t){if(this.logger.trace("initialize called"),this.initialized)return void this.logger.info("initialize has already been called, exiting early.");if(!this.isBrowserEnvironment)return this.logger.info("in non-browser environment, exiting early."),this.initialized=!0,void this.eventHandler.emitEvent(ou);const n=(null===e||void 0===e?void 0:e.correlationId)||this.getRequestCorrelationId(),r=this.config.system.allowPlatformBroker,o=this.performanceClient.startMeasurement(zr,n);if(this.eventHandler.emitEvent(ru),!t)try{this.logMultipleInstances(o)}catch(a){}if(await hc(this.browserStorage.initialize.bind(this.browserStorage),Ur,this.logger,this.performanceClient,n)(n),r)try{this.platformAuthProvider=await Nd(this.logger,this.performanceClient,n,this.config.system.nativeBrokerHandshakeTimeout)}catch(i){this.logger.verbose(i)}this.config.cache.claimsBasedCachingEnabled||(this.logger.verbose("Claims-based caching is disabled. Clearing the previous cache with claims"),dc(this.browserStorage.clearTokensAndKeysWithClaims.bind(this.browserStorage),To,this.logger,this.performanceClient,n)(n)),this.config.system.asyncPopups&&await this.preGeneratePkceCodes(n),this.initialized=!0,this.eventHandler.emitEvent(ou),o.end({allowPlatformBroker:r,success:!0})}async handleRedirectPromise(e){if(this.logger.verbose("handleRedirectPromise called"),Ml(this.initialized),this.isBrowserEnvironment){const t=e||"";let n=this.redirectResponse.get(t);return"undefined"===typeof n?(n=this.handleRedirectPromiseInternal(e),this.redirectResponse.set(t,n),this.logger.verbose("handleRedirectPromise has been called for the first time, storing the promise")):this.logger.verbose("handleRedirectPromise has been called previously, returning the result from the first call"),n}return this.logger.verbose("handleRedirectPromise returns null, not browser environment"),null}async handleRedirectPromiseInternal(e){var t;if(!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;if((null===(t=this.browserStorage.getInteractionInProgress())||void 0===t?void 0:t.type)===Pa)return this.logger.verbose("handleRedirectPromise removing interaction_in_progress flag and returning null after sign-out"),this.browserStorage.setInteractionInProgress(!1),Promise.resolve(null);const n=this.getAllAccounts(),r=this.browserStorage.getCachedNativeRequest(),o=r&&this.platformAuthProvider&&!e;let a,i;this.eventHandler.emitEvent(ku,Ka.Redirect);try{if(o&&this.platformAuthProvider){a=this.performanceClient.startMeasurement(pr,(null===r||void 0===r?void 0:r.correlationId)||""),this.logger.trace("handleRedirectPromise - acquiring token from native platform"),a.add({isPlatformBrokerRequest:!0});const e=new fd(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,za,this.performanceClient,this.platformAuthProvider,r.accountId,this.nativeInternalStorage,r.correlationId);i=hc(e.handleRedirectPromise.bind(e),Co,this.logger,this.performanceClient,a.event.correlationId)(this.performanceClient,a.event.correlationId)}else{const[t,n]=this.browserStorage.getCachedRequest(),r=t.correlationId;a=this.performanceClient.startMeasurement(pr,r),this.logger.trace("handleRedirectPromise - acquiring token from web flow");const o=this.createRedirectClient(r);i=hc(o.handleRedirectPromise.bind(o),xo,this.logger,this.performanceClient,a.event.correlationId)(e,t,n,a)}}catch(s){throw this.browserStorage.resetRequestCache(),s}return i.then(e=>{if(e){this.browserStorage.resetRequestCache();n.length<this.getAllAccounts().length?(this.eventHandler.emitEvent(cu,Ka.Redirect,e),this.logger.verbose("handleRedirectResponse returned result, login success")):(this.eventHandler.emitEvent(hu,Ka.Redirect,e),this.logger.verbose("handleRedirectResponse returned result, acquire token success")),a.end({success:!0},void 0,e.account)}else a.event.errorCode?a.end({success:!1},void 0):a.discard();return this.eventHandler.emitEvent(Su,Ka.Redirect),e}).catch(e=>{this.browserStorage.resetRequestCache();const t=e;throw n.length>0?this.eventHandler.emitEvent(gu,Ka.Redirect,null,t):this.eventHandler.emitEvent(uu,Ka.Redirect,null,t),this.eventHandler.emitEvent(Su,Ka.Redirect),a.end({success:!1},t),e})}async acquireTokenRedirect(e){const t=this.getRequestCorrelationId(e);this.logger.verbose("acquireTokenRedirect called",t);const n=this.performanceClient.startMeasurement(fr,t);n.add({scenarioId:e.scenarioId});const r=e.onRedirectNavigate;if(r)e.onRedirectNavigate=t=>{const o="function"===typeof r?r(t):void 0;return n.add({navigateCallbackResult:!1!==o}),n.event=n.end({success:!0},void 0,e.account)||n.event,o};else{const t=this.config.auth.onRedirectNavigate;this.config.auth.onRedirectNavigate=r=>{const o="function"===typeof t?t(r):void 0;return n.add({navigateCallbackResult:!1!==o}),n.event=n.end({success:!0},void 0,e.account)||n.event,o}}const o=this.getAllAccounts().length>0;try{let r;if(Ol(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0,Ta),o?this.eventHandler.emitEvent(du,Ka.Redirect,e):this.eventHandler.emitEvent(lu,Ka.Redirect,e),this.platformAuthProvider&&this.canUsePlatformBroker(e)){r=new fd(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,La,this.performanceClient,this.platformAuthProvider,this.getNativeAccountId(e),this.nativeInternalStorage,t).acquireTokenRedirect(e,n).catch(r=>{if(n.add({brokerErrorName:r.name,brokerErrorCode:r.errorCode}),r instanceof ld&&cd(r)){this.platformAuthProvider=void 0;return this.createRedirectClient(t).acquireToken(e)}if(r instanceof qc){this.logger.verbose("acquireTokenRedirect - Resolving interaction required error thrown by native broker by falling back to web flow");return this.createRedirectClient(t).acquireToken(e)}throw r})}else{r=this.createRedirectClient(t).acquireToken(e)}return await r}catch(a){throw this.browserStorage.resetRequestCache(),2===n.event.status?this.performanceClient.startMeasurement(pr,t).end({success:!1},a,e.account):n.end({success:!1},a,e.account),o?this.eventHandler.emitEvent(gu,Ka.Redirect,null,a):this.eventHandler.emitEvent(uu,Ka.Redirect,null,a),a}}acquireTokenPopup(e){const t=this.getRequestCorrelationId(e),n=this.performanceClient.startMeasurement(mr,t);n.add({scenarioId:e.scenarioId});try{this.logger.verbose("acquireTokenPopup called",t),Qd(this.initialized,n,e.account),this.browserStorage.setInteractionInProgress(!0,Ta)}catch(i){return Promise.reject(i)}const r=this.getAllAccounts();let o;r.length>0?this.eventHandler.emitEvent(du,Ka.Popup,e):this.eventHandler.emitEvent(lu,Ka.Popup,e);const a=this.getPreGeneratedPkceCodes(t);if(this.canUsePlatformBroker(e))n.add({isPlatformBrokerRequest:!0}),o=this.acquireTokenNative(c(c({},e),{},{correlationId:t}),Fa).then(e=>(n.end({success:!0},void 0,e.account),e)).catch(r=>{if(n.add({brokerErrorName:r.name,brokerErrorCode:r.errorCode}),r instanceof ld&&cd(r)){this.platformAuthProvider=void 0;return this.createPopupClient(t).acquireToken(e,a)}if(r instanceof qc){this.logger.verbose("acquireTokenPopup - Resolving interaction required error thrown by native broker by falling back to web flow");return this.createPopupClient(t).acquireToken(e,a)}throw r});else{o=this.createPopupClient(t).acquireToken(e,a)}return o.then(e=>(r.length<this.getAllAccounts().length?this.eventHandler.emitEvent(cu,Ka.Popup,e):this.eventHandler.emitEvent(hu,Ka.Popup,e),n.end({success:!0,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length},void 0,e.account),e)).catch(t=>(r.length>0?this.eventHandler.emitEvent(gu,Ka.Popup,null,t):this.eventHandler.emitEvent(uu,Ka.Popup,null,t),n.end({success:!1},t,e.account),Promise.reject(t))).finally(async()=>{this.browserStorage.setInteractionInProgress(!1),this.config.system.asyncPopups&&await this.preGeneratePkceCodes(t)})}trackPageVisibilityWithMeasurement(){const e=this.ssoSilentMeasurement||this.acquireTokenByCodeAsyncMeasurement;e&&(this.logger.info("Perf: Visibility change detected in ",e.event.name),e.increment({visibilityChangeCount:1}))}async ssoSilent(e){var t,n;const r=this.getRequestCorrelationId(e),o=c(c({},e),{},{prompt:e.prompt,correlationId:r});let a;if(this.ssoSilentMeasurement=this.performanceClient.startMeasurement(xr,r),null===(t=this.ssoSilentMeasurement)||void 0===t||t.add({scenarioId:e.scenarioId}),Qd(this.initialized,this.ssoSilentMeasurement,e.account),null===(n=this.ssoSilentMeasurement)||void 0===n||n.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),this.logger.verbose("ssoSilent called",r),this.eventHandler.emitEvent(fu,Ka.Silent,o),this.canUsePlatformBroker(o)){var i;null===(i=this.ssoSilentMeasurement)||void 0===i||i.add({isPlatformBrokerRequest:!0}),a=this.acquireTokenNative(o,qa).catch(e=>{var t;if(null===(t=this.ssoSilentMeasurement)||void 0===t||t.add({brokerErrorName:e.name,brokerErrorCode:e.errorCode}),e instanceof ld&&cd(e)){this.platformAuthProvider=void 0;return this.createSilentIframeClient(o.correlationId).acquireToken(o)}throw e})}else{a=this.createSilentIframeClient(o.correlationId).acquireToken(o)}return a.then(e=>{var t;return this.eventHandler.emitEvent(pu,Ka.Silent,e),null===(t=this.ssoSilentMeasurement)||void 0===t||t.end({success:!0,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length},void 0,e.account),e}).catch(t=>{var n;throw this.eventHandler.emitEvent(yu,Ka.Silent,null,t),null===(n=this.ssoSilentMeasurement)||void 0===n||n.end({success:!1},t,e.account),t}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})}async acquireTokenByCode(e){const t=this.getRequestCorrelationId(e);this.logger.trace("acquireTokenByCode called",t);const n=this.performanceClient.startMeasurement(ur,t);Qd(this.initialized,n),this.eventHandler.emitEvent(vu,Ka.Silent,e),n.add({scenarioId:e.scenarioId});try{if(e.code&&e.nativeAccountId)throw ns(qi);if(e.code){const r=e.code;let o=this.hybridAuthCodeResponses.get(r);return o?(this.logger.verbose("Existing acquireTokenByCode request found",t),n.discard()):(this.logger.verbose("Initiating new acquireTokenByCode request",t),o=this.acquireTokenByCodeAsync(c(c({},e),{},{correlationId:t})).then(e=>(this.eventHandler.emitEvent(bu,Ka.Silent,e),this.hybridAuthCodeResponses.delete(r),n.end({success:!0,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length},void 0,e.account),e)).catch(e=>{throw this.hybridAuthCodeResponses.delete(r),this.eventHandler.emitEvent(wu,Ka.Silent,null,e),n.end({success:!1},e),e}),this.hybridAuthCodeResponses.set(r,o)),await o}if(e.nativeAccountId){if(this.canUsePlatformBroker(e,e.nativeAccountId)){n.add({isPlatformBrokerRequest:!0});const r=await this.acquireTokenNative(c(c({},e),{},{correlationId:t}),Ua,e.nativeAccountId).catch(e=>{throw e instanceof ld&&cd(e)&&(this.platformAuthProvider=void 0),n.add({brokerErrorName:e.name,brokerErrorCode:e.errorCode}),e});return n.end({success:!0},void 0,r.account),r}throw ns(Ui)}throw ns(Fi)}catch(r){throw this.eventHandler.emitEvent(wu,Ka.Silent,null,r),n.end({success:!1},r),r}}async acquireTokenByCodeAsync(e){var t;this.logger.trace("acquireTokenByCodeAsync called",e.correlationId),this.acquireTokenByCodeAsyncMeasurement=this.performanceClient.startMeasurement(So,e.correlationId),null===(t=this.acquireTokenByCodeAsyncMeasurement)||void 0===t||t.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement);const n=this.createSilentAuthCodeClient(e.correlationId);return await n.acquireToken(e).then(e=>{var t;return null===(t=this.acquireTokenByCodeAsyncMeasurement)||void 0===t||t.end({success:!0,fromCache:e.fromCache}),e}).catch(e=>{var t;throw null===(t=this.acquireTokenByCodeAsyncMeasurement)||void 0===t||t.end({success:!1},e),e}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})}async acquireTokenFromCache(e,t){switch(this.performanceClient.addQueueMeasurement(Or,e.correlationId),t){case Ya:case Ja:case $a:const t=this.createSilentCacheClient(e.correlationId);return hc(t.acquireToken.bind(t),br,this.logger,this.performanceClient,e.correlationId)(e);default:throw sn(Vt)}}async acquireTokenByRefreshToken(e,t){switch(this.performanceClient.addQueueMeasurement(dr,e.correlationId),t){case Ya:case $a:case Xa:case Za:const t=this.createSilentRefreshClient(e.correlationId);return hc(t.acquireToken.bind(t),Sr,this.logger,this.performanceClient,e.correlationId)(e);default:throw sn(Vt)}}async acquireTokenBySilentIframe(e){this.performanceClient.addQueueMeasurement(Lr,e.correlationId);const t=this.createSilentIframeClient(e.correlationId);return hc(t.acquireToken.bind(t),wr,this.logger,this.performanceClient,e.correlationId)(e)}async logout(e){const t=this.getRequestCorrelationId(e);return this.logger.warning("logout API is deprecated and will be removed in msal-browser v3.0.0. Use logoutRedirect instead.",t),this.logoutRedirect(c({correlationId:t},e))}async logoutRedirect(e){const t=this.getRequestCorrelationId(e);Ol(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0,Pa);return this.createRedirectClient(t).logout(e)}logoutPopup(e){try{const t=this.getRequestCorrelationId(e);Rl(this.initialized),this.browserStorage.setInteractionInProgress(!0,Pa);return this.createPopupClient(t).logout(e).finally(()=>{this.browserStorage.setInteractionInProgress(!1)})}catch(t){return Promise.reject(t)}}async clearCache(e){if(!this.isBrowserEnvironment)return void this.logger.info("in non-browser environment, returning early.");const t=this.getRequestCorrelationId(e);return this.createSilentCacheClient(t).logout(e)}getAllAccounts(e){const t=this.getRequestCorrelationId();return function(e,t,n,r,o){return e.verbose("getAllAccounts called"),n?t.getAllAccounts(o||{},r):[]}(this.logger,this.browserStorage,this.isBrowserEnvironment,t,e)}getAccount(e){const t=this.getRequestCorrelationId();return function(e,t,n,r){const o=n.getAccountInfoFilteredBy(e,r);return o?(t.verbose("getAccount: Account matching provided filter found, returning"),o):(t.verbose("getAccount: No matching account found, returning null"),null)}(e,this.logger,this.browserStorage,t)}getAccountByUsername(e){const t=this.getRequestCorrelationId();return function(e,t,n,r){if(t.trace("getAccountByUsername called"),!e)return t.warning("getAccountByUsername: No username provided"),null;const o=n.getAccountInfoFilteredBy({username:e},r);return o?(t.verbose("getAccountByUsername: Account matching username found, returning"),t.verbosePii("getAccountByUsername: Returning signed-in accounts matching username: ".concat(e)),o):(t.verbose("getAccountByUsername: No matching account found, returning null"),null)}(e,this.logger,this.browserStorage,t)}getAccountByHomeId(e){const t=this.getRequestCorrelationId();return function(e,t,n,r){if(t.trace("getAccountByHomeId called"),!e)return t.warning("getAccountByHomeId: No homeAccountId provided"),null;const o=n.getAccountInfoFilteredBy({homeAccountId:e},r);return o?(t.verbose("getAccountByHomeId: Account matching homeAccountId found, returning"),t.verbosePii("getAccountByHomeId: Returning signed-in accounts matching homeAccountId: ".concat(e)),o):(t.verbose("getAccountByHomeId: No matching account found, returning null"),null)}(e,this.logger,this.browserStorage,t)}getAccountByLocalId(e){const t=this.getRequestCorrelationId();return function(e,t,n,r){if(t.trace("getAccountByLocalId called"),!e)return t.warning("getAccountByLocalId: No localAccountId provided"),null;const o=n.getAccountInfoFilteredBy({localAccountId:e},r);return o?(t.verbose("getAccountByLocalId: Account matching localAccountId found, returning"),t.verbosePii("getAccountByLocalId: Returning signed-in accounts matching localAccountId: ".concat(e)),o):(t.verbose("getAccountByLocalId: No matching account found, returning null"),null)}(e,this.logger,this.browserStorage,t)}setActiveAccount(e){const t=this.getRequestCorrelationId();!function(e,t,n){t.setActiveAccount(e,n)}(e,this.browserStorage,t)}getActiveAccount(){const e=this.getRequestCorrelationId();return function(e,t){return e.getActiveAccount(t)}(this.browserStorage,e)}async hydrateCache(e,t){this.logger.verbose("hydrateCache called");const n=Kc.createFromAccountInfo(e.account,e.cloudGraphHostName,e.msGraphHost);return await this.browserStorage.setAccount(n,e.correlationId),e.fromNativeBroker?(this.logger.verbose("Response was from native broker, storing in-memory"),this.nativeInternalStorage.hydrateCache(e,t)):this.browserStorage.hydrateCache(e,t)}async acquireTokenNative(e,t,n,r){if(this.logger.trace("acquireTokenNative called"),!this.platformAuthProvider)throw ns(Wi);return new fd(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,t,this.performanceClient,this.platformAuthProvider,n||this.getNativeAccountId(e),this.nativeInternalStorage,e.correlationId).acquireToken(e,r)}canUsePlatformBroker(e,t){if(this.logger.trace("canUsePlatformBroker called"),!this.platformAuthProvider)return this.logger.trace("canUsePlatformBroker: platform broker unavilable, returning false"),!1;if(!_d(this.config,this.logger,this.platformAuthProvider,e.authenticationScheme))return this.logger.trace("canUsePlatformBroker: isBrokerAvailable returned false, returning false"),!1;if(e.prompt)switch(e.prompt){case me:case ge:case de:case he:this.logger.trace("canUsePlatformBroker: prompt is compatible with platform broker flow");break;default:return this.logger.trace("canUsePlatformBroker: prompt = ".concat(e.prompt," is not compatible with platform broker flow, returning false")),!1}return!(!t&&!this.getNativeAccountId(e))||(this.logger.trace("canUsePlatformBroker: nativeAccountId is not available, returning false"),!1)}getNativeAccountId(e){const t=e.account||this.getAccount({loginHint:e.loginHint,sid:e.sid})||this.getActiveAccount();return t&&t.nativeAccountId||""}createPopupClient(e){return new Md(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.platformAuthProvider,e)}createRedirectClient(e){return new Rd(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.platformAuthProvider,e)}createSilentIframeClient(e){return new Hd(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,qa,this.performanceClient,this.nativeInternalStorage,this.platformAuthProvider,e)}createSilentCacheClient(e){return new hd(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.platformAuthProvider,e)}createSilentRefreshClient(e){return new Wd(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.platformAuthProvider,e)}createSilentAuthCodeClient(e){return new Gd(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,Ua,this.performanceClient,this.platformAuthProvider,e)}addEventCallback(e,t){return this.eventHandler.addEventCallback(e,t)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){return _l(),this.performanceClient.addPerformanceCallback(e)}removePerformanceCallback(e){return this.performanceClient.removePerformanceCallback(e)}enableAccountStorageEvents(){this.config.cache.cacheLocation===Sa?this.eventHandler.subscribeCrossTab():this.logger.info("Account storage events are only available when cacheLocation is set to localStorage")}disableAccountStorageEvents(){this.config.cache.cacheLocation===Sa?this.eventHandler.unsubscribeCrossTab():this.logger.info("Account storage events are only available when cacheLocation is set to localStorage")}getTokenCache(){return this.tokenCache}getLogger(){return this.logger}setLogger(e){this.logger=e}initializeWrapperLibrary(e,t){this.browserStorage.setWrapperMetadata(e,t)}setNavigationClient(e){this.navigationClient=e}getConfiguration(){return this.config}getPerformanceClient(){return this.performanceClient}isBrowserEnv(){return this.isBrowserEnvironment}getRequestCorrelationId(e){return null!==e&&void 0!==e&&e.correlationId?e.correlationId:this.isBrowserEnvironment?dl():H.EMPTY_STRING}async loginRedirect(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("loginRedirect called",t),this.acquireTokenRedirect(c({correlationId:t},e||Va))}loginPopup(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("loginPopup called",t),this.acquireTokenPopup(c({correlationId:t},e||Va))}async acquireTokenSilent(e){const t=this.getRequestCorrelationId(e),n=this.performanceClient.startMeasurement(hr,t);n.add({cacheLookupPolicy:e.cacheLookupPolicy,scenarioId:e.scenarioId}),Qd(this.initialized,n,e.account),this.logger.verbose("acquireTokenSilent called",t);const r=e.account||this.getActiveAccount();if(!r)throw ns(xi);return this.acquireTokenSilentDeduped(e,r,t).then(r=>(n.end({success:!0,fromCache:r.fromCache,accessTokenSize:r.accessToken.length,idTokenSize:r.idToken.length},void 0,r.account),c(c({},r),{},{state:e.state,correlationId:t}))).catch(e=>{throw e instanceof ht&&e.setCorrelationId(t),n.end({success:!1},e,r),e})}async acquireTokenSilentDeduped(e,t,n){const r=Vc(this.config.auth.clientId,c(c({},e),{},{authority:e.authority||this.config.auth.authority,correlationId:n}),t.homeAccountId),o=JSON.stringify(r),a=this.activeSilentTokenRequests.get(o);if("undefined"===typeof a){this.logger.verbose("acquireTokenSilent called for the first time, storing active request",n),this.performanceClient.addFields({deduped:!1},n);const r=hc(this.acquireTokenSilentAsync.bind(this),gr,this.logger,this.performanceClient,n)(c(c({},e),{},{correlationId:n}),t);return this.activeSilentTokenRequests.set(o,r),r.finally(()=>{this.activeSilentTokenRequests.delete(o)})}return this.logger.verbose("acquireTokenSilent has been called previously, returning the result from the first call",n),this.performanceClient.addFields({deduped:!0},n),a}async acquireTokenSilentAsync(e,t){const n=()=>this.trackPageVisibility(e.correlationId);this.performanceClient.addQueueMeasurement(gr,e.correlationId),this.eventHandler.emitEvent(du,Ka.Silent,e),e.correlationId&&this.performanceClient.incrementFields({visibilityChangeCount:0},e.correlationId),document.addEventListener("visibilitychange",n);const r=await hc($u,qr,this.logger,this.performanceClient,e.correlationId)(e,t,this.config,this.performanceClient,this.logger),o=e.cacheLookupPolicy||Ya;return this.acquireTokenSilentNoIframe(r,o).catch(async e=>{const t=function(e,t){const n=!(e instanceof qc&&e.subError!==jc),r=e.errorCode===oa||e.errorCode===Vt,o=n&&r||e.errorCode===_c||e.errorCode===Rc,a=ti.includes(t);return o&&a}(e,o);if(t){if(this.activeIframeRequest){if(o!==ei){const[t,n]=this.activeIframeRequest;this.logger.verbose("Iframe request is already in progress, awaiting resolution for request with correlationId: ".concat(n),r.correlationId);const a=this.performanceClient.startMeasurement(kr,r.correlationId);a.add({awaitIframeCorrelationId:n});const i=await t;if(a.end({success:i}),i)return this.logger.verbose("Parallel iframe request with correlationId: ".concat(n," succeeded. Retrying cache and/or RT redemption"),r.correlationId),this.acquireTokenSilentNoIframe(r,o);throw this.logger.info("Iframe request with correlationId: ".concat(n," failed. Interaction is required.")),e}return this.logger.warning("Another iframe request is currently in progress and CacheLookupPolicy is set to Skip. This may result in degraded performance and/or reliability for both calls. Please consider changing the CacheLookupPolicy to take advantage of request queuing and token cache.",r.correlationId),hc(this.acquireTokenBySilentIframe.bind(this),Lr,this.logger,this.performanceClient,r.correlationId)(r)}{let e;return this.activeIframeRequest=[new Promise(t=>{e=t}),r.correlationId],this.logger.verbose("Refresh token expired/invalid or CacheLookupPolicy is set to Skip, attempting acquire token by iframe.",r.correlationId),hc(this.acquireTokenBySilentIframe.bind(this),Lr,this.logger,this.performanceClient,r.correlationId)(r).then(t=>(e(!0),t)).catch(t=>{throw e(!1),t}).finally(()=>{this.activeIframeRequest=void 0})}}throw e}).then(t=>(this.eventHandler.emitEvent(hu,Ka.Silent,t),this.performanceClient.addFields({fromCache:t.fromCache},e.correlationId),t)).catch(e=>{throw this.eventHandler.emitEvent(gu,Ka.Silent,null,e),e}).finally(()=>{document.removeEventListener("visibilitychange",n)})}async acquireTokenSilentNoIframe(e,t){return _d(this.config,this.logger,this.platformAuthProvider,e.authenticationScheme)&&e.account.nativeAccountId?(this.logger.verbose("acquireTokenSilent - attempting to acquire token from native platform"),this.performanceClient.addFields({isPlatformBrokerRequest:!0},e.correlationId),this.acquireTokenNative(e,Ha,e.account.nativeAccountId,t).catch(async t=>{if(this.performanceClient.addFields({brokerErrorName:t.name,brokerErrorCode:t.errorCode},e.correlationId),t instanceof ld&&cd(t))throw this.logger.verbose("acquireTokenSilent - native platform unavailable, falling back to web flow"),this.platformAuthProvider=void 0,sn(Vt);throw t})):(this.logger.verbose("acquireTokenSilent - attempting to acquire token from web flow"),t===Ja&&this.logger.verbose("acquireTokenSilent - cache lookup policy set to AccessToken, attempting to acquire token from local cache"),hc(this.acquireTokenFromCache.bind(this),Or,this.logger,this.performanceClient,e.correlationId)(e,t).catch(n=>{if(t===Ja)throw n;return this.eventHandler.emitEvent(mu,Ka.Silent,e),hc(this.acquireTokenByRefreshToken.bind(this),dr,this.logger,this.performanceClient,e.correlationId)(e,t)}))}async preGeneratePkceCodes(e){return this.logger.verbose("Generating new PKCE codes"),this.pkceCode=await hc(Cd,Mo,this.logger,this.performanceClient,e)(this.performanceClient,this.logger,e),Promise.resolve()}getPreGeneratedPkceCodes(e){this.logger.verbose("Attempting to pick up pre-generated PKCE codes");const t=this.pkceCode?c({},this.pkceCode):void 0;return this.pkceCode=void 0,this.logger.verbose("".concat(t?"Found":"Did not find"," pre-generated PKCE codes")),this.performanceClient.addFields({usePreGeneratedPkce:!!t},e),t}logMultipleInstances(e){const t=this.config.auth.clientId;if(!window)return;window.msal=window.msal||{},window.msal.clientIds=window.msal.clientIds||[];window.msal.clientIds.length>0&&this.logger.verbose("There is already an instance of MSAL.js in the window."),window.msal.clientIds.push(t),function(e,t,n){var r;const o=(null===(r=window.msal)||void 0===r?void 0:r.clientIds)||[],a=o.length,i=o.filter(t=>t===e).length;i>1&&n.warning("There is already an instance of MSAL.js in the window with the same client id."),t.add({msalInstanceCount:a,sameClientIdInstanceCount:i})}(t,e,this.logger)}}class Jd{static async createPublicClientApplication(e){const t=await async function(e,t){const n=new Yl(e);return await n.initialize(),Yd.createController(n,t)}(e);return new Jd(e,t)}constructor(e,t){this.isBroker=!1,this.controller=t||new Yd(new Yl(e))}async initialize(e){return this.controller.initialize(e,this.isBroker)}async acquireTokenPopup(e){return this.controller.acquireTokenPopup(e)}acquireTokenRedirect(e){return this.controller.acquireTokenRedirect(e)}acquireTokenSilent(e){return this.controller.acquireTokenSilent(e)}acquireTokenByCode(e){return this.controller.acquireTokenByCode(e)}addEventCallback(e,t){return this.controller.addEventCallback(e,t)}removeEventCallback(e){return this.controller.removeEventCallback(e)}addPerformanceCallback(e){return this.controller.addPerformanceCallback(e)}removePerformanceCallback(e){return this.controller.removePerformanceCallback(e)}enableAccountStorageEvents(){this.controller.enableAccountStorageEvents()}disableAccountStorageEvents(){this.controller.disableAccountStorageEvents()}getAccount(e){return this.controller.getAccount(e)}getAccountByHomeId(e){return this.controller.getAccountByHomeId(e)}getAccountByLocalId(e){return this.controller.getAccountByLocalId(e)}getAccountByUsername(e){return this.controller.getAccountByUsername(e)}getAllAccounts(e){return this.controller.getAllAccounts(e)}handleRedirectPromise(e){return this.controller.handleRedirectPromise(e)}loginPopup(e){return this.controller.loginPopup(e)}loginRedirect(e){return this.controller.loginRedirect(e)}logout(e){return this.controller.logout(e)}logoutRedirect(e){return this.controller.logoutRedirect(e)}logoutPopup(e){return this.controller.logoutPopup(e)}ssoSilent(e){return this.controller.ssoSilent(e)}getTokenCache(){return this.controller.getTokenCache()}getLogger(){return this.controller.getLogger()}setLogger(e){this.controller.setLogger(e)}setActiveAccount(e){this.controller.setActiveAccount(e)}getActiveAccount(){return this.controller.getActiveAccount()}initializeWrapperLibrary(e,t){return this.controller.initializeWrapperLibrary(e,t)}setNavigationClient(e){this.controller.setNavigationClient(e)}getConfiguration(){return this.controller.getConfiguration()}async hydrateCache(e,t){return this.controller.hydrateCache(e,t)}clearCache(e){return this.controller.clearCache(e)}}class $d{constructor(e){this.config={siteUrl:e.siteUrl||"https://evokebehavioralhealthcom.sharepoint.com/sites/Clinistrators",staffListName:e.staffListName||"Staff",studentsListName:e.studentsListName||"Clients",scheduleListName:e.scheduleListName||"ABASchedules",clientId:e.clientId,tenantId:e.tenantId,redirectUri:e.redirectUri},this.msalConfig={auth:{clientId:this.config.clientId,authority:"https://login.microsoftonline.com/".concat(this.config.tenantId),redirectUri:this.config.redirectUri},cache:{cacheLocation:"localStorage",storeAuthStateInCookie:!1}},this.msalInstance=new Jd(this.msalConfig),this.isInitialized=!1,this.accessToken=null,this.tokenExpiry=null,this.requestDigest=null,this.digestExpiry=null,this.loginRequest={scopes:["https://evokebehavioralhealthcom.sharepoint.com/.default"],prompt:"select_account"},console.log("\ud83d\udd27 SharePointService initialized:",{siteUrl:this.config.siteUrl,clientId:this.config.clientId,redirectUri:this.config.redirectUri,scopes:this.loginRequest.scopes})}async initializeMSAL(){if(!this.isInitialized)try{console.log("\ud83d\udd04 Initializing MSAL..."),await this.msalInstance.initialize(),this.isInitialized=!0,console.log("\u2705 MSAL initialized successfully")}catch(e){throw console.error("\u274c MSAL initialization failed:",e),e}}async login(){try{console.log("\ud83d\udd10 Starting MSAL login..."),await this.initializeMSAL();const t=this.msalInstance.getAllAccounts();if(t.length>0)try{const e=await this.msalInstance.acquireTokenSilent(c(c({},this.loginRequest),{},{account:t[0]}));return this.accessToken=e.accessToken,this.tokenExpiry=e.expiresOn.getTime(),console.log("\u2705 Silent login successful"),!0}catch(e){console.log("\u26a0\ufe0f Silent login failed, will redirect...")}return console.log("\ud83d\udd17 Redirecting to Microsoft login..."),console.log("\ud83d\udccb Login request:",this.loginRequest),await this.msalInstance.loginRedirect(this.loginRequest),!1}catch(t){throw console.error("\u274c MSAL login failed:",t),t}}async checkAuthentication(){try{await this.initializeMSAL();const t=await this.msalInstance.handleRedirectPromise();if(t)return console.log("\u2705 Login redirect handled successfully"),console.log("\ud83d\udccb Token response:",{scopes:t.scopes,tokenType:t.tokenType,expiresOn:t.expiresOn}),this.accessToken=t.accessToken,this.tokenExpiry=t.expiresOn.getTime(),!0;const n=this.msalInstance.getAllAccounts();if(n.length>0){console.log("\u2705 Found existing account:",n[0].username);try{const e=await this.msalInstance.acquireTokenSilent(c(c({},this.loginRequest),{},{account:n[0]}));return this.accessToken=e.accessToken,this.tokenExpiry=e.expiresOn.getTime(),console.log("\u2705 Token acquired silently"),!0}catch(e){return console.log("\u26a0\ufe0f Silent token acquisition failed:",e.message),!1}}return console.log("\u26a0\ufe0f No authenticated accounts found"),!1}catch(e){return console.error("\u274c Authentication check failed:",e),!1}}async getCachedToken(){try{await this.initializeMSAL();const e=this.msalInstance.getAllAccounts();if(0===e.length)return null;const t=await this.msalInstance.acquireTokenSilent(c(c({},this.loginRequest),{},{account:e[0]}));return console.log("\u2705 Retrieved token silently from MSAL"),this.tokenExpiry=t.expiresOn.getTime(),t.accessToken}catch(e){return console.log("\u26a0\ufe0f Could not get token silently:",e.message),null}}forceLogout(){console.log("\ud83d\udeaa Logging out with MSAL..."),this.accessToken=null,this.tokenExpiry=null;const e=this.msalInstance.getAllAccounts();e.length>0&&this.msalInstance.logoutRedirect({account:e[0]})}async getRequestDigest(){if(this.requestDigest&&this.digestExpiry&&Date.now()<this.digestExpiry)return this.requestDigest;try{const e=await fetch("".concat(this.config.siteUrl,"/_api/contextinfo"),{method:"POST",headers:{Accept:"application/json;odata=verbose",Authorization:"Bearer ".concat(this.accessToken)}});if(e.ok){const t=await e.json();return this.requestDigest=t.d.GetContextWebInformation.FormDigestValue,this.digestExpiry=Date.now()+1e3*t.d.GetContextWebInformation.FormDigestTimeoutSeconds-6e4,this.requestDigest}throw new Error("Failed to get request digest: ".concat(e.status))}catch(e){throw console.error("Error getting request digest:",e),e}}async getHeaders(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t={Accept:"application/json;odata=verbose",Authorization:"Bearer ".concat(this.accessToken)};if(e){const e=await this.getRequestDigest();t["X-RequestDigest"]=e,t["Content-Type"]="application/json;odata=verbose"}return t}async makeRequest(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.accessToken)throw new Error("No access token available. Please login first.");try{const n=await fetch(e,t);if(401===n.status)throw new Error("Authentication failed. Access token may have expired.");return n}catch(n){throw console.error("SharePoint request failed:",n),n}}async loadStaff(){try{console.log("\ud83d\udd0d Loading staff from SharePoint REST API...");const e=await this.getHeaders(),t="".concat(this.config.siteUrl,"/_api/web/lists/getbytitle('").concat(this.config.staffListName,"')/items?")+"$select=Id,StaffPerson/Id,StaffPerson/Title,StaffPerson/EMail,Role,PrimaryProgram,SecondaryProgram,IsActive,AbsentAM,AbsentPM,AbsentFullDay&$expand=StaffPerson&$top=5000";console.log("\ud83d\udccb Fetching staff from:",t);const n=await this.makeRequest(t,{headers:e});if(!n.ok){const e=await n.text();throw console.error("SharePoint Staff API Error:",n.status,e),new Error("Failed to load staff: ".concat(n.status," - ").concat(e))}const r=await n.json();console.log("\ud83d\udd0d Raw SharePoint staff response:",r);const o=r.d.results||[];return console.log("\u2705 Found ".concat(o.length," staff members")),o.length>0&&console.log("\ud83d\udccb First staff item:",o[0]),o.map(e=>{const t=e.StaffPerson,n=t?t.Title:"Unknown Staff",r=t?t.EMail:"",o=new D({id:t?t.Id:e.Id,name:n,role:e.Role||"RBT",email:r,primaryProgram:!0===e.PrimaryProgram,secondaryProgram:!0===e.SecondaryProgram,isActive:!1!==e.IsActive,absentAM:!0===e.AbsentAM,absentPM:!0===e.AbsentPM,absentFullDay:!0===e.AbsentFullDay});return console.log("\u2705 Loaded staff: ".concat(o.name," (").concat(o.role,") - Primary: ").concat(o.primaryProgram,", Secondary: ").concat(o.secondaryProgram)),o})}catch(e){throw console.error("Error loading staff:",e),e}}async loadStudents(){try{console.log("\ud83d\udd0d Loading students from SharePoint REST API...");const e=await this.getHeaders(),t="".concat(this.config.siteUrl,"/_api/web/lists/getbytitle('").concat(this.config.studentsListName,"')/items?")+"$select=Id,Title,Program,RatioAM,RatioPM,IsActive,PairedWith,Team/Id,Team/Title,Team/EMail,AbsentAM,AbsentPM,AbsentFullDay&$expand=Team&$top=5000";console.log("\ud83d\udccb Fetching students from:",t);const n=await this.makeRequest(t,{headers:e});if(!n.ok){const e=await n.text();throw console.error("\u274c SharePoint Students API Error:",n.status,e),new Error("Failed to load students: ".concat(n.status," - ").concat(e))}const r=await n.json();console.log("\ud83d\udd0d Raw SharePoint students response:",r);const o=r.d.results||[];return console.log("\u2705 Found ".concat(o.length," students")),o.length>0&&(console.log("\ud83d\udccb First student item:",o[0]),console.log("\ud83d\udccb First student team data:",o[0].Team)),this.parseStudents(o)}catch(e){throw console.error("\u274c Error loading students:",e),e}}parseStudents(e){console.log("\ud83d\udd0d Parsing ".concat(e.length," students"));const t=e.map(e=>{console.log("\ud83d\udd0d Processing student: ".concat(e.Title));let t=[],n=[];e.Team&&(e.Team.results&&Array.isArray(e.Team.results)?(console.log("  \ud83d\udccb Team data for ".concat(e.Title,":"),e.Team.results),t=e.Team.results.map(e=>({id:e.Id,title:e.Title,name:e.Title,email:e.EMail||""})),n=t.map(e=>e.id)):e.Team.Id&&(console.log("  \ud83d\udccb Single team member for ".concat(e.Title,":"),e.Team),t=[{id:e.Team.Id,title:e.Team.Title,name:e.Team.Title,email:e.Team.EMail||""}],n=[e.Team.Id]));const r=new L({id:e.Id,name:e.Title,program:e.Program||R.PRIMARY,ratioAM:e.RatioAM||"1:1",ratioPM:e.RatioPM||"1:1",isActive:!1!==e.IsActive,team:t,teamIds:n,pairedWith:e.PairedWith||null,absentAM:!0===e.AbsentAM,absentPM:!0===e.AbsentPM,absentFullDay:!0===e.AbsentFullDay});return t.length>0?console.log("\u2705 ".concat(e.Title," has ").concat(t.length," team members:"),t.map(e=>e.title)):console.log("\u26a0\ufe0f ".concat(e.Title," has no team members")),r});return console.log("\ud83d\udcca STUDENT LOAD SUMMARY:"),console.log("  Total students: ".concat(t.length)),console.log("  Students with teams: ".concat(t.filter(e=>e.team&&e.team.length>0).length)),t}async loadSchedule(e){try{return console.log("\ud83d\udcc5 Schedule loading temporarily disabled - returning empty schedule"),new q({date:e,assignments:[],lockedAssignments:new Set,isFinalized:!1})}catch(t){return console.error("Error in loadSchedule:",t),new q({date:e})}}async saveStaff(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{const n=await this.getHeaders(!0);t&&(n["X-HTTP-Method"]="MERGE",n["If-Match"]="*");const r=t?"".concat(this.config.siteUrl,"/_api/web/lists/getbytitle('").concat(this.config.staffListName,"')/items(").concat(e.id,")"):"".concat(this.config.siteUrl,"/_api/web/lists/getbytitle('").concat(this.config.staffListName,"')/items"),o={__metadata:{type:"SP.Data.StaffListItem"},Title:e.name,Role:e.role,Email:e.email,PrimaryProgram:e.primaryProgram,SecondaryProgram:e.secondaryProgram,IsActive:e.isActive,AbsentAM:e.absentAM||!1,AbsentPM:e.absentPM||!1,AbsentFullDay:e.absentFullDay||!1},a=await this.makeRequest(r,{method:"POST",headers:n,body:JSON.stringify(o)});if(!a.ok)throw new Error("Failed to save staff: ".concat(a.status));return a}catch(n){throw console.error("Error saving staff:",n),n}}async saveStudent(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{const n=await this.getHeaders(!0);t&&(n["X-HTTP-Method"]="MERGE",n["If-Match"]="*");const r=t?"".concat(this.config.siteUrl,"/_api/web/lists/getbytitle('").concat(this.config.studentsListName,"')/items(").concat(e.id,")"):"".concat(this.config.siteUrl,"/_api/web/lists/getbytitle('").concat(this.config.studentsListName,"')/items"),o=e.team&&e.team.length>0?e.team.map(e=>e.id||e.userId).filter(e=>e):[],a={__metadata:{type:"SP.Data.ClientsListItem"},Title:e.name,Program:e.program,RatioAM:e.ratioAM,RatioPM:e.ratioPM,IsActive:e.isActive,TeamId:{results:o},AbsentAM:e.absentAM||!1,AbsentPM:e.absentPM||!1,AbsentFullDay:e.absentFullDay||!1},i=await this.makeRequest(r,{method:"POST",headers:n,body:JSON.stringify(a)});if(!i.ok)throw new Error("Failed to save student: ".concat(i.status));return i}catch(n){throw console.error("Error saving student:",n),n}}async saveSchedule(e){try{var t;if(!this.isAuthenticated())return console.error("Cannot save schedule - not authenticated"),!1;console.log("\ud83d\udcbe Saving schedule to SharePoint...",e.date),console.log("\ud83d\udd0d Checking for ABASchedules list...");const n=await fetch("".concat(this.siteUrl,"/_api/web/lists/getbytitle('ABASchedules')"),{method:"GET",headers:{Authorization:"Bearer ".concat(this.accessToken),Accept:"application/json;odata=verbose"}});if(console.log("\ud83d\udccb List check response status:",n.status),!n.ok){if(404===n.status)console.warn("\ud83d\udccb ABASchedules list not found (404). Schedule history features are disabled.");else{console.error("\ud83d\udccb Error checking for ABASchedules list:",n.status,n.statusText);const e=await n.text();console.error("\ud83d\udccb Error details:",e)}return console.log("\u2139\ufe0f To enable schedule history, create SharePoint lists using SCHEDULE_HISTORY_SETUP.md"),!1}console.log("\u2705 ABASchedules list found!"),console.log("\ud83d\udd0d Checking for ABAAssignments list...");const r=await fetch("".concat(this.siteUrl,"/_api/web/lists/getbytitle('ABAAssignments')"),{method:"GET",headers:{Authorization:"Bearer ".concat(this.accessToken),Accept:"application/json;odata=verbose"}});if(!r.ok)return console.error("\u274c ABAAssignments list not found:",r.status),console.log("\u2139\ufe0f Both ABASchedules and ABAAssignments lists are required"),!1;console.log("\u2705 Both SharePoint lists found, proceeding with save...");const o={ScheduleDate:e.date,IsFinalized:e.isFinalized,TotalAssignments:e.assignments.length,CreatedDate:(new Date).toISOString(),CreatedBy:(null===(t=this.currentUser)||void 0===t?void 0:t.displayName)||"Unknown",AssignmentsSummary:this.generateAssignmentsSummary(e.assignments)},a=await fetch("".concat(this.siteUrl,"/_api/web/lists/getbytitle('ABASchedules')/items"),{method:"POST",headers:{Authorization:"Bearer ".concat(this.accessToken),Accept:"application/json;odata=verbose","Content-Type":"application/json;odata=verbose","X-RequestDigest":await this.getRequestDigest()},body:JSON.stringify(o)});if(!a.ok){const e=await a.text();return console.error("Failed to save schedule metadata:",e),!1}const i=(await a.json()).d.ID;console.log("\u2705 Schedule metadata saved with ID:",i);const s=e.assignments.map(e=>this.saveAssignmentToHistory(e,i)),l=await Promise.allSettled(s),c=l.filter(e=>"fulfilled"===e.status),u=l.filter(e=>"rejected"===e.status);return console.log("\u2705 Saved ".concat(c.length," assignments, ").concat(u.length," failed")),u.length>0&&console.warn("Some assignments failed to save:",u),!0}catch(n){return console.error("Error saving schedule:",n),!1}}generateAssignmentsSummary(e){const t={totalAssignments:e.length,byProgram:{},bySession:{},staffCount:new Set(e.map(e=>e.staffId)).size,studentCount:new Set(e.map(e=>e.studentId)).size};return e.forEach(e=>{t.byProgram[e.program]=(t.byProgram[e.program]||0)+1,t.bySession[e.session]=(t.bySession[e.session]||0)+1}),JSON.stringify(t)}async saveAssignmentToHistory(e,t){try{const n={ScheduleID:t,ScheduleDate:e.date||(new Date).toISOString().split("T")[0],StaffID:e.staffId,StudentID:e.studentId,Session:e.session,Program:e.program,AssignmentType:e.type||"Standard",CreatedDate:(new Date).toISOString(),IsLocked:e.isLocked||!1};console.log("\ud83d\udcbe Saving assignment to ABAAssignments list:",n);const r=await fetch("".concat(this.siteUrl,"/_api/web/lists/getbytitle('ABAAssignments')/items"),{method:"POST",headers:{Authorization:"Bearer ".concat(this.accessToken),Accept:"application/json;odata=verbose","Content-Type":"application/json;odata=verbose","X-RequestDigest":await this.getRequestDigest()},body:JSON.stringify(n)});if(!r.ok){const t=await r.text();return console.error("\u274c Failed to save assignment to ABAAssignments list:",r.status,t),{success:!1,assignment:e,error:t}}const o=await r.json();return console.log("\u2705 Assignment saved successfully, ID:",o.d.ID),{success:!0,id:o.d.ID,assignment:e}}catch(n){return console.error("\u274c Error saving assignment:",n),{success:!1,assignment:e,error:n.message}}}async getScheduleHistory(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:7;try{if(!this.isAuthenticated())return console.error("Cannot load schedule history - not authenticated"),[];const r=new Date,o=new Date(r);o.setDate(o.getDate()-n);const a="StaffID eq ".concat(e," and StudentID eq ").concat(t," and ScheduleDate ge '").concat(o.toISOString().split("T")[0],"' and ScheduleDate le '").concat(r.toISOString().split("T")[0],"'"),i=await fetch("".concat(this.siteUrl,"/_api/web/lists/getbytitle('ABAAssignments')/items?$filter=").concat(encodeURIComponent(a),"&$orderby=ScheduleDate desc"),{method:"GET",headers:{Authorization:"Bearer ".concat(this.accessToken),Accept:"application/json;odata=verbose"}});if(!i.ok)return console.error("Failed to load schedule history"),[];return(await i.json()).d.results.map(e=>({date:e.ScheduleDate,staffId:e.StaffID,studentId:e.StudentID,session:e.Session,program:e.Program}))}catch(r){return console.error("Error loading schedule history:",r),[]}}async checkConsecutiveDaysRule(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3;try{const r=await this.getScheduleHistory(e,t,n+2);if(0===r.length)return{allowed:!0,consecutiveDays:0};const o=r.sort((e,t)=>new Date(e.date)-new Date(t.date));let a=0;(new Date).toISOString().split("T")[0];for(let e=o.length-1;e>=0;e--){const t=o[e].date,n=new Date;if(n.setDate(n.getDate()-(a+1)),t!==n.toISOString().split("T")[0])break;a++}return{allowed:a<n,consecutiveDays:a,message:a>=n?"".concat(e," has worked with ").concat(t," for ").concat(a," consecutive days. Consider assigning different staff."):null}}catch(r){return console.error("Error checking consecutive days rule:",r),{allowed:!0,consecutiveDays:0,error:r.message}}}}class Xd{constructor(e){this.config=e,this.accessToken=null}setAccessToken(e){this.accessToken=e}getHeaders(){const e={Accept:"application/json;odata=verbose","Content-Type":"application/json;odata=verbose"};return this.accessToken&&(e.Authorization="Bearer ".concat(this.accessToken)),e}async searchUsers(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;try{const n=await fetch("".concat(this.config.siteUrl,"/_api/web/siteusers?$filter=substringof('").concat(e,"',Title) or substringof('").concat(e,"',Email)&$top=").concat(t),{headers:this.getHeaders()});if(!n.ok)throw new Error("Failed to search users: ".concat(n.status));return(await n.json()).d.results.map(e=>({id:e.Id,title:e.Title,email:e.Email,loginName:e.LoginName,principalType:e.PrincipalType}))}catch(n){throw console.error("Error searching users:",n),n}}async getUserById(e){try{const t=await fetch("".concat(this.config.siteUrl,"/_api/web/siteusers/getbyid(").concat(e,")"),{headers:this.getHeaders()});if(!t.ok)throw new Error("Failed to get user: ".concat(t.status));const n=await t.json();return{id:n.d.Id,title:n.d.Title,email:n.d.Email,loginName:n.d.LoginName,principalType:n.d.PrincipalType}}catch(t){throw console.error("Error getting user by ID:",t),t}}async resolveUserByEmail(e){try{const t=await fetch("".concat(this.config.siteUrl,"/_api/web/ensureuser"),{method:"POST",headers:c(c({},this.getHeaders()),{},{"X-RequestDigest":await this.getRequestDigest()}),body:JSON.stringify({logonName:e})});if(!t.ok)throw new Error("Failed to resolve user: ".concat(t.status));const n=await t.json();return{id:n.d.Id,title:n.d.Title,email:n.d.Email,loginName:n.d.LoginName,principalType:n.d.PrincipalType}}catch(t){throw console.error("Error resolving user by email:",t),t}}async getRequestDigest(){try{const e=await fetch("".concat(this.config.siteUrl,"/_api/contextinfo"),{method:"POST",headers:this.getHeaders()});if(!e.ok)throw new Error("Failed to get request digest: ".concat(e.status));return(await e.json()).d.GetContextWebInformation.FormDigestValue}catch(e){throw console.error("Error getting request digest:",e),e}}formatForPeoplePicker(e){return e&&0!==e.length?{results:e}:null}extractUserIds(e){return e&&e.results?e.results.map(e=>e.Id||e.id):[]}async getAllSiteUsers(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];try{let t="".concat(this.config.siteUrl,"/_api/web/siteusers?$top=1000");e&&(t+="&$filter=PrincipalType eq 1");const n=await fetch(t,{headers:this.getHeaders()});if(!n.ok)throw new Error("Failed to get site users: ".concat(n.status));return(await n.json()).d.results.filter(e=>e.Title&&e.Email).map(e=>({id:e.Id,title:e.Title,email:e.Email,loginName:e.LoginName,principalType:e.PrincipalType})).sort((e,t)=>e.title.localeCompare(t.title))}catch(t){throw console.error("Error getting all site users:",t),t}}async validateUserIds(e){const t=[],n=[];for(const o of e)try{const e=await this.getUserById(o);t.push(e)}catch(r){n.push(o)}return{validUsers:t,invalidIds:n}}}class Zd{constructor(){this.debugMode=!1,this.maxIterations=50,this.maxChainDepth=5}getStaffPriorityScore(e){return{RBT:1,BS:2,EA:10,BCBA:20,CC:21,MHA:22,Teacher:999,Director:999,TEACHER:999,DIRECTOR:999}[e.role]||50}canStaffDoDirectService(e){return!["Teacher","Director","TEACHER","DIRECTOR"].includes(e.role)&&e.canDoDirectSessions()}sortStaffForStudentStrict(e,t,n){return[...t].sort((t,r)=>{const o=e.teamIds.includes(t.id),a=e.teamIds.includes(r.id);if(o&&!a)return-1;if(!o&&a)return 1;const i=this.getStaffPriorityScore(t),s=this.getStaffPriorityScore(r);return i!==s?i-s:"PM"===n&&i===s?Math.random()-.5:t.name.localeCompare(r.name)})}countUnassignedStudents(e,t){let n=0;const r=["AM","PM"];return t.filter(e=>e.isActive).forEach(t=>{r.forEach(r=>{t.isAvailableForSession(r)&&(this.isStudentAssigned(t.id,r,t.program,e)||n++)})}),n}findReplacementStaff(e,t,n,r,o){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[];const i=r.filter(r=>!!r.isActive&&(!!r.isAvailableForSession(t)&&(!!r.canWorkProgram(n)&&(!a.includes(r.id)&&(!!e.teamIds.includes(r.id)&&(!!this.canStaffDoDirectService(r)&&(!!o.isStaffAvailable(r.id,t,n)&&!o.hasStaffWorkedWithStudentToday(r.id,e.id))))))));if(0===i.length)return null;return this.sortStaffForStudentStrict(e,i,t)[0]}async findSimpleSwapWithUnassignedStaff(e,t,n,r,o,a){console.log("    \ud83d\udca1 SMART STRATEGY: Looking for unassigned staff who can enable swaps...");const i=r.filter(r=>!!r.isActive&&(!!r.canWorkProgram(n)&&(!!this.canStaffDoDirectService(r)&&(!!["RBT","BS"].includes(r.role)&&(!e.teamIds.includes(r.id)&&a.isStaffAvailable(r.id,t,n))))));console.log("    \ud83d\udcca Found ".concat(i.length," unassigned RBT/BS not on ").concat(e.name,"'s team in ").concat(n," ").concat(t));const s=r.filter(t=>e.teamIds.includes(t.id)&&this.canStaffDoDirectService(t));for(const l of s){if(a.isStaffAvailable(l.id,t,n)){console.log("    \u23ed\ufe0f ".concat(l.name," is already available in ").concat(t," ").concat(n));continue}const s=a.assignments.filter(e=>e.staffId===l.id&&e.session===t&&e.program===n);if(0!==s.length)for(const c of s){const s=o.find(e=>e.id===c.studentId);if(!s){console.log("    \u26a0\ufe0f Could not find student with id ".concat(c.studentId));continue}console.log("    \ud83d\udd0d ".concat(l.name," is with ").concat(s.name));let u=!1;for(const o of i){if(!s.teamIds.includes(o.id)){console.log("      \u23ed\ufe0f ".concat(o.name," is NOT on ").concat(s.name,"'s team"));continue}u=!0,console.log("      \ud83d\udca1 ".concat(o.name," (unassigned, not on ").concat(e.name,"'s team) IS on ").concat(s.name,"'s team! Attempting swap..."));const i=[];i.push(c);const d=a.assignments.filter(e=>e.staffId===l.id&&e.session===t&&e.program===n&&e.id!==c.id);i.push(...d);const h=[...a.assignments];i.forEach(e=>{const t=a.assignments.findIndex(t=>t.id===e.id);t>-1&&a.assignments.splice(t,1)}),console.log("      \ud83d\udd27 Temporarily removed ".concat(i.length," conflicting assignment(s) for validation"));const g=new F({id:U.generateAssignmentId(),staffId:o.id,studentId:s.id,session:t,program:n,date:a.date,isLocked:!1,assignedBy:"smart-swap"}),m=new F({id:U.generateAssignmentId(),staffId:l.id,studentId:e.id,session:t,program:n,date:a.date,isLocked:!1,assignedBy:"smart-swap"});console.log("      \ud83d\udd0d Validating: ".concat(o.name," \u2192 ").concat(s.name));const f=z.validateAssignment(g,a,r,[s]);console.log("      \ud83d\udd0d Validating: ".concat(l.name," \u2192 ").concat(e.name));const p=z.validateAssignment(m,a,r,[e]);if(a.assignments=h,0===f.length&&0===p.length)return console.log("      \u2705 SMART SWAP SUCCESS! ".concat(o.name," \u2192 ").concat(s.name,", ").concat(l.name," \u2192 ").concat(e.name)),{success:!0,swaps:[{description:"Smart swap: ".concat(o.name," covers ").concat(s.name,", freeing ").concat(l.name," for ").concat(e.name)}],newAssignments:[g,m],changes:[...i.map(e=>({type:"remove",assignmentId:e.id})),{type:"add",assignment:g},{type:"add",assignment:m}],description:"".concat(o.name," \u2192 ").concat(s.name,", ").concat(l.name," \u2192 ").concat(e.name)};console.log("      \u274c Validation failed: ".concat([...f,...p].join(", ")))}u||console.log("      \u274c No eligible unassigned RBT/BS found for ".concat(s.name))}else console.log("    \u26a0\ufe0f No assignments found for ".concat(l.name," in ").concat(t," ").concat(n))}return console.log("    \u274c No simple swaps found with unassigned RBT/BS not on ".concat(e.name,"'s team")),{success:!1}}async findAndSwapUnderutilizedStaff(e,t,n,r,o,a){console.log("    \ud83d\udd0d ULTRA-AGGRESSIVE: Looking for swap chains for ".concat(e.name,"..."));this.getRequiredStaffCount(e,t);const i=r.filter(t=>e.teamIds.includes(t.id)&&this.canStaffDoDirectService(t));if(console.log("    \ud83d\udcca ".concat(e.name," has ").concat(i.length," team members total")),0===i.length)return console.log("    \u274c No team members at all - cannot proceed"),{success:!1};for(const s of i){if(console.log("\n    \ud83d\udd04 Trying to free up: ".concat(s.name," (").concat(s.role,")")),a.isStaffAvailable(s.id,t,n)){console.log("      \u2705 ".concat(s.name," is already available!"));const o=new F({id:U.generateAssignmentId(),staffId:s.id,studentId:e.id,session:t,program:n,date:a.date,isLocked:!1,assignedBy:"reshuffle-direct"});if(0===z.validateAssignment(o,a,r,[e]).length)return console.log("      \u2705 DIRECT ASSIGNMENT SUCCESS!"),{success:!0,swaps:[{description:"Direct assignment: ".concat(s.name," \u2192 ").concat(e.name)}],newAssignments:[o],changes:[{type:"add",assignment:o}],description:"".concat(s.name," directly assigned to ").concat(e.name)}}const i=await this.findSwapChain(s,e,t,n,r,o,a,3);if(i.success)return console.log("      \u2705 SWAP CHAIN SUCCESS! Chain length: ".concat(i.chain.length)),i}return console.log("    \u274c Could not free any of ".concat(i.length," team members")),{success:!1}}async findSwapChain(e,t,n,r,o,a,i,s){let l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:new Set;if(console.log("      \ud83d\udd17 Finding swap chain for ".concat(e.name," (depth ").concat(s,")")),l.has(e.id)||s<=0)return{success:!1};l.add(e.id);const c=i.assignments.filter(t=>t.staffId===e.id);if(0===c.length)return{success:!1};for(const u of c){const c=a.find(e=>e.id===u.studentId);if(!c)continue;if(u.session===n&&u.program===r){console.log("        \u23ed\ufe0f ".concat(e.name," already in ").concat(n," ").concat(r,", checking next..."));continue}console.log("        \ud83d\udccc ".concat(e.name," currently with ").concat(c.name," (").concat(u.program," ").concat(u.session,")"));const d=this.findPotentialReplacements(c,u.session,u.program,o,i,[e.id]);console.log("        \ud83d\udd0d Found ".concat(d.length," potential replacements for ").concat(c.name));for(const h of d)if(console.log("          \ud83d\udca1 Trying ".concat(h.name," (").concat(h.role,") as replacement")),i.isStaffAvailable(h.id,u.session,u.program)){console.log("          \u2705 Direct swap available!");const s=this.createSwapChain(e,t,n,r,c,u,h,i,o,a);if(s.success)return s}else{console.log("          \ud83d\udd04 ".concat(h.name," is busy, trying recursive chain..."));const d=await this.findSwapChain(h,c,u.session,u.program,o,a,i,s-1,new Set(l));if(d.success){console.log("          \u2705 Recursive chain found! Combining...");const s=this.createSwapChain(e,t,n,r,c,u,h,i,o,a);if(s.success)return{success:!0,chain:[...d.chain,...s.chain],swaps:[...d.swaps,...s.swaps],newAssignments:[...d.newAssignments,...s.newAssignments],changes:[...d.changes,...s.changes],description:"Multi-level chain: ".concat(d.description," \u2192 ").concat(s.description)}}}}return{success:!1}}findPotentialReplacements(e,t,n,r,o){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[];const i=r.filter(t=>!!t.isActive&&(!!t.canWorkProgram(n)&&(!a.includes(t.id)&&(!!e.teamIds.includes(t.id)&&!!this.canStaffDoDirectService(t)))));return this.sortStaffForStudentStrict(e,i,t)}createSwapChain(e,t,n,r,o,a,i,s,l,c){console.log("          \ud83d\udd28 Creating swap chain:"),console.log("             1. ".concat(i.name," \u2192 ").concat(o.name," (").concat(a.program," ").concat(a.session,")")),console.log("             2. ".concat(e.name," \u2192 ").concat(t.name," (").concat(r," ").concat(n,")"));const u=new F({id:U.generateAssignmentId(),staffId:i.id,studentId:o.id,session:a.session,program:a.program,date:s.date,isLocked:!1,assignedBy:"chain-swap"}),d=new F({id:U.generateAssignmentId(),staffId:e.id,studentId:t.id,session:n,program:r,date:s.date,isLocked:!1,assignedBy:"chain-swap"}),h=z.validateAssignment(u,s,l,[o]),g=z.validateAssignment(d,s,l,[t]);return h.length>0?(console.log("          \u274c Replacement validation failed: ".concat(h.join(", "))),{success:!1}):g.length>0?(console.log("          \u274c Final validation failed: ".concat(g.join(", "))),{success:!1}):{success:!0,chain:[{from:i.name,to:o.name},{from:e.name,to:t.name}],swaps:[{description:"Chain: ".concat(i.name," \u2192 ").concat(o.name,", ").concat(e.name," \u2192 ").concat(t.name)}],newAssignments:[u,d],changes:[{type:"remove",assignmentId:a.id},{type:"add",assignment:u},{type:"add",assignment:d}],description:"".concat(i.name," covers ").concat(o.name,", freeing ").concat(e.name," for ").concat(t.name)}}async redistributeFromOverAssigned(e,t,n,r,o,a){return console.log("    \ud83d\udd0d Looking for over-assigned students..."),{success:!1}}async performFullScheduleReshuffle(e,t,n){console.log("\n\ud83d\udd04 ========== FULL SCHEDULE RESHUFFLE =========="),console.log("\ud83d\udcca Starting comprehensive reassignment to eliminate all gaps...");const r=["AM","PM"],o=[R.PRIMARY,R.SECONDARY],a=[];for(const c of o)for(const t of r)n.filter(e=>e.isActive&&e.program===c).forEach(n=>{n.isAvailableForSession(t)&&(this.isStudentAssigned(n.id,t,c,e)||a.push({student:n,session:t,program:c}))});if(0===a.length)return console.log("\u2705 No unassigned students - schedule is complete!"),{success:!0,swaps:[]};console.log("\ud83d\udccb Found ".concat(a.length," unassigned student-sessions")),a.forEach(e=>{console.log("  - ".concat(e.student.name," (").concat(e.program," ").concat(e.session,")"))});const i=[],s=[];let l=0;for(;a.length>0&&l<20;){l++,console.log("\n\ud83d\udd04 Reshuffle Iteration ".concat(l,"/").concat(20));const r=c({},a[0]),{student:o,session:u,program:d}=r;console.log("\n\ud83c\udfaf Attempting to assign: ".concat(o.name," (").concat(d," ").concat(u,")"));const h=await this.findSimpleSwapWithUnassignedStaff(o,u,d,t,n,e);if(h.success){console.log("  \u2705 SUCCESS via smart swap: ".concat(h.description)),i.push(...h.swaps),s.push(...h.newAssignments),h.changes.forEach(t=>{"add"===t.type?e.addAssignment(t.assignment):"remove"===t.type&&e.removeAssignment(t.assignmentId)}),a.shift();continue}const g=await this.findAndSwapUnderutilizedStaff(o,u,d,t,n,e);if(g.success){console.log("  \u2705 SUCCESS via swap: ".concat(g.description)),i.push(...g.swaps),s.push(...g.newAssignments),g.changes.forEach(t=>{"add"===t.type?e.addAssignment(t.assignment):"remove"===t.type&&e.removeAssignment(t.assignmentId)}),a.shift();continue}const m=await this.redistributeFromOverAssigned(o,u,d,t,n,e);if(m.success)console.log("  \u2705 SUCCESS via redistribution: ".concat(m.description)),i.push(...m.swaps),s.push(...m.newAssignments),m.changes.forEach(t=>{"add"===t.type?e.addAssignment(t.assignment):"remove"===t.type&&e.removeAssignment(t.assignmentId)}),a.shift();else if(console.log("  \u274c Cannot assign ".concat(o.name," - moving to end of queue")),a.push(a.shift()),l%a.length===0){console.log("  \ud83d\uded1 No progress after full cycle - stopping reshuffle");break}}return console.log("\n\ud83c\udfaf RESHUFFLE COMPLETE:"),console.log("  Iterations: ".concat(l)),console.log("  Swaps made: ".concat(i.length)),console.log("  New assignments: ".concat(s.length)),console.log("  Remaining unassigned: ".concat(a.length)),{success:0===a.length,swaps:i,newAssignments:s,remainingUnassigned:a}}async autoAssignSchedule(e,t,n){const r=[],o=[];console.log("\n\ud83d\ude80 ========== STARTING AUTO-ASSIGNMENT ==========");const a=t.filter(e=>e.isActive),i=n.filter(e=>e.isActive);console.log("\ud83d\udcca Active: ".concat(a.length," staff, ").concat(i.length," students")),console.log("\ud83d\udcca Attendance - Staff absent AM: ".concat(a.filter(e=>e.absentAM||e.absentFullDay).length,", PM: ").concat(a.filter(e=>e.absentPM||e.absentFullDay).length)),console.log("\ud83d\udcca Attendance - Students absent AM: ".concat(i.filter(e=>e.absentAM||e.absentFullDay).length,", PM: ").concat(i.filter(e=>e.absentPM||e.absentFullDay).length));const s=["AM","PM"],l=[R.PRIMARY,R.SECONDARY];for(const d of l)for(const t of s){console.log("\n\ud83d\udccb ===== ".concat(d," ").concat(t," ====="));const n=i.filter(n=>n.program===d&&n.isAvailableForSession(t)&&!this.isStudentAssigned(n.id,t,d,e)),s=this.prioritizeStudents(n,t);for(const l of s)try{if(l.isPaired()){const c=l.getPairedStudent(i);if(c&&n.includes(c)){const n=await this.assignPairedStudents(l,c,t,d,a,e);if(n.length>0){r.push(...n),n.forEach(t=>e.addAssignment(t));const t=s.indexOf(c);t>-1&&s.splice(t,1)}else o.push("Could not assign paired: ".concat(l.name," & ").concat(c.name));continue}}const c=await this.assignStudent(l,t,d,a,e);c.length>0?(r.push(...c),c.forEach(t=>e.addAssignment(t))):o.push("Could not assign: ".concat(l.name," in ").concat(d," ").concat(t))}catch(u){o.push("Error: ".concat(l.name," - ").concat(u.message))}}console.log("\n\u2705 PHASE 1 COMPLETE: ".concat(r.length," assignments created"));const c=this.countUnassignedStudents(e,n);if(c>0){console.log("\n\ud83d\udd04 PHASE 2: ".concat(c," gaps found - initiating FULL RESHUFFLE"));const a=await this.performFullScheduleReshuffle(e,t,n);a.success?(console.log("\n\ud83c\udf89 RESHUFFLE SUCCESS: All students assigned!"),r.push(...a.newAssignments)):(console.log("\n\u26a0\ufe0f RESHUFFLE INCOMPLETE: ".concat(a.remainingUnassigned.length," still unassigned")),a.remainingUnassigned.forEach(e=>{o.push("Final gap: ".concat(e.student.name," in ").concat(e.program," ").concat(e.session))}))}else console.log("\n\u2705 PHASE 2: No gaps found - schedule is perfect!");return console.log("\n\ud83c\udfaf ========== AUTO-ASSIGNMENT COMPLETE =========="),console.log("\ud83d\udcca Total assignments: ".concat(r.length)),console.log("\u274c Errors: ".concat(o.length)),{assignments:r,errors:o}}async assignStudent(e,t,n,r,o){const a=[],i=this.getRequiredStaffCount(e,t);if(console.log("\n\ud83c\udfaf Assigning ".concat(e.name," for ").concat(n," ").concat(t," (needs ").concat(i," staff)")),e.isSmallGroup(t))return this.assignSmallGroupStudent(e,t,n,r,o);const s=U.getAvailableStaffForStudent(e,t,n,r,o);let l=s.filter(t=>{var n,r;if(!(e.teamIds.includes(t.id)||t.email&&(null===(n=e.team)||void 0===n?void 0:n.some(e=>{var n,r;return(null===(n=e.email)||void 0===n?void 0:n.toLowerCase())===(null===(r=t.email)||void 0===r?void 0:r.toLowerCase())}))||(null===(r=e.team)||void 0===r?void 0:r.some(e=>{var n,r;return(null===(n=e.title||e.name)||void 0===n?void 0:n.toLowerCase())===(null===(r=t.name)||void 0===r?void 0:r.toLowerCase())}))))return!1;return["Teacher","Director","TEACHER","DIRECTOR"].includes(t.role)?(console.log("  \ud83d\udeab BLOCKING ".concat(t.name,": ").concat(t.role," cannot do direct service")),!1):!!t.canDoDirectSessions()||(console.log("  \ud83d\udeab BLOCKING ".concat(t.name,": Cannot do direct sessions")),!1)});console.log("  \ud83d\udcca Team staff breakdown:"),console.log("    Total available: ".concat(s.length)),console.log("    Team members: ".concat(l.length));const c=l.filter(e=>"RBT"===e.role||"BS"===e.role),u=l.filter(e=>"EA"===e.role),d=l.filter(e=>"RBT"!==e.role&&"BS"!==e.role&&"EA"!==e.role);let h;if(console.log("    RBT/BS: ".concat(c.length)),console.log("    EA: ".concat(u.length)),console.log("    Other: ".concat(d.length)),c.length>=i?(h=c,console.log("  \u2705 Using ONLY RBT/BS staff")):c.length+u.length>=i?(h=[...c,...u],console.log("  \u26a0\ufe0f Using RBT/BS + EA staff (".concat(c.length," RBT/BS + ").concat(Math.min(u.length,i-c.length)," EA)"))):(h=l,console.log("  \ud83d\udea8 Using all available team staff (still short)")),h.length<i)return console.log("  \u274c INSUFFICIENT: Need ".concat(i,", have ").concat(h.length," team members")),[];const g=this.sortStaffForStudentWithShuffling(e,h,t);console.log("  \ud83d\udccb Assignment order:"),g.slice(0,i).forEach((e,t)=>{console.log("    ".concat(t+1,". ").concat(e.name," (").concat(e.role,")"))});for(let m=0;m<i&&m<g.length;m++){const i=new F({id:U.generateAssignmentId(),staffId:g[m].id,studentId:e.id,session:t,program:n,date:o.date,isLocked:!1,assignedBy:"auto"}),s=z.validateAssignment(i,o,r,[e]);0===s.length?(a.push(i),console.log("  \u2705 Assigned ".concat(g[m].name," (").concat(g[m].role,")"))):console.log("  \u274c Cannot assign ".concat(g[m].name,": ").concat(s.join(", ")))}return a}assignSmallGroupStudent(e,t,n,r,o){if("function"!==typeof o.getAssignmentsForSession)return console.error("Schedule object missing getAssignmentsForSession method",o),[];const a=o.getAssignmentsForSession(t,n);for(const l of a){const i=this.findStudentById(l.studentId);if(i&&i.isSmallGroup(t)){if(1===a.filter(e=>e.staffId===l.staffId).length){const a=r.find(e=>e.id===l.staffId);if(a&&this.canStaffWorkWithStudent(a,e,o)){const r=new F({id:U.generateAssignmentId(),staffId:l.staffId,studentId:e.id,session:t,program:n,date:o.date,isLocked:!1,assignedBy:"auto"});return this.log("  Added ".concat(e.name," to existing small group with ").concat(a.name)),[r]}}}}let i=U.getAvailableStaffForStudent(e,t,n,r,o).filter(t=>e.teamIds.includes(t.id));const s=i.filter(e=>e.isPreferredDirectService());if(i=s.length>0?s:i.filter(e=>e.canDoDirectSessions()),i.length>0){const r=this.sortStaffForStudentWithShuffling(e,i,t),a=new F({id:U.generateAssignmentId(),staffId:r[0].id,studentId:e.id,session:t,program:n,date:o.date,isLocked:!1,assignedBy:"auto"});return this.log("  Started new small group with ".concat(r[0].name," for ").concat(e.name)),[a]}return[]}sortStaffForStudent(e,t){return[...t].sort((t,n)=>{const r=e.teamIds.includes(t.id),o=e.teamIds.includes(n.id);if(r&&!o)return-1;if(!r&&o)return 1;const a=t.isPreferredDirectService(),i=n.isPreferredDirectService();if(a&&!i)return-1;if(!a&&i)return 1;const s=t.getRoleLevel(),l=n.getRoleLevel();return s!==l?s-l:t.name.localeCompare(n.name)})}sortStaffForStudentWithShuffling(e,t,n){const r=t.filter(e=>e.isPreferredDirectService());console.log("\ud83d\udd0d STAFF PRIORITY DEBUG for ".concat(e.name,":")),console.log("  Total team staff: ".concat(t.length)),console.log("  Preferred staff (RBTs/BSs): ".concat(r.length)),console.log("  Preferred staff list:",r.map(e=>"".concat(e.name," (").concat(e.role,")")));const o=r.length>0?r:t;0===r.length&&console.log("\u26a0\ufe0f WARNING: No preferred staff (RBTs/BSs) available for ".concat(e.name,", using fallback staff"));const a="PM"===n?2:.8;return[...o].map(t=>({staff:t,isTeamMember:e.teamIds.includes(t.id),roleLevel:t.getRoleLevel(),isPreferred:t.isPreferredDirectService(),randomFactor:Math.random()*a})).sort((e,t)=>{if(e.isTeamMember&&!t.isTeamMember)return-1;if(!e.isTeamMember&&t.isTeamMember)return 1;if(e.isPreferred&&!t.isPreferred)return-1;if(!e.isPreferred&&t.isPreferred)return 1;const r=e.roleLevel+e.randomFactor,o=t.roleLevel+t.randomFactor,a="PM"===n?1.5:.3;return Math.abs(r-o)>a?r-o:e.staff.name.localeCompare(t.staff.name)}).map(e=>e.staff)}prioritizeStudents(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"AM";return[...e].sort((e,n)=>{if(e.requiresMultipleStaff(t)&&!n.requiresMultipleStaff(t))return-1;if(!e.requiresMultipleStaff(t)&&n.requiresMultipleStaff(t))return 1;const r=e.teamIds.length,o=n.teamIds.length;return r!==o?r-o:e.name.localeCompare(n.name)})}getRequiredStaffCount(e){switch("AM"===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"AM")?e.ratioAM:e.ratioPM){case j.TWO_TO_ONE:return 2;case j.ONE_TO_ONE:case j.ONE_TO_TWO:default:return 1}}isStudentAssigned(e,t,n,r){if("function"!==typeof r.getAssignmentsForSession)return console.error("Schedule object missing getAssignmentsForSession method",r),!1;return r.getAssignmentsForSession(t,n).some(t=>t.studentId===e)}canStaffWorkWithStudent(e,t,n){return!n.hasStaffWorkedWithStudentToday(e.id,t.id)}findStudentById(e){return null}optimizeAssignments(e,t,n){return this.log("Assignment optimization not yet implemented"),e.assignments}setDebugMode(e){this.debugMode=e}log(e){this.debugMode&&console.log("[AutoAssignment] ".concat(e))}generateStats(e,t,n){const r={totalAssignments:e.assignments.length,staffUtilization:{},unassignedStudents:[],assignmentsBySession:{},ratioDistribution:{}};t.filter(e=>e.isActive).forEach(t=>{const n=e.getStaffAssignments(t.id);r.staffUtilization[t.name]={assignmentCount:n.length,utilizationRate:n.length/2}});const o=n.filter(e=>e.isActive);return o.forEach(t=>{const n=e.getStudentAssignments(t.id);n.length<2&&r.unassignedStudents.push({name:t.name,assignmentCount:n.length,requiredCount:2})}),["AM","PM"].forEach(t=>{[R.PRIMARY,R.SECONDARY].forEach(n=>{const o="".concat(n,"_").concat(t);"function"===typeof e.getAssignmentsForSession?r.assignmentsBySession[o]=e.getAssignmentsForSession(t,n).length:(r.assignmentsBySession[o]=0,console.error("Schedule object missing getAssignmentsForSession method in stats collection"))})}),Object.values(j).forEach(e=>{const t=o.filter(t=>t.ratio===e).length;r.ratioDistribution[e]=t}),r}async assignPairedStudents(e,t,n,r,o,a){const i=[];if(this.log("Assigning paired students: ".concat(e.name," and ").concat(t.name)),this.isStudentAssigned(e.id,n,r,a)||this.isStudentAssigned(t.id,n,r,a))return this.log("One of the paired students is already assigned"),[];const s=this.getRequiredStaffCount(e,n),l=this.getRequiredStaffCount(t,n),c=s+l;this.log("Paired students need ".concat(s," + ").concat(l," = ").concat(c," staff total"));const u=U.getAvailableStaffForStudent(e,n,r,o,a).filter(e=>this.canStaffWorkWithStudent(e,t,a));if(u.length<c)return this.log("Insufficient staff for paired students. Need ".concat(c,", have ").concat(u.length)),[];const d=this.sortStaffForStudent(e,u);if(e.isSmallGroup(n)&&t.isSmallGroup(n)){if(this.log("Both students are 1:2 ratio - assigning same staff to both"),0===d.length)return this.log("No available staff for paired 1:2 students"),[];const s=d[0],l=new F({id:U.generateAssignmentId(),staffId:s.id,studentId:e.id,session:n,program:r,date:a.date,isLocked:!1,assignedBy:"auto-paired"}),c=new F({id:U.generateAssignmentId(),staffId:s.id,studentId:t.id,session:n,program:r,date:a.date,isLocked:!1,assignedBy:"auto-paired"}),u=z.validateAssignment(l,a,o,[e,t]),h=z.validateAssignment(c,a,o,[e,t]);if(0!==u.length||0!==h.length)return this.log("  Cannot assign ".concat(s.name," to paired students: ").concat([...u,...h].join(", "))),[];i.push(l,c),this.log("  Assigned ".concat(s.name," to both ").concat(e.name," and ").concat(t.name," (shared 1:2)"))}else{this.log("Assigning staff for ratios: ".concat(e.getSessionRatio(n)," and ").concat(t.getSessionRatio(n)));const c=Math.max(s,l);for(let u=0;u<c&&u<d.length;u++){const c=d[u];if(u<s){const s=new F({id:U.generateAssignmentId(),staffId:c.id,studentId:e.id,session:n,program:r,date:a.date,isLocked:!1,assignedBy:"auto-paired"}),l=z.validateAssignment(s,a,o,[e,t]);if(0!==l.length)return this.log("  Cannot assign ".concat(c.name," to ").concat(e.name,": ").concat(l.join(", "))),[];i.push(s),this.log("  Assigned ".concat(c.name," to ").concat(e.name," (paired)"))}if(u<l){const s=new F({id:U.generateAssignmentId(),staffId:c.id,studentId:t.id,session:n,program:r,date:a.date,isLocked:!1,assignedBy:"auto-paired"}),l=z.validateAssignment(s,a,o,[e,t]);if(0!==l.length)return this.log("  Cannot assign ".concat(c.name," to ").concat(t.name,": ").concat(l.join(", "))),[];i.push(s),this.log("  Assigned ".concat(c.name," to ").concat(t.name," (paired)"))}}}const h=i.filter(t=>t.studentId===e.id),g=i.filter(e=>e.studentId===t.id);return h.length===s&&g.length===l?(this.log("Successfully assigned ".concat(i.length," staff to paired students")),i):(this.log("Failed to assign sufficient staff to paired students"),[])}async validateStaffSwap(e,t,n,r,o,a,i){const s=i.find(t=>t.id===e.studentId);if(!s)return!1;const l=new F({id:U.generateAssignmentId(),staffId:n.id,studentId:s.id,session:e.session,program:e.program,date:o.date,isLocked:!1,assignedBy:"auto-swap"}),c=z.validateAssignment(l,o,a,[s]);if(c.length>0)return console.log("      \u274c Replacement validation failed: ".concat(c.join(", "))),!1;const u=new F({id:U.generateAssignmentId(),staffId:t.id,studentId:r.id,session:e.session,program:e.program,date:o.date,isLocked:!1,assignedBy:"auto-swap"}),d=z.validateAssignment(u,o,a,[r]);return!(d.length>0)||(console.log("      \u274c New assignment validation failed: ".concat(d.join(", "))),!1)}async executeStaffSwap(e,t,n,r,o,a,i){try{const s=e.studentId,l=new F({id:U.generateAssignmentId(),staffId:n.id,studentId:s,session:o,program:a,date:i.date,isLocked:!1,assignedBy:"auto-swap"}),c=new F({id:U.generateAssignmentId(),staffId:t.id,studentId:r.id,session:o,program:a,date:i.date,isLocked:!1,assignedBy:"auto-swap"});return{success:!0,swap:{originalAssignment:e,replacementAssignment:l,newAssignment:c,unassignedStudent:r.name,description:"".concat(n.name,"(").concat(n.role,") \u2192 Student").concat(s,", ").concat(t.name,"(").concat(t.role,") \u2192 ").concat(r.name)},newAssignments:[l,c]}}catch(s){return console.log("      \u274c Swap execution failed: ".concat(s.message)),{success:!1}}}generateUltimateFinalReport(e,t,n){const r=["AM","PM"],o=(R.PRIMARY,R.SECONDARY,[]);let a=0;return n.forEach(t=>{const n=[];r.forEach(r=>{if(t.program){this.isStudentAssigned(t.id,r,t.program,e)?a++:n.push("".concat(t.program," ").concat(r))}}),n.length>0&&o.push({name:t.name,missingSessions:n})}),{totalStudents:n.length,assignedStudents:n.length-o.length,unassignedStudents:o,totalAssignments:a}}async validateChainReassignment(e,t,n,r,o,a,i){const s=i.find(t=>t.id===e.studentId);if(!s)return!1;const l=new F({id:U.generateAssignmentId(),staffId:n.id,studentId:s.id,session:e.session,program:e.program,date:o.date,isLocked:!1,assignedBy:"auto-chain"});if(z.validateAssignment(l,o,a,[s]).length>0)return!1;const c=new F({id:U.generateAssignmentId(),staffId:t.id,studentId:r.id,session:e.session,program:e.program,date:o.date,isLocked:!1,assignedBy:"auto-chain"});return 0===z.validateAssignment(c,o,a,[r]).length}async executeChainReassignment(e,t,n,r,o,a,i){try{const s=e.studentId,l=new F({id:U.generateAssignmentId(),staffId:n.id,studentId:s,session:o,program:a,date:i.date,isLocked:!1,assignedBy:"auto-chain"}),c=new F({id:U.generateAssignmentId(),staffId:t.id,studentId:r.id,session:o,program:a,date:i.date,isLocked:!1,assignedBy:"auto-chain"});return{success:!0,swaps:[{type:"chain",description:"Chain: ".concat(n.name,"(").concat(n.role,") \u2192 Student").concat(s,", ").concat(t.name,"(").concat(t.role,") \u2192 ").concat(r.name)}],newAssignments:[l,c],changes:[{type:"remove",assignmentId:e.id},{type:"add",assignment:l},{type:"add",assignment:c}],description:"".concat(n.name," \u2192 Student").concat(s,", ").concat(t.name," \u2192 ").concat(r.name)}}catch(s){return{success:!1}}}async executeCrossSessionReallocation(e,t,n,r,o,a,i,s){try{const l=e.studentId,c=new F({id:U.generateAssignmentId(),staffId:n.id,studentId:l,session:a,program:i,date:s.date,isLocked:!1,assignedBy:"auto-cross"}),u=new F({id:U.generateAssignmentId(),staffId:t.id,studentId:r.id,session:o,program:i,date:s.date,isLocked:!1,assignedBy:"auto-cross"});return{success:!0,swaps:[{type:"cross-session",description:"Cross-session: ".concat(n.name," \u2192 ").concat(a,", ").concat(t.name," \u2192 ").concat(o," with ").concat(r.name)}],newAssignments:[c,u],changes:[{type:"remove",assignmentId:e.id},{type:"add",assignment:c},{type:"add",assignment:u}],description:"".concat(t.name," moved from ").concat(a," to ").concat(o," for ").concat(r.name)}}catch(l){return{success:!1}}}}const eh=y("lock-open",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]),th=y("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),nh=y("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);var rh=n(414);const oh=e=>{let{schedule:t,staff:n,students:o,onAssignmentLock:a,onAssignmentUnlock:i,onAssignmentRemove:s,onManualAssignment:l,selectedDate:u}=e;console.log("\ud83d\udd0d ScheduleTableView rendering with:",{studentsCount:o.length,staffCount:n.length,assignmentsCount:t.assignments.length});const[d,h]=(0,r.useState)({}),[g,m]=(0,r.useState)(new Set);(0,r.useEffect)(()=>{console.log("\ud83d\udd04 Schedule changed, syncing state..."),console.log("  Total assignments:",t.assignments.length);const e=new Set;t.assignments.forEach(t=>{const n=y(t.studentId,t.session);e.add(n)}),m(e),h(e=>{const n=c({},e);return t.assignments.forEach(e=>{const t=y(e.studentId,e.session);n[t]&&delete n[t]}),n})},[t.assignments.length]);const f=[...new Set(o.filter(e=>e.isActive).map(e=>e.program))],p=e=>{let t=[];return e.team&&e.team.length>0&&(t=e.team.map(e=>{const t=e.title||e.DisplayName||e.LookupValue;if(!t)return null;let r="RBT",o=e.email;if(e.email){const t=n.find(t=>t.email&&t.email.toLowerCase()===e.email.toLowerCase());t&&(r=t.role)}if("RBT"===r&&e.id){const t=n.find(t=>t.id===e.id);t&&(r=t.role)}return{id:e.id,name:t,role:r,email:o}}).filter(Boolean)),t},y=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return"".concat(e,"_").concat(t,"_").concat(n)},v=function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const o=y(e,t,r);h(e=>c(c({},e),{},{[o]:n?parseInt(n):null})),console.log("\ud83d\udcdd Staff selected: Student ".concat(e,", Session ").concat(t,", Staff ").concat(n,", Index ").concat(r))},b=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=y(e,t,n);console.log("\ud83d\udd13 Unlocking assignment: Student ".concat(e,", Session ").concat(t,", Index ").concat(n));const a=o.find(t=>t.id===e),l=x(a,t)[n];l&&(console.log("\ud83d\uddd1\ufe0f Removing assignment ID: ".concat(l.id," (Index ").concat(n,")")),s&&s(l.id),i&&i(l.id)),m(e=>{const t=new Set(e);return t.delete(r),t}),h(e=>c(c({},e),{},{[r]:null})),console.log("\u2705 Assignment unlocked successfully")},w=(e,t)=>{const n=y(e,t);return g.has(n)},k=e=>{let t=e.name;if(e.isPaired()){const n=e.getPairedStudent(o);n&&(t+=" (paired: ".concat(n.name,")"))}return t},S=e=>{const t={[j.ONE_TO_ONE]:"bg-blue-100 text-blue-800",[j.TWO_TO_ONE]:"bg-red-100 text-red-800",[j.ONE_TO_TWO]:"bg-green-100 text-green-800"};return(0,rh.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat(t[e.ratio]||"bg-gray-100 text-gray-800"),children:e.ratio})},x=(e,n)=>t&&t.assignments?t.assignments.filter(t=>t.studentId===e.id&&t.session===n&&t.program===e.program):[],C=(e,r)=>{if(!e.isAvailableForSession(r))return(0,rh.jsxs)("div",{className:"flex items-center gap-2",children:[(0,rh.jsx)("div",{className:"text-sm px-3 py-2 bg-gray-100 text-gray-400 rounded border border-gray-200 italic",children:"ABSENT"}),(0,rh.jsx)("span",{className:"px-2 py-1 bg-red-100 text-red-600 rounded text-xs font-medium",children:e.absentFullDay?"Full Day":"AM"===r?"Absent AM":"Absent PM"})]});const o=p(e),a=((e,t)=>{switch("AM"===t?e.ratioAM:e.ratioPM){case j.TWO_TO_ONE:return 2;case j.ONE_TO_ONE:case j.ONE_TO_TWO:default:return 1}})(e,r),i=x(e,r);console.log("\ud83d\udd0d DROPDOWN RENDER for ".concat(e.name," ").concat(r,":")),console.log("  Required staff:",a),console.log("  Current assignments:",i.length);const s=o.filter(o=>{if(i.some(e=>e.staffId===o.id||e.staffId==o.id))return!0;const a=n.find(e=>e.id===o.id||e.id==o.id);return!!a&&t.isStaffAvailable(a.id,r,e.program)});if(0===s.length)return(0,rh.jsx)("span",{className:"text-gray-400 text-sm",children:"No available team"});const l=[];for(let t=0;t<a;t++){const n=i[t],o="".concat(e.id,"_").concat(r,"_").concat(t),c=w(e.id,r),u=(null===n||void 0===n?void 0:n.staffId)||d[o]||"",h=i.filter((e,n)=>n!==t).map(e=>e.staffId),g=s.filter(e=>!h.includes(e.id)||e.id===u);l.push((0,rh.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,rh.jsxs)("select",{value:u,onChange:n=>v(e.id,r,n.target.value,t),disabled:c||!!n,className:"text-sm border rounded px-2 py-1 min-w-[160px] ".concat(c||n?"bg-gray-100 text-gray-600":"bg-white"),children:[(0,rh.jsx)("option",{value:"",children:"Select staff..."}),g.map(e=>(0,rh.jsxs)("option",{value:e.id,children:[e.name," (",e.role,")"]},e.id))]}),a>1&&(0,rh.jsxs)("span",{className:"text-xs text-gray-500",children:["#",t+1]}),n&&(0,rh.jsx)("button",{onClick:()=>b(e.id,r,t),className:"p-1 text-red-600 hover:text-red-800",title:"Remove this assignment",children:(0,rh.jsx)(eh,{className:"w-4 h-4"})})]},o))}return(0,rh.jsxs)("div",{className:"space-y-1",children:[l,a>1&&(0,rh.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["Requires ",a," staff"]})]})};return(0,rh.jsx)("div",{className:"space-y-6",children:f.map(e=>{const t=o.filter(t=>t.program===e&&t.isActive);return(0,rh.jsxs)("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden",children:[(0,rh.jsxs)("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white px-6 py-4",children:[(0,rh.jsx)("h3",{className:"text-lg font-bold",children:e.toUpperCase()}),(0,rh.jsxs)("p",{className:"text-blue-100 text-sm",children:[t.length," students"]})]}),(0,rh.jsx)("div",{className:"overflow-x-auto",children:(0,rh.jsxs)("table",{className:"w-full",children:[(0,rh.jsx)("thead",{className:"bg-gray-50",children:(0,rh.jsxs)("tr",{children:[(0,rh.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r",children:"Client"}),(0,rh.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r",children:"AM Staff Assignment"}),(0,rh.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r",children:"PM Staff Assignment"}),(0,rh.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Full Team"})]})}),(0,rh.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map((e,t)=>{const n=p(e),r=t%2===0;return(0,rh.jsxs)("tr",{className:r?"bg-white":"bg-gray-50",children:[(0,rh.jsx)("td",{className:"px-6 py-4 whitespace-nowrap border-r",children:(0,rh.jsx)("div",{className:"flex items-center",children:(0,rh.jsxs)("div",{children:[(0,rh.jsx)("div",{className:"text-sm font-medium text-gray-900",children:k(e)}),(0,rh.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[S(e),e.isPaired()&&(0,rh.jsx)("span",{className:"px-2 py-1 bg-purple-100 text-purple-800 rounded text-xs font-medium",children:"Paired"})]})]})})}),(0,rh.jsx)("td",{className:"px-6 py-4 whitespace-nowrap border-r",children:C(e,"AM")}),(0,rh.jsx)("td",{className:"px-6 py-4 whitespace-nowrap border-r",children:C(e,"PM")}),(0,rh.jsx)("td",{className:"px-6 py-4",children:(0,rh.jsx)("div",{className:"flex flex-wrap gap-1",children:n.length>0?n.map((e,t)=>{return(0,rh.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat((n=e.role,{RBT:"bg-purple-100 text-purple-800",BS:"bg-indigo-100 text-indigo-800",BCBA:"bg-blue-100 text-blue-800",EA:"bg-green-100 text-green-800",MHA:"bg-yellow-100 text-yellow-800",CC:"bg-orange-100 text-orange-800",Teacher:"bg-pink-100 text-pink-800",Director:"bg-gray-100 text-gray-800"}[n]||"bg-gray-100 text-gray-800")),children:e.name},t);var n}):(0,rh.jsx)("span",{className:"text-gray-400 text-sm",children:"No team assigned"})})})]},e.id)})})]})})]},e)})})},ah=e=>{let{schedule:t,staff:n,students:r,session:o,program:a}=e;const i=t.getAssignmentsForSession(o,a),s=r.filter(e=>e.program===a&&e.isActive),l=n.filter(e=>e.isActive&&!e.isAvailableForSession(o)),c=r.filter(e=>e.isActive&&e.program===a&&!e.isAvailableForSession(o)),u=s.filter(e=>e.isAvailableForSession(o)),d=new Set(i.map(e=>e.studentId)),h=u.length-d.size,g={},m=new Set(i.map(e=>e.staffId));i.forEach(e=>{const t=n.find(t=>t.id===e.staffId);if(t){const e=t.role;g[e]||(g[e]=new Set),g[e].add(t.id)}});const f={};Object.keys(g).forEach(e=>{f[e]=g[e].size});const p=s.filter(e=>!d.has(e.id)&&e.isAvailableForSession(o)),y=n.filter(e=>{if(!e.isActive)return!1;if(!e.isAvailableForSession(o))return!1;return("Primary"===a?e.primaryProgram:e.secondaryProgram)&&!m.has(e.id)}),v={};y.forEach(e=>{const t=e.role;v[t]||(v[t]=[]),v[t].push(e)});const b=e=>({RBT:"bg-purple-100 text-purple-800",BS:"bg-indigo-100 text-indigo-800",BCBA:"bg-blue-100 text-blue-800",EA:"bg-green-100 text-green-800",MHA:"bg-yellow-100 text-yellow-800",CC:"bg-orange-100 text-orange-800",Teacher:"bg-pink-100 text-pink-800",Trainer:"bg-gray-100 text-gray-800",Director:"bg-red-100 text-red-800"}[e]||"bg-gray-100 text-gray-800");return(0,rh.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[(0,rh.jsxs)("h3",{className:"font-semibold text-gray-900 mb-3",children:[a," ",o," Summary"]}),(0,rh.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,rh.jsxs)("div",{className:"flex justify-between",children:[(0,rh.jsx)("span",{children:"Total Students:"}),(0,rh.jsx)("span",{className:"font-medium",children:s.length})]}),(0,rh.jsxs)("div",{className:"flex justify-between",children:[(0,rh.jsx)("span",{children:"Assigned:"}),(0,rh.jsx)("span",{className:"font-medium",children:d.size})]}),(0,rh.jsxs)("div",{className:"flex justify-between",children:[(0,rh.jsx)("span",{children:"Unassigned:"}),(0,rh.jsx)("span",{className:"font-medium ".concat(0===h?"text-green-600":h<=2?"text-yellow-600":"text-red-600"),children:h})]}),(0,rh.jsxs)("div",{className:"flex justify-between",children:[(0,rh.jsx)("span",{children:"Staff Used:"}),(0,rh.jsx)("span",{className:"font-medium",children:m.size})]})]}),Object.keys(f).length>0&&(0,rh.jsxs)("div",{className:"mt-3 border-t pt-3",children:[(0,rh.jsx)("div",{className:"text-xs font-medium text-gray-600 mb-2",children:"Staff by Role:"}),(0,rh.jsx)("div",{className:"space-y-1",children:Object.entries(f).sort((e,t)=>{let[n]=e,[r]=t;return n.localeCompare(r)}).map(e=>{let[t,n]=e;return(0,rh.jsxs)("div",{className:"flex justify-between items-center",children:[(0,rh.jsx)("span",{className:"px-2 py-0.5 rounded text-xs font-medium ".concat(b(t)),children:t}),(0,rh.jsx)("span",{className:"text-xs font-semibold",children:n})]},t)})})]}),l.length>0&&(0,rh.jsxs)("div",{className:"mt-3 border-t pt-3",children:[(0,rh.jsxs)("div",{className:"text-xs font-medium text-red-600 mb-2",children:["Absent Staff (",l.length,"):"]}),(0,rh.jsx)("div",{className:"space-y-1 max-h-20 overflow-y-auto",children:l.map(e=>(0,rh.jsxs)("div",{className:"text-xs flex items-center gap-2",children:[(0,rh.jsx)("span",{className:"px-2 py-0.5 rounded ".concat(b(e.role)),children:e.role}),(0,rh.jsx)("span",{className:"text-gray-700",children:e.name}),(0,rh.jsx)("span",{className:"text-red-600 text-[10px]",children:e.absentFullDay?"(Full Day)":"AM"===o?"(AM)":"(PM)"})]},e.id))})]}),c.length>0&&(0,rh.jsxs)("div",{className:"mt-3 border-t pt-3",children:[(0,rh.jsxs)("div",{className:"text-xs font-medium text-red-600 mb-2",children:["Absent Clients (",c.length,"):"]}),(0,rh.jsx)("div",{className:"space-y-1 max-h-20 overflow-y-auto",children:c.map(e=>(0,rh.jsxs)("div",{className:"text-xs text-gray-700 flex items-center gap-2",children:[(0,rh.jsx)("span",{children:e.name}),(0,rh.jsx)("span",{className:"text-red-600 text-[10px]",children:e.absentFullDay?"(Full Day)":"AM"===o?"(AM)":"(PM)"})]},e.id))})]}),p.length>0&&(0,rh.jsxs)("div",{className:"mt-3 border-t pt-3",children:[(0,rh.jsx)("div",{className:"text-xs font-medium text-gray-600 mb-2",children:"Unassigned Students:"}),(0,rh.jsx)("div",{className:"space-y-1 max-h-20 overflow-y-auto",children:p.map(e=>(0,rh.jsxs)("div",{className:"text-xs text-gray-700 flex justify-between",children:[(0,rh.jsx)("span",{children:e.name}),(0,rh.jsx)("span",{className:"text-gray-500",children:"AM"===o?e.ratioAM:e.ratioPM})]},e.id))})]}),Object.keys(v).length>0&&(0,rh.jsxs)("div",{className:"mt-3 border-t pt-3",children:[(0,rh.jsx)("div",{className:"text-xs font-medium text-gray-600 mb-2",children:"Available Staff:"}),(0,rh.jsx)("div",{className:"space-y-1 max-h-20 overflow-y-auto",children:Object.entries(v).sort((e,t)=>{let[n]=e,[r]=t;return n.localeCompare(r)}).map(e=>{let[t,n]=e;return(0,rh.jsxs)("div",{className:"space-y-0.5",children:[(0,rh.jsxs)("div",{className:"px-2 py-0.5 rounded text-xs font-medium inline-block ".concat(b(t)),children:[t," (",n.length,")"]}),(0,rh.jsx)("div",{className:"ml-2 space-y-0.5",children:n.map(e=>(0,rh.jsx)("div",{className:"text-xs text-gray-600",children:e.name},e.id))})]},t)})})]}),0===h?(0,rh.jsxs)("div",{className:"mt-3 flex items-center gap-2 text-green-600",children:[(0,rh.jsx)(th,{className:"w-4 h-4"}),(0,rh.jsx)("span",{className:"text-sm font-medium",children:"Complete"})]}):(0,rh.jsxs)("div",{className:"mt-3 flex items-center gap-2 text-amber-600",children:[(0,rh.jsx)(nh,{className:"w-4 h-4"}),(0,rh.jsx)("span",{className:"text-sm font-medium",children:"Incomplete"})]})]})},ih=y("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),sh=y("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),lh=e=>{let{schedule:t,staff:n,students:o,onValidationChange:a}=e;const[i,s]=(0,r.useState)({errors:[],warnings:[],isValid:!0,lastValidated:null}),[l,c]=(0,r.useState)(!1),[u,d]=(0,r.useState)(!1);(0,r.useEffect)(()=>{h()},[t,n,o]);const h=async()=>{c(!0);try{const e=[],r=[],i=z.validateSchedule(t,n,o);e.push(...i);const l=g();e.push(...l.errors),r.push(...l.warnings);const c={errors:e,warnings:r,isValid:0===e.length,lastValidated:new Date};s(c),a&&a(c)}catch(e){console.error("Validation error:",e),s({errors:["Validation failed: ".concat(e.message)],warnings:[],isValid:!1,lastValidated:new Date})}finally{c(!1)}},g=()=>{const e=[],t=[],r=(o.filter(e=>e.isActive),n.filter(e=>e.isActive),m());e.push(...r);const a=f();e.push(...a);const i=p();t.push(...i);const s=y();e.push(...s);const l=v();t.push(...l);const c=w();return t.push(...c),{errors:e,warnings:t}},m=()=>{const e=[],n=o.filter(e=>e.isActive);for(const r of n){const n=t.getStudentAssignments(r.id);for(const t of["AM","PM"]){const o=n.filter(e=>e.session===t),a=r.ratio===j.TWO_TO_ONE?2:1;o.length>0&&o.length<a&&e.push("".concat(r.name," requires ").concat(a," staff but has only ").concat(o.length," assigned in ").concat(t," session"))}}return e},f=()=>{const e=[],r=o.filter(e=>e.isActive);for(const o of r){const r=t.getStudentAssignments(o.id).map(e=>e.staffId),a=[...new Set(r)];if(r.length!==a.length){const t=r.filter((e,t)=>r.indexOf(e)!==t).map(e=>{const t=n.find(t=>t.id===e);return t?t.name:"Staff ID ".concat(e)});e.push("".concat(o.name," has the same staff member(s) assigned multiple times: ").concat([...new Set(t)].join(", ")))}}return e},p=()=>{const e=[],r=n.filter(e=>e.isActive);for(const n of r){const r=t.getStaffAssignments(n.id),o={AM:0,PM:0};r.forEach(e=>{o[e.session]++}),Object.entries(o).forEach(t=>{let[r,o]=t;o>n.maxStudents&&e.push("".concat(n.name," is assigned to ").concat(o," students in ").concat(r," session (max: ").concat(n.maxStudents,")"))}),0===r.length&&e.push("".concat(n.name," has no assignments"))}return e},y=()=>{const e=[];for(const r of t.assignments){const t=n.find(e=>e.id===r.staffId),a=o.find(e=>e.id===r.studentId);t&&a&&(t.canWorkProgram(r.program)||e.push("".concat(t.name," is assigned to ").concat(a.name," in ").concat(r.program," program, but is not qualified for this program")),a.program!==r.program&&e.push("".concat(a.name," is assigned to ").concat(r.program," program but belongs to ").concat(a.program," program")))}return e},v=()=>{const e=[],n=o.filter(e=>e.isActive);for(const r of n){const n=t.getStudentAssignments(r.id),o=["AM","PM"];for(const t of o){0===n.filter(e=>e.session===t).length&&e.push("".concat(r.name," has no assignment for ").concat(t," session"))}}return e},w=()=>{const e=[],r=n.filter(e=>e.isActive).map(e=>({name:e.name,count:t.getStaffAssignments(e.id).length}));if(r.length>0){const t=Math.max(...r.map(e=>e.count)),n=Math.min(...r.map(e=>e.count));t-n>2&&e.push("Uneven workload distribution: some staff have ".concat(t," assignments while others have ").concat(n))}return e};return(0,rh.jsxs)("div",{className:"bg-white rounded-lg shadow-lg",children:[(0,rh.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,rh.jsxs)("div",{className:"flex items-center justify-between",children:[(0,rh.jsxs)("div",{className:"flex items-center gap-3",children:[l?(0,rh.jsx)(b,{className:"w-5 h-5 animate-spin"}):i.isValid&&0===i.warnings.length?(0,rh.jsx)(th,{className:"w-5 h-5 text-green-600"}):i.errors.length>0?(0,rh.jsx)(ih,{className:"w-5 h-5 text-red-600"}):(0,rh.jsx)(nh,{className:"w-5 h-5 text-yellow-600"}),(0,rh.jsxs)("div",{children:[(0,rh.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Schedule Validation"}),(0,rh.jsx)("p",{className:"text-sm text-gray-600",children:l?"Validating...":i.isValid&&0===i.warnings.length?"All constraints satisfied":i.errors.length>0?"".concat(i.errors.length," error(s) found"):"".concat(i.warnings.length," warning(s)")})]})]}),(0,rh.jsxs)("div",{className:"flex items-center gap-2",children:[(0,rh.jsxs)("button",{onClick:h,disabled:l,className:"px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 flex items-center gap-1",children:[(0,rh.jsx)(b,{className:"w-4 h-4 ".concat(l?"animate-spin":"")}),"Revalidate"]}),(0,rh.jsx)("button",{onClick:()=>d(!u),className:"px-3 py-1 text-sm border border-gray-300 rounded hover:bg-gray-50",children:u?"Hide Details":"Show Details"})]})]})}),u&&(0,rh.jsxs)("div",{className:"p-4 space-y-4",children:[(0,rh.jsx)(ch,{schedule:t,staff:n,students:o}),i.errors.length>0&&(0,rh.jsxs)("div",{className:"space-y-2",children:[(0,rh.jsxs)("h4",{className:"font-medium text-red-900 flex items-center gap-2",children:[(0,rh.jsx)(ih,{className:"w-4 h-4"}),"Errors (",i.errors.length,")"]}),(0,rh.jsx)("div",{className:"space-y-1",children:i.errors.map((e,t)=>(0,rh.jsx)("div",{className:"text-sm text-red-700 bg-red-50 p-2 rounded",children:e},t))})]}),i.warnings.length>0&&(0,rh.jsxs)("div",{className:"space-y-2",children:[(0,rh.jsxs)("h4",{className:"font-medium text-yellow-900 flex items-center gap-2",children:[(0,rh.jsx)(nh,{className:"w-4 h-4"}),"Warnings (",i.warnings.length,")"]}),(0,rh.jsx)("div",{className:"space-y-1",children:i.warnings.map((e,t)=>(0,rh.jsx)("div",{className:"text-sm text-yellow-700 bg-yellow-50 p-2 rounded",children:e},t))})]}),i.isValid&&0===i.warnings.length&&(0,rh.jsxs)("div",{className:"text-sm text-green-700 bg-green-50 p-3 rounded flex items-center gap-2",children:[(0,rh.jsx)(th,{className:"w-4 h-4"}),"Schedule passes all validation checks"]}),i.lastValidated&&(0,rh.jsxs)("div",{className:"text-xs text-gray-500 flex items-center gap-1",children:[(0,rh.jsx)(sh,{className:"w-3 h-3"}),"Last validated: ",i.lastValidated.toLocaleTimeString()]})]})]})},ch=e=>{let{schedule:t,staff:n,students:r}=e;const o=r.filter(e=>e.isActive),a=n.filter(e=>e.isActive),i=t.assignments.length,s=new Set(t.assignments.map(e=>e.studentId)).size,l=new Set(t.assignments.map(e=>e.staffId)).size,c=t.assignments.filter(e=>t.isAssignmentLocked(e.id)).length,u=o.length>0?s/o.length*100:0,d=a.length>0?l/a.length*100:0,h=[{label:"Total Assignments",value:i,color:"text-blue-600"},{label:"Students Assigned",value:"".concat(s,"/").concat(o.length),percentage:u,color:100===u?"text-green-600":"text-yellow-600"},{label:"Staff Utilized",value:"".concat(l,"/").concat(a.length),percentage:d,color:"text-blue-600"},{label:"Locked Assignments",value:c,color:"text-yellow-600"}];return(0,rh.jsxs)("div",{className:"space-y-3",children:[(0,rh.jsx)("h4",{className:"font-medium text-gray-900",children:"Summary"}),(0,rh.jsx)("div",{className:"grid grid-cols-2 gap-4",children:h.map((e,t)=>(0,rh.jsxs)("div",{className:"text-center p-3 bg-gray-50 rounded",children:[(0,rh.jsxs)("div",{className:"text-lg font-semibold ".concat(e.color),children:[e.value,void 0!==e.percentage&&(0,rh.jsxs)("span",{className:"text-sm ml-1",children:["(",e.percentage.toFixed(0),"%)"]})]}),(0,rh.jsx)("div",{className:"text-xs text-gray-600",children:e.label})]},t))})]})},uh=()=>(0,rh.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[(0,rh.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[(0,rh.jsx)(sh,{className:"w-5 h-5"}),"Scheduling Rules & Constraints"]}),(0,rh.jsx)("div",{className:"space-y-6",children:[{title:"Staff-Student Ratios",description:"Each student must have the correct number of staff assigned based on their ratio requirement",examples:["1:1 ratio = 1 staff member","2:1 ratio = 2 staff members","1:2 ratio = 1 staff for up to 2 students"]},{title:"Same-Day Restriction",description:"No staff member can be assigned to the same student for both AM and PM sessions",examples:["If John works with Student A in AM, he cannot work with Student A in PM"]},{title:"Program Qualifications",description:"Staff can only be assigned to programs they are qualified for",examples:["Primary program staff cannot be assigned to Secondary program students"]},{title:"Role Hierarchy",description:"Staff assignments follow the established hierarchy for optimal matches",examples:["RBT \u2192 BS \u2192 BCBA \u2192 EA \u2192 MHA \u2192 CC \u2192 Teacher \u2192 Director"]},{title:"Session Times",description:"Assignments must respect program-specific session times",examples:["Primary AM: 8:45-11:30, PM: 12:00-15:00","Secondary AM: 8:45-12:00, PM: 12:30-15:00"]}].map((e,t)=>(0,rh.jsxs)("div",{className:"border-l-4 border-blue-500 pl-4",children:[(0,rh.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:e.title}),(0,rh.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:e.description}),(0,rh.jsx)("ul",{className:"text-xs text-gray-500 space-y-1",children:e.examples.map((e,t)=>(0,rh.jsxs)("li",{className:"flex items-start gap-1",children:[(0,rh.jsx)("span",{className:"text-blue-500 mt-1",children:"\u2022"}),(0,rh.jsx)("span",{children:e})]},t))})]},t))})]}),dh=y("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),hh=y("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]]),gh=y("phone",[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]]),mh=y("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),fh=y("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]),ph=y("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),yh=e=>{let{selectedUsers:t=[],onSelectionChange:n,placeholder:o="Search for people...",maxSelections:a=null,disabled:i=!1,peoplePickerService:s}=e;const[l,c]=(0,r.useState)(!1),[u,d]=(0,r.useState)(""),[h,g]=(0,r.useState)([]),[m,f]=(0,r.useState)(!1),[p,y]=(0,r.useState)([]),b=(0,r.useRef)(null);(0,r.useEffect)(()=>{s&&w()},[s]),(0,r.useEffect)(()=>{const e=e=>{b.current&&!b.current.contains(e.target)&&c(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const w=async()=>{try{const e=await s.getAllSiteUsers(!0);y(e)}catch(e){console.error("Error loading users:",e)}},k=(u.trim()?h:p.slice(0,10)).filter(e=>!t.some(t=>t.id===e.id));return(0,rh.jsxs)("div",{className:"relative",ref:b,children:[t.length>0&&(0,rh.jsx)("div",{className:"mb-2 flex flex-wrap gap-2",children:t.map(e=>{const r="string"===typeof e.title?e.title:"string"===typeof e.name?e.name:"Unknown User";return(0,rh.jsxs)("div",{className:"inline-flex items-center gap-2 px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm",children:[(0,rh.jsx)(v,{className:"w-3 h-3"}),(0,rh.jsx)("span",{children:r}),!i&&(0,rh.jsx)("button",{onClick:()=>(e=>{if(i)return;const r=t.filter(t=>t.id!==e);n(r)})(e.id),className:"hover:bg-blue-200 rounded-full p-0.5",children:(0,rh.jsx)(mh,{className:"w-3 h-3"})})]},e.id||Math.random())})}),(0,rh.jsxs)("div",{className:"relative",children:[(0,rh.jsxs)("div",{className:"flex items-center border border-gray-300 rounded-md",children:[(0,rh.jsxs)("div",{className:"flex-1 flex items-center",children:[(0,rh.jsx)(fh,{className:"w-4 h-4 text-gray-400 ml-3"}),(0,rh.jsx)("input",{type:"text",value:u,onChange:e=>(async e=>{if(d(e),e.trim()){f(!0);try{const t=p.filter(t=>t.title.toLowerCase().includes(e.toLowerCase())||t.email.toLowerCase().includes(e.toLowerCase())).slice(0,10);g(t)}catch(t){console.error("Error searching users:",t),g([])}finally{f(!1)}}else g([])})(e.target.value),onFocus:()=>c(!0),placeholder:o,disabled:i,className:"w-full pl-2 pr-3 py-2 border-0 focus:outline-none focus:ring-0"})]}),(0,rh.jsx)("button",{onClick:()=>c(!l),disabled:i,className:"px-3 py-2 border-l border-gray-300 hover:bg-gray-50 disabled:opacity-50",children:(0,rh.jsx)(ph,{className:"w-4 h-4 transition-transform ".concat(l?"rotate-180":"")})})]}),l&&!i&&(0,rh.jsxs)("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto",children:[m&&(0,rh.jsx)("div",{className:"px-4 py-3 text-gray-500 text-sm",children:"Searching..."}),!m&&0===k.length&&(0,rh.jsx)("div",{className:"px-4 py-3 text-gray-500 text-sm",children:u.trim()?"No users found":"No users available"}),!m&&k.map(e=>{const r="string"===typeof e.title?e.title:"string"===typeof e.name?e.name:"Unknown",o="string"===typeof e.email?e.email:"",s=r.charAt(0).toUpperCase();return(0,rh.jsx)("button",{onClick:()=>(e=>{if(i)return;if(t.some(t=>t.id===e.id))return;if(a&&t.length>=a)return;const r=[...t,e];n(r),d(""),g([]),c(!1)})(e),className:"w-full px-4 py-3 text-left hover:bg-gray-50 focus:bg-gray-50 focus:outline-none border-b border-gray-100 last:border-b-0",children:(0,rh.jsxs)("div",{className:"flex items-center gap-3",children:[(0,rh.jsx)("div",{className:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white text-sm font-medium",children:s}),(0,rh.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,rh.jsx)("div",{className:"font-medium text-gray-900 truncate",children:r}),o&&(0,rh.jsx)("div",{className:"text-sm text-gray-500 truncate",children:o})]})]})},e.id||Math.random())}),a&&t.length>=a&&(0,rh.jsxs)("div",{className:"px-4 py-3 text-amber-600 text-sm bg-amber-50 border-t",children:["Maximum ",a," selection",1!==a?"s":""," reached"]})]})]}),a&&(0,rh.jsxs)("div",{className:"mt-1 text-xs text-gray-500",children:[t.length," of ",a," selected"]})]})},vh=e=>{let{selectedUser:t=null,onSelectionChange:n,placeholder:r="Search for a person...",disabled:o=!1,peoplePickerService:a}=e;return(0,rh.jsx)(yh,{selectedUsers:t?[t]:[],onSelectionChange:e=>n(e[0]||null),placeholder:r,maxSelections:1,disabled:o,peoplePickerService:a})},bh=e=>{let{selectedStaff:t=[],onSelectionChange:n,allStaff:o=[],disabled:a=!1,peoplePickerService:i}=e;const[s,l]=(0,r.useState)([]);(0,r.useEffect)(()=>{i&&o.length>0&&c()},[i,o]);const c=async()=>{try{const e=(await i.getAllSiteUsers(!0)).filter(e=>o.some(t=>t.email&&e.email&&t.email.toLowerCase()===e.email.toLowerCase()));l(e)}catch(e){console.error("Error loading staff users:",e)}};return(0,rh.jsxs)("div",{children:[(0,rh.jsx)(yh,{selectedUsers:t,onSelectionChange:n,placeholder:"Search for staff members...",disabled:a,peoplePickerService:i}),o.length>0&&0===s.length&&(0,rh.jsx)("div",{className:"mt-2 text-sm text-amber-600",children:"Note: Only users in the Staff list can be selected"})]})},wh=e=>{var t;let{staff:n=null,onSave:o,onCancel:a,peoplePickerService:i}=e;const[s,l]=(0,r.useState)({name:(null===n||void 0===n?void 0:n.name)||"",role:(null===n||void 0===n?void 0:n.role)||M.RBT,email:(null===n||void 0===n?void 0:n.email)||"",phone:(null===n||void 0===n?void 0:n.phone)||"",isActive:null===(t=null===n||void 0===n?void 0:n.isActive)||void 0===t||t,primaryProgram:(null===n||void 0===n?void 0:n.primaryProgram)||!1,secondaryProgram:(null===n||void 0===n?void 0:n.secondaryProgram)||!1,certificationExpiry:(null===n||void 0===n?void 0:n.certificationExpiry)||"",userId:(null===n||void 0===n?void 0:n.userId)||"",staffPerson:(null===n||void 0===n?void 0:n.staffPerson)||null}),[u,d]=(0,r.useState)(null!==n&&void 0!==n&&n.staffPerson?{id:n.userId,title:n.name,email:n.email}:null),[h,g]=(0,r.useState)({}),m=(e,t)=>{l(n=>c(c({},n),{},{[e]:t})),h[e]&&g(t=>c(c({},t),{},{[e]:null}))};return(0,rh.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,rh.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[(0,rh.jsx)("div",{className:"bg-blue-600 text-white p-4 rounded-t-lg",children:(0,rh.jsxs)("h2",{className:"text-xl font-bold flex items-center gap-2",children:[(0,rh.jsx)(dh,{className:"w-5 h-5"}),n?"Edit Staff Member":"Add Staff Member"]})}),(0,rh.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!(()=>{const e={};return s.name.trim()||(e.name="Name is required"),s.email.trim()?/\S+@\S+\.\S+/.test(s.email)||(e.email="Email is invalid"):e.email="Email is required",s.role||(e.role="Role is required"),s.primaryProgram||s.secondaryProgram||(e.programs="At least one program must be selected"),g(e),0===Object.keys(e).length})())return;const t=c({id:(null===n||void 0===n?void 0:n.id)||Date.now()},s);o(new D(t))},className:"p-6 space-y-6",children:[(0,rh.jsxs)("div",{children:[(0,rh.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Staff Member *"}),(0,rh.jsx)(vh,{selectedUser:u,onSelectionChange:e=>{d(e),l(e?t=>c(c({},t),{},{name:e.title,email:e.email,userId:e.id.toString(),staffPerson:e}):e=>c(c({},e),{},{name:"",email:"",userId:"",staffPerson:null}))},placeholder:"Search for staff member...",peoplePickerService:i}),h.name&&(0,rh.jsx)("p",{className:"mt-1 text-sm text-red-600",children:h.name})]}),(0,rh.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,rh.jsxs)("div",{children:[(0,rh.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Name *"}),(0,rh.jsx)("input",{type:"text",value:s.name,onChange:e=>m("name",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:u}),h.name&&(0,rh.jsx)("p",{className:"mt-1 text-sm text-red-600",children:h.name})]}),(0,rh.jsxs)("div",{children:[(0,rh.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Role *"}),(0,rh.jsx)("select",{value:s.role,onChange:e=>m("role",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:Object.values(M).map(e=>(0,rh.jsx)("option",{value:e,children:e},e))}),h.role&&(0,rh.jsx)("p",{className:"mt-1 text-sm text-red-600",children:h.role})]})]}),(0,rh.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,rh.jsxs)("div",{children:[(0,rh.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[(0,rh.jsx)(hh,{className:"w-4 h-4 inline mr-1"}),"Email *"]}),(0,rh.jsx)("input",{type:"email",value:s.email,onChange:e=>m("email",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:u}),h.email&&(0,rh.jsx)("p",{className:"mt-1 text-sm text-red-600",children:h.email})]}),(0,rh.jsxs)("div",{children:[(0,rh.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[(0,rh.jsx)(gh,{className:"w-4 h-4 inline mr-1"}),"Phone"]}),(0,rh.jsx)("input",{type:"tel",value:s.phone,onChange:e=>m("phone",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),(0,rh.jsxs)("div",{children:[(0,rh.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[(0,rh.jsx)(k,{className:"w-4 h-4 inline mr-1"}),"Certification Expiry"]}),(0,rh.jsx)("input",{type:"date",value:s.certificationExpiry,onChange:e=>m("certificationExpiry",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,rh.jsxs)("div",{children:[(0,rh.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Programs *"}),(0,rh.jsxs)("div",{className:"space-y-2",children:[(0,rh.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,rh.jsx)("input",{type:"checkbox",checked:s.primaryProgram,onChange:e=>m("primaryProgram",e.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,rh.jsx)("span",{className:"text-sm",children:"Primary Program"})]}),(0,rh.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,rh.jsx)("input",{type:"checkbox",checked:s.secondaryProgram,onChange:e=>m("secondaryProgram",e.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,rh.jsx)("span",{className:"text-sm",children:"Secondary Program"})]})]}),h.programs&&(0,rh.jsx)("p",{className:"mt-1 text-sm text-red-600",children:h.programs})]}),(0,rh.jsx)("div",{children:(0,rh.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,rh.jsx)("input",{type:"checkbox",checked:s.isActive,onChange:e=>m("isActive",e.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,rh.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Active"})]})}),(0,rh.jsxs)("div",{className:"flex gap-3 pt-4 border-t",children:[(0,rh.jsxs)("button",{type:"submit",className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 flex items-center justify-center gap-2",children:[(0,rh.jsx)(x,{className:"w-4 h-4"}),n?"Update Staff":"Add Staff"]}),(0,rh.jsxs)("button",{type:"button",onClick:a,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-500 flex items-center justify-center gap-2",children:[(0,rh.jsx)(mh,{className:"w-4 h-4"}),"Cancel"]})]})]})]})})},kh=e=>{var t;let{student:n=null,onSave:o,onCancel:a,allStaff:i=[],peoplePickerService:s}=e;const[l,u]=(0,r.useState)({name:(null===n||void 0===n?void 0:n.name)||"",program:(null===n||void 0===n?void 0:n.program)||R.PRIMARY,ratioAM:(null===n||void 0===n?void 0:n.ratioAM)||j.ONE_TO_ONE,ratioPM:(null===n||void 0===n?void 0:n.ratioPM)||j.ONE_TO_ONE,team:(null===n||void 0===n?void 0:n.team)||[],isActive:null===(t=null===n||void 0===n?void 0:n.isActive)||void 0===t||t,notes:(null===n||void 0===n?void 0:n.notes)||"",dateStarted:(null===n||void 0===n?void 0:n.dateStarted)||""}),[d,h]=(0,r.useState)({}),g=(e,t)=>{u(n=>c(c({},n),{},{[e]:t})),d[e]&&h(t=>c(c({},t),{},{[e]:null}))};return(0,rh.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,rh.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[(0,rh.jsx)("div",{className:"bg-green-600 text-white p-4 rounded-t-lg",children:(0,rh.jsxs)("h2",{className:"text-xl font-bold flex items-center gap-2",children:[(0,rh.jsx)(v,{className:"w-5 h-5"}),n?"Edit Student":"Add Student"]})}),(0,rh.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!(()=>{const e={};return l.name.trim()||(e.name="Name is required"),l.program||(e.program="Program is required"),l.ratioAM||(e.ratioAM="AM ratio is required"),l.ratioPM||(e.ratioPM="PM ratio is required"),h(e),0===Object.keys(e).length})())return;const t=c({id:(null===n||void 0===n?void 0:n.id)||Date.now()},l);o(new L(t))},className:"p-6 space-y-6",children:[(0,rh.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,rh.jsxs)("div",{children:[(0,rh.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Name *"}),(0,rh.jsx)("input",{type:"text",value:l.name,onChange:e=>g("name",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"}),d.name&&(0,rh.jsx)("p",{className:"mt-1 text-sm text-red-600",children:d.name})]}),(0,rh.jsxs)("div",{children:[(0,rh.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Program *"}),(0,rh.jsx)("select",{value:l.program,onChange:e=>g("program",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500",children:Object.values(R).map(e=>(0,rh.jsx)("option",{value:e,children:e},e))}),d.program&&(0,rh.jsx)("p",{className:"mt-1 text-sm text-red-600",children:d.program})]})]}),(0,rh.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,rh.jsxs)("div",{children:[(0,rh.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"AM Ratio *"}),(0,rh.jsx)("select",{value:l.ratioAM,onChange:e=>g("ratioAM",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500",children:Object.values(j).map(e=>(0,rh.jsx)("option",{value:e,children:e},e))}),d.ratioAM&&(0,rh.jsx)("p",{className:"mt-1 text-sm text-red-600",children:d.ratioAM})]}),(0,rh.jsxs)("div",{children:[(0,rh.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"PM Ratio *"}),(0,rh.jsx)("select",{value:l.ratioPM,onChange:e=>g("ratioPM",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500",children:Object.values(j).map(e=>(0,rh.jsx)("option",{value:e,children:e},e))}),d.ratioPM&&(0,rh.jsx)("p",{className:"mt-1 text-sm text-red-600",children:d.ratioPM})]})]}),(0,rh.jsxs)("div",{children:[(0,rh.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[(0,rh.jsx)(k,{className:"w-4 h-4 inline mr-1"}),"Date Started"]}),(0,rh.jsx)("input",{type:"date",value:l.dateStarted,onChange:e=>g("dateStarted",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"})]}),(0,rh.jsxs)("div",{children:[(0,rh.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Team Members"}),(0,rh.jsx)(bh,{selectedStaff:l.team,onSelectionChange:e=>{u(t=>c(c({},t),{},{team:e}))},allStaff:i,peoplePickerService:s}),(0,rh.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Select staff members who work with this client"})]}),(0,rh.jsxs)("div",{children:[(0,rh.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),(0,rh.jsx)("textarea",{value:l.notes,onChange:e=>g("notes",e.target.value),rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500",placeholder:"Additional notes about the student..."})]}),(0,rh.jsx)("div",{children:(0,rh.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,rh.jsx)("input",{type:"checkbox",checked:l.isActive,onChange:e=>g("isActive",e.target.checked),className:"rounded border-gray-300 text-green-600 focus:ring-green-500"}),(0,rh.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Active"})]})}),(0,rh.jsxs)("div",{className:"flex gap-3 pt-4 border-t",children:[(0,rh.jsxs)("button",{type:"submit",className:"flex-1 bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 flex items-center justify-center gap-2",children:[(0,rh.jsx)(x,{className:"w-4 h-4"}),n?"Update Student":"Add Student"]}),(0,rh.jsxs)("button",{type:"button",onClick:a,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-500 flex items-center justify-center gap-2",children:[(0,rh.jsx)(mh,{className:"w-4 h-4"}),"Cancel"]})]})]})]})})},Sh=y("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]]),xh=y("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),Ch=e=>{let{staff:t,students:n,onEditStudent:o,onEditStaff:a}=e;const[i,s]=(0,r.useState)("clients-by-staff"),[l,c]=(0,r.useState)(""),[u,d]=(0,r.useState)(""),h=(0,r.useMemo)(()=>{var e;console.log("\ud83d\udd0d TeamManagement: Building clientsByStaff mapping"),console.log("\ud83d\udd0d TeamManagement: Staff data:",t),console.log("\ud83d\udd0d TeamManagement: Students data:",n),console.log("\ud83d\udd0d TeamManagement: Sample student team data:",null===n||void 0===n||null===(e=n[0])||void 0===e?void 0:e.team);const r={};return t.filter(e=>e.isActive).forEach(e=>{console.log("\ud83d\udd0d Processing staff: ".concat(e.name," (ID: ").concat(e.id,")"));const t=n.filter(t=>{if(!t.isActive)return!1;if(console.log("  \ud83d\udd0d Checking student: ".concat(t.name)),console.log("    Team data:",t.team),!t.team||0===t.team.length)return console.log("    \u26a0\ufe0f No team data for ".concat(t.name)),!1;const n=t.team.some(n=>{var r,o,a,i,s;console.log("    \ud83d\udd0d Checking team member:",n);const l=null===(r=e.email)||void 0===r?void 0:r.toLowerCase().trim(),c=null===(o=n.email)||void 0===o?void 0:o.toLowerCase().trim();if(l&&c&&l===c)return console.log("    \u2705 EMAIL MATCH: ".concat(e.name," found in ").concat(t.name,"'s team")),!0;if(e.id&&n.id&&e.id===n.id)return console.log("    \u2705 ID MATCH: ".concat(e.name," found in ").concat(t.name,"'s team")),!0;const u=null===(a=e.name)||void 0===a?void 0:a.toLowerCase().trim(),d=(null===(i=n.title)||void 0===i?void 0:i.toLowerCase().trim())||(null===(s=n.name)||void 0===s?void 0:s.toLowerCase().trim());return!(!u||!d||u!==d)&&(console.log("    \u2705 NAME MATCH: ".concat(e.name," found in ").concat(t.name,"'s team")),!0)});return n&&console.log("  \u2705 ".concat(t.name," assigned to ").concat(e.name)),n});r[e.id]={staff:e,clients:t},console.log("\u2705 ".concat(e.name," has ").concat(t.length," clients:"),t.map(e=>e.name))}),console.log("\ud83d\udcca Final clientsByStaff mapping:",r),r},[t,n]),g=(0,r.useMemo)(()=>{console.log("\ud83d\udd0d TeamManagement: Building staffByClient mapping");const e={};return n.filter(e=>e.isActive).forEach(n=>{console.log("\ud83d\udd0d Processing student: ".concat(n.name)),console.log("  Team data:",n.team);const r=n.team.map(e=>{console.log("  \ud83d\udd0d Processing team member:",e);const n=t.find(t=>{var n,r,o,a,i;const s=null===(n=t.email)||void 0===n?void 0:n.toLowerCase().trim(),l=null===(r=e.email)||void 0===r?void 0:r.toLowerCase().trim();if(s&&l&&s===l)return console.log("    \u2705 EMAIL MATCH: Found staff ".concat(t.name," for team member")),!0;if(t.id&&e.id&&t.id===e.id)return console.log("    \u2705 ID MATCH: Found staff ".concat(t.name," for team member")),!0;const c=null===(o=t.name)||void 0===o?void 0:o.toLowerCase().trim(),u=(null===(a=e.title)||void 0===a?void 0:a.toLowerCase().trim())||(null===(i=e.name)||void 0===i?void 0:i.toLowerCase().trim());return!(!c||!u||c!==u)&&(console.log("    \u2705 NAME MATCH: Found staff ".concat(t.name," for team member")),!0)});var r;return n?{id:n.id,name:e.title||e.DisplayName||e.LookupValue||n.name,role:(null===(r=n.role)||void 0===r?void 0:r.name)||n.role,email:n.email}:(console.log("    \u26a0\ufe0f No staff match found for team member:",e),{id:e.id,name:e.title||e.DisplayName||e.LookupValue,role:"Unknown",email:e.email})}).filter(Boolean);e[n.id]={student:n,teamMembers:r},console.log("\u2705 ".concat(n.name," has ").concat(r.length," team members:"),r.map(e=>e.name))}),console.log("\ud83d\udcca Final staffByClient mapping:",e),e},[t,n]),m=(0,r.useMemo)(()=>"clients-by-staff"===i?Object.values(h).filter(e=>{const t=e.staff.name.toLowerCase().includes(l.toLowerCase()),n=!u||"Primary"===u&&e.staff.primaryProgram||"Secondary"===u&&e.staff.secondaryProgram;return t&&n}):Object.values(g).filter(e=>{const t=e.student.name.toLowerCase().includes(l.toLowerCase()),n=!u||e.student.program===u;return t&&n}),[i,h,g,l,u]),f=(e,t,n)=>e.filter(e=>e.getSessionRatio(n)===t).length,p=e=>({RBT:"bg-blue-100 text-blue-800","Senior RBT":"bg-green-100 text-green-800",Lead:"bg-purple-100 text-purple-800",Supervisor:"bg-orange-100 text-orange-800",Director:"bg-red-100 text-red-800"}[e]||"bg-gray-100 text-gray-800");return(0,rh.jsxs)("div",{className:"bg-white rounded-lg shadow-lg",children:[(0,rh.jsx)("div",{className:"bg-indigo-600 text-white p-4 rounded-t-lg",children:(0,rh.jsxs)("h2",{className:"text-xl font-bold flex items-center gap-2",children:[(0,rh.jsx)(v,{className:"w-5 h-5"}),"Team Management"]})}),(0,rh.jsxs)("div",{className:"p-6",children:[(0,rh.jsxs)("div",{className:"flex flex-col lg:flex-row gap-4 mb-6",children:[(0,rh.jsxs)("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[(0,rh.jsxs)("button",{onClick:()=>s("clients-by-staff"),className:"px-4 py-2 rounded-md text-sm font-medium transition-colors ".concat("clients-by-staff"===i?"bg-white text-indigo-600 shadow-sm":"text-gray-600 hover:text-gray-900"),children:[(0,rh.jsx)(v,{className:"w-4 h-4 inline mr-2"}),"Clients by Staff"]}),(0,rh.jsxs)("button",{onClick:()=>s("staff-by-client"),className:"px-4 py-2 rounded-md text-sm font-medium transition-colors ".concat("staff-by-client"===i?"bg-white text-indigo-600 shadow-sm":"text-gray-600 hover:text-gray-900"),children:[(0,rh.jsx)(dh,{className:"w-4 h-4 inline mr-2"}),"Staff by Client"]})]}),(0,rh.jsxs)("div",{className:"flex gap-3 flex-1",children:[(0,rh.jsxs)("div",{className:"relative flex-1",children:[(0,rh.jsx)(fh,{className:"w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),(0,rh.jsx)("input",{type:"text",value:l,onChange:e=>c(e.target.value),placeholder:"Search ".concat("clients-by-staff"===i?"staff":"clients","..."),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),(0,rh.jsxs)("div",{className:"relative",children:[(0,rh.jsx)(Sh,{className:"w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),(0,rh.jsxs)("select",{value:u,onChange:e=>d(e.target.value),className:"pl-10 pr-8 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 appearance-none bg-white",children:[(0,rh.jsx)("option",{value:"",children:"All Programs"}),(0,rh.jsx)("option",{value:"Primary",children:"Primary"}),(0,rh.jsx)("option",{value:"Secondary",children:"Secondary"})]})]})]})]}),(0,rh.jsx)("div",{className:"space-y-4",children:0===m.length?(0,rh.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,rh.jsx)(v,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),(0,rh.jsxs)("p",{children:["No ","clients-by-staff"===i?"staff":"clients"," found"]})]}):m.map((e,t)=>{var n,r,s,l,c,u,d,h;return(0,rh.jsx)("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50",children:"clients-by-staff"===i?(0,rh.jsxs)("div",{children:[(0,rh.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,rh.jsxs)("div",{className:"flex items-center gap-3",children:[(0,rh.jsx)("div",{className:"w-10 h-10 bg-indigo-500 rounded-full flex items-center justify-center text-white font-medium",children:"string"===typeof e.staff.name?e.staff.name.charAt(0):(null===(n=e.staff.name)||void 0===n||null===(r=n.toString)||void 0===r?void 0:r.call(n).charAt(0))||"?"}),(0,rh.jsxs)("div",{children:[(0,rh.jsx)("h3",{className:"font-semibold text-gray-900",children:"string"===typeof e.staff.name?e.staff.name:(null===(s=e.staff.name)||void 0===s||null===(l=s.toString)||void 0===l?void 0:l.call(s))||JSON.stringify(e.staff.name)}),(0,rh.jsxs)("div",{className:"flex items-center gap-2",children:[(0,rh.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(p("object"===typeof e.staff.role?e.staff.role.name:e.staff.role)),children:"object"===typeof e.staff.role?e.staff.role.name:"string"===typeof e.staff.role?e.staff.role:JSON.stringify(e.staff.role)}),(0,rh.jsxs)("div",{className:"flex gap-1",children:[e.staff.primaryProgram&&(0,rh.jsx)("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs",children:"Primary"}),e.staff.secondaryProgram&&(0,rh.jsx)("span",{className:"px-2 py-1 bg-green-100 text-green-700 rounded text-xs",children:"Secondary"})]})]})]})]}),(0,rh.jsx)("button",{onClick:()=>a&&a(e.staff),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded",children:(0,rh.jsx)(xh,{className:"w-4 h-4"})})]}),(0,rh.jsxs)("div",{className:"ml-13",children:[(0,rh.jsxs)("div",{className:"flex items-center gap-4 mb-2",children:[(0,rh.jsxs)("span",{className:"text-sm font-medium text-gray-700",children:["Clients: ",e.clients.length]}),e.clients.length>0&&(0,rh.jsxs)(rh.Fragment,{children:[(0,rh.jsxs)("span",{className:"text-xs text-gray-500",children:["AM: ",f(e.clients,"1:1","AM")," (1:1),",f(e.clients,"2:1","AM")," (2:1),",f(e.clients,"1:2","AM")," (1:2)"]}),(0,rh.jsxs)("span",{className:"text-xs text-gray-500",children:["PM: ",f(e.clients,"1:1","PM")," (1:1),",f(e.clients,"2:1","PM")," (2:1),",f(e.clients,"1:2","PM")," (1:2)"]})]})]}),e.clients.length>0&&(0,rh.jsx)("div",{className:"flex flex-wrap gap-2",children:e.clients.map(e=>{var t,n,r,o,a,i;return(0,rh.jsxs)("div",{className:"flex items-center gap-2 bg-gray-100 rounded-full px-3 py-1",children:[(0,rh.jsx)("span",{className:"text-sm",children:"string"===typeof e.name?e.name:(null===(t=e.name)||void 0===t||null===(n=t.toString)||void 0===n?void 0:n.call(t))||JSON.stringify(e.name)}),(0,rh.jsxs)("div",{className:"flex gap-1",children:[(0,rh.jsxs)("span",{className:"text-xs bg-blue-200 text-blue-700 px-1 rounded",children:["AM: ","string"===typeof e.ratioAM?e.ratioAM:(null===(r=e.ratioAM)||void 0===r||null===(o=r.toString)||void 0===o?void 0:o.call(r))||JSON.stringify(e.ratioAM)]}),(0,rh.jsxs)("span",{className:"text-xs bg-green-200 text-green-700 px-1 rounded",children:["PM: ","string"===typeof e.ratioPM?e.ratioPM:(null===(a=e.ratioPM)||void 0===a||null===(i=a.toString)||void 0===i?void 0:i.call(a))||JSON.stringify(e.ratioPM)]})]})]},e.id)})})]})]}):(0,rh.jsxs)("div",{children:[(0,rh.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,rh.jsxs)("div",{className:"flex items-center gap-3",children:[(0,rh.jsx)("div",{className:"w-10 h-10 bg-green-500 rounded-full flex items-center justify-center text-white font-medium",children:"string"===typeof e.student.name?e.student.name.charAt(0):(null===(c=e.student.name)||void 0===c||null===(u=c.toString)||void 0===u?void 0:u.call(c).charAt(0))||"?"}),(0,rh.jsxs)("div",{children:[(0,rh.jsx)("h3",{className:"font-semibold text-gray-900",children:"string"===typeof e.student.name?e.student.name:(null===(d=e.student.name)||void 0===d||null===(h=d.toString)||void 0===h?void 0:h.call(d))||JSON.stringify(e.student.name)}),(0,rh.jsxs)("div",{className:"flex items-center gap-2",children:[(0,rh.jsx)("span",{className:"px-2 py-1 bg-gray-100 text-gray-700 rounded text-xs",children:e.student.program}),(0,rh.jsxs)("span",{className:"text-xs bg-blue-200 text-blue-700 px-2 py-1 rounded",children:["AM: ",e.student.ratioAM]}),(0,rh.jsxs)("span",{className:"text-xs bg-green-200 text-green-700 px-2 py-1 rounded",children:["PM: ",e.student.ratioPM]})]})]})]}),(0,rh.jsx)("button",{onClick:()=>o&&o(e.student),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded",children:(0,rh.jsx)(xh,{className:"w-4 h-4"})})]}),(0,rh.jsxs)("div",{className:"ml-13",children:[(0,rh.jsx)("div",{className:"flex items-center gap-4 mb-2",children:(0,rh.jsxs)("span",{className:"text-sm font-medium text-gray-700",children:["Team Members: ",e.teamMembers.length]})}),e.teamMembers.length>0?(0,rh.jsx)("div",{className:"flex flex-wrap gap-2",children:e.teamMembers.map(e=>{var t,n;return(0,rh.jsxs)("div",{className:"flex items-center gap-2 bg-indigo-100 rounded-full px-3 py-1",children:[(0,rh.jsx)("span",{className:"text-sm",children:"string"===typeof e.name?e.name:(null===(t=e.name)||void 0===t||null===(n=t.toString)||void 0===n?void 0:n.call(t))||JSON.stringify(e.name)}),(0,rh.jsx)("span",{className:"text-xs px-2 py-0.5 rounded ".concat(p("object"===typeof e.role?e.role.name:"string"===typeof e.role?e.role:JSON.stringify(e.role))),children:"object"===typeof e.role?e.role.name:"string"===typeof e.role?e.role:JSON.stringify(e.role)})]},e.id)})}):(0,rh.jsx)("p",{className:"text-sm text-gray-500 italic",children:"No team members assigned"})]})]})},t)})}),(0,rh.jsxs)("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-3 gap-4 bg-gray-50 rounded-lg p-4",children:[(0,rh.jsxs)("div",{className:"text-center",children:[(0,rh.jsx)("div",{className:"text-2xl font-bold text-indigo-600",children:t.filter(e=>e.isActive).length}),(0,rh.jsx)("div",{className:"text-sm text-gray-600",children:"Active Staff"})]}),(0,rh.jsxs)("div",{className:"text-center",children:[(0,rh.jsx)("div",{className:"text-2xl font-bold text-green-600",children:n.filter(e=>e.isActive).length}),(0,rh.jsx)("div",{className:"text-sm text-gray-600",children:"Active Clients"})]}),(0,rh.jsxs)("div",{className:"text-center",children:[(0,rh.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:Object.values(g).reduce((e,t)=>e+t.teamMembers.length,0)}),(0,rh.jsx)("div",{className:"text-sm text-gray-600",children:"Total Team Assignments"})]})]})]})]})},Ah=y("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),Ih=y("user-x",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]),Th=y("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),Ph=e=>{let{staff:t,students:n,currentDate:o,onUpdateStaffAttendance:a,onUpdateStudentAttendance:i,onResetAllAttendance:s}=e;const[l,c]=(0,r.useState)("staff"),[u,d]=(0,r.useState)(""),h=(0,r.useMemo)(()=>t.filter(e=>e.isActive&&e.name.toLowerCase().includes(u.toLowerCase())),[t,u]),g=(0,r.useMemo)(()=>n.filter(e=>e.isActive&&e.name.toLowerCase().includes(u.toLowerCase())),[n,u]),m=(0,r.useMemo)(()=>{const e=h.filter(e=>e.absentAM||e.absentFullDay).length,t=h.filter(e=>e.absentPM||e.absentFullDay).length,n=g.filter(e=>e.absentAM||e.absentFullDay).length,r=g.filter(e=>e.absentPM||e.absentFullDay).length;return{staffAbsentAM:e,staffAbsentPM:t,clientsAbsentAM:n,clientsAbsentPM:r,staffPresent:h.length-e-t+h.filter(e=>e.absentFullDay).length,clientsPresent:g.length-n-r+g.filter(e=>e.absentFullDay).length}},[h,g]),f=(e,t,n)=>{const r={absentAM:e.absentAM||!1,absentPM:e.absentPM||!1,absentFullDay:e.absentFullDay||!1};"absentFullDay"===t?(r.absentFullDay=n,r.absentAM=n,r.absentPM=n):"absentAM"===t?(r.absentAM=n,n||r.absentPM||(r.absentFullDay=!1)):"absentPM"===t&&(r.absentPM=n,n||r.absentAM||(r.absentFullDay=!1)),a(e.id,r)},p=(e,t,n)=>{const r={absentAM:e.absentAM||!1,absentPM:e.absentPM||!1,absentFullDay:e.absentFullDay||!1};"absentFullDay"===t?(r.absentFullDay=n,r.absentAM=n,r.absentPM=n):"absentAM"===t?(r.absentAM=n,n||r.absentPM||(r.absentFullDay=!1)):"absentPM"===t&&(r.absentPM=n,n||r.absentAM||(r.absentFullDay=!1)),i(e.id,r)},y=e=>{const t=e.getAttendanceStatus();return"Present"===t?(0,rh.jsxs)("span",{className:"px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium flex items-center gap-1",children:[(0,rh.jsx)(Ah,{className:"w-3 h-3"}),"Present"]}):"Absent Full Day"===t?(0,rh.jsxs)("span",{className:"px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs font-medium flex items-center gap-1",children:[(0,rh.jsx)(Ih,{className:"w-3 h-3"}),"Absent Full Day"]}):"Absent AM"===t?(0,rh.jsxs)("span",{className:"px-2 py-1 bg-orange-100 text-orange-800 rounded-full text-xs font-medium flex items-center gap-1",children:[(0,rh.jsx)(Th,{className:"w-3 h-3"}),"Absent AM"]}):"Absent PM"===t?(0,rh.jsxs)("span",{className:"px-2 py-1 bg-orange-100 text-orange-800 rounded-full text-xs font-medium flex items-center gap-1",children:[(0,rh.jsx)(Th,{className:"w-3 h-3"}),"Absent PM"]}):void 0};return(0,rh.jsxs)("div",{className:"bg-white rounded-lg shadow-lg",children:[(0,rh.jsxs)("div",{className:"bg-purple-600 text-white p-4 rounded-t-lg",children:[(0,rh.jsxs)("h2",{className:"text-xl font-bold flex items-center gap-2",children:[(0,rh.jsx)(k,{className:"w-5 h-5"}),"Attendance Management"]}),(0,rh.jsx)("p",{className:"text-purple-100 text-sm mt-1",children:new Date(o).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),(0,rh.jsxs)("div",{className:"p-6",children:[(0,rh.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[(0,rh.jsxs)("div",{className:"bg-blue-50 rounded-lg p-4",children:[(0,rh.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:h.length}),(0,rh.jsx)("div",{className:"text-sm text-blue-800",children:"Total Staff"}),(0,rh.jsxs)("div",{className:"text-xs text-blue-600 mt-1",children:[m.staffAbsentAM+m.staffAbsentPM," absent today"]})]}),(0,rh.jsxs)("div",{className:"bg-green-50 rounded-lg p-4",children:[(0,rh.jsx)("div",{className:"text-2xl font-bold text-green-600",children:g.length}),(0,rh.jsx)("div",{className:"text-sm text-green-800",children:"Total Clients"}),(0,rh.jsxs)("div",{className:"text-xs text-green-600 mt-1",children:[m.clientsAbsentAM+m.clientsAbsentPM," absent today"]})]}),(0,rh.jsxs)("div",{className:"bg-orange-50 rounded-lg p-4",children:[(0,rh.jsx)("div",{className:"text-2xl font-bold text-orange-600",children:m.staffAbsentAM+m.clientsAbsentAM}),(0,rh.jsx)("div",{className:"text-sm text-orange-800",children:"Absent AM"}),(0,rh.jsxs)("div",{className:"text-xs text-orange-600 mt-1",children:[m.staffAbsentAM," staff, ",m.clientsAbsentAM," clients"]})]}),(0,rh.jsxs)("div",{className:"bg-purple-50 rounded-lg p-4",children:[(0,rh.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:m.staffAbsentPM+m.clientsAbsentPM}),(0,rh.jsx)("div",{className:"text-sm text-purple-800",children:"Absent PM"}),(0,rh.jsxs)("div",{className:"text-xs text-purple-600 mt-1",children:[m.staffAbsentPM," staff, ",m.clientsAbsentPM," clients"]})]})]}),(0,rh.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[(0,rh.jsxs)("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[(0,rh.jsxs)("button",{onClick:()=>c("staff"),className:"px-4 py-2 rounded-md text-sm font-medium transition-colors ".concat("staff"===l?"bg-white text-purple-600 shadow-sm":"text-gray-600 hover:text-gray-900"),children:[(0,rh.jsx)(v,{className:"w-4 h-4 inline mr-2"}),"Staff (",h.length,")"]}),(0,rh.jsxs)("button",{onClick:()=>c("clients"),className:"px-4 py-2 rounded-md text-sm font-medium transition-colors ".concat("clients"===l?"bg-white text-purple-600 shadow-sm":"text-gray-600 hover:text-gray-900"),children:[(0,rh.jsx)(dh,{className:"w-4 h-4 inline mr-2"}),"Clients (",g.length,")"]})]}),(0,rh.jsx)("input",{type:"text",value:u,onChange:e=>d(e.target.value),placeholder:"Search...",className:"flex-1 px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500"}),s&&(0,rh.jsx)("button",{onClick:()=>{window.confirm("Clear all attendance for all staff and clients? This will mark everyone as present.")&&s()},className:"px-4 py-2 bg-red-50 text-red-600 border border-red-200 rounded-md hover:bg-red-100 transition-colors font-medium whitespace-nowrap",children:"Reset All"})]}),"staff"===l&&(0,rh.jsx)("div",{className:"space-y-3",children:0===h.length?(0,rh.jsx)("div",{className:"text-center py-8 text-gray-500",children:"No staff members found"}):h.map(e=>(0,rh.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4 hover:border-purple-300 transition-colors",children:[(0,rh.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,rh.jsxs)("div",{className:"flex items-center gap-3",children:[(0,rh.jsx)("div",{className:"w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center text-white font-medium",children:e.name.charAt(0)}),(0,rh.jsxs)("div",{children:[(0,rh.jsx)("h3",{className:"font-semibold text-gray-900",children:e.name}),(0,rh.jsx)("span",{className:"text-sm text-gray-600",children:e.role})]})]}),y(e)]}),(0,rh.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,rh.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,rh.jsx)("input",{type:"checkbox",checked:e.absentAM||e.absentFullDay,onChange:t=>f(e,"absentAM",t.target.checked),disabled:e.absentFullDay,className:"rounded border-gray-300 text-orange-600 focus:ring-orange-500"}),(0,rh.jsx)("span",{className:"text-sm text-gray-700",children:"Absent AM"})]}),(0,rh.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,rh.jsx)("input",{type:"checkbox",checked:e.absentPM||e.absentFullDay,onChange:t=>f(e,"absentPM",t.target.checked),disabled:e.absentFullDay,className:"rounded border-gray-300 text-purple-600 focus:ring-purple-500"}),(0,rh.jsx)("span",{className:"text-sm text-gray-700",children:"Absent PM"})]}),(0,rh.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,rh.jsx)("input",{type:"checkbox",checked:e.absentFullDay,onChange:t=>f(e,"absentFullDay",t.target.checked),className:"rounded border-gray-300 text-red-600 focus:ring-red-500"}),(0,rh.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:"Full Day"})]})]})]},e.id))}),"clients"===l&&(0,rh.jsx)("div",{className:"space-y-3",children:0===g.length?(0,rh.jsx)("div",{className:"text-center py-8 text-gray-500",children:"No clients found"}):g.map(e=>(0,rh.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4 hover:border-purple-300 transition-colors",children:[(0,rh.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,rh.jsxs)("div",{className:"flex items-center gap-3",children:[(0,rh.jsx)("div",{className:"w-10 h-10 bg-green-500 rounded-full flex items-center justify-center text-white font-medium",children:e.name.charAt(0)}),(0,rh.jsxs)("div",{children:[(0,rh.jsx)("h3",{className:"font-semibold text-gray-900",children:e.name}),(0,rh.jsxs)("div",{className:"flex items-center gap-2",children:[(0,rh.jsx)("span",{className:"text-sm text-gray-600",children:e.program}),(0,rh.jsxs)("span",{className:"text-xs bg-gray-100 text-gray-700 px-2 py-0.5 rounded",children:["AM: ",e.ratioAM]}),(0,rh.jsxs)("span",{className:"text-xs bg-gray-100 text-gray-700 px-2 py-0.5 rounded",children:["PM: ",e.ratioPM]})]})]})]}),y(e)]}),(0,rh.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,rh.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,rh.jsx)("input",{type:"checkbox",checked:e.absentAM||e.absentFullDay,onChange:t=>p(e,"absentAM",t.target.checked),disabled:e.absentFullDay,className:"rounded border-gray-300 text-orange-600 focus:ring-orange-500"}),(0,rh.jsx)("span",{className:"text-sm text-gray-700",children:"Absent AM"})]}),(0,rh.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,rh.jsx)("input",{type:"checkbox",checked:e.absentPM||e.absentFullDay,onChange:t=>p(e,"absentPM",t.target.checked),disabled:e.absentFullDay,className:"rounded border-gray-300 text-purple-600 focus:ring-purple-500"}),(0,rh.jsx)("span",{className:"text-sm text-gray-700",children:"Absent PM"})]}),(0,rh.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,rh.jsx)("input",{type:"checkbox",checked:e.absentFullDay,onChange:t=>p(e,"absentFullDay",t.target.checked),className:"rounded border-gray-300 text-red-600 focus:ring-red-500"}),(0,rh.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:"Full Day"})]})]})]},e.id))}),(0,rh.jsx)("div",{className:"mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,rh.jsxs)("div",{className:"flex items-start gap-2",children:[(0,rh.jsx)(Th,{className:"w-5 h-5 text-blue-600 mt-0.5"}),(0,rh.jsxs)("div",{className:"text-sm text-blue-800",children:[(0,rh.jsx)("p",{className:"font-medium mb-1",children:"Attendance Notes:"}),(0,rh.jsxs)("ul",{className:"list-disc list-inside space-y-1 text-blue-700",children:[(0,rh.jsx)("li",{children:'Marking "Full Day" will automatically mark both AM and PM as absent'}),(0,rh.jsx)("li",{children:"Absent staff will be excluded from auto-scheduling"}),(0,rh.jsx)("li",{children:"Absent clients will not be assigned staff in auto-scheduling"}),(0,rh.jsx)("li",{children:"Attendance changes are saved immediately"})]})]})]})})]})]})},Eh=[new D({id:1,name:"Sarah Johnson",role:"RBT",primaryProgram:!0,secondaryProgram:!1,isActive:!0}),new D({id:2,name:"Mike Chen",role:"RBT",primaryProgram:!0,secondaryProgram:!1,isActive:!0}),new D({id:3,name:"Emily Rodriguez",role:"RBT",primaryProgram:!1,secondaryProgram:!0,isActive:!0}),new D({id:4,name:"David Kim",role:"RBT",primaryProgram:!0,secondaryProgram:!1,isActive:!0}),new D({id:5,name:"Jessica Williams",role:"RBT",primaryProgram:!1,secondaryProgram:!0,isActive:!0}),new D({id:6,name:"Alex Thompson",role:"RBT",primaryProgram:!0,secondaryProgram:!0,isActive:!0}),new D({id:7,name:"Maria Garcia",role:"RBT",primaryProgram:!0,secondaryProgram:!0,isActive:!0}),new D({id:8,name:"Chris Lee",role:"RBT",primaryProgram:!1,secondaryProgram:!0,isActive:!0}),new D({id:9,name:"Amanda Davis",role:"RBT",primaryProgram:!0,secondaryProgram:!1,isActive:!0}),new D({id:10,name:"Ryan Martinez",role:"RBT",primaryProgram:!1,secondaryProgram:!0,isActive:!0}),new D({id:11,name:"Nicole Brown",role:"RBT",primaryProgram:!0,secondaryProgram:!1,isActive:!0}),new D({id:12,name:"Kevin Wilson",role:"RBT",primaryProgram:!0,secondaryProgram:!1,isActive:!0}),new D({id:13,name:"Stephanie Taylor",role:"RBT",primaryProgram:!1,secondaryProgram:!0,isActive:!0}),new D({id:14,name:"Brandon White",role:"RBT",primaryProgram:!0,secondaryProgram:!1,isActive:!0}),new D({id:15,name:"Melissa Adams",role:"RBT",primaryProgram:!1,secondaryProgram:!0,isActive:!0}),new D({id:16,name:"Jordan Smith",role:"RBT",primaryProgram:!0,secondaryProgram:!1,isActive:!0}),new D({id:17,name:"Taylor Jones",role:"RBT",primaryProgram:!1,secondaryProgram:!0,isActive:!0}),new D({id:18,name:"Morgan Clark",role:"RBT",primaryProgram:!0,secondaryProgram:!1,isActive:!0}),new D({id:19,name:"Casey Green",role:"RBT",primaryProgram:!0,secondaryProgram:!1,isActive:!0}),new D({id:20,name:"Riley Miller",role:"RBT",primaryProgram:!1,secondaryProgram:!0,isActive:!0}),new D({id:41,name:"Dr. Jennifer Parker",role:"BS",primaryProgram:!0,secondaryProgram:!0,isActive:!0}),new D({id:42,name:"Lisa Anderson",role:"BS",primaryProgram:!0,secondaryProgram:!1,isActive:!0}),new D({id:43,name:"Mark Roberts",role:"BS",primaryProgram:!1,secondaryProgram:!0,isActive:!0}),new D({id:44,name:"Amy Foster",role:"BS",primaryProgram:!0,secondaryProgram:!1,isActive:!0}),new D({id:45,name:"Daniel Cooper",role:"BS",primaryProgram:!1,secondaryProgram:!0,isActive:!0}),new D({id:61,name:"Dr. Michael Stevens",role:"BCBA",primaryProgram:!0,secondaryProgram:!0,isActive:!0}),new D({id:62,name:"Dr. Sarah Mitchell",role:"BCBA",primaryProgram:!0,secondaryProgram:!1,isActive:!0}),new D({id:63,name:"Dr. Robert Turner",role:"BCBA",primaryProgram:!1,secondaryProgram:!0,isActive:!0}),new D({id:64,name:"Dr. Linda Campbell",role:"BCBA",primaryProgram:!0,secondaryProgram:!0,isActive:!0}),new D({id:71,name:"Carol Henderson",role:"EA",primaryProgram:!0,secondaryProgram:!1,isActive:!0}),new D({id:72,name:"Janet Phillips",role:"EA",primaryProgram:!1,secondaryProgram:!0,isActive:!0}),new D({id:73,name:"Robert Evans",role:"EA",primaryProgram:!0,secondaryProgram:!1,isActive:!0}),new D({id:76,name:"Patricia Young",role:"MHA",primaryProgram:!0,secondaryProgram:!0,isActive:!0}),new D({id:77,name:"Thomas Hall",role:"MHA",primaryProgram:!1,secondaryProgram:!0,isActive:!0}),new D({id:78,name:"Michelle Lewis",role:"CC",primaryProgram:!0,secondaryProgram:!0,isActive:!0}),new D({id:79,name:"Elizabeth Murphy",role:"Teacher",primaryProgram:!0,secondaryProgram:!0,isActive:!0}),new D({id:80,name:"James Wilson",role:"Director",primaryProgram:R.PRIMARY,secondaryProgram:R.SECONDARY,isActive:!0})],Nh=[new L({id:101,name:"Alex Martinez",program:R.PRIMARY,ratio:j.ONE_TO_ONE,isActive:!0}),new L({id:102,name:"Emma Thompson",program:R.PRIMARY,ratio:j.ONE_TO_ONE,isActive:!0}),new L({id:103,name:"Liam Johnson",program:R.PRIMARY,ratio:j.TWO_TO_ONE,isActive:!0}),new L({id:104,name:"Sophie Chen",program:R.PRIMARY,ratio:j.ONE_TO_ONE,isActive:!0}),new L({id:105,name:"Noah Davis",program:R.PRIMARY,ratio:j.ONE_TO_TWO,isActive:!0}),new L({id:106,name:"Isabella Garcia",program:R.PRIMARY,ratio:j.ONE_TO_TWO,isActive:!0}),new L({id:107,name:"Mason Williams",program:R.PRIMARY,ratio:j.ONE_TO_ONE,isActive:!0}),new L({id:108,name:"Olivia Brown",program:R.PRIMARY,ratio:j.TWO_TO_ONE,isActive:!0}),new L({id:109,name:"Lucas Wilson",program:R.PRIMARY,ratio:j.ONE_TO_ONE,isActive:!0,pairedWith:110}),new L({id:110,name:"Ava Rodriguez",program:R.PRIMARY,ratio:j.ONE_TO_ONE,isActive:!0,pairedWith:109}),new L({id:111,name:"Ethan Taylor",program:R.PRIMARY,ratio:j.ONE_TO_ONE,isActive:!0}),new L({id:112,name:"Mia Anderson",program:R.PRIMARY,ratio:j.ONE_TO_TWO,isActive:!0}),new L({id:113,name:"Jacob Miller",program:R.PRIMARY,ratio:j.ONE_TO_TWO,isActive:!0}),new L({id:114,name:"Charlotte Lee",program:R.PRIMARY,ratio:j.ONE_TO_ONE,isActive:!0,pairedWith:115}),new L({id:115,name:"Michael White",program:R.PRIMARY,ratio:j.ONE_TO_ONE,isActive:!0,pairedWith:114}),new L({id:116,name:"Amelia Harris",program:R.PRIMARY,ratio:j.TWO_TO_ONE,isActive:!0}),new L({id:117,name:"Benjamin Clark",program:R.PRIMARY,ratio:j.ONE_TO_ONE,isActive:!0}),new L({id:118,name:"Harper Lewis",program:R.PRIMARY,ratio:j.ONE_TO_ONE,isActive:!0}),new L({id:119,name:"Daniel Walker",program:R.PRIMARY,ratio:j.ONE_TO_ONE,isActive:!0}),new L({id:120,name:"Ella Young",program:R.PRIMARY,ratio:j.ONE_TO_ONE,isActive:!0}),new L({id:121,name:"Matthew King",program:R.PRIMARY,ratio:j.ONE_TO_ONE,isActive:!0}),new L({id:122,name:"Avery Scott",program:R.PRIMARY,ratio:j.ONE_TO_TWO,isActive:!0}),new L({id:123,name:"Logan Green",program:R.PRIMARY,ratio:j.ONE_TO_TWO,isActive:!0}),new L({id:124,name:"Luna Adams",program:R.PRIMARY,ratio:j.ONE_TO_ONE,isActive:!0}),new L({id:125,name:"Owen Baker",program:R.PRIMARY,ratio:j.ONE_TO_ONE,isActive:!0}),new L({id:126,name:"Layla Hall",program:R.PRIMARY,ratio:j.ONE_TO_ONE,isActive:!0}),new L({id:127,name:"Carter Rivera",program:R.PRIMARY,ratio:j.TWO_TO_ONE,isActive:!0}),new L({id:128,name:"Zoe Campbell",program:R.PRIMARY,ratio:j.ONE_TO_ONE,isActive:!0}),new L({id:129,name:"Grayson Nelson",program:R.PRIMARY,ratio:j.ONE_TO_ONE,isActive:!0}),new L({id:130,name:"Lily Mitchell",program:R.PRIMARY,ratio:j.ONE_TO_ONE,isActive:!0}),new L({id:201,name:"Adrian Torres",program:R.SECONDARY,ratio:j.ONE_TO_ONE,isActive:!0,pairedWith:202}),new L({id:202,name:"Cesar Flores",program:R.SECONDARY,ratio:j.ONE_TO_ONE,isActive:!0,pairedWith:201}),new L({id:203,name:"Maya Patel",program:R.SECONDARY,ratio:j.TWO_TO_ONE,isActive:!0}),new L({id:204,name:"Diego Santos",program:R.SECONDARY,ratio:j.ONE_TO_ONE,isActive:!0}),new L({id:205,name:"Zara Ahmed",program:R.SECONDARY,ratio:j.ONE_TO_TWO,isActive:!0}),new L({id:206,name:"Kai Thompson",program:R.SECONDARY,ratio:j.ONE_TO_TWO,isActive:!0}),new L({id:207,name:"Nora Kim",program:R.SECONDARY,ratio:j.ONE_TO_ONE,isActive:!0}),new L({id:208,name:"Mateo Gonzalez",program:R.SECONDARY,ratio:j.ONE_TO_ONE,isActive:!0}),new L({id:209,name:"Aria Parker",program:R.SECONDARY,ratio:j.TWO_TO_ONE,isActive:!0}),new L({id:210,name:"Felix Rodriguez",program:R.SECONDARY,ratio:j.ONE_TO_ONE,isActive:!0}),new L({id:211,name:"Ivy Chen",program:R.SECONDARY,ratio:j.ONE_TO_ONE,isActive:!0}),new L({id:212,name:"Jaxon Davis",program:R.SECONDARY,ratio:j.ONE_TO_TWO,isActive:!0}),new L({id:213,name:"Vera Martinez",program:R.SECONDARY,ratio:j.ONE_TO_TWO,isActive:!0}),new L({id:214,name:"Ezra Wilson",program:R.SECONDARY,ratio:j.ONE_TO_ONE,isActive:!0}),new L({id:215,name:"Sage Anderson",program:R.SECONDARY,ratio:j.ONE_TO_ONE,isActive:!0}),new L({id:216,name:"Phoenix Taylor",program:R.SECONDARY,ratio:j.ONE_TO_ONE,isActive:!0}),new L({id:217,name:"River Johnson",program:R.SECONDARY,ratio:j.TWO_TO_ONE,isActive:!0}),new L({id:218,name:"Luna Garcia",program:R.SECONDARY,ratio:j.ONE_TO_ONE,isActive:!0}),new L({id:219,name:"Atlas Brown",program:R.SECONDARY,ratio:j.ONE_TO_ONE,isActive:!0}),new L({id:220,name:"Nova Lee",program:R.SECONDARY,ratio:j.ONE_TO_ONE,isActive:!0})],_h=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date;const t=new q({date:e});return[{staffId:1,studentId:101,session:"AM",program:R.PRIMARY},{staffId:2,studentId:102,session:"AM",program:R.PRIMARY},{staffId:4,studentId:107,session:"AM",program:R.PRIMARY},{staffId:9,studentId:101,session:"PM",program:R.PRIMARY},{staffId:11,studentId:102,session:"PM",program:R.PRIMARY},{staffId:3,studentId:201,session:"AM",program:R.SECONDARY},{staffId:5,studentId:202,session:"AM",program:R.SECONDARY}].forEach((n,r)=>{const o=new F({id:"test_".concat(r+1),staffId:n.staffId,studentId:n.studentId,session:n.session,program:n.program,date:e,isLocked:!1,assignedBy:"manual"});t.addAssignment(o)}),t.lockAssignment("test_1"),t.lockAssignment("test_6"),t},Mh=()=>({validScenario:{description:"All constraints satisfied",schedule:_h(),expectedErrors:0,expectedWarnings:0},sameDayViolation:{description:"Staff assigned to same student twice in one day",schedule:(()=>{const e=_h(),t=new F({id:"violation_1",staffId:1,studentId:101,session:"PM",program:R.PRIMARY,date:new Date,isLocked:!1,assignedBy:"manual"});return e.addAssignment(t),e})(),expectedErrors:1,expectedWarnings:0},ratioViolation:{description:"2:1 student with only one staff assigned",schedule:(()=>{const e=new q({date:new Date}),t=new F({id:"ratio_violation",staffId:1,studentId:103,session:"AM",program:R.PRIMARY,date:new Date,isLocked:!1,assignedBy:"manual"});return e.addAssignment(t),e})(),expectedErrors:1,expectedWarnings:0}});class Rh{constructor(){this.testResults=[],this.autoAssignEngine=new Zd,this.autoAssignEngine.setDebugMode(!0)}async runAllTests(){return console.log("\ud83e\uddea Starting ABA Scheduler Test Suite...\n"),this.testResults=[],await this.testDataModels(),await this.testValidationRules(),await this.testAutoAssignment(),await this.testPerformance(),await this.testIntegration(),this.printSummary(),this.testResults}async testDataModels(){console.log("\ud83d\udccb Testing Data Models..."),this.test("Staff role hierarchy",()=>{const e=Eh.find(e=>"RBT"===e.role),t=Eh.find(e=>"BCBA"===e.role),n=Eh.find(e=>"Director"===e.role);return e.getRoleLevel()<t.getRoleLevel()&&t.getRoleLevel()<n.getRoleLevel()}),this.test("Staff program qualification",()=>{const e=Eh[0],t=e.canWorkProgram("Primary"),n=e.canWorkProgram("Secondary");return(!e.primaryProgram||t)&&(!e.secondaryProgram||n)}),this.test("Student ratio requirements",()=>{const e=Nh.find(e=>"1:1"===e.ratio),t=Nh.find(e=>"2:1"===e.ratio),n=Nh.find(e=>"1:2"===e.ratio);return!e.requiresMultipleStaff()&&t.requiresMultipleStaff()&&n.isSmallGroup()}),this.test("Schedule assignment management",()=>{const e=_h(),t=e.assignments.length,n={id:"test_new",staffId:99,studentId:199,session:"AM",program:"Primary",date:new Date};return e.addAssignment(n),e.removeAssignment("test_new"),e.assignments.length===t}),this.test("Assignment ID generation",()=>{const e=U.generateAssignmentId();return e!==U.generateAssignmentId()&&e.includes("assignment_")}),this.test("Staff hierarchy sorting",()=>{const e=U.sortStaffByHierarchy(Eh.slice(0,5));for(let t=1;t<e.length;t++)if(e[t].getRoleLevel()<e[t-1].getRoleLevel())return!1;return!0}),console.log("\u2705 Data Models tests completed\n")}async testValidationRules(){console.log("\ud83d\udd0d Testing Validation Rules...");const e=Mh();this.test("Valid schedule passes validation",()=>{const t=e.validScenario;return z.validateSchedule(t.schedule,Eh,Nh).length===t.expectedErrors}),this.test("Same-day violation detected",()=>{const t=e.sameDayViolation;return z.validateSchedule(t.schedule,Eh,Nh).length>=t.expectedErrors}),this.test("Ratio violation detected",()=>{const t=e.ratioViolation;return z.validateSchedule(t.schedule,Eh,Nh).length>=t.expectedErrors}),this.test("Individual assignment validation",()=>{const e=_h(),t=e.assignments[0],n=new q({date:e.date,assignments:e.assignments.filter(e=>e.id!==t.id),lockedAssignments:e.lockedAssignments,isFinalized:e.isFinalized});return 0===z.validateAssignment(t,n,Eh,Nh).length}),console.log("\u2705 Validation Rules tests completed\n")}async testAutoAssignment(){console.log("\ud83e\udd16 Testing Auto-Assignment..."),this.test("Auto-assignment creates assignments",async()=>{const e=_h(),t=(e.assignments.length,await this.autoAssignEngine.autoAssignSchedule(e,Eh,Nh));return t&&t.assignments&&t.assignments.length>=0}),this.test("Auto-assignment respects staff hierarchy",async()=>{const e=_h(),t=Nh.find(t=>"1:1"===t.ratio&&!e.assignments.some(e=>e.studentId===t.id));if(!t)return!0;const n=await this.autoAssignEngine.autoAssignSchedule(e,Eh,Nh);if(!n||!n.assignments)return!1;const r=n.assignments.find(e=>e.studentId===t.id);if(r){const e=Eh.find(e=>e.id===r.staffId);return e&&e.canWorkProgram(r.program)}return!0}),this.test("Auto-assignment respects constraints",async()=>{const e=_h(),t=await this.autoAssignEngine.autoAssignSchedule(e,Eh,Nh);if(!t||!t.assignments)return!1;const n=[...e.assignments,...t.assignments];return 0===z.validateSchedule(c(c({},e),{},{assignments:n}),Eh,Nh).length}),this.test("Auto-assignment preserves locked assignments",async()=>{const e=_h(),t=[...e.lockedAssignments],n=await this.autoAssignEngine.autoAssignSchedule(e,Eh,Nh);return!(!n||!n.assignments)&&t.every(t=>e.assignments.some(e=>e.id===t))}),console.log("\u2705 Auto-Assignment tests completed\n")}async testPerformance(){console.log("\u26a1 Testing Performance..."),this.test("Handles large datasets efficiently",async()=>{const e=Date.now(),t=Eh.slice(0,20),n=Nh.slice(0,15),r=_h(),o=await this.autoAssignEngine.autoAssignSchedule(r,t,n),a=Date.now()-e;return console.log("  Auto-assignment completed in ".concat(a,"ms")),o&&o.assignments&&a<5e3}),this.test("Validation performs efficiently",()=>{const e=_h(),t=Date.now();for(let r=0;r<10;r++)z.validateSchedule(e,Eh,Nh);const n=Date.now()-t;return console.log("  10 validation runs completed in ".concat(n,"ms")),n<1e3}),console.log("\u2705 Performance tests completed\n")}async testIntegration(){console.log("\ud83d\udd17 Testing Integration Scenarios..."),this.test("Complete scheduling workflow",async()=>{const e=_h();e.assignments.length;e.assignments.length>0&&e.lockAssignment(e.assignments[0].id);const t=await this.autoAssignEngine.autoAssignSchedule(e,Eh,Nh);if(!t||!t.assignments)return!1;const n=z.validateSchedule(e,Eh,Nh);return t.assignments.length>=0&&0===n.length}),this.test("Handles mixed ratio requirements",async()=>{const e=_h(),t=Nh.filter(e=>"1:1"===e.ratio),n=Nh.filter(e=>"2:1"===e.ratio),r=Nh.filter(e=>"1:2"===e.ratio);console.log("  Testing with ".concat(t.length," 1:1, ").concat(n.length," 2:1, ").concat(r.length," 1:2 students"));const o=await this.autoAssignEngine.autoAssignSchedule(e,Eh,Nh);return o&&o.errors&&0===o.errors.length}),this.test("Maintains program separation",async()=>{const e=_h(),t=await this.autoAssignEngine.autoAssignSchedule(e,Eh,Nh);if(!t||!t.assignments)return!1;const n=[...e.assignments,...t.assignments].filter(e=>"Primary"===e.program).every(e=>{const t=Eh.find(t=>t.id===e.staffId);return t&&t.canWorkProgram("Primary")}),r=[...e.assignments,...t.assignments].filter(e=>"Secondary"===e.program).every(e=>{const t=Eh.find(t=>t.id===e.staffId);return t&&t.canWorkProgram("Secondary")});return n&&r}),console.log("\u2705 Integration tests completed\n")}test(e,t){try{const n=Date.now(),r=t(),o=Date.now()-n;return r instanceof Promise?r.then(t=>{const r=Date.now()-n;return this.recordTest(e,t,null,r),t}).catch(t=>{const r=Date.now()-n;return this.recordTest(e,!1,t,r),!1}):(this.recordTest(e,r,null,o),r)}catch(n){return this.recordTest(e,!1,n,0),!1}}recordTest(e,t,n,r){const o={name:e,passed:t,error:n?n.message:null,duration:r};this.testResults.push(o);const a=t?"\u2705":"\u274c",i=r>0?" (".concat(r,"ms)"):"";console.log("  ".concat(a," ").concat(e).concat(i)),n&&console.log("    Error: ".concat(n.message))}printSummary(){const e=this.testResults.filter(e=>e.passed).length,t=this.testResults.length-e,n=this.testResults.reduce((e,t)=>e+t.duration,0);console.log("\n\ud83d\udcca Test Summary:"),console.log("   Total Tests: ".concat(this.testResults.length)),console.log("   Passed: ".concat(e)),console.log("   Failed: ".concat(t)),console.log("   Total Duration: ".concat(n,"ms")),console.log("   Success Rate: ".concat((e/this.testResults.length*100).toFixed(1),"%")),t>0&&(console.log("\n\u274c Failed Tests:"),this.testResults.filter(e=>!e.passed).forEach(e=>{console.log("   - ".concat(e.name,": ").concat(e.error||"Unknown error"))})),console.log(0===t?"\n\ud83c\udf89 All tests passed!":"\n\u26a0\ufe0f  Some tests failed.")}generateReport(){return{summary:{total:this.testResults.length,passed:this.testResults.filter(e=>e.passed).length,failed:this.testResults.filter(e=>!e.passed).length,duration:this.testResults.reduce((e,t)=>e+t.duration,0)},results:this.testResults,timestamp:(new Date).toISOString()}}}class Oh extends r.Component{constructor(e){super(e),this.handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null}),this.props.onReset&&this.props.onReset()},this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,t){console.error("Error caught by boundary:",e,t),this.setState({error:e,errorInfo:t})}render(){return this.state.hasError?(0,rh.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center p-4",children:(0,rh.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-2xl w-full",children:[(0,rh.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,rh.jsx)(nh,{className:"text-red-500",size:32}),(0,rh.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Something went wrong"})]}),(0,rh.jsx)("p",{className:"text-gray-700 mb-4",children:"The application encountered an unexpected error. This has been logged for review."}),this.state.error&&(0,rh.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded p-4 mb-4",children:[(0,rh.jsx)("h3",{className:"font-semibold text-red-900 mb-2",children:"Error Details:"}),(0,rh.jsx)("pre",{className:"text-sm text-red-800 overflow-auto",children:this.state.error.toString()})]}),!1,(0,rh.jsxs)("div",{className:"flex gap-3",children:[(0,rh.jsx)("button",{onClick:this.handleReset,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Try Again"}),(0,rh.jsx)("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors",children:"Reload Page"})]}),(0,rh.jsx)("div",{className:"mt-6 pt-6 border-t border-gray-200",children:(0,rh.jsx)("p",{className:"text-sm text-gray-600",children:"If this problem persists, please contact support with the error details above."})})]})}):this.props.children}}const jh=Oh,Dh=()=>{const[e]=(0,r.useState)({siteUrl:"https://evokebehavioralhealthcom.sharepoint.com/sites/Clinistrators",staffListName:"Staff",studentsListName:"Clients",scheduleListName:"ABASchedules",clientId:"c9f70b7e-8ffb-403d-af93-80b95b38a0bb",tenantId:"a4adcc38-7b4e-485c-80f9-7d9ca4e83d64",redirectUri:"localhost"===window.location.hostname?"http://localhost:3000":"https://mlr3037.github.io/EvokeSchedule2.0"}),[t]=(0,r.useState)(()=>new $d(e)),[n]=(0,r.useState)(()=>new Xd(e)),[o]=(0,r.useState)(()=>new Zd),[a,i]=(0,r.useState)(!1),[s,l]=(0,r.useState)(null),[u,d]=(0,r.useState)([]),[h,g]=(0,r.useState)([]),[m,f]=(0,r.useState)(new Date),[p,y]=(0,r.useState)(new q({date:new Date})),[_,M]=(0,r.useState)("schedule"),[R,O]=(0,r.useState)(!1),[j,z]=(0,r.useState)(!1),[H,B]=(0,r.useState)(!1),[W,K]=(0,r.useState)(null),[V,G]=(0,r.useState)(!1),[Q,Y]=(0,r.useState)(!1),[J,$]=(0,r.useState)(null),[X,Z]=(0,r.useState)(null),[ee,te]=(0,r.useState)(!1),[ne,re]=(0,r.useState)(null),[oe,ae]=(0,r.useState)(!1);(0,r.useEffect)(()=>{ie()},[]);const ie=async()=>{try{await t.initializeMSAL();const e=await t.checkAuthentication();i(e),l(t.accessToken),t.accessToken&&n.setAccessToken(t.accessToken),e&&await se()}catch(e){console.error("Error initializing app:",e),(e.message.includes("session has expired")||e.message.includes("Authentication"))&&(i(!1),l(null))}},se=async()=>{O(!0);try{const[e,n,r]=await Promise.all([t.loadStaff().catch(e=>(console.error("Failed to load staff:",e),[])),t.loadStudents().catch(e=>(console.error("Failed to load students:",e),[])),t.loadSchedule(m).catch(e=>(console.error("Failed to load schedule:",e),{assignments:[],date:m}))]);d(e),g(n),y(r),console.log("\u2705 Loaded ".concat(e.length," staff, ").concat(n.length," students")),0===e.length&&0===n.length&&console.warn("\u26a0\ufe0f No data loaded. Check authentication and SharePoint list names.")}catch(e){console.error("\ud83d\udca5 Error loading data:",e),d([]),g([]),y({assignments:[],date:m})}finally{O(!1)}},le=async()=>{try{const e=u.map(e=>new D(c(c({},e),{},{absentAM:!1,absentPM:!1,absentFullDay:!1}))),n=h.map(e=>new L(c(c({},e),{},{absentAM:!1,absentPM:!1,absentFullDay:!1})));d(e),g(n);const r=[...e.map(e=>t.saveStaff(e,!0).catch(t=>console.error("Failed to clear attendance for staff ".concat(e.name,":"),t))),...n.map(e=>t.saveStudent(e,!0).catch(t=>console.error("Failed to clear attendance for student ".concat(e.name,":"),t)))];await Promise.all(r),console.log("\u2705 All attendance cleared for new day")}catch(e){console.error("Error clearing attendance:",e)}},ce=async()=>{try{O(!0);await t.login()&&(i(!0),l(t.accessToken),t.accessToken&&n.setAccessToken(t.accessToken),await se())}catch(e){console.error("Login error:",e),alert("Login failed: ".concat(e.message))}finally{O(!1)}};return a?(0,rh.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,rh.jsx)("header",{className:"bg-white shadow-sm border-b border-gray-200",children:(0,rh.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,rh.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,rh.jsxs)("div",{className:"flex items-center gap-3",children:[(0,rh.jsx)(v,{className:"w-8 h-8 text-blue-600"}),(0,rh.jsxs)("div",{children:[(0,rh.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"ABA Scheduler"}),(0,rh.jsx)("p",{className:"text-sm text-gray-500",children:"Staff & Student Scheduling"})]})]}),(0,rh.jsxs)("div",{className:"flex items-center gap-4",children:[(0,rh.jsxs)("div",{className:"flex items-center gap-2",children:[(0,rh.jsx)(k,{className:"w-5 h-5 text-gray-500"}),(0,rh.jsx)("input",{type:"date",value:m.toISOString().split("T")[0],onChange:e=>(async e=>{if(f(e),a)try{m.toDateString()!==e.toDateString()&&(console.log("\ud83d\udcc5 Date changed, clearing attendance for new day..."),await le());const n=await t.loadSchedule(e);y(n)}catch(n){console.error("Error loading schedule for new date:",n)}})(new Date(e.target.value)),className:"border border-gray-300 rounded px-3 py-1 text-sm"})]}),(0,rh.jsxs)("div",{className:"flex items-center gap-2",children:[(0,rh.jsxs)("button",{onClick:async()=>{B(!0);try{const e=await o.autoAssignSchedule(p,u,h);if(e.assignments.length>0){const t=[...p.assignments,...e.assignments],n=new q({date:p.date,assignments:t,lockedAssignments:p.lockedAssignments,isFinalized:p.isFinalized});y(n)}e.errors.length>0&&console.warn("Auto-assignment errors:",e.errors)}catch(e){console.error("Auto-assignment failed:",e),alert("Auto-assignment failed. Please check the console for details.")}finally{B(!1)}},disabled:H||R,className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 disabled:opacity-50 flex items-center gap-2",children:[H?(0,rh.jsx)(b,{className:"w-4 h-4 animate-spin"}):(0,rh.jsx)(S,{className:"w-4 h-4"}),"Auto Assign"]}),(0,rh.jsxs)("button",{onClick:async()=>{z(!0);try{const e=c(c({},p),{},{date:m.toISOString().split("T")[0]});await t.saveSchedule(e)?(console.log("\u2705 Schedule saved successfully to SharePoint"),alert("Schedule saved successfully! Historical data is now available for rule checking.")):(console.log("\u2139\ufe0f Schedule save failed - check browser console for details"),alert("Failed to save schedule. Please check the browser console (F12 \u2192 Console) for detailed error information. This might be due to missing SharePoint lists, permissions, or column naming issues."))}catch(e){console.error("Error saving schedule:",e),alert("Error saving schedule: "+e.message)}finally{z(!1)}},disabled:j||R,className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 disabled:opacity-50 flex items-center gap-2",children:[j?(0,rh.jsx)(b,{className:"w-4 h-4 animate-spin"}):(0,rh.jsx)(x,{className:"w-4 h-4"}),"Save"]}),(0,rh.jsxs)("button",{onClick:se,disabled:R,className:"bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700 disabled:opacity-50 flex items-center gap-2",children:[(0,rh.jsx)(b,{className:"w-4 h-4 ".concat(R?"animate-spin":"")}),"Refresh"]}),(0,rh.jsx)("button",{onClick:()=>{localStorage.removeItem("sp_access_token"),localStorage.removeItem("sp_token_expiry"),t.accessToken=null,t.tokenExpiry=null,i(!1),l(null),alert("Authentication cache cleared. Please refresh the page and log in again.")},className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 flex items-center gap-2",title:"Clear authentication cache to fix 401 errors",children:"\ud83d\udd04 Clear Auth"})]}),(0,rh.jsx)("div",{className:"relative",children:(0,rh.jsxs)("button",{onClick:()=>{t.forceLogout(),i(!1),l(null),d([]),g([]),y(new q({date:m}))},className:"flex items-center gap-2 text-gray-700 hover:text-gray-900",children:[(0,rh.jsx)(C,{className:"w-5 h-5"}),"Sign Out"]})})]})]})})}),(0,rh.jsx)("nav",{className:"bg-white border-b border-gray-200",children:(0,rh.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,rh.jsx)("div",{className:"flex space-x-8",children:[{id:"schedule",label:"Schedule",icon:A},{id:"staff",label:"Staff",icon:v},{id:"students",label:"Students",icon:v},{id:"teams",label:"Teams",icon:v},{id:"attendance",label:"Attendance",icon:k},{id:"validation",label:"Validation",icon:I},{id:"rules",label:"Rules",icon:T},{id:"tests",label:"Tests",icon:S}].map(e=>{const t=e.icon;return(0,rh.jsxs)("button",{onClick:()=>M(e.id),className:"py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 ".concat(_===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[(0,rh.jsx)(t,{className:"w-4 h-4"}),e.label]},e.id)})})})}),(0,rh.jsxs)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[R&&(0,rh.jsxs)("div",{className:"flex justify-center items-center py-12",children:[(0,rh.jsx)(b,{className:"w-8 h-8 animate-spin text-blue-600"}),(0,rh.jsx)("span",{className:"ml-2 text-gray-600",children:"Loading..."})]}),!R&&(0,rh.jsxs)(rh.Fragment,{children:["schedule"===_&&(0,rh.jsxs)("div",{className:"space-y-6",children:[(0,rh.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6 mb-6",children:[(0,rh.jsx)(ah,{schedule:p,staff:u,students:h,session:"AM",program:"Primary"}),(0,rh.jsx)(ah,{schedule:p,staff:u,students:h,session:"PM",program:"Primary"}),(0,rh.jsx)(ah,{schedule:p,staff:u,students:h,session:"AM",program:"Secondary"}),(0,rh.jsx)(ah,{schedule:p,staff:u,students:h,session:"PM",program:"Secondary"})]}),(0,rh.jsx)(oh,{schedule:p,staff:u,students:h,onAssignmentLock:e=>{p.lockAssignment(e);const t=new q({date:p.date,assignments:[...p.assignments],lockedAssignments:new Set(p.lockedAssignments),isFinalized:p.isFinalized});y(t)},onAssignmentUnlock:e=>{p.unlockAssignment(e);const t=new q({date:p.date,assignments:[...p.assignments],lockedAssignments:new Set(p.lockedAssignments),isFinalized:p.isFinalized});y(t)},onAssignmentRemove:e=>{console.log("\ud83d\uddd1\ufe0f Removing assignment:",e),p.removeAssignment(e),p.unlockAssignment(e);const t=new q({date:p.date,assignments:[...p.assignments],lockedAssignments:new Set(p.lockedAssignments),isFinalized:p.isFinalized});y(t),console.log("\u2705 Assignment removed. Total assignments:",t.assignments.length)},onManualAssignment:e=>{let{staffId:t,studentId:n,session:r,program:o}=e;const a=new F({id:U.generateAssignmentId(),staffId:t,studentId:n,session:r,program:o,date:m,isLocked:!1,assignedBy:"manual"});p.addAssignment(a);const i=new q({date:p.date,assignments:[...p.assignments],lockedAssignments:new Set(p.lockedAssignments),isFinalized:p.isFinalized});y(i)},selectedDate:m})]}),"staff"===_&&(0,rh.jsxs)("div",{className:"space-y-6",children:[(0,rh.jsxs)("div",{className:"flex justify-between items-center",children:[(0,rh.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Staff Management"}),(0,rh.jsxs)("button",{onClick:()=>G(!0),className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 flex items-center gap-2",children:[(0,rh.jsx)(P,{className:"w-4 h-4"}),"Add Staff"]})]}),(0,rh.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4",children:[(0,rh.jsx)("h3",{className:"text-lg font-semibold text-yellow-800 mb-2",children:"Debug Information"}),(0,rh.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,rh.jsxs)("div",{children:[(0,rh.jsx)("strong",{children:"Authentication Status:"})," ",a?"\u2705 Authenticated":"\u274c Not Authenticated"]}),(0,rh.jsxs)("div",{children:[(0,rh.jsx)("strong",{children:"Access Token:"})," ",s?"\u2705 Present":"\u274c Missing"]}),(0,rh.jsxs)("div",{children:[(0,rh.jsx)("strong",{children:"Staff Count:"})," ",u.length]}),(0,rh.jsxs)("div",{children:[(0,rh.jsx)("strong",{children:"Students Count:"})," ",h.length]}),(0,rh.jsxs)("div",{className:"col-span-2",children:[(0,rh.jsx)("strong",{children:"SharePoint Site:"})," ",e.siteUrl]}),(0,rh.jsxs)("div",{children:[(0,rh.jsx)("strong",{children:"Staff List:"})," ",e.staffListName]}),(0,rh.jsxs)("div",{children:[(0,rh.jsx)("strong",{children:"Students List:"})," ",e.studentsListName]})]})]}),(0,rh.jsx)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:(0,rh.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,rh.jsx)("thead",{className:"bg-gray-50",children:(0,rh.jsxs)("tr",{children:[(0,rh.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),(0,rh.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),(0,rh.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Primary Program"}),(0,rh.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Secondary Program"}),(0,rh.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,rh.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,rh.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:u.map(e=>(0,rh.jsxs)("tr",{children:[(0,rh.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.name}),(0,rh.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.role}),(0,rh.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.primaryProgram||"-"}),(0,rh.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.secondaryProgram||"-"}),(0,rh.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,rh.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(e.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.isActive?"Active":"Inactive"})}),(0,rh.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[(0,rh.jsx)("button",{onClick:()=>$(e),className:"text-blue-600 hover:text-blue-900 mr-3",children:(0,rh.jsx)(E,{className:"w-4 h-4"})}),(0,rh.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this staff member?"))try{await t.deleteStaff(e),await se()}catch(n){console.error("Error deleting staff:",n)}})(e.id),className:"text-red-600 hover:text-red-900",children:(0,rh.jsx)(N,{className:"w-4 h-4"})})]})]},e.id))})]})})]}),"students"===_&&(0,rh.jsxs)("div",{className:"space-y-6",children:[(0,rh.jsxs)("div",{className:"flex justify-between items-center",children:[(0,rh.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Student Management"}),(0,rh.jsxs)("button",{onClick:()=>Y(!0),className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 flex items-center gap-2",children:[(0,rh.jsx)(P,{className:"w-4 h-4"}),"Add Student"]})]}),(0,rh.jsx)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:(0,rh.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,rh.jsx)("thead",{className:"bg-gray-50",children:(0,rh.jsxs)("tr",{children:[(0,rh.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),(0,rh.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Program"}),(0,rh.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ratio AM"}),(0,rh.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ratio PM"}),(0,rh.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,rh.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,rh.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:h.map(e=>(0,rh.jsxs)("tr",{children:[(0,rh.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.name}),(0,rh.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.program}),(0,rh.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(0,rh.jsx)("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs font-medium",children:e.ratioAM})}),(0,rh.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(0,rh.jsx)("span",{className:"px-2 py-1 bg-purple-100 text-purple-800 rounded text-xs font-medium",children:e.ratioPM})}),(0,rh.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,rh.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(e.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.isActive?"Active":"Inactive"})}),(0,rh.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[(0,rh.jsx)("button",{onClick:()=>Z(e),className:"text-blue-600 hover:text-blue-900 mr-3",children:(0,rh.jsx)(E,{className:"w-4 h-4"})}),(0,rh.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this student?"))try{await t.deleteStudent(e),await se()}catch(n){console.error("Error deleting student:",n)}})(e.id),className:"text-red-600 hover:text-red-900",children:(0,rh.jsx)(N,{className:"w-4 h-4"})})]})]},e.id))})]})})]}),"teams"===_&&(0,rh.jsx)(Ch,{staff:u,students:h,onEditStaff:e=>{$(e),G(!0)},onEditStudent:e=>{Z(e),Y(!0)}}),"attendance"===_&&(0,rh.jsx)(Ph,{staff:u,students:h,currentDate:m,onUpdateStaffAttendance:async(e,n)=>{try{const r=u.find(t=>t.id===e);if(!r)return void console.error("Staff member not found:",e);const o=u.map(t=>t.id===e?new D(c(c({},t),{},{absentAM:n.absentAM,absentPM:n.absentPM,absentFullDay:n.absentFullDay})):t);d(o);const a=new D(c(c({},r),{},{absentAM:n.absentAM,absentPM:n.absentPM,absentFullDay:n.absentFullDay}));await t.saveStaff(a,!0),console.log("\u2705 Staff attendance updated:",r.name,n)}catch(r){console.error("Error updating staff attendance:",r),console.warn("\u26a0\ufe0f Attendance updated locally but not saved to SharePoint")}},onUpdateStudentAttendance:async(e,n)=>{try{const r=h.find(t=>t.id===e);if(!r)return void console.error("Student not found:",e);const o=h.map(t=>t.id===e?new L(c(c({},t),{},{absentAM:n.absentAM,absentPM:n.absentPM,absentFullDay:n.absentFullDay})):t);g(o);const a=new L(c(c({},r),{},{absentAM:n.absentAM,absentPM:n.absentPM,absentFullDay:n.absentFullDay}));await t.saveStudent(a,!0),console.log("\u2705 Student attendance updated:",r.name,n)}catch(r){console.error("Error updating student attendance:",r),console.warn("\u26a0\ufe0f Attendance updated locally but not saved to SharePoint")}},onResetAllAttendance:le}),"validation"===_&&(0,rh.jsx)(lh,{schedule:p,staff:u,students:h,onValidationChange:e=>{K(e)}}),"rules"===_&&(0,rh.jsx)(uh,{}),"tests"===_&&(0,rh.jsxs)("div",{className:"space-y-6",children:[(0,rh.jsxs)("div",{className:"flex justify-between items-center",children:[(0,rh.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Test Suite"}),(0,rh.jsxs)("button",{onClick:async()=>{ae(!0),re(null);try{console.log("\ud83e\uddea Starting test suite...");const e=await(async()=>{const e=new Rh;return await e.runAllTests(),e.generateReport()})();re(e),console.log("\u2705 Test suite completed")}catch(e){console.error("\u274c Test suite failed:",e),re({summary:{total:0,passed:0,failed:1,duration:0},results:[],error:e.message})}finally{ae(!1)}},disabled:oe,className:"bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700 disabled:opacity-50 flex items-center gap-2",children:[oe?(0,rh.jsx)(b,{className:"w-5 h-5 animate-spin"}):(0,rh.jsx)(S,{className:"w-5 h-5"}),oe?"Running Tests...":"Run All Tests"]})]}),ne&&(0,rh.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,rh.jsxs)("div",{className:"mb-6",children:[(0,rh.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Test Results Summary"}),(0,rh.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,rh.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg text-center",children:[(0,rh.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:ne.summary.total}),(0,rh.jsx)("div",{className:"text-sm text-blue-800",children:"Total Tests"})]}),(0,rh.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg text-center",children:[(0,rh.jsx)("div",{className:"text-2xl font-bold text-green-600",children:ne.summary.passed}),(0,rh.jsx)("div",{className:"text-sm text-green-800",children:"Passed"})]}),(0,rh.jsxs)("div",{className:"bg-red-50 p-4 rounded-lg text-center",children:[(0,rh.jsx)("div",{className:"text-2xl font-bold text-red-600",children:ne.summary.failed}),(0,rh.jsx)("div",{className:"text-sm text-red-800",children:"Failed"})]}),(0,rh.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg text-center",children:[(0,rh.jsxs)("div",{className:"text-2xl font-bold text-gray-600",children:[ne.summary.duration,"ms"]}),(0,rh.jsx)("div",{className:"text-sm text-gray-800",children:"Duration"})]})]}),(0,rh.jsxs)("div",{className:"mt-4",children:[(0,rh.jsxs)("div",{className:"flex items-center justify-between text-sm text-gray-600 mb-1",children:[(0,rh.jsx)("span",{children:"Success Rate"}),(0,rh.jsxs)("span",{children:[ne.summary.total>0?(ne.summary.passed/ne.summary.total*100).toFixed(1):0,"%"]})]}),(0,rh.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,rh.jsx)("div",{className:"h-2 rounded-full ".concat(0===ne.summary.failed?"bg-green-500":"bg-yellow-500"),style:{width:"".concat(ne.summary.total>0?ne.summary.passed/ne.summary.total*100:0,"%")}})})]})]}),ne.results&&ne.results.length>0&&(0,rh.jsxs)("div",{children:[(0,rh.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Test Details"}),(0,rh.jsx)("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:ne.results.map((e,t)=>(0,rh.jsxs)("div",{className:"p-3 rounded border-l-4 ".concat(e.passed?"bg-green-50 border-green-400":"bg-red-50 border-red-400"),children:[(0,rh.jsxs)("div",{className:"flex items-center justify-between",children:[(0,rh.jsx)("div",{className:"flex items-center gap-2",children:(0,rh.jsxs)("span",{className:"text-sm font-medium ".concat(e.passed?"text-green-800":"text-red-800"),children:[e.passed?"\u2705":"\u274c"," ",e.name]})}),(0,rh.jsxs)("span",{className:"text-xs text-gray-500",children:[e.duration,"ms"]})]}),e.error&&(0,rh.jsx)("div",{className:"mt-2 text-sm text-red-700 font-mono bg-red-100 p-2 rounded",children:e.error})]},t))})]}),ne.error&&(0,rh.jsxs)("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded",children:[(0,rh.jsx)("h4",{className:"text-red-800 font-medium",children:"Test Suite Error"}),(0,rh.jsx)("p",{className:"text-red-700 text-sm mt-1",children:ne.error})]})]}),(0,rh.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[(0,rh.jsx)("h3",{className:"text-lg font-semibold text-blue-900 mb-3",children:"About the Test Suite"}),(0,rh.jsxs)("div",{className:"text-blue-800 space-y-2",children:[(0,rh.jsx)("p",{children:"This comprehensive test suite validates all core functionality of the ABA Scheduling System:"}),(0,rh.jsxs)("ul",{className:"list-disc list-inside space-y-1 ml-4",children:[(0,rh.jsxs)("li",{children:[(0,rh.jsx)("strong",{children:"Data Models:"})," Staff and Student object validation, role hierarchies"]}),(0,rh.jsxs)("li",{children:[(0,rh.jsx)("strong",{children:"Validation Rules:"})," Schedule constraints, ratio requirements, program separation"]}),(0,rh.jsxs)("li",{children:[(0,rh.jsx)("strong",{children:"Auto-Assignment:"})," Automated scheduling algorithms and optimization"]}),(0,rh.jsxs)("li",{children:[(0,rh.jsx)("strong",{children:"Performance:"})," Large dataset handling and response times"]}),(0,rh.jsxs)("li",{children:[(0,rh.jsx)("strong",{children:"Integration:"})," End-to-end workflow testing"]})]}),(0,rh.jsxs)("p",{className:"mt-3 text-sm",children:[(0,rh.jsx)("strong",{children:"Note:"})," Tests run using sample data and do not affect your actual schedule or database."]})]})]})]})]})]}),V&&(0,rh.jsx)(wh,{staff:J,onSave:J?async e=>{z(!0);try{const n=new D(c(c({},e),{},{id:J.id}));await t.saveStaff(n,!0),await se(),$(null),G(!1),alert("Staff member updated successfully!")}catch(n){console.error("Error updating staff:",n),alert("Failed to update staff: ".concat(n.message))}finally{z(!1)}}:async e=>{z(!0);try{const n=new D(e);await t.saveStaff(n),await se(),G(!1),alert("Staff member added successfully!")}catch(n){console.error("Error adding staff:",n),alert("Failed to add staff: ".concat(n.message))}finally{z(!1)}},onCancel:()=>{G(!1),$(null)},peoplePickerService:n}),Q&&(0,rh.jsx)(kh,{student:X,onSave:X?async e=>{z(!0);try{const n=new L(c(c({},e),{},{id:X.id}));await t.saveStudent(n,!0),await se(),Z(null),Y(!1),alert("Student updated successfully!")}catch(n){console.error("Error updating student:",n),alert("Failed to update student: ".concat(n.message))}finally{z(!1)}}:async e=>{z(!0);try{const n=new L(e);await t.saveStudent(n),await se(),Y(!1),alert("Student added successfully!")}catch(n){console.error("Error adding student:",n),alert("Failed to add student: ".concat(n.message))}finally{z(!1)}},onCancel:()=>{Y(!1),Z(null)},allStaff:u,peoplePickerService:n})]}):(0,rh.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:(0,rh.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-lg max-w-md w-full mx-4",children:[(0,rh.jsxs)("div",{className:"text-center mb-6",children:[(0,rh.jsx)(v,{className:"w-12 h-12 text-blue-600 mx-auto mb-4"}),(0,rh.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"ABA Scheduler"}),(0,rh.jsx)("p",{className:"text-gray-600",children:"Staff & Student Scheduling System"})]}),(0,rh.jsx)("button",{onClick:ce,disabled:R,className:"w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:R?(0,rh.jsxs)(rh.Fragment,{children:[(0,rh.jsx)(b,{className:"w-5 h-5 animate-spin"}),"Signing in..."]}):(0,rh.jsxs)(rh.Fragment,{children:[(0,rh.jsx)(w,{className:"w-5 h-5"}),"Sign in with Microsoft"]})}),(0,rh.jsx)("div",{className:"mt-6 text-sm text-gray-500 text-center",children:(0,rh.jsx)("p",{children:"Sign in to access the ABA scheduling system"})})]})})},Lh=()=>(0,rh.jsx)(jh,{children:(0,rh.jsx)(Dh,{})}),Fh=e=>{e&&e instanceof Function&&n.e(206).then(n.bind(n,206)).then(t=>{let{getCLS:n,getFID:r,getFCP:o,getLCP:a,getTTFB:i}=t;n(e),r(e),o(e),a(e),i(e)})};o.createRoot(document.getElementById("root")).render((0,rh.jsx)(r.StrictMode,{children:(0,rh.jsx)(Lh,{})})),Fh()})();